import{c as ce,g as de,u as Z,s as ue,C as V,W as pe}from"./BrWS3jyv.js";import ee from"./DedN-0-8.js";import{W as me,_ as ve,a as X,b as fe}from"./CShsi_j0.js";import _e from"./CGH5Dg1z.js";import ge from"./C3SGvlsi.js";import he from"./ppjqkqxj.js";import ye from"./DQYZk7pO.js";import we from"./pYcZOq89.js";import be from"./Do3DaQJ7.js";import{c as N,t as b,L as P,M as xe,N as k,_ as te,v as O,x as n,y as oe,i as Ce,O as ne,P as K,z as i,Q as Se,R as Ee,r as U,o as ke,S as z,H as Y,B as M,A as C,T as G,U as Ne,C as De,D as Te,V as $e}from"./CXKBW9bp.js";import Oe from"./BQiUPR7d.js";import"./Co5Yh9qW.js";import"./BZlV4d_H.js";import"./D6MSCDtN.js";import"./DCuKtvF5.js";import"./BhHKfS1x.js";import"./DhArhav2.js";import"./LO9d5QDA.js";import"./C9FxdTob.js";import"./CPSOXViN.js";import"./BusWVMfE.js";import"./CFp7YugP.js";import"./BpaItJhg.js";import"./BrpX9v5z.js";import"./CtsN6OKl.js";import"./DyX7Hz4p.js";import"./BzwoaQg0.js";import"./BlsdkEl4.js";import"./05y29Pbc.js";import"./Bz-gP_sh.js";import"./nFlh00AY.js";import"./Beib-58n.js";import"./Cvh5gN-8.js";import"./CEOfDmHY.js";import"./boeXk8Qw.js";import"./C1BJVgeZ.js";import"./BSz_bCp-.js";function Re(c){return new Date(c).toLocaleTimeString(void 0,{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})+"."+String(new Date(c).getMilliseconds()).padStart(3,"0")}const Ie={__name:"EventTag",props:["event"],setup(c){const d=c,g=N(()=>me[d.event]||"rgb(114,166,234)"),u=N(()=>({background:"transparent",border:"2px solid rgb(66, 75, 87)",color:g.value,"font-size":"0.9rem"})),e={"session.status":"session.status ðŸ–¥ï¸",message:"message âœ‰ï¸","message.any":"message.any âœ‰ï¸","message.ack":"message.ack ðŸ‘€"},m=N(()=>e[d.event]||d.event);return(v,l)=>{const f=be;return b(),P(f,{style:xe(k(u)),value:k(m)},null,8,["style","value"])}}},Ve={class:"truncate"},Be={__name:"EventDetail",props:["data"],setup(c){const d=c,g=N(()=>{var l,f,t,x,p;const e=d.data.payload,m=d.data,v=d.data.event;switch(v){case"session.status":return[e.status,(l=m.me)==null?void 0:l.id,(f=m.me)==null?void 0:f.pushName];case"message":case"message.any":case"message.ack":case"message.reaction":return[e.id,e.body,v==="message.ack"?e.ackName:null,v==="message.ack"?null:(t=e.reaction)==null?void 0:t.text,(x=e.media)!=null&&x.url?"ðŸ–¼":null];case"group.v2.join":return[e.group.id,JSON.stringify(e.group)];case"group.v2.leave":return[e.group.id];case"group.v2.update":return[e.group.id,JSON.stringify(e.group)];case"group.v2.participants":return[e.group.id,e.type,JSON.stringify(e.participants)];case"engine.event":return[e.event,JSON.stringify(e.data)];case"presence.update":return[e.id,(p=e.presences)==null?void 0:p[0].lastKnownPresence];default:return[]}}),u=N(()=>g.value.filter(e=>e!=null).join(" | "));return(e,m)=>(b(),O("div",Ve,[n("code",null,oe(k(u)),1)]))}},Ae=te(Be,[["__scopeId","data-v-5d65cace"]]),Ue={class:"flex gap-2"},Le={style:{"margin-top":"-0.75rem"}},je={style:{"max-width":"100%"}},Me={__name:"EventDataViewer",props:["data"],setup(c){const d=c,g=N(()=>{const e={...d.data};return delete e._json,{id:e.id,session:e.session,event:e.event,payload:e.payload,...e}});async function u(e){await navigator.clipboard.writeText(JSON.stringify(g.value,null,2)),e.preventDefault()}return(e,m)=>{const v=ee,l=Ce("vue-json-pretty"),f=ne("tooltip");return b(),O("div",Ue,[n("div",Le,[K(i(v,{rounded:"",text:"",icon:"pi pi-copy",severity:"secondary",onClick:m[0]||(m[0]=t=>u(t))},null,512),[[f,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),n("div",je,[i(l,{data:k(g),deep:2,showLine:!1,showIcon:!0,theme:"dark"},null,8,["data"])])])}}},Fe={key:0,class:"pi pi-angle-down"},Je={key:1,class:"pi pi-angle-up"},He={__name:"expand",props:["rows","data"],setup(c){const d=c,g=N(()=>{var u;return!((u=d.rows)!=null&&u[d.data.id])});return(u,e)=>k(g)?(b(),O("i",Fe)):(b(),O("i",Je))}};var se={exports:{}};(function(c,d){(function(g,u){c.exports=u()})(ce,function(){return function g(u,e,m){var v=window,l="application/octet-stream",f=m||l,t=u,x=!e&&!m&&t,p=document.createElement("a"),h=function(r){return String(r)},_=v.Blob||v.MozBlob||v.WebKitBlob||h,w=e||"download",S,E;if(_=_.call?_.bind(v):Blob,String(this)==="true"&&(t=[t,f],f=t[0],t=t[1]),x&&x.length<2048&&(w=x.split("/").pop().split("?")[0],p.href=x,p.href.indexOf(x)!==-1)){var D=new XMLHttpRequest;return D.open("GET",x,!0),D.responseType="blob",D.onload=function(r){g(r.target.response,w,l)},setTimeout(function(){D.send()},0),D}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(t))if(t.length>1024*1024*1.999&&_!==h)t=F(t),f=t.type||l;else return navigator.msSaveBlob?navigator.msSaveBlob(F(t),w):R(t);else if(/([\x80-\xff])/.test(t)){var T=0,A=new Uint8Array(t.length),L=A.length;for(T;T<L;++T)A[T]=t.charCodeAt(T);t=new _([A],{type:f})}S=t instanceof _?t:new _([t],{type:f});function F(r){var o=r.split(/[:;,]/),s=o[1],y=o[2]=="base64"?atob:decodeURIComponent,I=y(o.pop()),J=I.length,$=0,H=new Uint8Array(J);for($;$<J;++$)H[$]=I.charCodeAt($);return new _([H],{type:s})}function R(r,o){if("download"in p)return p.href=r,p.setAttribute("download",w),p.className="download-js-link",p.innerHTML="downloading...",p.style.display="none",document.body.appendChild(p),setTimeout(function(){p.click(),document.body.removeChild(p),o===!0&&setTimeout(function(){v.URL.revokeObjectURL(p.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(r)&&(r="data:"+r.replace(/^data:([\w\/\-\+]+)/,l)),window.open(r)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=r),!0;var s=document.createElement("iframe");document.body.appendChild(s),!o&&/^data:/.test(r)&&(r="data:"+r.replace(/^data:([\w\/\-\+]+)/,l)),s.src=r,setTimeout(function(){document.body.removeChild(s)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(S,w);if(v.URL)R(v.URL.createObjectURL(S),!0);else{if(typeof S=="string"||S.constructor===h)try{return R("data:"+f+";base64,"+v.btoa(S))}catch{return R("data:"+f+","+encodeURIComponent(S))}E=new FileReader,E.onload=function(r){R(this.result)},E.readAsDataURL(S)}return!0}})})(se);var We=se.exports;const Pe=de(We),B=c=>(De("data-v-8b771d31"),c=c(),Te(),c),ze={class:"mb-4"},Ge=B(()=>n("h5",{class:"flex align-items-center gap-1"},[n("i",{class:"pi pi-eye"}),n("span",{class:"mr-1"}," Event Monitor ")],-1)),Ke={class:"m-0"},qe=B(()=>n("a",{target:"_blank",href:"https://waha.devlike.pro/docs/how-to/webhooks/#events"}," WAHA Events ",-1)),Qe=B(()=>n("br",null,null,-1)),Xe=B(()=>n("b",null,"development",-1)),Ye=B(()=>n("b",null,"debugging",-1)),Ze={class:"pi pi-info-circle"},et={class:"flex justify-content-between align-items-center flex-column sm:flex-row gap-2 sm:gap-0"},tt={class:"flex flex-column sm:flex-row gap-2"},ot={class:"flex gap-2"},nt={class:"flex align-items-center justify-content-center"},st={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-2"},at={class:"p-4 text-center text-se"},it=B(()=>n("span",null," Listening for new events... ",-1)),lt=B(()=>n("i",{class:"pi pi-spin pi-spinner"},null,-1)),rt={class:"event-viewer"},ct={__name:"EventTable",setup(c){const d=Se(),g=Z(),{servers:u}=Ee(g),e=U(null);ke(async()=>{var y;for(let I=0;I<30;I++)u.value.length===0&&await ue(100);u.value.length>0&&(e.value=(y=u.value)==null?void 0:y[0].id,E())});const m=U([]),v=X.filter(o=>o!=="engine.event"),l=U({global:{value:null,matchMode:z.CONTAINS},event:{value:v,matchMode:z.IN},session:{value:null,matchMode:z.CONTAINS}}),f=["_json"],t=U(!1);function x(o){o.timestamp=o.timestamp||Date.now(),o._json=o._json||JSON.stringify(o),m.value.push(o)}Y(e,()=>{t.value&&(L(),E())});const p=N(()=>{var o;return l.value.event.value?(o=l.value.event.value)==null?void 0:o.includes("engine.event"):!0});Y(p,()=>{t.value&&(L(),E())});let h=null;const _=U(V.DISCONNECTED),w=U({}),S=o=>{const s=w.value[o.data.id]===void 0||!w.value[o.data.id],y={...w.value};s?y[o.data.id]=!0:delete y[o.data.id],w.value={...y}},E=()=>{t.value=!0,D()};function D(){if(!t.value)return;if(!e.value){d.add({severity:"warn",summary:"No server selected",detail:"Please select a server to start listening"});return}if(h){d.add({severity:"warn",summary:"Already listening",detail:"Please stop the current listener before starting a new one or refresh the page"});return}const o=g.getServer(e.value),s=["*"];p.value&&s.push("engine.event"),h=new pe(o,s),h.connect(),_.value=V.CONNECTING,h.on("open",()=>{_.value=V.CONNECTED}),h.on("close",()=>{_.value=V.DISCONNECTED,T()}),h.on("error",()=>{_.value=V.ERROR,T()}),h.on("event",x)}function T(){A(),setTimeout(()=>{D()},300)}function A(){h==null||h.stop(),h=null}const L=()=>{t.value=!1,A(),_.value=V.DISCONNECTED},F=()=>{m.value=[]},R=N(()=>`Clean Events (${m.value.length})`);function r(o){Pe(JSON.stringify(m.value,null,2),"events.json","text/plain")}return(o,s)=>{const y=ee,I=fe,J=_e,$=ge,H=he,j=ye,ae=we,ie=Ie,le=Ae,re=Oe,q=ne("tooltip");return b(),O(G,null,[n("div",ze,[Ge,n("div",null,[n("p",Ke,[M(" Monitor "),qe,M(" from your sessions in real-time! "),Qe,M(" You can use Event Monitor for "),Xe,M(" and "),Ye,M(" purposes. "),K(n("i",Ze,null,512),[[q,"Displays only new incoming events in real-time; no historical data is available."]])])])]),i(re,{value:m.value,dataKey:"id",expandedRows:w.value,"onUpdate:expandedRows":s[4]||(s[4]=a=>w.value=a),rowHover:!0,filters:l.value,"onUpdate:filters":s[5]||(s[5]=a=>l.value=a),filterDisplay:"row",globalFilterFields:f,showGridlines:"",style:{"white-space":"nowrap"},sortField:"timestamp",sortOrder:-1,resizableColumns:"",class:"p-datatable--clickable",onRowClick:S},{header:C(()=>[n("div",et,[n("div",tt,[n("div",ot,[t.value?(b(),P(y,{key:1,label:"Pause",icon:"pi pi-pause",severity:"secondary",onClick:L})):(b(),P(y,{key:0,label:"Listen",icon:"pi pi-play",severity:"success",onClick:E})),i(I,{placeholder:"Select Server",modelValue:e.value,"onUpdate:modelValue":s[0]||(s[0]=a=>e.value=a),showClear:!1},null,8,["modelValue"])]),n("div",nt,[i(ve,{status:_.value},null,8,["status"])])]),n("div",st,[K(i(y,{icon:"pi pi-download",label:"Download",onClick:s[1]||(s[1]=a=>r(a))},null,512),[[q,"Download all events as JSON"]]),i(y,{label:k(R),icon:"pi pi-trash",severity:"secondary",onClick:F},null,8,["label"]),i(H,{iconPosition:"left"},{default:C(()=>[i(J,{class:"pi pi-search"}),i($,{modelValue:l.value.global.value,"onUpdate:modelValue":s[2]||(s[2]=a=>l.value.global.value=a),placeholder:"Search in data",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])])]),empty:C(()=>[n("div",at,[_.value===k(V).CONNECTED?(b(),O(G,{key:0},[it,lt],64)):(b(),O(G,{key:1},[t.value?Ne("",!0):(b(),P(y,{key:0,label:"Listen",icon:"pi pi-play",severity:"success",onClick:E}))],64))])]),expansion:C(a=>[n("div",rt,[i(Me,{data:a.data},null,8,["data"])])]),default:C(()=>[i(j,{style:{width:"3rem"}},{body:C(({data:a})=>[i(He,{rows:w.value,data:a},null,8,["rows","data"])]),_:1}),i(j,{field:"event",header:"Event","show-filter-menu":!1},{filter:C(({filterModel:a,filterCallback:Q})=>[i(ae,{id:"events",modelValue:a.value,"onUpdate:modelValue":W=>a.value=W,placeholder:"Any","max-selected-labels":1,selectedItemsLabel:"{0} events",onChange:W=>Q(),options:k(X),showClear:!0,required:!1},null,8,["modelValue","onUpdate:modelValue","onChange","options"])]),body:C(({data:a})=>[i(ie,{event:a.event},null,8,["event"])]),_:1}),i(j,{field:"session",header:"Session","show-filter-menu":!1},{filter:C(({filterModel:a,filterCallback:Q})=>[i($,{modelValue:l.value.session.value,"onUpdate:modelValue":s[3]||(s[3]=W=>l.value.session.value=W),placeholder:"Session",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),i(j,{field:"timestamp",header:"Time",sortable:""},{body:C(({data:a})=>[n("span",null,oe(k(Re)(a.timestamp)),1)]),_:1}),i(j,{header:"Detail","show-filter-menu":!1},{body:C(({data:a})=>[i(le,{data:a},null,8,["data"])]),_:1})]),_:1},8,["value","expandedRows","filters"])],64)}}},dt=te(ct,[["__scopeId","data-v-8b771d31"]]),ut={class:"grid"},pt={class:"col-12"},mt={class:"card"},Xt={__name:"event-monitor",setup(c){const d=Z();return $e(()=>{d.refresh()}),(g,u)=>(b(),O("div",ut,[n("div",pt,[n("div",mt,[i(dt)])])]))}};export{Xt as default};
