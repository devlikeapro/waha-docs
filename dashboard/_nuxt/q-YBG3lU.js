import{c as ce,g as de,u as Z,s as ue,C as B,W as pe}from"./B5R7onfE.js";import ee from"./DcRiB3Zs.js";import{W as me,_ as ve,a as X,b as fe}from"./X2hX7WL6.js";import _e from"./CH0tkif2.js";import he from"./QexgR7ol.js";import ge from"./esjnmfDm.js";import we from"./DaWsc1Lx.js";import ye from"./C3jAflnl.js";import be from"./RjlWoQTp.js";import{c as D,t as b,L as z,M as xe,N as k,_ as te,v as R,x as n,y as oe,i as Ce,O as ne,P as K,z as l,Q as Se,R as Ee,r as U,o as ke,S as J,H as Y,B as j,A as C,T as G,U as De,C as Ne,D as Te,V as $e}from"./3wcKxrOr.js";import Re from"./CrxYxaYK.js";import"./CqvL8OFi.js";import"./FjUBiY_G.js";import"./Duu0VUuu.js";import"./B3QKI4Ro.js";import"./17EOHIWw.js";import"./Bq9XILvm.js";import"./Donu5aJY.js";import"./CaSRmfbs.js";import"./BQIR-okA.js";import"./QoULVSx3.js";import"./Gk-vn1l0.js";import"./BWgH3DTO.js";import"./Cc6m2auJ.js";import"./1wy0pC4D.js";import"./Vnx4ycj3.js";import"./DTWJJ012.js";import"./C3lO5ljT.js";import"./CB9bEY1p.js";import"./VosnKEvh.js";import"./Dtryipgj.js";import"./CxPtcwnU.js";import"./DfmAQES-.js";import"./BEbqlBdJ.js";import"./B76NYlD3.js";import"./DjzmPTjb.js";import"./WHtcA8o4.js";function Ie(c){return new Date(c).toLocaleTimeString(void 0,{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})+"."+String(new Date(c).getMilliseconds()).padStart(3,"0")}const Ve={__name:"EventTag",props:["event"],setup(c){const d=c,h=D(()=>me[d.event]||"rgb(114,166,234)"),u=D(()=>({background:"transparent",border:"2px solid rgb(66, 75, 87)",color:h.value,"font-size":"0.9rem"})),e={"session.status":"session.status ðŸ–¥ï¸",message:"message âœ‰ï¸","message.any":"message.any âœ‰ï¸","message.ack":"message.ack ðŸ‘€"},m=D(()=>e[d.event]||d.event);return(v,i)=>{const f=be;return b(),z(f,{style:xe(k(u)),value:k(m)},null,8,["style","value"])}}},Be={class:"truncate"},Oe={__name:"EventDetail",props:["data"],setup(c){const d=c,h=D(()=>{var i,f,t,x,p;const e=d.data.payload,m=d.data,v=d.data.event;switch(v){case"session.status":return[e.status,(i=m.me)==null?void 0:i.id,(f=m.me)==null?void 0:f.pushName];case"message":case"message.any":case"message.ack":case"message.reaction":return[e.id,e.body,v==="message.ack"?e.ackName:null,v==="message.ack"?null:(t=e.reaction)==null?void 0:t.text,(x=e.media)!=null&&x.url?"ðŸ–¼":null];case"engine.event":return[e.event,JSON.stringify(e.data)];case"presence.update":return[e.id,(p=e.presences)==null?void 0:p[0].lastKnownPresence];default:return[]}}),u=D(()=>h.value.filter(e=>e!=null).join(" | "));return(e,m)=>(b(),R("div",Be,[n("code",null,oe(k(u)),1)]))}},Ae=te(Oe,[["__scopeId","data-v-eda98894"]]),Ue={class:"flex gap-2"},Le={style:{"margin-top":"-0.75rem"}},Me={style:{"max-width":"100%"}},je={__name:"EventDataViewer",props:["data"],setup(c){const d=c,h=D(()=>{const e={...d.data};return delete e._json,{id:e.id,session:e.session,event:e.event,payload:e.payload,...e}});async function u(e){await navigator.clipboard.writeText(JSON.stringify(h.value,null,2)),e.preventDefault()}return(e,m)=>{const v=ee,i=Ce("vue-json-pretty"),f=ne("tooltip");return b(),R("div",Ue,[n("div",Le,[K(l(v,{rounded:"",text:"",icon:"pi pi-copy",severity:"secondary",onClick:m[0]||(m[0]=t=>u(t))},null,512),[[f,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),n("div",Me,[l(i,{data:k(h),deep:2,showLine:!1,showIcon:!0,theme:"dark"},null,8,["data"])])])}}},Fe={key:0,class:"pi pi-angle-down"},He={key:1,class:"pi pi-angle-up"},We={__name:"expand",props:["rows","data"],setup(c){const d=c,h=D(()=>{var u;return!((u=d.rows)!=null&&u[d.data.id])});return(u,e)=>k(h)?(b(),R("i",Fe)):(b(),R("i",He))}};var se={exports:{}};(function(c,d){(function(h,u){c.exports=u()})(ce,function(){return function h(u,e,m){var v=window,i="application/octet-stream",f=m||i,t=u,x=!e&&!m&&t,p=document.createElement("a"),g=function(r){return String(r)},_=v.Blob||v.MozBlob||v.WebKitBlob||g,y=e||"download",S,E;if(_=_.call?_.bind(v):Blob,String(this)==="true"&&(t=[t,f],f=t[0],t=t[1]),x&&x.length<2048&&(y=x.split("/").pop().split("?")[0],p.href=x,p.href.indexOf(x)!==-1)){var N=new XMLHttpRequest;return N.open("GET",x,!0),N.responseType="blob",N.onload=function(r){h(r.target.response,y,i)},setTimeout(function(){N.send()},0),N}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(t))if(t.length>1024*1024*1.999&&_!==g)t=F(t),f=t.type||i;else return navigator.msSaveBlob?navigator.msSaveBlob(F(t),y):I(t);else if(/([\x80-\xff])/.test(t)){var T=0,A=new Uint8Array(t.length),L=A.length;for(T;T<L;++T)A[T]=t.charCodeAt(T);t=new _([A],{type:f})}S=t instanceof _?t:new _([t],{type:f});function F(r){var o=r.split(/[:;,]/),s=o[1],w=o[2]=="base64"?atob:decodeURIComponent,V=w(o.pop()),H=V.length,$=0,W=new Uint8Array(H);for($;$<H;++$)W[$]=V.charCodeAt($);return new _([W],{type:s})}function I(r,o){if("download"in p)return p.href=r,p.setAttribute("download",y),p.className="download-js-link",p.innerHTML="downloading...",p.style.display="none",document.body.appendChild(p),setTimeout(function(){p.click(),document.body.removeChild(p),o===!0&&setTimeout(function(){v.URL.revokeObjectURL(p.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(r)&&(r="data:"+r.replace(/^data:([\w\/\-\+]+)/,i)),window.open(r)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=r),!0;var s=document.createElement("iframe");document.body.appendChild(s),!o&&/^data:/.test(r)&&(r="data:"+r.replace(/^data:([\w\/\-\+]+)/,i)),s.src=r,setTimeout(function(){document.body.removeChild(s)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(S,y);if(v.URL)I(v.URL.createObjectURL(S),!0);else{if(typeof S=="string"||S.constructor===g)try{return I("data:"+f+";base64,"+v.btoa(S))}catch{return I("data:"+f+","+encodeURIComponent(S))}E=new FileReader,E.onload=function(r){I(this.result)},E.readAsDataURL(S)}return!0}})})(se);var Pe=se.exports;const ze=de(Pe),O=c=>(Ne("data-v-8b771d31"),c=c(),Te(),c),Je={class:"mb-4"},Ge=O(()=>n("h5",{class:"flex align-items-center gap-1"},[n("i",{class:"pi pi-eye"}),n("span",{class:"mr-1"}," Event Monitor ")],-1)),Ke={class:"m-0"},qe=O(()=>n("a",{target:"_blank",href:"https://waha.devlike.pro/docs/how-to/webhooks/#events"}," WAHA Events ",-1)),Qe=O(()=>n("br",null,null,-1)),Xe=O(()=>n("b",null,"development",-1)),Ye=O(()=>n("b",null,"debugging",-1)),Ze={class:"pi pi-info-circle"},et={class:"flex justify-content-between align-items-center flex-column sm:flex-row gap-2 sm:gap-0"},tt={class:"flex flex-column sm:flex-row gap-2"},ot={class:"flex gap-2"},nt={class:"flex align-items-center justify-content-center"},st={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-2"},at={class:"p-4 text-center text-se"},lt=O(()=>n("span",null," Listening for new events... ",-1)),it=O(()=>n("i",{class:"pi pi-spin pi-spinner"},null,-1)),rt={class:"event-viewer"},ct={__name:"EventTable",setup(c){const d=Se(),h=Z(),{servers:u}=Ee(h),e=U(null);ke(async()=>{var w;for(let V=0;V<30;V++)u.value.length===0&&await ue(100);u.value.length>0&&(e.value=(w=u.value)==null?void 0:w[0].id,E())});const m=U([]),v=X.filter(o=>o!=="engine.event"),i=U({global:{value:null,matchMode:J.CONTAINS},event:{value:v,matchMode:J.IN},session:{value:null,matchMode:J.CONTAINS}}),f=["_json"],t=U(!1);function x(o){o.timestamp=o.timestamp||Date.now(),o._json=o._json||JSON.stringify(o),m.value.push(o)}Y(e,()=>{t.value&&(L(),E())});const p=D(()=>{var o;return i.value.event.value?(o=i.value.event.value)==null?void 0:o.includes("engine.event"):!0});Y(p,()=>{t.value&&(L(),E())});let g=null;const _=U(B.DISCONNECTED),y=U({}),S=o=>{const s=y.value[o.data.id]===void 0||!y.value[o.data.id],w={...y.value};s?w[o.data.id]=!0:delete w[o.data.id],y.value={...w}},E=()=>{t.value=!0,N()};function N(){if(!t.value)return;if(!e.value){d.add({severity:"warn",summary:"No server selected",detail:"Please select a server to start listening"});return}if(g){d.add({severity:"warn",summary:"Already listening",detail:"Please stop the current listener before starting a new one or refresh the page"});return}const o=h.getServer(e.value),s=["*"];p.value&&s.push("engine.event"),g=new pe(o,s),g.connect(),_.value=B.CONNECTING,g.on("open",()=>{_.value=B.CONNECTED}),g.on("close",()=>{_.value=B.DISCONNECTED,T()}),g.on("error",()=>{_.value=B.ERROR,T()}),g.on("event",x)}function T(){A(),setTimeout(()=>{N()},300)}function A(){g==null||g.stop(),g=null}const L=()=>{t.value=!1,A(),_.value=B.DISCONNECTED},F=()=>{m.value=[]},I=D(()=>`Clean Events (${m.value.length})`);function r(o){ze(JSON.stringify(m.value,null,2),"events.json","text/plain")}return(o,s)=>{const w=ee,V=fe,H=_e,$=he,W=ge,M=we,ae=ye,le=Ve,ie=Ae,re=Re,q=ne("tooltip");return b(),R(G,null,[n("div",Je,[Ge,n("div",null,[n("p",Ke,[j(" Monitor "),qe,j(" from your sessions in real-time! "),Qe,j(" You can use Event Monitor for "),Xe,j(" and "),Ye,j(" purposes. "),K(n("i",Ze,null,512),[[q,"Displays only new incoming events in real-time; no historical data is available."]])])])]),l(re,{value:m.value,dataKey:"id",expandedRows:y.value,"onUpdate:expandedRows":s[4]||(s[4]=a=>y.value=a),rowHover:!0,filters:i.value,"onUpdate:filters":s[5]||(s[5]=a=>i.value=a),filterDisplay:"row",globalFilterFields:f,showGridlines:"",style:{"white-space":"nowrap"},sortField:"timestamp",sortOrder:-1,resizableColumns:"",class:"p-datatable--clickable",onRowClick:S},{header:C(()=>[n("div",et,[n("div",tt,[n("div",ot,[t.value?(b(),z(w,{key:1,label:"Pause",icon:"pi pi-pause",severity:"secondary",onClick:L})):(b(),z(w,{key:0,label:"Listen",icon:"pi pi-play",severity:"success",onClick:E})),l(V,{placeholder:"Select Server",modelValue:e.value,"onUpdate:modelValue":s[0]||(s[0]=a=>e.value=a),showClear:!1},null,8,["modelValue"])]),n("div",nt,[l(ve,{status:_.value},null,8,["status"])])]),n("div",st,[K(l(w,{icon:"pi pi-download",label:"Download",onClick:s[1]||(s[1]=a=>r(a))},null,512),[[q,"Download all events as JSON"]]),l(w,{label:k(I),icon:"pi pi-trash",severity:"secondary",onClick:F},null,8,["label"]),l(W,{iconPosition:"left"},{default:C(()=>[l(H,{class:"pi pi-search"}),l($,{modelValue:i.value.global.value,"onUpdate:modelValue":s[2]||(s[2]=a=>i.value.global.value=a),placeholder:"Search in data",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])])]),empty:C(()=>[n("div",at,[_.value===k(B).CONNECTED?(b(),R(G,{key:0},[lt,it],64)):(b(),R(G,{key:1},[t.value?De("",!0):(b(),z(w,{key:0,label:"Listen",icon:"pi pi-play",severity:"success",onClick:E}))],64))])]),expansion:C(a=>[n("div",rt,[l(je,{data:a.data},null,8,["data"])])]),default:C(()=>[l(M,{style:{width:"3rem"}},{body:C(({data:a})=>[l(We,{rows:y.value,data:a},null,8,["rows","data"])]),_:1}),l(M,{field:"event",header:"Event","show-filter-menu":!1},{filter:C(({filterModel:a,filterCallback:Q})=>[l(ae,{id:"events",modelValue:a.value,"onUpdate:modelValue":P=>a.value=P,placeholder:"Any","max-selected-labels":1,selectedItemsLabel:"{0} events",onChange:P=>Q(),options:k(X),showClear:!0,required:!1},null,8,["modelValue","onUpdate:modelValue","onChange","options"])]),body:C(({data:a})=>[l(le,{event:a.event},null,8,["event"])]),_:1}),l(M,{field:"session",header:"Session","show-filter-menu":!1},{filter:C(({filterModel:a,filterCallback:Q})=>[l($,{modelValue:i.value.session.value,"onUpdate:modelValue":s[3]||(s[3]=P=>i.value.session.value=P),placeholder:"Session",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(M,{field:"timestamp",header:"Time",sortable:""},{body:C(({data:a})=>[n("span",null,oe(k(Ie)(a.timestamp)),1)]),_:1}),l(M,{header:"Detail","show-filter-menu":!1},{body:C(({data:a})=>[l(ie,{data:a},null,8,["data"])]),_:1})]),_:1},8,["value","expandedRows","filters"])],64)}}},dt=te(ct,[["__scopeId","data-v-8b771d31"]]),ut={class:"grid"},pt={class:"col-12"},mt={class:"card"},Xt={__name:"event-monitor",setup(c){const d=Z();return $e(()=>{d.refresh()}),(h,u)=>(b(),R("div",ut,[n("div",pt,[n("div",mt,[l(dt)])])]))}};export{Xt as default};
