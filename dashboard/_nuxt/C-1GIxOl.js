import{u as F,a as me,_ as ve,l as ce}from"./B86MJA9I.js";import W from"./C59UeKWi.js";import Ie from"./jn4OOEQC.js";import te from"./VnQEm5No.js";import Ne from"./D9eiLzAI.js";import Re from"./BmURRE_M.js";import{c as C,M as g,t as c,P as T,O as D,v as $,N as q,z as o,y as I,r as x,A as u,x as e,X as le,R as j,U as fe,B as R,Y as Me,W as Le,_ as qe,o as _e,Z as be,$ as se,C as Oe,D as Ee,a0 as he,Q as ge,G as Ae,i as Pe,a1 as je,S as Fe,L as We,V as ne,a2 as He}from"./ql5q8IH5.js";import ze from"./DB2cdlMc.js";import Ge from"./ZRIOX9Tv.js";import Je from"./BK8-RYDw.js";import Ke from"./BTMPJfUN.js";import{a as ye,_ as Se,u as $e}from"./WhS_oGDJ.js";import ue from"./DaOX-P5x.js";import Qe from"./Dli2VeJA.js";import Ye from"./Bn73OMWp.js";import Xe from"./B5xWuPOc.js";import Ze from"./0QDnIFCd.js";import we from"./BxG2mG0d.js";import es from"./Cb4c85RJ.js";import ss from"./CvTdIbTI.js";import os from"./DBasQp_w.js";import xe from"./DK_7Yy8C.js";import ke from"./BKGkMP22.js";import ns from"./rG9o9ENH.js";import ts from"./jmpPgqxW.js";import ls from"./BFXsDwaI.js";const Ce={__name:"SessionChip",props:{session:Object,image:String},setup(t){const l=t,s=C(()=>{if(l.session.me)return`${l.session.me.pushName} (${l.session.me.id})`});return(a,d)=>{const i=Re;return g(s)?(c(),T(i,{key:0,label:g(s),image:t.image},null,8,["label","image"])):D("",!0)}}},Ve={__name:"RefreshButton",props:["refreshing"],setup(t){const l=t,s=C(()=>l.refreshing?"pi pi-refresh pi-spin":"pi pi-refresh");return(a,d)=>{const i=W;return c(),T(i,{icon:g(s),rounded:"",text:"",disabled:t.refreshing},null,8,["icon","disabled"])}}},is=["src"],as={__name:"Base64Img",props:{data:String,mimetype:String},setup(t){const l=t,s=C(()=>`data:${l.mimetype};base64, ${l.data}`);return(a,d)=>(c(),$("img",{src:s.value,style:{"max-width":"100%"}},null,8,is))}};function rs(t){return new Promise(l=>setTimeout(l,t))}const ds={key:2,style:{"background-color":"#f8f9fa",padding:"1rem",color:"red","white-space":"pre-wrap"}},De={__name:"SessionScreenshot",props:{session:Object},setup(t,{expose:l}){const s=F(),a=t,{data:d,pending:i,error:m,refresh:r}=me(`session-screenshot-${a.session.server.id}-${a.session.name}`,async()=>(await rs(1e3),await s.getScreenshot(a.session.server.id,a.session.name)));return l({refresh:r}),(_,v)=>{const y=Ge,k=Je,b=as;return c(),$(q,null,[g(i)?(c(),$(q,{key:0},[o(y,{mode:"indeterminate",style:{height:"3px"}}),!g(d)&&!g(m)?(c(),T(k,{key:0,width:"100%",height:"20rem"})):D("",!0)],64)):D("",!0),g(d)?(c(),T(b,{key:1,data:g(d).data,mimetype:g(d).mimetype},null,8,["data","mimetype"])):D("",!0),g(m)?(c(),$("pre",ds,""+I(g(m).cause.response.data.message||g(m).cause.response.data||g(m))+`
  `,1)):D("",!0)],64)}}},cs={class:"",style:{"min-width":"20rem"}},us={class:"flex justify-content-center align-items-center"},ps=e("h5",{class:"m-0"},"Screenshot",-1),ms={class:"m-auto w-full"},vs={__name:"ScreenshotButton",props:["disabled","session"],setup(t){const l=x(null),s=x(null),a=i=>{l.value.toggle(i)},d=()=>{s.value.refresh()};return(i,m)=>{const r=W,_=Ve,v=De,y=Ke;return c(),$(q,null,[o(r,{disabled:t.disabled,type:"button",icon:"pi pi-camera",onClick:a,rounded:"",outlined:""},null,8,["disabled"]),o(y,{ref_key:"op",ref:l,appendTo:"body",showCloseIcon:!0},{default:u(()=>[e("div",cs,[e("div",us,[ps,o(_,{onClick:d})]),e("div",ms,[o(v,{ref_key:"screenshot",ref:s,session:t.session},null,8,["session"])])])]),_:1},512)],64)}}},fs={class:"ml-1"},_s={key:1},bs={class:"ml-1"},Te={__name:"ServerDropdown",props:le({showClear:Boolean,placeholder:String,required:Boolean,invalid:Boolean,disabled:Boolean},{server:{},serverModifiers:{}}),emits:["update:server"],setup(t){const l=j(t,"server"),s=F();return(a,d)=>{const i=ye,m=ue;return c(),T(m,{optionValue:"id",modelValue:l.value,"onUpdate:modelValue":d[0]||(d[0]=r=>l.value=r),options:g(s).servers,onChange:d[1]||(d[1]=r=>a.$emit("change",l.value)),placeholder:t.placeholder,class:"p-column-filter",showClear:t.showClear,required:t.required,invalid:t.invalid,disabled:t.disabled},{value:u(r=>[r.value?(c(),$(q,{key:0},[o(i,{connected:g(s).getServer(r.value).connected},null,8,["connected"]),e("span",fs,I(g(s).getServer(r.value).name),1)],64)):(c(),$("span",_s,I(r.placeholder),1))]),option:u(r=>[o(i,{connected:r.option.connected},null,8,["connected"]),e("span",bs,I(r.option.name)+" ("+I(r.option.connection.url)+") ",1)]),_:1},8,["modelValue","options","placeholder","showClear","required","invalid","disabled"])}}},hs={class:"p-dialog-title flex gap-2 align-items-center"},gs=e("span",null,"(",-1),ys={class:"ml-1"},Ss=e("span",null,")",-1),$s=["disabled"],ws=e("i",{class:"pi pi-refresh"},null,-1),xs=[ws],Ue={__name:"SessionHeader",props:{session:Object,refresh:Boolean},setup(t){const l=t,s=F(),{refreshing:a}=fe(s),d=C(()=>l.session.server.id?l.session.server:s.getServer(l.session.server));async function i(){await s.refresh()}return(m,r)=>{var k;const _=Se,v=ye,y=ve;return c(),$("div",hs,[e("span",null,I((k=t.session)==null?void 0:k.name),1),o(_,{status:t.session.status},null,8,["status"]),e("div",null,[gs,o(v,{connected:d.value.connected},null,8,["connected"]),e("span",ys,I(d.value.name),1),Ss]),t.refresh?(c(),$("button",{key:0,onClick:r[0]||(r[0]=b=>i()),class:"p-link layout-topbar-button",disabled:g(a)},xs,8,$s)):D("",!0),o(y,{refreshing:g(a)},null,8,["refreshing"])])}}},ks={class:"-mt-4 p-0 line-height-3 block",style:{"font-family":"monaco, Consolas, 'Lucida Console', monospace"}},Cs={__name:"CodeHighlight",props:["invalid"],setup(t){const l=t,s=C(()=>l.invalid?"p-invalid p-component p-inputtext":"");return(a,d)=>(c(),$("pre",{class:Le(["border-round surface-ground text-900 p-5 overflow-auto",s.value])},[R("        "),e("code",ks,[Me(a.$slots,"default")])],2))}},pe=t=>(Oe("data-v-ca11cfb1"),t=t(),Ee(),t),Vs={class:"h-full flex flex-column"},Ds={class:"flex justify-content-center align-items-center"},Ts=pe(()=>e("h5",{class:"m-0"},"Request",-1)),Us={class:"flex flex-column justify-content-between h-full"},Bs={class:"flex flex-column gap-2"},Is={class:"flex gap-2"},Ns={class:"text-center"},Rs=pe(()=>e("div",{class:"mb-2"},"Body",-1)),Ms={class:"text-center mt-2"},Ls={class:"flex flex-column h-full"},qs={class:"flex justify-content-center align-items-center"},Os=pe(()=>e("h5",{class:"m-0"},"Response",-1)),Es={__name:"SessionRequestResponse",props:["session"],setup(t){const l=F(),s=t,a=x(null),d=x("POST"),i=x("/api/sendText"),m=x(""),r=x(!1),_=x(!1);function v(w){return JSON.stringify(w,null,2)}function y(w){try{return JSON.parse(w)}catch{return w}}const k=C(()=>({method:d.value,uri:i.value,params:void 0,body:y(m.value)})),b=["GET","POST","PUT","DELETE","PATCH"];async function U(w){await navigator.clipboard.writeText(a.value),w.preventDefault()}async function B(w){await navigator.clipboard.writeText(v(k.value)),w.preventDefault()}async function O(){try{_.value=!1,r.value=!0;const w=await l.callServerAPI(s.session.server.id,k.value);a.value=v(w)}catch(w){_.value=!0,w.response?a.value=v(w.response.data):a.value=v(w)}finally{r.value=!1}}return _e(()=>{const w={chatId:"11111111111@c.us",text:"Hi there!",session:s.session.name};m.value=v(w),a.value="..."}),(w,V)=>{const E=W,H=ue,z=te,Y=Xe,G=Ze,A=Cs,S=be("tooltip");return c(),$(q,null,[e("div",null,[e("div",Vs,[e("div",Ds,[Ts,se(o(E,{rounded:"",text:"",tabindex:0,icon:"pi pi-copy",onClick:V[0]||(V[0]=n=>B(n))},null,512),[[S,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),e("div",Us,[e("div",Bs,[e("div",Is,[o(H,{modelValue:d.value,"onUpdate:modelValue":V[1]||(V[1]=n=>d.value=n),options:b},null,8,["modelValue"]),o(z,{type:"text",class:"w-full",modelValue:i.value,"onUpdate:modelValue":V[2]||(V[2]=n=>i.value=n),placeholder:"API Endpoint"},null,8,["modelValue"])]),e("div",Ns,[Rs,o(Y,{modelValue:m.value,"onUpdate:modelValue":V[3]||(V[3]=n=>m.value=n),rows:"8",class:"w-full",placeholder:"Request"},null,8,["modelValue"])])]),e("div",Ms,[o(E,{onClick:O,loading:r.value,label:"Send",icon:"pi pi-send","icon-pos":"right"},null,8,["loading"])])])])]),o(G),e("div",null,[e("div",Ls,[e("div",qs,[Os,se(o(E,{rounded:"",text:"",tabindex:0,icon:"pi pi-copy",onClick:V[4]||(V[4]=n=>U(n))},null,512),[[S,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),o(A,{class:"m-0 p-4 pretty",invalid:_.value},{default:u(()=>[R(I(a.value),1)]),_:1},8,["invalid"])])])],64)}}},As=qe(Es,[["__scopeId","data-v-ca11cfb1"]]),Ps={class:"grid pt-4"},js={class:"col-12 sm:col-6 h-full"},Fs={class:"grid"},Ws={class:"col-12"},Hs={class:""},zs={class:"flex justify-content-center align-items-center"},Gs={class:"col-12"},Js={class:""},Ks={class:"flex justify-content-center align-items-center"},Qs=e("h5",{class:"m-0"},"Screenshot",-1),Ys={class:"m-auto w-full"},Xs={class:"col-12 sm:col-6 h-full card"},Zs={__name:"SessionControl",props:["session"],setup(t){const l=F(),s=t,a=x(null),d=()=>{a.value.refresh()},i=x(null);return _e(()=>{var m,r;(r=(m=s.session)==null?void 0:m.me)!=null&&r.id&&l.getProfilePicture(s.session.server.id,s.session.name,s.session.me.id).then(_=>{i.value=_.profilePictureURL})}),(m,r)=>{const _=Ce,v=Ve,y=De,k=As;return c(),$("div",Ps,[e("div",js,[e("div",Fs,[e("div",Ws,[e("div",Hs,[e("div",zs,[t.session.me?(c(),T(_,{key:0,session:t.session,image:g(i)},null,8,["session","image"])):D("",!0)])])]),e("div",Gs,[e("div",Js,[e("div",Ks,[Qs,o(v,{onClick:d})]),e("div",Ys,[o(y,{ref_key:"screenshot",ref:a,session:t.session},null,8,["session"])])])])])]),e("div",Xs,[o(k,{session:t.session},null,8,["session"])])])}}},eo={__name:"SessionControlDialog",props:{visible:{},visibleModifiers:{},session:{},sessionModifiers:{}},emits:["update:visible","update:session"],setup(t){const l=j(t,"visible"),s=j(t,"session");return he(),(a,d)=>{const i=Ue,m=Zs,r=we;return c(),T(r,{visible:l.value,"onUpdate:visible":d[0]||(d[0]=_=>l.value=_),modal:!0,maximizable:""},{header:u(()=>[o(i,{session:s.value},null,8,["session"])]),default:u(()=>[o(m,{session:s.value},null,8,["session"])]),_:1},8,["visible"])}}},so={class:"field"},oo=e("label",{for:"url"},"URL",-1),no={class:"field mb-4"},to=e("label",{for:"events"},"Events",-1),lo=e("div",{class:"font-bold mb-2"},"Retries",-1),io={class:"flex gap-3"},ao={class:"field"},ro=e("label",{for:"retries-attempts"},"Attempts",-1),co=e("span",{class:"pi pi-plus"},null,-1),uo=e("span",{class:"pi pi-minus"},null,-1),po={class:"field"},mo=e("label",{for:"retries-delay-seconds"},"Delay, seconds",-1),vo=e("span",{class:"pi pi-plus"},null,-1),fo=e("span",{class:"pi pi-minus"},null,-1),_o={class:"field"},bo=e("label",{for:"hmac"},"HMAC Key (optional)",-1),ho={__name:"SessionWebhook",props:le({disabled:Boolean,index:Number},{webhook:{},webhookModifiers:{}}),emits:["update:webhook"],setup(t){const l=j(t,"webhook"),s=t,a=["session.status","message","message.any","message.reaction","message.ack","message.revoked","state.change","group.join","group.leave","presence.update","poll.vote","poll.vote.failed"];return(d,i)=>{const m=te,r=ns,_=ts,v=W,y=xe,k=ke;return c(),T(k,{activeIndex:0},{default:u(()=>[o(y,{header:`Webhook ${s.index+1}`},{default:u(()=>[e("div",so,[oo,o(m,{id:"url",modelValue:l.value.url,"onUpdate:modelValue":i[0]||(i[0]=b=>l.value.url=b),modelModifiers:{trim:!0},required:"true",disabled:t.disabled},null,8,["modelValue","disabled"])]),e("div",no,[to,o(r,{id:"events",modelValue:l.value.events,"onUpdate:modelValue":i[1]||(i[1]=b=>l.value.events=b),options:a,placeholder:"Select Events","max-selected-labels":1,selectedItemsLabel:"{0} events selected",disabled:t.disabled},null,8,["modelValue","disabled"]),e("ul",null,[(c(!0),$(q,null,ge(l.value.events,b=>(c(),$("li",{key:b},I(b),1))),128))])]),e("div",null,[lo,e("div",io,[e("div",ao,[ro,o(_,{modelValue:l.value.retries.attempts,"onUpdate:modelValue":i[2]||(i[2]=b=>l.value.retries.attempts=b),inputId:"retries-delay-attempts",showButtons:"",buttonLayout:"horizontal",min:1,step:1,disabled:t.disabled},{incrementbuttonicon:u(()=>[co]),decrementbuttonicon:u(()=>[uo]),_:1},8,["modelValue","disabled"])]),e("div",po,[mo,o(_,{modelValue:l.value.retries.delaySeconds,"onUpdate:modelValue":i[3]||(i[3]=b=>l.value.retries.delaySeconds=b),inputId:"retries-delay-seconds",showButtons:"",buttonLayout:"horizontal",min:1,step:1,disabled:t.disabled},{incrementbuttonicon:u(()=>[vo]),decrementbuttonicon:u(()=>[fo]),_:1},8,["modelValue","disabled"])])])]),e("div",_o,[bo,o(m,{id:"hmac",modelValue:l.value.hmac.key,"onUpdate:modelValue":i[4]||(i[4]=b=>l.value.hmac.key=b),modelModifiers:{trim:!0},disabled:t.disabled},null,8,["modelValue","disabled"])]),o(v,{label:"Remove Webhook",icon:"pi pi-trash",text:"",onClick:i[5]||(i[5]=b=>d.$emit("remove")),severity:"warning",disabled:t.disabled},null,8,["disabled"])]),_:1},8,["header"])]),_:1})}}},go={class:"flex flex-column gap-2"},yo=e("div",null,[e("label",null,"Webhooks")],-1),So={key:0,class:"text-300 text-center"},$o={__name:"SessionWebhooksField",props:le({disabled:Boolean},{webhooks:{},webhooksModifiers:{}}),emits:["update:webhooks"],setup(t){const l=j(t,"webhooks");function s(){l.value.push({url:"https://httpbin.org/post",events:["session.status","message","message.reaction"],hmac:{key:null},retries:{delaySeconds:2,attempts:15}})}function a(d){l.value.splice(d,1)}return(d,i)=>{const m=ho,r=W;return c(),$("div",go,[yo,l.value.length===0?(c(),$("div",So," No webhooks configured ")):(c(!0),$(q,{key:1},ge(l.value,(_,v)=>(c(),T(m,{webhook:l.value[v],"onUpdate:webhook":y=>l.value[v]=y,index:v,onRemove:y=>a(v),disabled:t.disabled},null,8,["webhook","onUpdate:webhook","index","onRemove","disabled"]))),256)),e("div",null,[o(r,{label:"Add Webhook",icon:"pi pi-plus",text:"",onClick:s,severity:"secondary",disabled:t.disabled},null,8,["disabled"])])])}}},wo={class:"mb-2"},xo=e("b",null,"Server",-1),ko=e("b",null,"Name",-1),Co={class:"field"},Vo=e("label",{for:"server"},"Server",-1),Do={key:0,class:"p-invalid"},To={class:"field"},Uo=e("label",{for:"name"},"Name",-1),Bo={key:0,class:"p-invalid"},Io={key:0,class:"mb-4"},No=e("div",{class:"mb-3"},[e("label",null,"Engine Settings ")],-1),Ro={class:"flex flex-column gap-2"},Mo=e("div",null,[e("a",{href:"https://waha.devlike.pro/docs/engines/noweb",target:"_blank"},"Read more about NOWEB settings")],-1),Lo={class:"field"},qo={class:"field flex justify-content-between align-items-center"},Oo=e("div",null,[e("label",{for:"debug"},"Proxy")],-1),Eo={key:0,class:"card mb-4"},Ao={class:"field"},Po=e("label",{for:"proxy-server"},"Server",-1),jo={key:0,class:"p-invalid"},Fo={class:"flex gap-3"},Wo={class:"field w-full"},Ho=e("label",{for:"proxy-username"},"Username (optional)",-1),zo={class:"field w-full"},Go=e("label",{for:"proxy-password"},"Password (optional)",-1),Jo={class:"field flex justify-content-between align-items-center"},Ko=e("div",null,[e("label",{for:"debug"},"Debug Mode")],-1),Qo={class:"w-full flex flex-column gap-2"},Yo={class:"flex justify-content-end"},Xo={__name:"SessionDialog",props:le({mode:String},{visible:{},visibleModifiers:{},session:{},sessionModifiers:{}}),emits:["update:visible","update:session"],setup(t){var G,A;const l=j(t,"visible"),s=j(t,"session"),a=t,d=C(()=>a.mode==="new"),i=C(()=>a.mode==="view"),m=C(()=>a.mode==="start"),r=C(()=>i.value),_=C(()=>r.value||m.value),v=$e(),y=F(),k=C(()=>y.getServer(s.value.server)),b=C(()=>{var S,n;return((n=(S=k.value)==null?void 0:S.version)==null?void 0:n.engine)==="NOWEB"});C(()=>{var S,n;return((n=(S=k.value)==null?void 0:S.version)==null?void 0:n.engine)==="WEBJS"});const U=x(!!((A=(G=s.value.config)==null?void 0:G.proxy)!=null&&A.server));Ae(s,async(S,n)=>{var f,P;U.value=(P=(f=S==null?void 0:S.config)==null?void 0:f.proxy)==null?void 0:P.server});const B=x(!1),O=x(!1),w=C(()=>{const S=ce.cloneDeep(s.value.config);return U.value||(S.proxy=void 0),S}),V=C(()=>{const S={...w.value};return b.value||delete S.noweb,{name:s.value.name,config:S}});async function E(){if(B.value=!0,!!s.value.name){try{O.value=!0,await v(y.startSession(s.value.server,V.value),"Session Started","Failed to start session")}finally{O.value=!1}s.value=void 0,H()}}function H(){B.value=!1,l.value=!1}const z=C(()=>m.value&&!["STOPPED","FAILED"].includes(s.value.status));async function Y(S){await navigator.clipboard.writeText(JSON.stringify({method:"POST",uri:"/api/sessions/start",body:V.value},null,2)),S.preventDefault()}return(S,n)=>{const f=Ue,P=es,M=Te,X=te,ie=ss,J=Pe("font-awesome-icon"),K=os,Q=xe,ae=ke,oe=$o,re=ls,Z=W,de=we,ee=be("tooltip");return c(),T(de,{visible:l.value,"onUpdate:visible":n[11]||(n[11]=h=>l.value=h),header:"Session",modal:!0,class:"p-fluid",maximizable:""},je({footer:u(()=>[e("div",Qo,[e("div",null,[z.value?(c(),T(P,{key:0,severity:"warn"},{default:u(()=>[R(" The session is in '"),e("b",null,I(s.value.status)+"'",1),R(" status! If you want to change config - please stop it first and run again. ")]),_:1})):D("",!0)]),e("div",Yo,[se(o(Z,{label:"Copy Request",text:"",tabindex:0,icon:"pi pi-copy",severity:"secondary",onClick:n[10]||(n[10]=h=>Y(h))},null,512),[[ee,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]]),o(Z,{label:i.value?"Close":"Cancel",icon:"pi pi-times",text:"",severity:"secondary",onClick:H},null,8,["label"]),i.value?D("",!0):(c(),T(Z,{key:0,label:d.value?"Start New":"Start",icon:"pi pi-play",text:"",onClick:E,loading:O.value,disabled:z.value},null,8,["label","loading","disabled"]))])])]),default:u(()=>[e("div",wo,[m.value?(c(),T(P,{key:0,severity:"info"},{default:u(()=>[R(" To change the "),xo,R(" or "),ko,R(" - please logout from the session and run again. ")]),_:1})):D("",!0)]),e("div",Co,[Vo,o(M,{placeholder:"Select Server",modelValue:s.value.server,"onUpdate:modelValue":n[0]||(n[0]=h=>s.value.server=h),showClear:!1,required:!0,invalid:B.value&&!s.value.server,disabled:_.value},null,8,["modelValue","invalid","disabled"]),B.value&&!s.value.server?(c(),$("small",Do,"Server is required.")):D("",!0)]),e("div",To,[Uo,o(X,{id:"name",modelValue:s.value.name,"onUpdate:modelValue":n[1]||(n[1]=h=>s.value.name=h),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:B.value&&!s.value.name,disabled:!d.value},null,8,["modelValue","invalid","disabled"]),B.value&&!s.value.name?(c(),$("small",Bo,"Name is required.")):D("",!0)]),b.value?(c(),$("div",Io,[No,o(ae,{activeIndex:0},{default:u(()=>[o(Q,{header:"NOWEB"},{header:u(()=>[R("  "),o(ie,{value:"New"})]),default:u(()=>[e("div",Ro,[Mo,e("div",null,[se((c(),T(K,{modelValue:s.value.config.noweb.store.enabled,"onUpdate:modelValue":n[2]||(n[2]=h=>s.value.config.noweb.store.enabled=h),onLabel:"Store: Enabled",offLabel:"Store: Disabled",disabled:_.value},{icon:u(()=>[o(J,{icon:"fa-solid fa-folder",class:"mr-2"})]),_:1},8,["modelValue","disabled"])),[[ee,"Store contacts, chats, messages in the database, so you can get it in API"]])]),e("div",null,[se((c(),T(K,{modelValue:s.value.config.noweb.store.fullSync,"onUpdate:modelValue":n[3]||(n[3]=h=>s.value.config.noweb.store.fullSync=h),onLabel:"Store: Full Sync On",offLabel:"Store: Full Sync Off",disabled:_.value},{icon:u(()=>[o(J,{icon:"fa-solid fa-sync",class:"mr-2"})]),_:1},8,["modelValue","disabled"])),[[ee,`Sync all contacts, chats, messages from the phone at the start.
Otherwise the store can miss some information.`]])])])]),_:1})]),_:1})])):D("",!0),e("div",Lo,[o(oe,{ref:"webhooks",webhooks:s.value.config.webhooks,"onUpdate:webhooks":n[4]||(n[4]=h=>s.value.config.webhooks=h),disabled:r.value},null,8,["webhooks","disabled"])]),e("div",null,[e("div",qo,[Oo,o(K,{modelValue:U.value,"onUpdate:modelValue":n[5]||(n[5]=h=>U.value=h),onLabel:"Proxy On",offLabel:"Proxy Off",disabled:r.value},{icon:u(()=>[o(J,{icon:"fa-solid fa-server",class:"mr-2"})]),_:1},8,["modelValue","disabled"])]),U.value?(c(),$("div",Eo,[e("div",Ao,[Po,o(X,{id:"proxy-server",modelValue:s.value.config.proxy.server,"onUpdate:modelValue":n[6]||(n[6]=h=>s.value.config.proxy.server=h),modelModifiers:{trim:!0},required:"true",invalid:B.value&&!s.value.config.proxy.server,disabled:i.value,placeholder:"host:port"},null,8,["modelValue","invalid","disabled"]),B.value&&!s.value.config.proxy.server?(c(),$("small",jo,"Server is required.")):D("",!0)]),e("div",Fo,[e("div",Wo,[Ho,o(X,{id:"proxy-username",modelValue:s.value.config.proxy.username,"onUpdate:modelValue":n[7]||(n[7]=h=>s.value.config.proxy.username=h),modelModifiers:{trim:!0},disabled:i.value},null,8,["modelValue","disabled"])]),e("div",zo,[Go,o(re,{id:"proxy-password",modelValue:s.value.config.proxy.password,"onUpdate:modelValue":n[8]||(n[8]=h=>s.value.config.proxy.password=h),modelModifiers:{trim:!0},disabled:i.value,feedback:!1,toggleMask:""},null,8,["modelValue","disabled"])])])])):D("",!0)]),e("div",Jo,[Ko,o(K,{modelValue:s.value.config.debug,"onUpdate:modelValue":n[9]||(n[9]=h=>s.value.config.debug=h),onLabel:"Debug Enabled",offLabel:"Debug Disabled",onIcon:"fa fa-bug",disabled:r.value},{icon:u(()=>[o(J,{icon:"fa-solid fa-bug",class:"mr-2"})]),_:1},8,["modelValue","disabled"])])]),_:2},[d.value?void 0:{name:"header",fn:u(()=>[o(f,{session:s.value},null,8,["session"])]),key:"0"}]),1032,["visible"])}}},Zo=["WORKING","FAILED","STARTING","SCAN_QR_CODE","STOPPED"],en={class:"flex justify-content-between"},sn={class:"flex align-items-center gap-1"},on=e("i",{class:"pi pi-whatsapp"},null,-1),nn=e("span",{class:"mr-1"}," Sessions ",-1),tn=["disabled"],ln=e("i",{class:"pi pi-refresh"},null,-1),an=[ln],rn={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-0"},dn={class:"flex gap-2 align-items-center"},cn={class:"flex gap-2"},un={class:"my-auto"},pn={class:"flex flex-row gap-2 justify-content-end"},En={__name:"SessionTable",setup(t){const l=he(),s=Fe(),a=F(),{allSessions:d,refreshing:i,servers:m}=fe(a),r=d,_=$e(),v=x({config:{webhooks:[]}}),y=x(!1),k=x(void 0),b=x(!1);x(null);const U=x({}),B=x(null);We(()=>{O()});const O=()=>{U.value={global:{value:null,matchMode:ne.CONTAINS},status:{value:null,matchMode:ne.EQUALS},"server.id":{value:null,matchMode:ne.EQUALS},name:{operator:He.AND,constraints:[{value:null,matchMode:ne.STARTS_WITH}]}}};function w(){const n=m.value.find(f=>f.connected);if(!n){l.add({severity:"error",summary:"No connected server",detail:"Please connect to a server first",life:3e3});return}v.value={server:n.id,name:"session_"+Math.random().toString(36).substring(7),config:{webhooks:[{url:"https://httpbin.org/post",events:["session.status","message","message.reaction"],hmac:{key:null},retries:{delaySeconds:2,attempts:15}}],noweb:{store:{enabled:!0,fullSync:!1}},proxy:{}}},k.value="new",y.value=!0}function V(n){v.value=ce.cloneDeep({name:n.name,status:n.status,server:n.server.id,config:n.config}),k.value="view",y.value=!0}function E(n){v.value=ce.cloneDeep({name:n.name,status:n.status,server:n.server.id,config:n.config}),k.value="start",y.value=!0}function H(n,f){s.require({target:n.target,message:`Stop '${f.name}' session?
`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-warning p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Stop",accept:async()=>{await _(a.stopSession(f.server.id,f.name,!1),"Stopped","Failed to stop session")},reject:()=>{}})}function z(n,f){s.require({target:n.target,message:`Logout '${f.name}' session?
`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Logout",accept:async()=>{await _(a.logoutSession(f.server.id,f.name),"Logged out","Failed to logout session")},reject:()=>{}})}function Y(){me("store",async()=>await a.refresh())}function G(n){A(n.data)}function A(n){b.value=!0,v.value=n}const S=["name","me.id"];return(n,f)=>{const P=ve,M=W,X=Ie,ie=te,J=Ne,K=Ce,Q=ze,ae=vs,oe=Se,re=ue,Z=Te,de=Qe,ee=Ye,h=eo,Be=Xo;return c(),$(q,null,[e("div",en,[e("div",null,[e("h5",sn,[on,nn,o(P,{refreshing:g(i)},null,8,["refreshing"])])]),e("div",null,[e("button",{onClick:Y,class:"p-link layout-topbar-button",disabled:g(i)},an,8,tn)])]),o(de,{value:g(r).length>0?g(r):[],paginator:!0,rows:20,dataKey:p=>`${p.name}-${p.server.id}-${p.status}`,rowHover:!0,filters:U.value,"onUpdate:filters":f[1]||(f[1]=p=>U.value=p),filterDisplay:"row",loading:B.value,globalFilterFields:S,onRowClick:G,showGridlines:"",class:"p-datatable--clickable",style:{"white-space":"nowrap"}},{header:u(()=>[e("div",rn,[o(M,{label:"Start New",icon:"pi pi-play",severity:"success",onClick:w}),o(J,{iconPosition:"left"},{default:u(()=>[o(X,{class:"pi pi-search"}),o(ie,{modelValue:U.value.global.value,"onUpdate:modelValue":f[0]||(f[0]=p=>U.value.global.value=p),placeholder:"Search by name or phone number",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])]),empty:u(()=>[R(" No sessions found")]),loading:u(()=>[R(" Loading sessions...")]),default:u(()=>[o(Q,{field:"name",header:"Name",sortable:""},{body:u(({data:p})=>[e("div",dn,[o(M,{icon:"pi pi-info",rounded:"",outlined:"",onClick:N=>A(p)},null,8,["onClick"]),e("span",null,I(p.name),1),o(K,{session:p},null,8,["session"])])]),_:1}),o(Q,{field:"status",header:"Status",showFilterMenu:!1,style:{width:"9rem"}},{body:u(({data:p})=>[e("div",cn,[e("div",null,[o(ae,{session:p},null,8,["session"])]),e("div",un,[o(oe,{status:p.status},null,8,["status"])])])]),filter:u(({filterModel:p,filterCallback:N})=>[o(re,{modelValue:p.value,"onUpdate:modelValue":L=>p.value=L,options:g(Zo),onChange:L=>N(),placeholder:"Any",class:"p-column-filter",showClear:!0},{option:u(({option:L})=>[o(oe,{status:L,value:L},null,8,["status","value"])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1}),o(Q,{field:"server.name",filterField:"server.id",header:"Server",showFilterMenu:!1},{filter:u(({filterModel:p,filterCallback:N})=>[o(Z,{placeholder:"Any",onChange:L=>N(),modelValue:p.value,"onUpdate:modelValue":L=>p.value=L,showClear:!0,required:!1},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:1}),o(Q,null,{body:u(({data:p})=>[e("div",pn,[o(M,{icon:"pi pi-cog",severity:"secondary",rounded:"",outlined:"",onClick:N=>V(p)},null,8,["onClick"]),o(M,{icon:"pi pi-play",severity:"success",rounded:"",outlined:"",onClick:N=>E(p)},null,8,["onClick"]),o(M,{icon:"pi pi-stop",severity:"warning",rounded:"",outlined:"",onClick:N=>H(N,p)},null,8,["onClick"]),o(M,{icon:"pi pi-trash",severity:"danger",rounded:"",outlined:"",onClick:N=>z(N,p)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","dataKey","filters","loading"]),o(ee),o(h,{visible:b.value,"onUpdate:visible":f[2]||(f[2]=p=>b.value=p),session:v.value,"onUpdate:session":f[3]||(f[3]=p=>v.value=p)},null,8,["visible","session"]),o(Be,{visible:y.value,"onUpdate:visible":f[4]||(f[4]=p=>y.value=p),session:v.value,"onUpdate:session":f[5]||(f[5]=p=>v.value=p),mode:k.value},null,8,["visible","session","mode"])],64)}}};export{En as _};
