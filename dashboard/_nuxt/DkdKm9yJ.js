import{u as q,s as cs,a as he,b as ge,_ as Te,l as G}from"./sQyK-SvR.js";import P from"./Bop0cGJ1.js";import ps from"./DSVMLoHa.js";import{Y as ye,Q as A,M as c,t as r,v as g,R as M,x as e,z as o,V as $e,_ as pe,N,T as me,y as j,c as L,P as T,O as U,r as S,A as m,W as le,U as K,X as ms,B as O,$ as vs,S as fs,o as Le,C as _s,D as bs,a0 as Se,G as ve,i as Be,a1 as hs,a2 as Me,a3 as gs,a4 as ys,L as $s,Z as ce,a5 as Ss}from"./CaCECGDZ.js";import Oe from"./DuMNKr4x.js";import ws from"./DGZ9dGM6.js";import ie from"./dc4b6sBG.js";import xs from"./DgkBwQaV.js";import Ie from"./CqX05D3V.js";import ks from"./mUDbzm4u.js";import je from"./B4jNwnls.js";import Ne from"./DEKUjKM1.js";import Cs from"./Dam_NNtp.js";import{a as Ee,u as we,_ as qe}from"./D0RKdYSB.js";import xe from"./CmnwwV1x.js";import Pe from"./StpBhrHq.js";import Vs from"./f-XvMWly.js";import Ae from"./CVghVey9.js";import Ds from"./IOtG1cpt.js";import He from"./DztKQaRZ.js";import ke from"./cUi9eWDi.js";import Rs from"./BX43g2Xn.js";import Us from"./-8MliEBP.js";import Fe from"./lkgusaTw.js";import We from"./CSC-Grpx.js";import Ke from"./Y-MB9bnM.js";import Ts from"./DvhA0eOG.js";import Ls from"./XCxmta1f.js";import Bs from"./Dttv2cyU.js";import Ms from"./BlL3If82.js";function Os(t){return t?Object.keys(t).map(n=>({key:n,value:t[n]})):[]}function Is(t){return t.reduce((n,l)=>(n[l.key]=l.value,n),{})}const js={key:0},Ns={key:1,class:"ml-auto flex align-items-center gap-2 mr-2"},Es=e("label",{for:"show-duplicates"},"Hide Duplicates",-1),qs={class:"pi pi-info-circle"},Ps={__name:"HideDuplicates",setup(t){const n=q(),{hideDuplicatedSessions:l,servers:s}=ye(n);return n.$subscribe((a,p)=>{cs(p.hideDuplicatedSessions)}),(a,p)=>{const i=ps,d=A("tooltip");return c(s)&&c(s).length<2?(r(),g("div",js)):(r(),g("div",Ns,[Es,M(e("i",qs,null,512),[[d,`Show NOT STOPPED sessions with the same "name" and "me".
Useful when you use multiple workers with the same database`]]),o(i,{id:"show-duplicates",modelValue:c(l),"onUpdate:modelValue":p[0]||(p[0]=_=>$e(l)?l.value=_:null)},null,8,["modelValue"])]))}}},As={class:"metadata"},Hs={__name:"Metadata",props:["metadata"],setup(t){return(n,l)=>(r(),g("div",As,[(r(!0),g(N,null,me(t.metadata,(s,a)=>(r(),g("pre",{key:a},j(a)+"="+j(s),1))),128))]))}},Fs=pe(Hs,[["__scopeId","data-v-cb7cbf08"]]),Ws={class:"text-center p-1"},Ks={class:"text-center"},Qe={__name:"SessionChip",props:{session:Object,image:String},setup(t){const n=t,l=L(()=>{if(n.session.me)return`${n.session.me.id}`});return(s,a)=>{var i,d;const p=ks;return r(),g("div",null,[e("div",Ws,[e("b",Ks,j((d=(i=n.session)==null?void 0:i.me)==null?void 0:d.pushName),1)]),c(l)?(r(),T(p,{key:0,label:c(l),image:t.image},null,8,["label","image"])):U("",!0)])}}},Ce={__name:"RefreshButton",props:["refreshing"],setup(t){const n=t,l=L(()=>n.refreshing?"pi pi-refresh pi-spin":"pi pi-refresh");return(s,a)=>{const p=P;return r(),T(p,{icon:c(l),rounded:"",text:"",disabled:t.refreshing},null,8,["icon","disabled"])}}},Qs=["src"],ze={__name:"Base64Img",props:{data:String,mimetype:String},setup(t){const n=t,l=L(()=>`data:${n.mimetype};base64, ${n.data}`);return(s,a)=>(r(),g("img",{src:l.value,style:{"max-width":"100%"}},null,8,Qs))}},zs={key:2,style:{"background-color":"#f8f9fa",padding:"1rem",color:"red","white-space":"pre-wrap"}},Ge={__name:"SessionScreenshot",props:{session:Object},setup(t,{expose:n}){const l=q(),s=t,{data:a,pending:p,error:i,refresh:d}=he(`session-screenshot-${s.session.server.id}-${s.session.name}`,async()=>(await ge(1e3),await l.getScreenshot(s.session.server.id,s.session.name)));return n({refresh:d}),(_,v)=>{const w=je,x=Ne,y=ze;return r(),g(N,null,[c(p)?(r(),g(N,{key:0},[o(w,{mode:"indeterminate",style:{height:"3px"}}),!c(a)&&!c(i)?(r(),T(x,{key:0,width:"100%",height:"20rem"})):U("",!0)],64)):U("",!0),c(a)?(r(),T(y,{key:1,data:c(a).data,mimetype:c(a).mimetype},null,8,["data","mimetype"])):U("",!0),c(i)?(r(),g("pre",zs,""+j(c(i).cause.response.data.message||c(i).cause.response.data||c(i))+`
  `,1)):U("",!0)],64)}}},Gs={class:"",style:{"min-width":"20rem"}},Ys={class:"flex justify-content-center align-items-center"},Js=e("h5",{class:"m-0"},"Screenshot",-1),Xs={class:"m-auto w-full"},Zs={__name:"ScreenshotButton",props:["session"],setup(t){const n=t,l=S(null),s=S(null),a=d=>{l.value.toggle(d)},p=()=>{s.value.refresh()},i=L(()=>n.session.status==="STOPPED");return(d,_)=>{const v=P,w=Ce,x=Ge,y=Cs,k=A("tooltip");return r(),g(N,null,[M(o(v,{disabled:c(i),type:"button",icon:"pi pi-camera",onClick:a,rounded:"",outlined:"",severity:"help"},null,8,["disabled"]),[[k,"Screenshot / QR",void 0,{top:!0}]]),o(y,{ref_key:"op",ref:l,appendTo:"body",showCloseIcon:!0},{default:m(()=>[e("div",Gs,[e("div",Ys,[Js,o(w,{onClick:p})]),e("div",Xs,[o(x,{ref_key:"screenshot",ref:s,session:t.session},null,8,["session"])])])]),_:1},512)],64)}}},eo={class:"ml-1"},so={key:1},oo={class:"ml-1"},Ye={__name:"ServerDropdown",props:le({showClear:Boolean,placeholder:String,required:Boolean,invalid:Boolean,disabled:Boolean},{server:{},serverModifiers:{}}),emits:["update:server"],setup(t){const n=K(t,"server"),l=q();return(s,a)=>{const p=Ee,i=xe;return r(),T(i,{optionValue:"id",modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=d=>n.value=d),options:c(l).servers,onChange:a[1]||(a[1]=d=>s.$emit("change",n.value)),placeholder:t.placeholder,class:"p-column-filter",showClear:t.showClear,required:t.required,invalid:t.invalid,disabled:t.disabled},{value:m(d=>[d.value?(r(),g(N,{key:0},[o(p,{connected:c(l).getServer(d.value).connected},null,8,["connected"]),e("span",eo,j(c(l).getServer(d.value).name),1)],64)):(r(),g("span",so,j(d.placeholder),1))]),option:m(d=>[o(p,{connected:d.option.connected},null,8,["connected"]),e("span",oo,j(d.option.name)+" ("+j(d.option.connection.url)+") ",1)]),_:1},8,["modelValue","options","placeholder","showClear","required","invalid","disabled"])}}},to={class:"flex flex-row gap-2 justify-content-end"},Je={__name:"SessionActionButtons",props:["name","isStarting","isRestarting","isStopping","isLoggingOut","isRemoving","allDisabled","hideActions","skipConfirmation","group"],emits:["view","start","restart","stop","logout","delete"],setup(t,{emit:n}){const l=ms(),s=t,a=n;function p(y){return s.skipConfirmation?!s.skipConfirmation.includes(y):!0}async function i(){if(!p("start")){a("start");return}l.require({group:s.group,target:event.target,message:`Start ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-success p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Start",accept:()=>{a("start")},reject:()=>{}})}const d=L(()=>s.hideActions?!s.hideActions.includes("view"):!0);function _(y){l.require({group:s.group,target:y.target,message:`Restart ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-info p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Restart",accept:()=>{a("restart")},reject:()=>{}})}function v(y){l.require({group:s.group,target:y.target,message:`Stop ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-warning p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Stop",accept:async()=>{a("stop")},reject:()=>{}})}function w(y){l.require({group:s.group,target:y.target,message:`Logout ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-warning p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Logout",accept:async()=>{a("logout")},reject:()=>{}})}function x(y){l.require({group:s.group,target:y.target,message:`Delete ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Delete",accept:async()=>{a("delete")},reject:()=>{}})}return(y,k)=>{const C=P,V=Pe,u=Vs,f=A("tooltip");return r(),g(N,null,[e("div",to,[c(d)?M((r(),T(C,{key:0,icon:"pi pi-cog",severity:"help",rounded:"",outlined:"",onClick:k[0]||(k[0]=I=>y.$emit("view")),disabled:t.allDisabled},null,8,["disabled"])),[[f,"Configuration",void 0,{top:!0}]]):U("",!0),M(o(C,{icon:"pi pi-play",severity:"success",rounded:"",outlined:"",onClick:i,loading:t.isStarting,disabled:t.allDisabled},null,8,["loading","disabled"]),[[f,"Start",void 0,{top:!0}]]),M(o(C,{icon:"pi pi-replay",severity:"info",rounded:"",outlined:"",onClick:k[1]||(k[1]=I=>_(I)),loading:t.isRestarting,disabled:t.allDisabled},null,8,["loading","disabled"]),[[f,"Restart",void 0,{top:!0}]]),M(o(C,{icon:"pi pi-stop",severity:"secondary",rounded:"",outlined:"",onClick:k[2]||(k[2]=I=>v(I)),loading:t.isStopping,disabled:t.allDisabled},null,8,["loading","disabled"]),[[f,"Stop",void 0,{top:!0}]]),M(o(C,{icon:"pi pi-sign-out",severity:"warning",rounded:"",outlined:"",onClick:k[3]||(k[3]=I=>w(I)),loading:t.isLoggingOut,disabled:t.allDisabled},null,8,["loading","disabled"]),[[f,"Logout",void 0,{top:!0}]]),M(o(C,{icon:"pi pi-trash",severity:"danger",rounded:"",outlined:"",onClick:k[4]||(k[4]=I=>x(I)),loading:t.isRemoving,disabled:t.allDisabled},null,8,["loading","disabled"]),[[f,"Delete",void 0,{top:!0}]])]),t.group==="popup"?(r(),T(V,{key:0,group:"popup"})):U("",!0),t.group==="dialog"?(r(),T(u,{key:1,group:"dialog"})):U("",!0)],64)}}},no={class:"flex flex-row gap-2 justify-content-end"},lo={__name:"SessionActions",props:["session","disabled"],setup(t,{expose:n}){const l=t,s=q(),a=we(),p=S(!1),i=S(!1),d=S(!1),_=S(!1),v=S(!1),w=L(()=>l.disabled||p.value||i.value||d.value||_.value||v.value);async function x(){const u=l.session;_.value=!0,await a(s.startSession(u.server.id,u.name),"Started","Failed to start session",u.name,u.name).finally(()=>_.value=!1)}async function y(){const u=l.session;v.value=!0,await a(s.restartSession(u.server.id,u.name),"Restarted","Failed to restart session",u.name,u.name).finally(()=>v.value=!1)}async function k(){const u=l.session;p.value=!0,await a(s.stopSession(u.server.id,u.name),"Stopped","Failed to stop session",u.name,u.name).finally(()=>p.value=!1)}async function C(){const u=l.session;i.value=!0,await a(s.logoutSession(u.server.id,u.name),"Logged out","Failed to logout session",u.name,u.name).finally(()=>i.value=!1)}async function V(){const u=l.session;d.value=!0,await a(s.deleteSession(u.server.id,u.name),"Deleted","Failed to delete session",u.name,u.name).finally(()=>d.value=!1)}return n({startSession:x,restartSession:y,stopSession:k,logoutSession:C,deleteSession:V}),(u,f)=>{const I=Je;return r(),g("div",no,[o(I,{group:"popup",name:`'${t.session.name}' session`,onView:f[0]||(f[0]=Y=>u.$emit("view",t.session)),onStart:x,onRestart:y,onStop:k,onLogout:C,onDelete:V,"is-starting":c(_),"is-restarting":c(v),"is-stopping":c(p),"is-logging-out":c(i),"is-removing":c(d),"all-disabled":c(w),"hide-actions":[],"skip-confirmation":["start"]},null,8,["name","is-starting","is-restarting","is-stopping","is-logging-out","is-removing","all-disabled"])])}}},io={class:"p-dialog-title flex gap-2 align-items-center"},ao=e("i",{class:"pi pi-whatsapp"},null,-1),ro=e("span",null,"(",-1),uo={class:"ml-1"},co=e("span",null,")",-1),po=["disabled"],mo=e("i",{class:"pi pi-refresh"},null,-1),vo=[mo],Ve={__name:"SessionHeader",props:{session:Object,refresh:Boolean},setup(t){const n=t,l=q(),{refreshing:s}=ye(l),a=L(()=>n.session.server.id?n.session.server:l.getServer(n.session.server));async function p(){await l.refresh()}return(i,d)=>{var y,k;const _=qe,v=Ee,w=Te,x=A("tooltip");return r(),g("div",io,[ao,e("span",null,j((y=t.session)==null?void 0:y.name),1),o(_,{status:t.session.status,value:(k=t.session.status)==null?void 0:k.toUpperCase()},null,8,["status","value"]),e("div",null,[ro,o(v,{connected:a.value.connected},null,8,["connected"]),e("span",uo,j(a.value.name),1),co]),t.refresh?M((r(),g("button",{key:0,onClick:d[0]||(d[0]=C=>p()),class:"p-link layout-topbar-button",disabled:c(s)},vo,8,po)),[[x,"Refresh",void 0,{top:!0}]]):U("",!0),o(w,{refreshing:c(s)},null,8,["refreshing"])])}}},fo={class:"-mt-4 p-0 line-height-3 block",style:{"font-family":"monaco, Consolas, 'Lucida Console', monospace"}},_o={__name:"CodeHighlight",props:["invalid"],setup(t){const n=t,l=L(()=>n.invalid?"p-invalid p-component p-inputtext":"");return(s,a)=>(r(),g("pre",{class:fs(["border-round surface-ground text-900 p-5 overflow-auto",l.value])},[O("        "),e("code",fo,[vs(s.$slots,"default")])],2))}},De=t=>(_s("data-v-aa1b18ec"),t=t(),bs(),t),bo={class:"h-full flex flex-column"},ho={class:"flex justify-content-center align-items-center"},go=De(()=>e("h5",{class:"m-0"},"Request",-1)),yo={class:"flex flex-column justify-content-between h-full"},$o={class:"flex flex-column gap-2"},So={class:"flex gap-2"},wo={class:"text-center"},xo=De(()=>e("div",{class:"mb-2"},"Body",-1)),ko={class:"text-center mt-2"},Co={class:"flex flex-column h-full"},Vo={class:"flex justify-content-center align-items-center"},Do=De(()=>e("h5",{class:"m-0"},"Response",-1)),Ro={__name:"SessionRequestResponse",props:["session"],setup(t){const n=q(),l=t,s=S(null),a=S("POST"),p=S("/api/sendText"),i=S(""),d=S(!1),_=S(!1);function v(u){return JSON.stringify(u,null,2)}function w(u){try{return JSON.parse(u)}catch{return u}}const x=L(()=>({method:a.value,uri:p.value,params:void 0,body:w(i.value)})),y=["GET","POST","PUT","DELETE","PATCH"];async function k(u){await navigator.clipboard.writeText(s.value),u.preventDefault()}async function C(u){await navigator.clipboard.writeText(v(x.value)),u.preventDefault()}async function V(){try{_.value=!1,d.value=!0;const u=await n.callServerAPI(l.session.server.id,x.value);s.value=v(u)}catch(u){_.value=!0,u.response?s.value=v(u.response.data):s.value=v(u)}finally{d.value=!1}}return Le(()=>{const u={chatId:"11111111111@c.us",text:"Hi there!",session:l.session.name};i.value=v(u),s.value="..."}),(u,f)=>{const I=P,Y=xe,E=ie,ae=Ds,H=He,oe=_o,J=A("tooltip");return r(),g(N,null,[e("div",null,[e("div",bo,[e("div",ho,[go,M(o(I,{rounded:"",text:"",tabindex:0,icon:"pi pi-copy",onClick:f[0]||(f[0]=$=>C($))},null,512),[[J,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),e("div",yo,[e("div",$o,[e("div",So,[o(Y,{modelValue:a.value,"onUpdate:modelValue":f[1]||(f[1]=$=>a.value=$),options:y},null,8,["modelValue"]),o(E,{type:"text",class:"w-full",modelValue:p.value,"onUpdate:modelValue":f[2]||(f[2]=$=>p.value=$),placeholder:"API Endpoint"},null,8,["modelValue"])]),e("div",wo,[xo,o(ae,{modelValue:i.value,"onUpdate:modelValue":f[3]||(f[3]=$=>i.value=$),rows:"8",class:"w-full",placeholder:"Request"},null,8,["modelValue"])])]),e("div",ko,[o(I,{onClick:V,loading:d.value,label:"Send",icon:"pi pi-send","icon-pos":"right"},null,8,["loading"])])])])]),o(H),e("div",null,[e("div",Co,[e("div",Vo,[Do,M(o(I,{rounded:"",text:"",tabindex:0,icon:"pi pi-copy",onClick:f[4]||(f[4]=$=>k($))},null,512),[[J,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),o(oe,{class:"m-0 p-4 pretty",invalid:_.value},{default:m(()=>[O(j(s.value),1)]),_:1},8,["invalid"])])])],64)}}},Uo=pe(Ro,[["__scopeId","data-v-aa1b18ec"]]),To={class:"grid pt-4"},Lo={class:"col-12 sm:col-6 h-full"},Bo={class:"grid"},Mo={class:"col-12"},Oo={class:""},Io={class:"flex justify-content-center align-items-center"},jo={class:"col-12"},No={class:""},Eo={class:"flex justify-content-center align-items-center"},qo=e("h5",{class:"m-0"},"Screenshot",-1),Po={class:"m-auto w-full"},Ao={class:"col-12 sm:col-6 h-full card"},Ho={__name:"SessionControl",props:["session"],setup(t){const n=q(),l=t,s=S(null),a=()=>{s.value.refresh()},p=S(null);return Le(()=>{var i,d;(d=(i=l.session)==null?void 0:i.me)!=null&&d.id&&n.getProfilePicture(l.session.server.id,l.session.name,l.session.me.id).then(_=>{p.value=_.profilePictureURL})}),(i,d)=>{const _=Qe,v=Ce,w=Ge,x=Uo;return r(),g("div",To,[e("div",Lo,[e("div",Bo,[e("div",Mo,[e("div",Oo,[e("div",Io,[t.session.me?(r(),T(_,{key:0,session:t.session,image:c(p)},null,8,["session","image"])):U("",!0)])])]),e("div",jo,[e("div",No,[e("div",Eo,[qo,o(v,{onClick:a})]),e("div",Po,[o(w,{ref_key:"screenshot",ref:s,session:t.session},null,8,["session"])])])])])]),e("div",Ao,[o(x,{session:t.session},null,8,["session"])])])}}},Fo={__name:"SessionControlDialog",props:{visible:{},visibleModifiers:{},session:{},sessionModifiers:{}},emits:["update:visible","update:session"],setup(t){const n=K(t,"visible"),l=K(t,"session");return Se(),(s,a)=>{const p=Ve,i=Ho,d=ke;return r(),T(d,{visible:n.value,"onUpdate:visible":a[0]||(a[0]=_=>n.value=_),modal:!0,maximizable:""},{header:m(()=>[o(p,{session:l.value},null,8,["session"])]),default:m(()=>[o(i,{session:l.value},null,8,["session"])]),_:1},8,["visible"])}}},Wo={class:"card p-fluid"},Ko={class:"flex flex-grow-1 justify-content-center"},Qo={class:"flex flex-grow-1 justify-content-center"},Xe={__name:"KeyValueTable",props:le(["keyColumn","keyColumnName","prefix"],{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const n=K(t,"modelValue"),l=t,s=S([]),a=_=>{let{newData:v,index:w}=_;n.value[w]=v},p=_=>{let{data:v,newValue:w,field:x}=_;v[x]=w};function i(){const _=n.value.length+1,v=`${l.prefix}${_}`;n.value.unshift({[l.keyColumn]:v,value:"123"})}function d(_){n.value.splice(_,1)}return(_,v)=>{const w=ie,x=Ie,y=P,k=Ae,C=A("tooltip");return r(),g("div",Wo,[o(k,{editingRows:s.value,"onUpdate:editingRows":v[0]||(v[0]=V=>s.value=V),value:n.value,editMode:"cell",dataKey:l.keyColumn,onRowEditSave:a,onCellEditComplete:p,pt:{table:{style:"min-width: 50rem"},column:{bodycell:({state:V})=>({style:V.d_editing&&"padding-top: 0.6rem; padding-bottom: 0.6rem"})}}},{default:m(()=>[o(x,{field:l.keyColumn,header:l.keyColumnName,style:{width:"40%"}},{editor:m(({data:V,field:u})=>[o(w,{modelValue:V[u],"onUpdate:modelValue":f=>V[u]=f},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["field","header"]),o(x,{style:{width:"40%"},field:"value",header:"Value"},{editor:m(({data:V,field:u})=>[o(w,{modelValue:V[u],"onUpdate:modelValue":f=>V[u]=f},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(x,{style:{"min-width":"1rem"}},{header:m(()=>[e("div",Ko,[M(o(y,{label:"",rounded:"",text:"",style:{height:"2rem",width:"2rem"},icon:"pi pi-plus",severity:"success",onClick:i},null,512),[[C,"Add",void 0,{top:!0}]])])]),body:m(({index:V})=>[e("div",Qo,[M(o(y,{label:"",rounded:"",text:"",style:{height:"2rem",width:"2rem"},icon:"pi pi-trash",severity:"warning",onClick:u=>d(V)},null,8,["onClick"]),[[C,"Delete",void 0,{top:!0}]])])]),_:1})]),_:1},8,["editingRows","value","dataKey","pt"])])}}},zo={class:"flex justify-content-between align-items-center w-full"},Go={class:"field"},Yo=e("label",{for:"url"},"URL",-1),Jo={class:"field mb-4"},Xo=e("label",{for:"events"},"Events",-1),Zo=e("div",{class:"font-bold mb-2"},"Retries",-1),et={class:"flex gap-3"},st={class:"field"},ot=e("label",{for:"retries-attempts"},"Attempts",-1),tt=e("span",{class:"pi pi-plus"},null,-1),nt=e("span",{class:"pi pi-minus"},null,-1),lt={class:"field"},it=e("label",{for:"retries-delay-seconds"},"Delay, seconds",-1),at=e("span",{class:"pi pi-plus"},null,-1),rt=e("span",{class:"pi pi-minus"},null,-1),dt={class:"field"},ut=e("label",{for:"hmac"},"HMAC Key (optional)",-1),ct={class:"field"},pt={class:"field flex justify-content-between align-items-center"},mt=e("div",null,[e("label",{for:"hmac"},"Custom Headers (optional)")],-1),vt={__name:"SessionWebhook",props:le({disabled:Boolean,index:Number},{webhook:{},webhookModifiers:{}}),emits:["update:webhook"],setup(t){const n=K(t,"webhook"),l=t,s=["session.status","message","message.any","message.reaction","message.ack","message.revoked","chat.archive","group.join","group.leave","presence.update","poll.vote","poll.vote.failed","call.received","call.accepted","call.rejected","label.upsert","label.deleted","label.chat.added","label.chat.deleted"],a=S(n.value.customHeaders&&n.value.customHeaders.length>0);return ve(a,(p,i)=>{if(i&&!p){n.value.customHeaders=null;return}!i&&p&&(n.value.customHeaders=[{name:"X-Header-1",value:"123"}])}),(p,i)=>{const d=P,_=ie,v=Oe,w=Ts,x=Be("font-awesome-icon"),y=Fe,k=Xe,C=We,V=Ke,u=A("tooltip");return r(),T(V,{activeIndex:0},{default:m(()=>[o(C,null,{header:m(()=>[e("div",zo,[e("div",null," Webhook "+j(l.index+1),1),e("div",null,[M(o(d,{label:"",text:"",rounded:"",style:{height:"2rem",width:"2rem"},icon:"pi pi-trash",severity:"warning",onClick:i[0]||(i[0]=f=>p.$emit("remove"))},null,512),[[u,"Delete Webhook",void 0,{top:!0}]])])])]),default:m(()=>[e("div",Go,[Yo,o(_,{id:"url",modelValue:n.value.url,"onUpdate:modelValue":i[1]||(i[1]=f=>n.value.url=f),modelModifiers:{trim:!0},required:"true",disabled:t.disabled},null,8,["modelValue","disabled"])]),e("div",Jo,[Xo,o(v,{id:"events",modelValue:n.value.events,"onUpdate:modelValue":i[2]||(i[2]=f=>n.value.events=f),options:s,placeholder:"Select Events","max-selected-labels":1,selectedItemsLabel:"{0} events selected",disabled:t.disabled},null,8,["modelValue","disabled"]),e("ul",null,[(r(!0),g(N,null,me(n.value.events,f=>(r(),g("li",{key:f},j(f),1))),128))])]),e("div",null,[Zo,e("div",et,[e("div",st,[ot,o(w,{modelValue:n.value.retries.attempts,"onUpdate:modelValue":i[3]||(i[3]=f=>n.value.retries.attempts=f),inputId:"retries-delay-attempts",showButtons:"",buttonLayout:"horizontal",min:1,step:1,disabled:t.disabled},{incrementbuttonicon:m(()=>[tt]),decrementbuttonicon:m(()=>[nt]),_:1},8,["modelValue","disabled"])]),e("div",lt,[it,o(w,{modelValue:n.value.retries.delaySeconds,"onUpdate:modelValue":i[4]||(i[4]=f=>n.value.retries.delaySeconds=f),inputId:"retries-delay-seconds",showButtons:"",buttonLayout:"horizontal",min:1,step:1,disabled:t.disabled},{incrementbuttonicon:m(()=>[at]),decrementbuttonicon:m(()=>[rt]),_:1},8,["modelValue","disabled"])])])]),e("div",dt,[ut,o(_,{id:"hmac",modelValue:n.value.hmac.key,"onUpdate:modelValue":i[5]||(i[5]=f=>n.value.hmac.key=f),modelModifiers:{trim:!0},disabled:t.disabled},null,8,["modelValue","disabled"])]),e("div",ct,[e("div",pt,[mt,o(y,{modelValue:a.value,"onUpdate:modelValue":i[6]||(i[6]=f=>a.value=f),id:"customHeaders",onLabel:"Headers On",offLabel:"Headers Off"},{icon:m(()=>[o(x,{icon:"fa-solid fa-fingerprint",class:"mr-2"})]),_:1},8,["modelValue"])]),a.value?(r(),T(k,{key:0,modelValue:n.value.customHeaders,"onUpdate:modelValue":i[7]||(i[7]=f=>n.value.customHeaders=f),"key-column":"name","key-column-name":"Header",prefix:"X-Header-"},null,8,["modelValue"])):U("",!0)])]),_:1})]),_:1})}}},ft={class:"flex flex-column gap-2"},_t={class:"flex justify-content-between align-items-center w-full"},bt=e("h5",null,"🔄 Webhooks",-1),ht={class:"pr-2"},gt={key:0,class:"text-300 text-center"},yt={__name:"SessionWebhooksField",props:le({disabled:Boolean},{webhooks:{},webhooksModifiers:{}}),emits:["update:webhooks"],setup(t){const n=K(t,"webhooks");function l(){const a={url:"https://httpbin.org/post",events:["session.status","message"],hmac:{key:null},retries:{delaySeconds:2,attempts:15},customHeaders:null};n.value.push(a)}function s(a){n.value.splice(a,1)}return(a,p)=>{const i=P,d=vt;return r(),g("div",ft,[e("div",_t,[bt,e("div",ht,[o(i,{label:"Add Webhook",text:"",icon:"pi pi-plus",severity:"success",onClick:l})])]),n.value.length===0?(r(),g("div",gt," No webhooks configured ")):(r(!0),g(N,{key:1},me(n.value,(_,v)=>(r(),T(d,{webhook:n.value[v],"onUpdate:webhook":w=>n.value[v]=w,index:v,total:n.value.length,onRemove:w=>s(v),disabled:t.disabled},null,8,["webhook","onUpdate:webhook","index","total","onRemove","disabled"]))),256))])}}},$t=e("div",null,[e("h5",null,[e("i",{class:"pi pi-whatsapp"}),O(" Create Session ")])],-1),St={class:"mb-2"},wt=e("b",null,"Server",-1),xt=e("b",null,"Name",-1),kt={class:"field"},Ct=e("label",{for:"server"},"Server",-1),Vt={key:0,class:"p-invalid"},Dt={class:"field"},Rt=e("label",{for:"name"},"Name (optional)",-1),Ut={key:0,class:"mb-4"},Tt=e("div",{class:"mb-3"},[e("h5",null,"🏭 Engine Settings ")],-1),Lt={class:"flex flex-column gap-2"},Bt=e("div",null,[e("a",{href:"https://waha.devlike.pro/docs/engines/noweb",target:"_blank"},"Read more about NOWEB settings")],-1),Mt={class:"flex gap-2"},Ot={class:"pi pi-info-circle"},It={class:"field mt-4"},jt={class:"field flex justify-content-between align-items-center"},Nt=e("div",null,[e("h5",null,[e("label",{for:"proxy"},"🌐 Proxy")])],-1),Et={key:0,class:"card mb-4"},qt={class:"field"},Pt=e("label",{for:"proxy-server"},"Server",-1),At={key:0,class:"p-invalid"},Ht={class:"flex gap-3"},Ft={class:"field w-full"},Wt=e("label",{for:"proxy-username"},"Username (optional)",-1),Kt={class:"field w-full"},Qt=e("label",{for:"proxy-password"},"Password (optional)",-1),zt={class:"field flex justify-content-between align-items-center"},Gt=e("div",null,[e("h5",null,[e("label",{for:"debug"},"🛠️ Debug")])],-1),Yt={class:"w-full flex flex-column gap-2"},Jt={class:"flex justify-content-end"},Xt={__name:"SessionDialog",props:le({mode:String},{visible:{},visibleModifiers:{},session:{},sessionModifiers:{}}),emits:["update:visible","update:session"],setup(t){var oe,J;const n=Se(),l=K(t,"visible"),s=K(t,"session"),a=t,p=L(()=>a.mode==="new"),i=L(()=>a.mode==="update"),d=L(()=>i.value),_=we(),v=q(),w=L(()=>v.getServer(s.value.server)),x=L(()=>{var $,b;return((b=($=w.value)==null?void 0:$.version)==null?void 0:b.engine)==="NOWEB"});L(()=>{var $,b;return((b=($=w.value)==null?void 0:$.version)==null?void 0:b.engine)==="WEBJS"});const y=S([]),k=S(!!((J=(oe=s.value.config)==null?void 0:oe.proxy)!=null&&J.server));ve(s,async($,b)=>{var Q,F,te;k.value=(F=(Q=$==null?void 0:$.config)==null?void 0:Q.proxy)==null?void 0:F.server,y.value=Os((te=$.config)==null?void 0:te.metadata)});const C=S(!1),V=S(!1),u=L(()=>{const $=G.cloneDeep(s.value.config);return k.value||($.proxy=void 0),$.metadata=Is(y.value),$}),f=L(()=>{const $={...u.value};return x.value||delete $.noweb,{name:s.value.name,config:$}});async function I(){C.value=!0;try{V.value=!0;const $=G.cloneDeep(f.value);await _(v.updateSession(s.value.server,s.value.name,$.config),void 0,"Failed to update session"),n.add({severity:"success",summary:"Updated",detail:s.value.name,life:3e3})}finally{V.value=!1}s.value=void 0,E()}async function Y($){C.value=!0;try{V.value=!0;const b=G.cloneDeep(f.value);b.start=$;const Q=await _(v.createSession(s.value.server,b),void 0,"Failed to start session"),F=$?"Started":"Created";n.add({severity:"success",summary:F,detail:Q.name,life:3e3})}finally{V.value=!1}s.value=void 0,E()}function E(){C.value=!1,l.value=!1}const ae=L(()=>s.value.status==="STOPPED");async function H($){await navigator.clipboard.writeText(JSON.stringify({method:"POST",uri:"/api/sessions",body:f.value},null,2)),$.preventDefault()}return($,b)=>{const Q=Ve,F=Rs,te=Ye,re=ie,fe=Us,X=Be("font-awesome-icon"),Z=Fe,_e=We,B=Ke,D=Xe,de=yt,ue=Ls,ne=P,be=ke,ee=A("tooltip");return r(),T(be,{visible:l.value,"onUpdate:visible":b[15]||(b[15]=R=>l.value=R),modal:!0,class:"p-fluid",maximizable:""},hs({footer:m(()=>[e("div",Yt,[e("div",null,[i.value&&!ae.value?(r(),T(F,{key:0,severity:"warn"},{default:m(()=>[O(" The session is in '"),e("b",null,j(s.value.status)+"'",1),O(" status, in order to save configuration the session will be restarted. ")]),_:1})):U("",!0)]),e("div",Jt,[M(o(ne,{label:"Copy",text:"",tabindex:0,icon:"pi pi-copy",severity:"secondary",onClick:b[12]||(b[12]=R=>H(R))},null,512),[[ee,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]]),i.value?U("",!0):(r(),T(ne,{key:0,label:"Create",icon:"pi pi-plus",text:"",onClick:b[13]||(b[13]=R=>Y(!1)),loading:V.value},null,8,["loading"])),i.value?U("",!0):(r(),T(ne,{key:1,label:"Create & Start",icon:"pi pi-play",text:"",onClick:b[14]||(b[14]=R=>Y(!0)),loading:V.value},null,8,["loading"])),i.value?(r(),T(ne,{key:2,label:"Update",icon:"pi pi-save",text:"",onClick:I,loading:V.value},null,8,["loading"])):U("",!0)])])]),default:m(()=>[e("div",St,[i.value?(r(),T(F,{key:0,severity:"info"},{default:m(()=>[O(" To change the "),wt,O(" or "),xt,O(" - please remove the session and run again. ")]),_:1})):U("",!0)]),e("div",kt,[Ct,o(te,{placeholder:"Select Server",modelValue:s.value.server,"onUpdate:modelValue":b[0]||(b[0]=R=>s.value.server=R),showClear:!1,required:!0,invalid:C.value&&!s.value.server,disabled:d.value},null,8,["modelValue","invalid","disabled"]),C.value&&!s.value.server?(r(),g("small",Vt,"Server is required.")):U("",!0)]),e("div",Dt,[Rt,o(re,{id:"name",modelValue:s.value.name,"onUpdate:modelValue":b[1]||(b[1]=R=>s.value.name=R),modelModifiers:{trim:!0},required:"false",autofocus:"",placeholder:"session_1111111111111",disabled:!p.value},null,8,["modelValue","disabled"])]),x.value?(r(),g("div",Ut,[Tt,o(B,{activeIndex:0},{default:m(()=>[o(_e,{header:"NOWEB"},{header:m(()=>[O("  "),o(fe,{value:"New"})]),default:m(()=>[e("div",Lt,[Bt,e("div",null,[M((r(),T(Z,{modelValue:s.value.config.noweb.markOnline,"onUpdate:modelValue":b[2]||(b[2]=R=>s.value.config.noweb.markOnline=R),onLabel:"Presence: online",offLabel:"Presence: offline",disabled:d.value},{icon:m(()=>[o(X,{icon:"fa-solid fa-sync",class:"mr-2"})]),_:1},8,["modelValue","disabled"])),[[ee,"Send presence when connect for the connected session. If presence online - you don not get notifications in your phone"]])]),e("div",Mt,[e("div",null,[M((r(),T(Z,{modelValue:s.value.config.noweb.store.enabled,"onUpdate:modelValue":b[3]||(b[3]=R=>s.value.config.noweb.store.enabled=R),onLabel:"Store: Enabled",offLabel:"Store: Disabled",disabled:d.value},{icon:m(()=>[o(X,{icon:"fa-solid fa-folder",class:"mr-2"})]),_:1},8,["modelValue","disabled"])),[[ee,"Store contacts, chats, messages in the database, so you can get it in API"]])]),e("div",null,[M((r(),T(Z,{modelValue:s.value.config.noweb.store.fullSync,"onUpdate:modelValue":b[4]||(b[4]=R=>s.value.config.noweb.store.fullSync=R),onLabel:"Store: Full Sync On",offLabel:"Store: Full Sync Off",disabled:d.value},{icon:m(()=>[o(X,{icon:"fa-solid fa-sync",class:"mr-2"})]),_:1},8,["modelValue","disabled"])),[[ee,`Sync all contacts, chats, messages from the phone at the start.
Otherwise the store can miss some information.`]])])])])]),_:1})]),_:1})])):U("",!0),e("div",null,[e("div",null,[e("h5",null,[O("📝 Metadata "),M(e("i",Ot,null,512),[[ee,"Key value pairs you can attach to Session and will receive it in webhooks, API and search the values on Dashboard."]])])]),o(D,{modelValue:y.value,"onUpdate:modelValue":b[5]||(b[5]=R=>y.value=R),"key-column":"key","key-column-name":"Key",prefix:"user.id."},null,8,["modelValue"])]),e("div",It,[o(de,{ref:"webhooks",webhooks:s.value.config.webhooks,"onUpdate:webhooks":b[6]||(b[6]=R=>s.value.config.webhooks=R)},null,8,["webhooks"])]),e("div",null,[e("div",jt,[Nt,o(Z,{modelValue:k.value,"onUpdate:modelValue":b[7]||(b[7]=R=>k.value=R),id:"proxy",onLabel:"Proxy On",offLabel:"Proxy Off"},{icon:m(()=>[o(X,{icon:"fa-solid fa-server",class:"mr-2"})]),_:1},8,["modelValue"])]),k.value?(r(),g("div",Et,[e("div",qt,[Pt,o(re,{id:"proxy-server",modelValue:s.value.config.proxy.server,"onUpdate:modelValue":b[8]||(b[8]=R=>s.value.config.proxy.server=R),modelModifiers:{trim:!0},required:"true",invalid:C.value&&!s.value.config.proxy.server,placeholder:"host:port"},null,8,["modelValue","invalid"]),C.value&&!s.value.config.proxy.server?(r(),g("small",At,"Server is required.")):U("",!0)]),e("div",Ht,[e("div",Ft,[Wt,o(re,{id:"proxy-username",modelValue:s.value.config.proxy.username,"onUpdate:modelValue":b[9]||(b[9]=R=>s.value.config.proxy.username=R),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e("div",Kt,[Qt,o(ue,{id:"proxy-password",modelValue:s.value.config.proxy.password,"onUpdate:modelValue":b[10]||(b[10]=R=>s.value.config.proxy.password=R),modelModifiers:{trim:!0},feedback:!1,toggleMask:""},null,8,["modelValue"])])])])):U("",!0)]),e("div",zt,[Gt,o(Z,{modelValue:s.value.config.debug,"onUpdate:modelValue":b[11]||(b[11]=R=>s.value.config.debug=R),onLabel:"Debug Enabled",offLabel:"Debug Disabled",onIcon:"fa fa-bug"},{icon:m(()=>[o(X,{icon:"fa-solid fa-bug",class:"mr-2"})]),_:1},8,["modelValue"])])]),_:2},[p.value?{name:"header",fn:m(()=>[$t]),key:"0"}:void 0,p.value?void 0:{name:"header",fn:m(()=>[e("div",null,[o(Q,{session:s.value},null,8,["session"])])]),key:"1"}]),1032,["visible"])}}},Zt=["WORKING","FAILED","STARTING","SCAN_QR_CODE","STOPPED"],en={class:"",style:{"min-width":"20rem"}},sn={class:"flex justify-content-center align-items-center"},on=e("h5",{class:"m-0"},"QR",-1),tn={class:"m-auto w-full"},nn={class:"flex justify-content-center"},ln={key:1,style:{"background-color":"#f8f9fa",padding:"1rem",color:"red","white-space":"pre-wrap"}},an={__name:"QRImage",props:{session:Object},setup(t){const n=q(),l=t,{data:s,pending:a,error:p,refresh:i}=he(`session-qr-${l.session.server.id}-${l.session.name}`,async()=>(await ge(1e3),await n.getQR(l.session.server.id,l.session.name)));return(d,_)=>{const v=Ce,w=je,x=Ne,y=ze;return r(),g("div",en,[e("div",sn,[on,o(v,{onClick:c(i)},null,8,["onClick"])]),e("div",tn,[c(a)?(r(),g(N,{key:0},[o(w,{mode:"indeterminate",style:{height:"3px"}}),!c(s)&&!c(p)?(r(),T(x,{key:0,width:"100%",height:"20rem"})):U("",!0)],64)):U("",!0),e("div",nn,[c(s)?(r(),T(y,{key:0,data:c(s).data,mimetype:c(s).mimetype},null,8,["data","mimetype"])):U("",!0),c(p)?(r(),g("pre",ln,""+j(c(p).cause.response.data.message||c(p).cause.response.data||c(p))+`
  `,1)):U("",!0)])])])}}},rn={},dn={class:"pl-4"},un=Me('<li> Open <b>WhatsApp</b> on your phone </li><li> Tap <b>More options</b> <i class="pi pi-ellipsis-v"></i> or <b>Settings</b> <i class="pi pi-cog"></i></li><li> Tap <b>Linked Devices</b> &gt; <b>Link a device</b></li><li><b>Link with phone number instead</b> and enter the code </li>',4),cn=[un];function pn(t,n){return r(),g("ul",dn,cn)}const mn=pe(rn,[["render",pn]]),vn={class:"flex flex-column gap-2 mt-4"},fn={class:"flex justify-content-between gap-2"},_n={class:"field"},bn={class:"card flex justify-content-center align-items-center"},hn={class:"mx-1",style:{"font-size":"2rem"}},gn={__name:"PairingCodeSteps",props:["session"],setup(t){const n=t,l=S(null),s=S(!1),a=S(""),p=we(),i=q();function d(v){return v.replace(/\D/g,"")}async function _(){l.value=d(l.value),s.value=!0;try{await ge(1e3);const v=await p(i.getPairingCode(n.session.server.id,n.session.name,l.value),"Request sent","Failed to request code",n.session.name,n.session.name);a.value=v.code}finally{s.value=!1}}return ve(l,G.debounce(v=>{l.value=d(v)},1e3)),(v,w)=>{const x=ie,y=P,k=He;return r(),g(N,null,[e("div",vn,[e("form",{onSubmit:gs(_,["prevent"])},[e("div",fn,[e("div",_n,[o(x,{id:"phone","input-id":"phone",name:"phone",modelValue:c(l),"onUpdate:modelValue":w[0]||(w[0]=C=>$e(l)?l.value=C:null),modelModifiers:{trim:!0},useGrouping:!1,required:"true",autofocus:"",placeholder:"1213213213 (no +, no dashes -)"},null,8,["modelValue"])]),e("div",null,[o(y,{type:"submit",label:"Show Code",icon:"pi pi-send",loading:c(s)},null,8,["loading"])])])],32)]),c(a)?(r(),g(N,{key:0},[o(k),e("div",null,[o(mn)]),e("div",bn,[e("div",null,[c(a)?(r(!0),g(N,{key:0},me(c(a),C=>(r(),g("span",hn,j(C),1))),256)):U("",!0)])])],64)):U("",!0)],64)}}},yn={},$n={class:"pl-4"},Sn=Me('<li> Open <b>WhatsApp</b> on your phone </li><li> Tap <b>More options</b> <i class="pi pi-ellipsis-v"></i> or <b>Settings</b> <i class="pi pi-cog"></i></li><li> Tap <b>Linked Devices</b> and <b>Link a device</b></li><li> Point your phone to this screen to capture <b>QR code</b></li>',4),wn=[Sn];function xn(t,n){return r(),g("ul",$n,wn)}const kn=pe(yn,[["render",xn]]),Cn=e("i",{class:"pi pi-qrcode mr-2"},null,-1),Vn=e("p",null,[O(" Scan "),e("b",null,"QR Code"),O(" to authorize this session. ")],-1),Dn=e("i",{class:"pi pi-send mr-2"},null,-1),Rn=e("p",{class:"m-0"},[O(" Enter "),e("b",null,"Your Phone number"),O(": ")],-1),Un={__name:"SessionLoginDialog",props:le(["session"],{visible:{},visibleModifiers:{}}),emits:["update:visible"],setup(t){const n=K(t,"visible");return(l,s)=>{const a=Bs,p=Ms,i=ke;return r(),T(i,{visible:n.value,"onUpdate:visible":s[0]||(s[0]=d=>n.value=d),modal:!0,class:"p-fluid",maximizable:""},{header:m(()=>[o(Ve,{session:t.session},null,8,["session"])]),default:m(()=>[o(p,null,{default:m(()=>[o(a,null,{header:m(()=>[Cn,O(" Scan QR ")]),default:m(()=>[Vn,o(kn),e("div",null,[o(an,{session:t.session},null,8,["session"])])]),_:1}),o(a,null,{header:m(()=>[Dn,O(" Enter Code ")]),default:m(()=>[Rn,e("div",null,[o(gn,{session:t.session},null,8,["session"])])]),_:1})]),_:1})]),_:1},8,["visible"])}}},Tn={__name:"SessionLogin",props:["session"],setup(t){const n=S(!1);return(l,s)=>{const a=P,p=A("tooltip");return r(),g(N,null,[M(o(a,{icon:"pi pi-sign-in",severity:"",rounded:"",outlined:"",onClick:s[0]||(s[0]=i=>n.value=!0),disabled:t.session.status!=="SCAN_QR_CODE"},null,8,["disabled"]),[[p,"Login",void 0,{top:!0}]]),o(Un,{visible:c(n),"onUpdate:visible":s[1]||(s[1]=i=>$e(n)?n.value=i:null),session:t.session},null,8,["visible","session"])],64)}}},Ln={class:"flex justify-content-between"},Bn={class:"flex align-items-center gap-1"},Mn=e("i",{class:"pi pi-whatsapp"},null,-1),On=e("span",{class:"mr-1"}," Sessions ",-1),In=["disabled"],jn=e("i",{class:"pi pi-refresh"},null,-1),Nn=[jn],En={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-0"},qn={class:"flex flex-column"},Pn={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-2"},An={style:{"text-align":"left"},class:"flex flex-column"},Hn={class:"text-center"},Fn={class:"flex gap-2"},Wn={class:"my-auto"},Kn={class:"flex flex-row gap-2 justify-content-end",style:{order:"2"}},wl={__name:"SessionTable",setup(t){const n=Se(),l=q(),{visibleSessions:s,refreshing:a,servers:p}=ye(l),i=S({config:{webhooks:[]}}),d=S(!1),_=S(void 0),v=S(!1),w=S(10);S(null);const x=S({}),y=S(null),k=S([]),C=L(()=>k.value.filter(B=>V.value[`session-action-${B.server.id}-${B.name}`])),V=S({});function u(B){C.value.forEach(D=>{V.value[`session-action-${D.server.id}-${D.name}`][B]()})}ys(()=>{V.value=[]}),$s(()=>{te()});const f=S([{field:"name",header:"Name"},{field:"metadata",header:"Metadata"},{field:"me",header:"Me"},{field:"status",header:"Status"},{field:"server",header:"Server"}]);function I(){return JSON.parse(localStorage.getItem("sessions.table.columns.hidden"))||[]}const Y=I(),E=S(G.differenceBy(f.value,Y,"field")),ae=B=>{E.value=f.value.filter(D=>B.includes(D))};function H(B){return!E.value||E.value.length===0?!0:G.find(E.value,{field:B})}const oe=L(()=>H("name")),J=L(()=>H("metadata")),$=L(()=>H("me")),b=L(()=>H("status")),Q=L(()=>H("server")),F=L(()=>G.differenceBy(f.value,E.value,"field"));ve(()=>F.value,B=>{localStorage.setItem("sessions.table.columns.hidden",JSON.stringify(B))},{deep:!0});const te=()=>{x.value={global:{value:null,matchMode:ce.CONTAINS},status:{value:null,matchMode:ce.EQUALS},"server.id":{value:null,matchMode:ce.EQUALS},name:{operator:Ss.AND,constraints:[{value:null,matchMode:ce.STARTS_WITH}]}}};function re(){const B=p.value.find(D=>D.connected);if(!B){n.add({severity:"error",summary:"No connected server",detail:"Please connect to a server first",life:3e3});return}i.value={server:B.id,name:"",config:{metadata:{},webhooks:[{url:"https://httpbin.org/post",events:["session.status","message"],hmac:{key:null},retries:{delaySeconds:2,attempts:15},customHeaders:null}],noweb:{markOnline:!0,store:{enabled:!0,fullSync:!1}},proxy:{}}},_.value="new",d.value=!0}function fe(B){i.value=G.cloneDeep({name:B.name,status:B.status,server:B.server.id,config:B.config}),_.value="update",d.value=!0}function X(){he("store",async()=>await l.refresh())}function Z(B){v.value=!0,i.value=B}const _e=L(()=>["name","me.id","me.pushName","_metadata"]);return(B,D)=>{const de=Te,ue=P,ne=Ps,be=Oe,ee=ws,R=ie,Ze=xs,se=Ie,es=Fs,ss=Qe,os=Zs,Re=qe,ts=xe,ns=Ye,ls=Je,is=lo,as=Ae,rs=Pe,ds=Fo,us=Xt,Ue=A("tooltip");return r(),g(N,null,[e("div",Ln,[e("div",null,[e("h5",Bn,[Mn,On,o(de,{refreshing:c(a)},null,8,["refreshing"])])]),e("div",null,[M((r(),g("button",{onClick:X,class:"p-link layout-topbar-button",disabled:c(a)},Nn,8,In)),[[Ue,"Refresh",void 0,{top:!0}]])])]),o(as,{selection:k.value,"onUpdate:selection":D[6]||(D[6]=h=>k.value=h),value:c(s).length>0?c(s):[],paginator:!0,rows:w.value,rowsPerPageOptions:[5,10,20,50,100,500],dataKey:h=>`${h.server.id}-${h.name}`,rowHover:!0,filters:x.value,"onUpdate:filters":D[7]||(D[7]=h=>x.value=h),filterDisplay:"row",loading:y.value,globalFilterFields:c(_e),showGridlines:"",style:{"white-space":"nowrap"},sortField:"name",sortOrder:1},{header:m(()=>[e("div",En,[e("div",qn,[o(ue,{label:"Start New",icon:"pi pi-play",severity:"success",onClick:re})]),e("div",Pn,[o(ne),e("div",An,[o(be,{placeholder:"Columns",modelValue:E.value,options:f.value,optionLabel:"header",selectedItemsLabel:"Columns",maxSelectedLabels:0,"onUpdate:modelValue":ae},null,8,["modelValue","options"])]),o(Ze,{iconPosition:"left"},{default:m(()=>[o(ee,{class:"pi pi-search"}),o(R,{modelValue:x.value.global.value,"onUpdate:modelValue":D[0]||(D[0]=h=>x.value.global.value=h),placeholder:"Search by name, phone, metadata",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])])]),empty:m(()=>[O(" No sessions found")]),loading:m(()=>[O(" Loading sessions...")]),default:m(()=>[o(se,{selectionMode:"multiple",headerStyle:"width: 3rem"}),c(oe)?(r(),T(se,{key:0,field:"name",header:"Name",sortable:""})):U("",!0),c(J)?(r(),T(se,{key:1,header:"Metadata"},{body:m(({data:h})=>{var W;return[o(es,{metadata:(W=h.config)==null?void 0:W.metadata},null,8,["metadata"])]}),_:1})):U("",!0),c($)?(r(),T(se,{key:2,header:"Me"},{body:m(({data:h})=>[e("div",Hn,[o(ss,{session:h},null,8,["session"])])]),_:1})):U("",!0),c(b)?(r(),T(se,{key:3,field:"status",header:"Status",showFilterMenu:!1,style:{width:"9rem"}},{body:m(({data:h})=>[e("div",Fn,[e("div",null,[o(Tn,{session:h},null,8,["session"])]),e("div",null,[o(os,{session:h},null,8,["session"])]),e("div",null,[M(o(ue,{icon:"pi pi-whatsapp",severity:"",rounded:"",outlined:"",onClick:W=>Z(h)},null,8,["onClick"]),[[Ue,"Send Request",void 0,{top:!0}]])]),e("div",Wn,[o(Re,{status:h.status,value:h.status.toUpperCase()},null,8,["status","value"])])])]),filter:m(({filterModel:h,filterCallback:W})=>[o(ts,{modelValue:h.value,"onUpdate:modelValue":z=>h.value=z,options:c(Zt),onChange:z=>W(),placeholder:"Any",class:"p-column-filter",showClear:!0},{option:m(({option:z})=>[o(Re,{status:z,value:z},null,8,["status","value"])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1})):U("",!0),c(Q)?(r(),T(se,{key:4,field:"server.name",filterField:"server.id",header:"Server",showFilterMenu:!1},{filter:m(({filterModel:h,filterCallback:W})=>[o(ns,{placeholder:"Any",onChange:z=>W(),modelValue:h.value,"onUpdate:modelValue":z=>h.value=z,showClear:!0,required:!1},null,8,["onChange","modelValue","onUpdate:modelValue"])]),body:m(({data:h})=>[O(j(h.server.name),1)]),_:1})):U("",!0),o(se,{showFilterMenu:!1},{filter:m(()=>[e("div",Kn,[o(ls,{group:"dialog",name:`'${c(C).length}' sessions`,"all-disabled":c(C).length===0,"hide-actions":["view"],onStart:D[1]||(D[1]=h=>u("startSession")),onRestart:D[2]||(D[2]=h=>u("restartSession")),onStop:D[3]||(D[3]=h=>u("stopSession")),onLogout:D[4]||(D[4]=h=>u("logoutSession")),onDelete:D[5]||(D[5]=h=>u("deleteSession"))},null,8,["name","all-disabled"])])]),body:m(({data:h})=>[o(is,{ref:W=>{V.value[`session-action-${h.server.id}-${h.name}`]=W},session:h,disabled:c(C).length!==0,onView:fe},null,8,["session","disabled"])]),_:1})]),_:1},8,["selection","value","rows","dataKey","filters","loading","globalFilterFields"]),o(rs),o(ds,{visible:v.value,"onUpdate:visible":D[8]||(D[8]=h=>v.value=h),session:i.value,"onUpdate:session":D[9]||(D[9]=h=>i.value=h)},null,8,["visible","session"]),o(us,{visible:d.value,"onUpdate:visible":D[10]||(D[10]=h=>d.value=h),session:i.value,"onUpdate:session":D[11]||(D[11]=h=>i.value=h),mode:_.value},null,8,["visible","session","mode"])],64)}}};export{Ps as _,wl as a};
