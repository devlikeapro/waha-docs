import{u as se,_ as xe}from"./Cnmo1OAV.js";import H from"./CaWnzDcw.js";import Ce from"./BDKx1mWm.js";import re from"./D6atgbJh.js";import De from"./DqN_nw6n.js";import le from"./DKrTESMM.js";import{_ as ie}from"./7jNAbCRE.js";import Ie from"./NAJEcTwn.js";import{c as R,O as K,t as i,v as g,B as a,y as S,N as _,P as T,x as e,T as N,Z as G,z as o,U as C,X as Ve,L as D,a1 as z,r as V,A as m,H as ne,W as Ue,a3 as Te,a2 as Re,Y as Le,R as Me,V as Pe,S as We}from"./CFUq_nD1.js";import{u as F,l as q,d as oe}from"./58LrC_IB.js";import{_ as Ne,u as J}from"./2iudWBMv.js";import ae from"./C6mLBRuZ.js";import ce from"./BGbt5Q3r.js";import Ae from"./6g5OKpU4.js";import ue from"./C-xU0BFv.js";import Be from"./b-kUBtim.js";import Oe from"./D2yyVtSF.js";import je from"./mRb4B-OV.js";import qe from"./529VZ_cP.js";import Fe from"./DwA-pA8X.js";function Ee(s){const l=Math.floor(s/864e5),t=Math.floor(s/36e5)%24,u=Math.floor(s/6e4)%60,c=Math.floor(s/1e3)%60,d=`${String(t).padStart(2,"0")}:${String(u).padStart(2,"0")}:${String(c).padStart(2,"0")}`;return l===0?d:l===1?`${d} 1 day`:`${d} ${l} days`}const Ye={class:"pi pi-info-circle"},de={__name:"ServerUptime",props:["status"],setup(s){const l=s,t=R(()=>{const c=l.status.uptime;if(c)return Ee(c)}),u=R(()=>{const c=l.status.startTimestamp;if(c)return new Date(c)});return(c,d)=>{var h;const v=K("tooltip");return i(),g(N,null,[a(S(_(t))+" up ",1),T(e("i",Ye,null,512),[[v,`Start time: ${(h=_(u))==null?void 0:h.toLocaleString()}`]])],64)}}},ze=e("code",null," (",-1),He=e("code",null,")",-1),Ke={key:0},Ge={__name:"ServerInfoColumn",props:["server"],setup(s){const l=F();return(t,u)=>{const c=de;return i(),g(N,null,[e("div",null,[e("code",null,S(s.server.version.engine),1),ze,e("code",{class:G({"text-orange-400":s.server.version.version!==_(l).latestVersion})},S(s.server.version.version),3),He]),s.server.status?(i(),g("div",Ke,[o(c,{status:s.server.status},null,8,["status"])])):C("",!0)],64)}}},Je={__name:"ServerSessionSummary",props:{sessions:{required:!0}},setup(s){const l=s,t=R(()=>q.groupBy(l.sessions||[],"status")),u={WORKING:1,SCAN_QR_CODE:2,STARTING:3,FAILED:4,STOPPED:5},c=R(()=>q.sortBy(Object.entries(t.value),([d,v])=>u[d]));return(d,v)=>{const h=Ne;return i(!0),g(N,null,Ve(_(c),([b,w])=>(i(),D(h,{key:b+w.length,status:b,value:`${b}: ${w.length}`},null,8,["status","value"]))),128)}}},Qe={class:"mb-4"},Xe=e("b",null,"browser's local storage",-1),Ze=e("br",null,null,-1),et={class:"field"},tt=e("label",{for:"name"},"Name",-1),nt={key:0,class:"p-invalid"},ot={class:"field"},st=e("label",{for:"connection-url"},"API URL",-1),rt={key:0,class:"p-invalid"},lt={key:1,class:"p-invalid"},it=e("b",null,"https://",-1),at=e("b",null,"http://",-1),ct=e("br",null,null,-1),ut=e("a",{href:"https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content#developer_console",target:"_blank"}," Mixed Content ",-1),dt=e("b",null,"http://",-1),vt=e("br",null,null,-1),pt=e("br",null,null,-1),mt=e("a",{href:"https://waha.devlike.pro/docs/how-to/security/#https",target:"_blank"},"ðŸ”’ Security ->",-1),_t={class:"field"},ft=e("label",{for:"connection-key"},"API Key (optional)",-1),ht={__name:"ServerDialog",props:{visible:{},visibleModifiers:{},server:{},serverModifiers:{}},emits:["update:visible","update:server"],setup(s){const l=z(s,"visible"),t=z(s,"server"),u=F(),c=J(),d=V(!1),v=R(()=>{var r;const y=(r=t.value.connection)==null?void 0:r.url;return y?y.startsWith("http://")||y.startsWith("https://"):!1});async function h(){d.value=!0,!(!t.value.name||!v.value)&&(t.value.id?await c(u.editServer(t.value.id,t.value),"Server updated","Failed to update server",t.value.name,t.value.name):await c(u.addServer(t.value),"Connected to server","Failed to connect to server",t.value.name,t.value.name),b(),t.value={connection:{}})}function b(){d.value=!1,l.value=!1}const w=R(()=>{var r;const y=(r=t.value.connection)==null?void 0:r.url;return y?y.startsWith("http://"):!1}),x=R(()=>location.protocol==="https:");return(y,r)=>{const p=ce,I=re,A=Ae,L=H,B=ue;return i(),D(B,{visible:l.value,"onUpdate:visible":r[3]||(r[3]=U=>l.value=U),header:"Server",modal:!0,class:"p-fluid"},{footer:m(()=>[o(L,{label:"Cancel",icon:"pi pi-times",text:"",onClick:b,severity:"secondary"}),o(L,{label:t.value.id?"Save":"Connect",icon:{"pi pi-check":!!t.value.id,"pi pi-link":!t.value.id},text:"",onClick:h},null,8,["label","icon"])]),default:m(()=>[e("div",Qe,[o(p,{severity:"info"},{default:m(()=>[a(" Workers data is saved in your "),Xe,a(". "),Ze,a(" It's safe to put server API and key here. ")]),_:1})]),e("div",et,[tt,o(I,{id:"name",modelValue:t.value.name,"onUpdate:modelValue":r[0]||(r[0]=U=>t.value.name=U),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:d.value&&!t.value.name},null,8,["modelValue","invalid"]),d.value&&!t.value.name?(i(),g("small",nt,"Name is required.")):C("",!0)]),e("div",ot,[st,o(I,{id:"connection-url",modelValue:t.value.connection.url,"onUpdate:modelValue":r[1]||(r[1]=U=>t.value.connection.url=U),modelModifiers:{trim:!0},required:"true",invalid:d.value&&!_(v)},null,8,["modelValue","invalid"]),d.value&&!t.value.connection.url?(i(),g("small",rt,"URL is required.")):C("",!0),d.value&&!_(v)?(i(),g("small",lt,"URL is not correct.")):C("",!0),_(x)&&_(w)?(i(),D(p,{key:2,severity:"error",class:"mt-2"},{default:m(()=>[a(" You're using "),it,a(" connection but server is using "),at,a(" connection. "),ct,a(" It's not possible to use it due to "),ut]),_:1})):C("",!0),_(w)?(i(),D(p,{key:3,severity:"warn",class:"mt-2"},{default:m(()=>[a(" You're using "),dt,a(" connection which is not secure. "),vt,a(" Kindly configure HTTPS Connection. "),pt,a(" Read more about "),mt]),_:1})):C("",!0)]),e("div",_t,[ft,o(A,{id:"connection-key",modelValue:t.value.connection.key,"onUpdate:modelValue":r[2]||(r[2]=U=>t.value.connection.key=U),modelModifiers:{trim:!0},feedback:!1,toggleMask:""},null,8,["modelValue"])])]),_:1},8,["visible"])}}},gt={class:"p-3 flex flex-column gap-2"},bt={class:"flex gap-2"},yt=e("div",null," Status: ",-1),kt={class:"flex flex-column gap-1"},$t={class:"flex gap-1"},St=e("div",null," API URL: ",-1),wt=["href"],xt=e("i",{class:"pi pi-external-link"},null,-1),Ct={class:"flex gap-1"},Dt=e("div",null," Dashboard URL: ",-1),It=["href"],Vt=e("i",{class:"pi pi-external-link"},null,-1),Ut={class:"flex gap-2"},Tt=e("div",null," Engine: ",-1),Rt={class:"flex gap-2"},Lt=e("div",null," Version: ",-1),Mt={key:0,class:"text-green-500 font-medium ml-2"},Pt=e("i",{class:"pi text-green-500 pi-check-circle"},null,-1),Wt={class:"flex gap-2"},Nt=e("div",null," Uptime: ",-1),At={key:0},Bt={class:"text-900 font-medium"},Ot={href:"https://waha.devlike.pro/docs/overview/changelog/",target:"_blank"},jt=e("i",{class:"pi pi-external-link"},null,-1),qt={__name:"ServerStatus",props:["server"],setup(s){const l=s,t=F(),u=R(()=>{var c;return((c=l.server.version)==null?void 0:c.version)!==t.latestVersion});return(c,d)=>{var w,x,y,r,p,I;const v=ie,h=de,b=ce;return i(),g("div",gt,[e("div",bt,[yt,e("div",kt,[e("div",null,[o(v,{class:"mr-1",connected:s.server.connected},null,8,["connected"]),e("span",null,[e("b",null,[s.server.connected?(i(),g(N,{key:0},[a(" Connected ")],64)):(i(),g(N,{key:1},[a(" Disconnected ")],64))])])])])]),e("div",$t,[St,e("div",null,[e("a",{href:(w=s.server.connection)==null?void 0:w.url,target:"_blank",class:"ml-2"},[a(S((x=s.server.connection)==null?void 0:x.url)+" ",1),xt],8,wt)])]),e("div",Ct,[Dt,e("div",null,[e("a",{href:_(oe)((y=s.server.connection)==null?void 0:y.url),target:"_blank",class:"ml-2"},[a(S(_(oe)((r=s.server.connection)==null?void 0:r.url))+" ",1),Vt],8,It)])]),e("div",Ut,[Tt,e("div",null,[e("code",null,S((p=s.server.version)==null?void 0:p.engine),1)])]),e("div",Rt,[Lt,e("div",null,[e("code",{class:G({"text-orange-400":_(u)})},S((I=s.server.version)==null?void 0:I.version),3),_(u)?C("",!0):(i(),g("span",Mt,[Pt,a(" Up to date ")]))])]),e("div",Wt,[Nt,s.server.status?(i(),g("div",At,[o(h,{status:s.server.status},null,8,["status"])])):C("",!0)]),_(u)?(i(),D(b,{key:0,severity:"info"},{default:m(()=>[a(" There's a new "),e("span",Bt,[e("a",Ot,[a(S(_(t).latestVersion)+" ",1),jt])]),a(" version available! ")]),_:1})):C("",!0)])}}},Ft={class:"flex flex-wrap justify-content-between"},Et={class:"flex gap-2 align-items-center"},Yt=e("span",{class:"text-xl font-bold"},"Copy",-1),zt={class:"flex gap-2 align-items-center"},Ht=e("label",{for:"show-all"},"Show All",-1),Kt={__name:"ServerVariablesTable",props:["server"],setup(s){const l=s,t=F(),u=V(!1),c=J();function d(r){return q.sortBy(r,p=>p.name.startsWith("DEBUG")?0:p.name.startsWith("WAHA_")?1:p.name.startsWith("WHATSAPP_")?2:3)}function v(r){return r.map(p=>`${p.name}=${p.value}`).join(`
`)}const{data:h,pending:b,error:w,refresh:x}=se(`server-environment-${l.server.id}`,async()=>{if(!l.server.id)return[];const r=await c(t.getServerEnvironment(l.server.id,u.value),void 0,"Failed to fetch server environment",void 0,l.server.name),p=Object.keys(r).map(I=>({name:I,value:r[I]}));return d(p)});ne(()=>l.server,x,{immediate:!0}),ne(u,x);async function y(r){const p=v(h.value);await navigator.clipboard.writeText(p),r.preventDefault()}return(r,p)=>{const I=H,A=Be,L=le,B=ae,U=K("tooltip");return i(),D(B,{value:_(h),loading:_(b),resizableColumns:""},{header:m(()=>[e("div",Ft,[e("div",Et,[Yt,T(o(I,{rounded:"",text:"",icon:"pi pi-copy",onClick:p[0]||(p[0]=M=>y(M))},null,512),[[U,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),e("div",zt,[o(A,{inputId:"show-all",modelValue:_(u),"onUpdate:modelValue":p[1]||(p[1]=M=>Ue(u)?u.value=M:null)},null,8,["modelValue"]),Ht])])]),default:m(()=>[o(L,{field:"name",header:"Environment Variable"},{body:m(({data:M})=>[e("code",null,S(M.name),1)]),_:1}),o(L,{field:"value",header:"Value"})]),_:1},8,["value","loading"])}}},Gt=e("h4",null,"Variables",-1),Jt={__name:"ServerControlDialog",props:Te(["server"],{visible:{},visibleModifiers:{}}),emits:["update:visible"],setup(s){const l=z(s,"visible"),t=s;return(u,c)=>{const d=qt,v=Kt,h=ue;return i(),D(h,{visible:l.value,"onUpdate:visible":c[0]||(c[0]=b=>l.value=b),modal:!0,class:"p-fluid",style:{"max-width":"100%","min-width":"50%"},header:"Server"},{default:m(()=>[e("h4",null,S(s.server.name),1),o(d,{server:t.server},null,8,["server"]),Gt,o(v,{server:t.server},null,8,["server"])]),_:1},8,["visible"])}}},Qt={style:{"min-width":"15rem"}},Xt={key:0,class:"flex flex-column"},Zt={__name:"OverlayLinks",props:{title:{type:String,required:!0}},setup(s,{expose:l}){const t=V(null),u=V(null);return l({toggle:(d,v)=>{t.value.toggle(d),u.value=v},currentItem:u}),(d,v)=>(i(),D(_(Fe),{ref_key:"overlayPanel",ref:t,appendTo:"body",showCloseIcon:!0},{default:m(()=>[e("div",Qt,[u.value?(i(),g("div",Xt,[Re(d.$slots,"default")])):C("",!0)])]),_:3},512))}},en=["href"],Y={__name:"OverlayLink",props:{href:{type:String,required:!0},icon:{type:String,required:!0},name:{type:String,required:!0}},setup(s){return(l,t)=>(i(),g("a",{href:s.href,target:"_blank",class:"overlay-link w-full flex align-items-center"},[e("i",{class:G(`pi ${s.icon} mr-2`)},null,2),e("span",null,S(s.name),1)],8,en))}},tn={class:"flex justify-content-between"},nn={class:"flex align-items-center gap-1"},on=e("i",{class:"pi pi-server"},null,-1),sn=e("span",{class:"mr-1"}," Workers ",-1),rn=["disabled"],ln=e("i",{class:"pi pi-refresh"},null,-1),an=[ln],cn={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-0"},un={key:0,class:"pi pi-info-circle text-orange-400"},dn=["href"],vn={class:"flex gap-1"},pn={class:"flex flex-row gap-2 justify-content-end"},mn=e("p",null,[a(" It'll call "),e("code",null,"POST api/server/stop"),a(", but if you're using Docker "),e("br"),a(" and followed "),e("a",{href:"https://waha.devlike.pro/docs/how-to/install/",target:"_blank"},[e("b",null,"ðŸ”§ Install & Update")]),a(" guide, Docker will start a new container. ")],-1),_n=e("p",null," By default it will gracefully stop the server, but you can force restart. ",-1),fn=e("i",{class:"pi pi-replay mr-2"},null,-1),Nn={__name:"ServerTable",setup(s){const l=Le(),t=F(),u=J(),{servers:c,refreshing:d}=Me(t),v=V({connection:{}}),h=V(!1),b=V(!1),w=V(!1),x=V(null),y=(k,f)=>{x.value.toggle(k,f)};V(null);const r=V({}),p=V(null);Pe(()=>{I()});const I=()=>{r.value={global:{value:null,matchMode:We.CONTAINS}}};function A(){v.value={connection:{}},h.value=!0}function L(k){v.value=q.cloneDeep(k),b.value=!0}function B(k){v.value=q.cloneDeep(k),h.value=!0}function U(k,f){l.require({group:"popup",target:k.target,message:`Disconnect '${f.name}' worker?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Disconnect",accept:()=>u(t.deleteServer(f.id),"Disconnected","Failed to disconnect worker"),reject:()=>{}})}const M=k=>{l.require({group:"restart",message:k.name,header:`Restart '${k.name}' server?`,icon:"pi pi-replay",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-warning p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Restart",accept:async()=>{await u(t.stopServer(k,w.value),"Restarting...","Failed to restart worker",k.name,k.name)},reject:()=>{}})};function ve(){se("store",async()=>await t.refresh())}return(k,f)=>{const pe=xe,W=H,me=Ce,_e=re,fe=De,O=le,E=ie,Q=Ie,he=Ge,ge=Je,be=ae,ye=ht,ke=Jt,$e=Oe,Se=je,we=qe,P=K("tooltip");return i(),g(N,null,[e("div",tn,[e("div",null,[e("h5",nn,[on,sn,o(pe,{refreshing:_(d)},null,8,["refreshing"])])]),e("div",null,[T((i(),g("button",{onClick:ve,class:"p-link layout-topbar-button",disabled:_(d)},an,8,rn)),[[P,"Refresh",void 0,{top:!0}]])])]),o(be,{value:_(c).length>0?_(c):[],paginator:!0,rows:10,dataKey:"id",rowHover:!0,filters:r.value,"onUpdate:filters":f[1]||(f[1]=n=>r.value=n),filterDisplay:"menu",loading:p.value,globalFilterFields:["name","id","connection.url"],showGridlines:"",style:{"white-space":"nowrap"},resizableColumns:""},{header:m(()=>[e("div",cn,[o(W,{label:"Connect",icon:"pi pi-link",severity:"success",onClick:A}),o(fe,{iconPosition:"left"},{default:m(()=>[o(me,{class:"pi pi-search"}),o(_e,{modelValue:r.value.global.value,"onUpdate:modelValue":f[0]||(f[0]=n=>r.value.global.value=n),placeholder:"Keyword Search",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])]),empty:m(()=>[a(" No workers found")]),loading:m(()=>[a(" Loading workers...")]),default:m(()=>[o(O,{field:"name",header:"Name"},{body:m(({data:n})=>{var $,j,X,Z,ee,te;return[e("div",null,[a(S(n.name)+" ",1),(j=($=n.status)==null?void 0:$.worker)!=null&&j.id&&((Z=(X=n.status)==null?void 0:X.worker)==null?void 0:Z.id)!==n.name?T((i(),g("i",un,null,512)),[[P,`Worker ID does not match. Rename the worker to match it.

ðŸ‘‰ Worker ID: ${(te=(ee=n.status)==null?void 0:ee.worker)==null?void 0:te.id}`]]):C("",!0)])]}),_:1}),o(O,{header:"API"},{body:m(({data:n})=>[e("div",null,[o(E,{connected:n.connected},null,8,["connected"]),e("a",{class:"ml-1",href:n.connection.url,target:"_blank"},S(n.connection.url),9,dn)])]),_:1}),o(O,{header:"Info"},{body:m(({data:n})=>[n.connected===void 0?(i(),D(Q,{key:0,width:"9rem"})):n.connected===!1?(i(),D(E,{key:1,connected:n.connected},null,8,["connected"])):(i(),D(he,{key:2,server:n},null,8,["server"]))]),_:1}),o(O,{header:"Sessions"},{body:m(({data:n})=>[e("div",vn,[n.connected===void 0?(i(),D(Q,{key:0,width:"10rem"})):C("",!0),n.connected===!1?(i(),D(E,{key:1,connected:n.connected},null,8,["connected"])):C("",!0),o(ge,{sessions:_(t).visibleSessionsByServer[n.id]},null,8,["sessions"])])]),_:1}),o(O,null,{body:m(({data:n})=>[e("div",pn,[T(o(W,{icon:"pi pi-link",severity:"info",rounded:"",outlined:"",onClick:$=>y($,n)},null,8,["onClick"]),[[P,"Links",void 0,{top:!0}]]),T(o(W,{disabled:!n.connected,icon:"pi pi-info",severity:"help",rounded:"",outlined:"",onClick:$=>L(n)},null,8,["disabled","onClick"]),[[P,"Worker Info",void 0,{top:!0}]]),T(o(W,{icon:"pi pi-pencil",severity:"success",rounded:"",outlined:"",onClick:$=>B(n)},null,8,["onClick"]),[[P,"Edit Worker",void 0,{top:!0}]]),T(o(W,{icon:"pi pi-replay",severity:"warning",rounded:"",outlined:"",onClick:$=>M(n)},null,8,["onClick"]),[[P,"Restart Worker",void 0,{top:!0}]]),T(o(W,{icon:"pi pi-times",severity:"danger",rounded:"",outlined:"",onClick:$=>U($,n)},null,8,["onClick"]),[[P,"Disconnect Worker",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","filters","loading"]),o(ye,{visible:h.value,"onUpdate:visible":f[2]||(f[2]=n=>h.value=n),server:v.value,"onUpdate:server":f[3]||(f[3]=n=>v.value=n)},null,8,["visible","server"]),o(ke,{visible:b.value,"onUpdate:visible":f[4]||(f[4]=n=>b.value=n),server:v.value,"onUpdate:server":f[5]||(f[5]=n=>v.value=n)},null,8,["visible","server"]),o($e,{group:"popup"}),o(we,{group:"restart"},{message:m(n=>[e("div",null,[e("p",null,[a(" You're going to restart "),e("b",null,S(n.message.message),1),a(" server. ")]),mn,e("div",null,[_n,o(Se,{modelValue:w.value,"onUpdate:modelValue":f[6]||(f[6]=$=>w.value=$),id:"forceRestart",onLabel:"Force Restart On",offLabel:"Force Restart Off"},{icon:m(()=>[fn]),_:1},8,["modelValue"])])])]),_:1}),o(Zt,{ref_key:"linksOverlayPanel",ref:x,title:"Server Links"},{default:m(()=>{var n,$,j;return[o(Y,{href:`${(n=x.value.currentItem)==null?void 0:n.connection.url}/dashboard`,icon:"pi-home",name:"Dashboard"},null,8,["href"]),o(Y,{href:`${($=x.value.currentItem)==null?void 0:$.connection.url}/jobs`,icon:"pi-cog",name:"Jobs"},null,8,["href"]),o(Y,{href:(j=x.value.currentItem)==null?void 0:j.connection.url,icon:"pi-code",name:"Swagger"},null,8,["href"])]}),_:1},512)],64)}}};export{Nn as _};
