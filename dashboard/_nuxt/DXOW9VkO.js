import{u as j,l as F,d as J,a as te,_ as ke}from"./C3w4ZZYK.js";import E from"./DeGajdkY.js";import Se from"./Co2qXpSM.js";import ne from"./BQjY-vaa.js";import we from"./C9R_y87H.js";import oe from"./CJzihNLU.js";import{a as xe,u as G,_ as se}from"./o-mOyOgR.js";import Ce from"./Bl-Pa-kf.js";import{c as T,R as K,t as c,v as y,B as l,y as w,M as p,S as R,x as e,N,Z as re,z as o,O as C,U as Ve,P as V,W as q,r as U,A as m,G as ee,T as De,V as Ie,X as Ue,Q as Re,L as Te,a4 as Me}from"./DpCWagb1.js";import le from"./iyzUyVn9.js";import ie from"./yYvbezlc.js";import We from"./Bq57sxCW.js";import ae from"./cYwAlf7y.js";import Ne from"./RvhuKTQ1.js";import Ae from"./Ds3cYBF_.js";import Be from"./Ke7mCKgS.js";import Le from"./BWW4F-X7.js";function Pe(s){const i=Math.floor(s/864e5),t=Math.floor(s/36e5)%24,d=Math.floor(s/6e4)%60,a=Math.floor(s/1e3)%60,v=`${String(t).padStart(2,"0")}:${String(d).padStart(2,"0")}:${String(a).padStart(2,"0")}`;return i===0?v:i===1?`${v} 1 day`:`${v} ${i} days`}const Fe={class:"pi pi-info-circle"},ce={__name:"ServerUptime",props:["status"],setup(s){const i=s,t=T(()=>{const a=i.status.uptime;if(a)return Pe(a)}),d=T(()=>{const a=i.status.startTimestamp;if(a)return new Date(a)});return(a,v)=>{var f;const _=K("tooltip");return c(),y(N,null,[l(w(p(t))+" up ",1),R(e("i",Fe,null,512),[[_,`Start time: ${(f=p(d))==null?void 0:f.toLocaleString()}`]])],64)}}},je=e("code",null," (",-1),Oe=e("code",null,")",-1),qe={key:0},Ee={__name:"ServerInfoColumn",props:["server"],setup(s){const i=j();return(t,d)=>{const a=ce;return c(),y(N,null,[e("div",null,[e("code",null,w(s.server.version.engine),1),je,e("code",{class:re({"text-orange-400":s.server.version.version!==p(i).latestVersion})},w(s.server.version.version),3),Oe]),s.server.status?(c(),y("div",qe,[o(a,{status:s.server.status},null,8,["status"])])):C("",!0)],64)}}},Ge={__name:"ServerSessionSummary",props:{sessions:{required:!0}},setup(s){const i=s,t=T(()=>F.groupBy(i.sessions||[],"status")),d={WORKING:1,SCAN_QR_CODE:2,STARTING:3,FAILED:4,STOPPED:5},a=T(()=>F.sortBy(Object.entries(t.value),([v,_])=>d[v]));return(v,_)=>{const f=xe;return c(!0),y(N,null,Ve(p(a),([g,k])=>(c(),V(f,{key:g+k.length,status:g,value:`${g}: ${k.length}`},null,8,["status","value"]))),128)}}},Ke={class:"mb-4"},Ye=e("b",null,"browser's local storage",-1),He=e("br",null,null,-1),ze={class:"field"},Qe=e("label",{for:"name"},"Name",-1),Xe={key:0,class:"p-invalid"},Ze={class:"field"},Je=e("label",{for:"connection-url"},"API URL",-1),et={key:0,class:"p-invalid"},tt={key:1,class:"p-invalid"},nt=e("b",null,"https://",-1),ot=e("b",null,"http://",-1),st=e("br",null,null,-1),rt=e("a",{href:"https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content#developer_console",target:"_blank"}," Mixed Content ",-1),lt=e("b",null,"http://",-1),it=e("br",null,null,-1),at=e("br",null,null,-1),ct=e("a",{href:"https://waha.devlike.pro/docs/how-to/security/#https",target:"_blank"},"ðŸ”’ Security ->",-1),ut={class:"field"},dt=e("label",{for:"connection-key"},"API Key (optional)",-1),vt={__name:"ServerDialog",props:{visible:{},visibleModifiers:{},server:{},serverModifiers:{}},emits:["update:visible","update:server"],setup(s){const i=q(s,"visible"),t=q(s,"server"),d=j(),a=G(),v=U(!1),_=T(()=>{var r;const $=(r=t.value.connection)==null?void 0:r.url;return $?$.startsWith("http://")||$.startsWith("https://"):!1});async function f(){v.value=!0,!(!t.value.name||!_.value)&&(t.value.id?await a(d.editServer(t.value.id,t.value),"Server updated","Failed to update server",t.value.name,t.value.name):await a(d.addServer(t.value),"Connected to server","Failed to connect to server",t.value.name,t.value.name),g(),t.value={connection:{}})}function g(){v.value=!1,i.value=!1}const k=T(()=>{var r;const $=(r=t.value.connection)==null?void 0:r.url;return $?$.startsWith("http://"):!1}),S=T(()=>location.protocol==="https:");return($,r)=>{const u=ie,x=ne,A=We,M=E,B=ae;return c(),V(B,{visible:i.value,"onUpdate:visible":r[3]||(r[3]=D=>i.value=D),header:"Server",modal:!0,class:"p-fluid"},{footer:m(()=>[o(M,{label:"Cancel",icon:"pi pi-times",text:"",onClick:g,severity:"secondary"}),o(M,{label:t.value.id?"Save":"Connect",icon:{"pi pi-check":!!t.value.id,"pi pi-link":!t.value.id},text:"",onClick:f},null,8,["label","icon"])]),default:m(()=>[e("div",Ke,[o(u,{severity:"info"},{default:m(()=>[l(" Workers data is saved in your "),Ye,l(". "),He,l(" It's safe to put server API and key here. ")]),_:1})]),e("div",ze,[Qe,o(x,{id:"name",modelValue:t.value.name,"onUpdate:modelValue":r[0]||(r[0]=D=>t.value.name=D),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:v.value&&!t.value.name},null,8,["modelValue","invalid"]),v.value&&!t.value.name?(c(),y("small",Xe,"Name is required.")):C("",!0)]),e("div",Ze,[Je,o(x,{id:"connection-url",modelValue:t.value.connection.url,"onUpdate:modelValue":r[1]||(r[1]=D=>t.value.connection.url=D),modelModifiers:{trim:!0},required:"true",invalid:v.value&&!p(_)},null,8,["modelValue","invalid"]),v.value&&!t.value.connection.url?(c(),y("small",et,"URL is required.")):C("",!0),v.value&&!p(_)?(c(),y("small",tt,"URL is not correct.")):C("",!0),p(S)&&p(k)?(c(),V(u,{key:2,severity:"error",class:"mt-2"},{default:m(()=>[l(" You're using "),nt,l(" connection but server is using "),ot,l(" connection. "),st,l(" It's not possible to use it due to "),rt]),_:1})):C("",!0),p(k)?(c(),V(u,{key:3,severity:"warn",class:"mt-2"},{default:m(()=>[l(" You're using "),lt,l(" connection which is not secure. "),it,l(" Kindly configure HTTPS Connection. "),at,l(" Read more about "),ct]),_:1})):C("",!0)]),e("div",ut,[dt,o(A,{id:"connection-key",modelValue:t.value.connection.key,"onUpdate:modelValue":r[2]||(r[2]=D=>t.value.connection.key=D),modelModifiers:{trim:!0},feedback:!1,toggleMask:""},null,8,["modelValue"])])]),_:1},8,["visible"])}}},pt={class:"p-3 flex flex-column gap-2"},mt={class:"flex gap-2"},_t=e("div",null," Status: ",-1),ft={class:"flex flex-column gap-1"},ht={class:"flex gap-1"},bt=e("div",null," API URL: ",-1),gt=["href"],yt=e("i",{class:"pi pi-external-link"},null,-1),$t={class:"flex gap-1"},kt=e("div",null," Dashboard URL: ",-1),St=["href"],wt=e("i",{class:"pi pi-external-link"},null,-1),xt={class:"flex gap-2"},Ct=e("div",null," Engine: ",-1),Vt={class:"flex gap-2"},Dt=e("div",null," Version: ",-1),It={key:0,class:"text-green-500 font-medium ml-2"},Ut=e("i",{class:"pi text-green-500 pi-check-circle"},null,-1),Rt={class:"flex gap-2"},Tt=e("div",null," Uptime: ",-1),Mt={key:0},Wt={class:"text-900 font-medium"},Nt={href:"https://waha.devlike.pro/docs/overview/changelog/",target:"_blank"},At=e("i",{class:"pi pi-external-link"},null,-1),Bt={__name:"ServerStatus",props:["server"],setup(s){const i=s,t=j(),d=T(()=>{var a;return((a=i.server.version)==null?void 0:a.version)!==t.latestVersion});return(a,v)=>{var k,S,$,r,u,x;const _=se,f=ce,g=ie;return c(),y("div",pt,[e("div",mt,[_t,e("div",ft,[e("div",null,[o(_,{class:"mr-1",connected:s.server.connected},null,8,["connected"]),e("span",null,[e("b",null,[s.server.connected?(c(),y(N,{key:0},[l(" Connected ")],64)):(c(),y(N,{key:1},[l(" Disconnected ")],64))])])])])]),e("div",ht,[bt,e("div",null,[e("a",{href:(k=s.server.connection)==null?void 0:k.url,target:"_blank",class:"ml-2"},[l(w((S=s.server.connection)==null?void 0:S.url)+" ",1),yt],8,gt)])]),e("div",$t,[kt,e("div",null,[e("a",{href:p(J)(($=s.server.connection)==null?void 0:$.url),target:"_blank",class:"ml-2"},[l(w(p(J)((r=s.server.connection)==null?void 0:r.url))+" ",1),wt],8,St)])]),e("div",xt,[Ct,e("div",null,[e("code",null,w((u=s.server.version)==null?void 0:u.engine),1)])]),e("div",Vt,[Dt,e("div",null,[e("code",{class:re({"text-orange-400":p(d)})},w((x=s.server.version)==null?void 0:x.version),3),p(d)?C("",!0):(c(),y("span",It,[Ut,l(" Up to date ")]))])]),e("div",Rt,[Tt,s.server.status?(c(),y("div",Mt,[o(f,{status:s.server.status},null,8,["status"])])):C("",!0)]),p(d)?(c(),V(g,{key:0,severity:"info"},{default:m(()=>[l(" There's a new "),e("span",Wt,[e("a",Nt,[l(w(p(t).latestVersion)+" ",1),At])]),l(" version available! ")]),_:1})):C("",!0)])}}},Lt={class:"flex flex-wrap justify-content-between"},Pt={class:"flex gap-2 align-items-center"},Ft=e("span",{class:"text-xl font-bold"},"Copy",-1),jt={class:"flex gap-2 align-items-center"},Ot=e("label",{for:"show-all"},"Show All",-1),qt={__name:"ServerVariablesTable",props:["server"],setup(s){const i=s,t=j(),d=U(!1),a=G();function v(r){return F.sortBy(r,u=>u.name.startsWith("DEBUG")?0:u.name.startsWith("WAHA_")?1:u.name.startsWith("WHATSAPP_")?2:3)}function _(r){return r.map(u=>`${u.name}=${u.value}`).join(`
`)}const{data:f,pending:g,error:k,refresh:S}=te(`server-environment-${i.server.id}`,async()=>{if(!i.server.id)return[];const r=await a(t.getServerEnvironment(i.server.id,d.value),void 0,"Failed to fetch server environment",void 0,i.server.name),u=Object.keys(r).map(x=>({name:x,value:r[x]}));return v(u)});ee(()=>i.server,S,{immediate:!0}),ee(d,S);async function $(r){const u=_(f.value);await navigator.clipboard.writeText(u),r.preventDefault()}return(r,u)=>{const x=E,A=Ne,M=oe,B=le,D=K("tooltip");return c(),V(B,{value:p(f),loading:p(g)},{header:m(()=>[e("div",Lt,[e("div",Pt,[Ft,R(o(x,{rounded:"",text:"",icon:"pi pi-copy",onClick:u[0]||(u[0]=h=>$(h))},null,512),[[D,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),e("div",jt,[o(A,{inputId:"show-all",modelValue:p(d),"onUpdate:modelValue":u[1]||(u[1]=h=>De(d)?d.value=h:null)},null,8,["modelValue"]),Ot])])]),default:m(()=>[o(M,{field:"name",header:"Environment Variable"},{body:m(({data:h})=>[e("code",null,w(h.name),1)]),_:1}),o(M,{field:"value",header:"Value"})]),_:1},8,["value","loading"])}}},Et=e("h4",null,"Variables",-1),Gt={__name:"ServerControlDialog",props:Ie(["server"],{visible:{},visibleModifiers:{}}),emits:["update:visible"],setup(s){const i=q(s,"visible"),t=s;return(d,a)=>{const v=Bt,_=qt,f=ae;return c(),V(f,{visible:i.value,"onUpdate:visible":a[0]||(a[0]=g=>i.value=g),modal:!0,class:"p-fluid",style:{"max-width":"100%","min-width":"50%"},header:"Server"},{default:m(()=>[e("h4",null,w(s.server.name),1),o(v,{server:t.server},null,8,["server"]),Et,o(_,{server:t.server},null,8,["server"])]),_:1},8,["visible"])}}},Kt={class:"flex justify-content-between"},Yt={class:"flex align-items-center gap-1"},Ht=e("i",{class:"pi pi-server"},null,-1),zt=e("span",{class:"mr-1"}," Workers ",-1),Qt=["disabled"],Xt=e("i",{class:"pi pi-refresh"},null,-1),Zt=[Xt],Jt={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-0"},en={key:0,class:"pi pi-info-circle text-orange-400"},tn=["href"],nn={class:"flex gap-1"},on={class:"flex flex-row gap-2 justify-content-end"},sn=e("p",null,[l(" It'll call "),e("code",null,"POST api/server/stop"),l(", but if you're using Docker "),e("br"),l(" and followed "),e("a",{href:"https://waha.devlike.pro/docs/how-to/install/",target:"_blank"},[e("b",null,"ðŸ”§ Install & Update")]),l(" guide, Docker will start a new container. ")],-1),rn=e("p",null," By default it will gracefully stop the server, but you can force restart. ",-1),ln=e("i",{class:"pi pi-replay mr-2"},null,-1),xn={__name:"ServerTable",setup(s){const i=Ue(),t=j(),d=G(),{servers:a,refreshing:v}=Re(t),_=U({connection:{}}),f=U(!1),g=U(!1),k=U(!1);U(null);const S=U({}),$=U(null);Te(()=>{r()});const r=()=>{S.value={global:{value:null,matchMode:Me.CONTAINS}}};function u(){_.value={connection:{}},f.value=!0}function x(h){_.value=F.cloneDeep(h),g.value=!0}function A(h){_.value=F.cloneDeep(h),f.value=!0}function M(h,b){i.require({group:"popup",target:h.target,message:`Disconnect '${b.name}' worker?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Disconnect",accept:()=>d(t.deleteServer(b.id),"Disconnected","Failed to disconnect worker"),reject:()=>{}})}const B=h=>{i.require({group:"restart",message:h.name,header:`Restart '${h.name}' server?`,icon:"pi pi-replay",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-warning p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Restart",accept:async()=>{await d(t.stopServer(h,k.value),"Restarting...","Failed to restart worker",h.name,h.name)},reject:()=>{}})};function D(){te("store",async()=>await t.refresh())}return(h,b)=>{const ue=ke,L=E,de=Se,ve=ne,pe=we,P=oe,O=se,Y=Ce,me=Ee,_e=Ge,fe=le,he=vt,be=Gt,ge=Ae,ye=Be,$e=Le,W=K("tooltip");return c(),y(N,null,[e("div",Kt,[e("div",null,[e("h5",Yt,[Ht,zt,o(ue,{refreshing:p(v)},null,8,["refreshing"])])]),e("div",null,[R((c(),y("button",{onClick:D,class:"p-link layout-topbar-button",disabled:p(v)},Zt,8,Qt)),[[W,"Refresh",void 0,{top:!0}]])])]),o(fe,{value:p(a).length>0?p(a):[],paginator:!0,rows:10,dataKey:"id",rowHover:!0,filters:S.value,"onUpdate:filters":b[1]||(b[1]=n=>S.value=n),filterDisplay:"menu",loading:$.value,globalFilterFields:["name","id","connection.url"],showGridlines:"",style:{"white-space":"nowrap"}},{header:m(()=>[e("div",Jt,[o(L,{label:"Connect",icon:"pi pi-link",severity:"success",onClick:u}),o(pe,{iconPosition:"left"},{default:m(()=>[o(de,{class:"pi pi-search"}),o(ve,{modelValue:S.value.global.value,"onUpdate:modelValue":b[0]||(b[0]=n=>S.value.global.value=n),placeholder:"Keyword Search",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])]),empty:m(()=>[l(" No workers found")]),loading:m(()=>[l(" Loading workers...")]),default:m(()=>[o(P,{field:"name",header:"Name"},{body:m(({data:n})=>{var I,H,z,Q,X,Z;return[e("div",null,[l(w(n.name)+" ",1),(H=(I=n.status)==null?void 0:I.worker)!=null&&H.id&&((Q=(z=n.status)==null?void 0:z.worker)==null?void 0:Q.id)!==n.name?R((c(),y("i",en,null,512)),[[W,`Worker ID does not match. Rename the worker to match it.

ðŸ‘‰ Worker ID: ${(Z=(X=n.status)==null?void 0:X.worker)==null?void 0:Z.id}`]]):C("",!0)])]}),_:1}),o(P,{header:"API"},{body:m(({data:n})=>[e("div",null,[o(O,{connected:n.connected},null,8,["connected"]),e("a",{class:"ml-1",href:n.connection.url,target:"_blank"},w(n.connection.url),9,tn)])]),_:1}),o(P,{header:"Info"},{body:m(({data:n})=>[n.connected===void 0?(c(),V(Y,{key:0,width:"9rem"})):n.connected===!1?(c(),V(O,{key:1,connected:n.connected},null,8,["connected"])):(c(),V(me,{key:2,server:n},null,8,["server"]))]),_:1}),o(P,{header:"Sessions"},{body:m(({data:n})=>[e("div",nn,[n.connected===void 0?(c(),V(Y,{key:0,width:"10rem"})):C("",!0),n.connected===!1?(c(),V(O,{key:1,connected:n.connected},null,8,["connected"])):C("",!0),o(_e,{sessions:p(t).visibleSessionsByServer[n.id]},null,8,["sessions"])])]),_:1}),o(P,null,{body:m(({data:n})=>[e("div",on,[R(o(L,{disabled:!n.connected,icon:"pi pi-info",severity:"help",rounded:"",outlined:"",onClick:I=>x(n)},null,8,["disabled","onClick"]),[[W,"Worker Info",void 0,{top:!0}]]),R(o(L,{icon:"pi pi-pencil",severity:"success",rounded:"",outlined:"",onClick:I=>A(n)},null,8,["onClick"]),[[W,"Edit Worker",void 0,{top:!0}]]),R(o(L,{icon:"pi pi-replay",severity:"warning",rounded:"",outlined:"",onClick:I=>B(n)},null,8,["onClick"]),[[W,"Restart Worker",void 0,{top:!0}]]),R(o(L,{icon:"pi pi-times",severity:"danger",rounded:"",outlined:"",onClick:I=>M(I,n)},null,8,["onClick"]),[[W,"Disconnect Worker",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","filters","loading"]),o(he,{visible:f.value,"onUpdate:visible":b[2]||(b[2]=n=>f.value=n),server:_.value,"onUpdate:server":b[3]||(b[3]=n=>_.value=n)},null,8,["visible","server"]),o(be,{visible:g.value,"onUpdate:visible":b[4]||(b[4]=n=>g.value=n),server:_.value,"onUpdate:server":b[5]||(b[5]=n=>_.value=n)},null,8,["visible","server"]),o(ge,{group:"popup"}),o($e,{group:"restart"},{message:m(n=>[e("div",null,[e("p",null,[l(" You're going to restart "),e("b",null,w(n.message.message),1),l(" server. ")]),sn,e("div",null,[rn,o(ye,{modelValue:k.value,"onUpdate:modelValue":b[6]||(b[6]=I=>k.value=I),id:"forceRestart",onLabel:"Force Restart On",offLabel:"Force Restart Off"},{icon:m(()=>[ln]),_:1},8,["modelValue"])])])]),_:1})],64)}}};export{xn as _};
