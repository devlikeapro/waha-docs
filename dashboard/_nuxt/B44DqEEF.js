import{c as de,g as ue,u as Z,s as pe,C as I,W as me}from"./0YJqZkZc.js";import ee from"./CtGShW_O.js";import{W as ve,_ as fe,a as X,b as _e}from"./i4At_bA9.js";import ge from"./BrH20rlc.js";import he from"./BIYsKJDr.js";import ye from"./Dr8aoB3F.js";import we from"./DVUno6Ta.js";import be from"./yCzRczAF.js";import xe from"./XJBn7BCa.js";import{c as k,t as x,L as P,M as Ce,N as E,_ as te,v as T,x as n,y as oe,i as Se,O as ne,P as K,z as l,Q as Ee,R as ke,r as L,o as Ne,S as z,H as Y,B as J,A as S,T as G,U as De,C as Te,D as $e,V as Oe}from"./qTZtBG9C.js";import Re from"./DGph6L_W.js";import"./fsogjyde.js";import"./stY_3GQ3.js";import"./B0VqKK7w.js";import"./m0gQYl2I.js";import"./B_Lv7Gwd.js";import"./C_oRfS8W.js";import"./DcaWwO0S.js";import"./Dt1cD4y8.js";import"./Dcvm1s8E.js";import"./Cbq64HwX.js";import"./CRkG-XIb.js";import"./B-8oE4H3.js";import"./BlxCgclS.js";import"./BYfiD-iO.js";import"./CUH4nKri.js";import"./B0S2sxhe.js";import"./CAVP1j0T.js";import"./DaPiPM5S.js";import"./BftkcmqA.js";import"./DnhMVqhJ.js";import"./C5rN1HRG.js";import"./ChyhYJaj.js";import"./CKJpYYhI.js";import"./Dw_Z5b5e.js";import"./Bg35cM6f.js";import"./B70bAP2v.js";function Ie(d){return new Date(d).toLocaleTimeString(void 0,{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})+"."+String(new Date(d).getMilliseconds()).padStart(3,"0")}const Ve={__name:"EventTag",props:["event"],setup(d){const u=d,h=k(()=>ve[u.event]||"rgb(114,166,234)"),p=k(()=>({background:"transparent",border:"2px solid rgb(66, 75, 87)",color:h.value,"font-size":"0.9rem"})),e={"session.status":"session.status 🖥️",message:"message ✉️","message.any":"message.any ✉️","message.ack":"message.ack 👀"},m=k(()=>e[u.event]||u.event);return(v,w)=>{const s=xe;return x(),P(s,{style:Ce(E(p)),value:E(m)},null,8,["style","value"])}}},Be={class:"truncate"},Ae={__name:"EventDetail",props:["data"],setup(d){const u=d,h=k(()=>{var w,s,o,f,_;const e=u.data.payload,m=u.data,v=u.data.event;switch(v){case"session.status":return[e.status,(w=m.me)==null?void 0:w.id,(s=m.me)==null?void 0:s.pushName];case"message":case"message.any":case"message.ack":case"message.reaction":return[e.id,e.body,v==="message.ack"?e.ackName:null,v==="message.ack"?null:(o=e.reaction)==null?void 0:o.text,(f=e.media)!=null&&f.url?"🖼":null];case"group.v2.join":return[e.group.id,JSON.stringify(e.group)];case"group.v2.leave":return[e.group.id];case"group.v2.update":return[e.group.id,JSON.stringify(e.group)];case"group.v2.participants":return[e.group.id,e.type,JSON.stringify(e.participants)];case"engine.event":return[e.event,JSON.stringify(e.data)];case"presence.update":return[e.id,(_=e.presences)==null?void 0:_[0].lastKnownPresence];default:return[]}}),p=k(()=>h.value.filter(e=>e!=null).join(" | "));return(e,m)=>(x(),T("div",Be,[n("code",null,oe(E(p)),1)]))}},Ue=te(Ae,[["__scopeId","data-v-5d65cace"]]),Le={class:"flex gap-2"},je={style:{"margin-top":"-0.75rem"}},Me={style:{"max-width":"100%"}},Fe={__name:"EventDataViewer",props:["data"],setup(d){const u=d,h=k(()=>{const e={...u.data};return delete e._json,{id:e.id,session:e.session,event:e.event,payload:e.payload,...e}});async function p(e){await navigator.clipboard.writeText(JSON.stringify(h.value,null,2)),e.preventDefault()}return(e,m)=>{const v=ee,w=Se("vue-json-pretty"),s=ne("tooltip");return x(),T("div",Le,[n("div",je,[K(l(v,{rounded:"",text:"",icon:"pi pi-copy",severity:"secondary",onClick:m[0]||(m[0]=o=>p(o))},null,512),[[s,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),n("div",Me,[l(w,{data:E(h),deep:2,showLine:!1,showIcon:!0,theme:"dark"},null,8,["data"])])])}}},Je={key:0,class:"pi pi-angle-down"},He={key:1,class:"pi pi-angle-up"},We={__name:"expand",props:["rows","data"],setup(d){const u=d,h=k(()=>{var p;return!((p=u.rows)!=null&&p[u.data.id])});return(p,e)=>E(h)?(x(),T("i",Je)):(x(),T("i",He))}};var se={exports:{}};(function(d,u){(function(h,p){d.exports=p()})(de,function(){return function h(p,e,m){var v=window,w="application/octet-stream",s=m||w,o=p,f=!e&&!m&&o,_=document.createElement("a"),B=function(r){return String(r)},i=v.Blob||v.MozBlob||v.WebKitBlob||B,b=e||"download",g,j;if(i=i.call?i.bind(v):Blob,String(this)==="true"&&(o=[o,s],s=o[0],o=o[1]),f&&f.length<2048&&(b=f.split("/").pop().split("?")[0],_.href=f,_.href.indexOf(f)!==-1)){var C=new XMLHttpRequest;return C.open("GET",f,!0),C.responseType="blob",C.onload=function(r){h(r.target.response,b,w)},setTimeout(function(){C.send()},0),C}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(o))if(o.length>1024*1024*1.999&&i!==B)o=U(o),s=o.type||w;else return navigator.msSaveBlob?navigator.msSaveBlob(U(o),b):$(o);else if(/([\x80-\xff])/.test(o)){var N=0,A=new Uint8Array(o.length),H=A.length;for(N;N<H;++N)A[N]=o.charCodeAt(N);o=new i([A],{type:s})}g=o instanceof i?o:new i([o],{type:s});function U(r){var D=r.split(/[:;,]/),t=D[1],c=D[2]=="base64"?atob:decodeURIComponent,y=c(D.pop()),O=y.length,R=0,M=new Uint8Array(O);for(R;R<O;++R)M[R]=y.charCodeAt(R);return new i([M],{type:t})}function $(r,D){if("download"in _)return _.href=r,_.setAttribute("download",b),_.className="download-js-link",_.innerHTML="downloading...",_.style.display="none",document.body.appendChild(_),setTimeout(function(){_.click(),document.body.removeChild(_),D===!0&&setTimeout(function(){v.URL.revokeObjectURL(_.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(r)&&(r="data:"+r.replace(/^data:([\w\/\-\+]+)/,w)),window.open(r)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=r),!0;var t=document.createElement("iframe");document.body.appendChild(t),!D&&/^data:/.test(r)&&(r="data:"+r.replace(/^data:([\w\/\-\+]+)/,w)),t.src=r,setTimeout(function(){document.body.removeChild(t)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(g,b);if(v.URL)$(v.URL.createObjectURL(g),!0);else{if(typeof g=="string"||g.constructor===B)try{return $("data:"+s+";base64,"+v.btoa(g))}catch{return $("data:"+s+","+encodeURIComponent(g))}j=new FileReader,j.onload=function(r){$(this.result)},j.readAsDataURL(g)}return!0}})})(se);var Pe=se.exports;const ze=ue(Pe),V=d=>(Te("data-v-0c272024"),d=d(),$e(),d),Ge={class:"mb-4"},Ke=V(()=>n("h5",{class:"flex align-items-center gap-1"},[n("i",{class:"pi pi-eye"}),n("span",{class:"mr-1"}," Event Monitor ")],-1)),qe={class:"m-0"},Qe=V(()=>n("a",{target:"_blank",href:"https://waha.devlike.pro/docs/how-to/webhooks/#events"}," WAHA Events ",-1)),Xe=V(()=>n("br",null,null,-1)),Ye=V(()=>n("b",null,"development",-1)),Ze=V(()=>n("b",null,"debugging",-1)),et={class:"pi pi-info-circle"},tt={class:"flex justify-content-between align-items-center flex-column sm:flex-row gap-2 sm:gap-0"},ot={class:"flex flex-column sm:flex-row gap-2"},nt={class:"flex gap-2"},st={class:"flex align-items-center justify-content-center"},at={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-2"},lt={class:"p-4 text-center text-se"},it=V(()=>n("span",null," Listening for new events... ",-1)),rt=V(()=>n("i",{class:"pi pi-spin pi-spinner"},null,-1)),ct={class:"event-viewer"},dt={__name:"EventTable",setup(d){const u=Ee(),h=Z(),{servers:p}=ke(h),e=L(null);Ne(async()=>{var y;for(let O=0;O<30;O++)p.value.length===0&&await pe(100);p.value.length>0&&(e.value=(y=p.value)==null?void 0:y[0].id,C())});const m=L([]),v=["engine.event","group.join","group.leave"],w=X.filter(t=>!v.includes(t)),s=L({global:{value:null,matchMode:z.CONTAINS},event:{value:w,matchMode:z.IN},session:{value:null,matchMode:z.CONTAINS}}),o=["_json"],f=L(!1);function _(t){t.timestamp=t.timestamp||Date.now(),t._json=t._json||JSON.stringify(t),m.value.push(t)}Y(e,()=>{f.value&&(U(),C())});const B=k(()=>{var t;return s.value.event.value?(t=s.value.event.value)==null?void 0:t.includes("engine.event"):!0});Y(B,()=>{f.value&&(U(),C())});let i=null;const b=L(I.DISCONNECTED),g=L({}),j=t=>{const c=g.value[t.data.id]===void 0||!g.value[t.data.id],y={...g.value};c?y[t.data.id]=!0:delete y[t.data.id],g.value={...y}},C=()=>{f.value=!0,N()};function N(){if(!f.value)return;if(!e.value){u.add({severity:"warn",summary:"No server selected",detail:"Please select a server to start listening"});return}if(i){u.add({severity:"warn",summary:"Already listening",detail:"Please stop the current listener before starting a new one or refresh the page"});return}const t=h.getServer(e.value),c=["*"];B.value&&c.push("engine.event"),i=new me(t,c),i.connect(),b.value=I.CONNECTING,i.on("open",()=>{b.value=I.CONNECTED}),i.on("close",()=>{b.value=I.DISCONNECTED,A()}),i.on("error",()=>{b.value=I.ERROR,A()}),i.on("event",_)}function A(){H(),setTimeout(()=>{N()},300)}function H(){i==null||i.stop(),i=null}const U=()=>{f.value=!1,H(),b.value=I.DISCONNECTED},$=()=>{m.value=[]},r=k(()=>`Clean Events (${m.value.length})`);function D(t){ze(JSON.stringify(m.value,null,2),"events.json","text/plain")}return(t,c)=>{const y=ee,O=_e,R=ge,M=he,ae=ye,F=we,le=be,ie=Ve,re=Ue,ce=Re,q=ne("tooltip");return x(),T(G,null,[n("div",Ge,[Ke,n("div",null,[n("p",qe,[J(" Monitor "),Qe,J(" from your sessions in real-time! "),Xe,J(" You can use Event Monitor for "),Ye,J(" and "),Ze,J(" purposes. "),K(n("i",et,null,512),[[q,"Displays only new incoming events in real-time; no historical data is available."]])])])]),l(ce,{value:m.value,dataKey:"id",expandedRows:g.value,"onUpdate:expandedRows":c[4]||(c[4]=a=>g.value=a),rowHover:!0,filters:s.value,"onUpdate:filters":c[5]||(c[5]=a=>s.value=a),filterDisplay:"row",globalFilterFields:o,showGridlines:"",style:{"white-space":"nowrap"},sortField:"timestamp",sortOrder:-1,resizableColumns:"",class:"p-datatable--clickable",onRowClick:j},{header:S(()=>[n("div",tt,[n("div",ot,[n("div",nt,[f.value?(x(),P(y,{key:1,label:"Pause",icon:"pi pi-pause",severity:"secondary",onClick:U})):(x(),P(y,{key:0,label:"Listen",icon:"pi pi-play",severity:"success",onClick:C})),l(O,{placeholder:"Select Server",modelValue:e.value,"onUpdate:modelValue":c[0]||(c[0]=a=>e.value=a),showClear:!1},null,8,["modelValue"])]),n("div",st,[l(fe,{status:b.value},null,8,["status"])])]),n("div",at,[K(l(y,{icon:"pi pi-download",label:"Download",onClick:c[1]||(c[1]=a=>D(a))},null,512),[[q,"Download all events as JSON"]]),l(y,{label:E(r),icon:"pi pi-trash",severity:"secondary",onClick:$},null,8,["label"]),l(ae,{iconPosition:"left"},{default:S(()=>[l(R,{class:"pi pi-search"}),l(M,{modelValue:s.value.global.value,"onUpdate:modelValue":c[2]||(c[2]=a=>s.value.global.value=a),placeholder:"Search in data",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])])]),empty:S(()=>[n("div",lt,[b.value===E(I).CONNECTED?(x(),T(G,{key:0},[it,rt],64)):(x(),T(G,{key:1},[f.value?De("",!0):(x(),P(y,{key:0,label:"Listen",icon:"pi pi-play",severity:"success",onClick:C}))],64))])]),expansion:S(a=>[n("div",ct,[l(Fe,{data:a.data},null,8,["data"])])]),default:S(()=>[l(F,{style:{width:"3rem"}},{body:S(({data:a})=>[l(We,{rows:g.value,data:a},null,8,["rows","data"])]),_:1}),l(F,{field:"event",header:"Event","show-filter-menu":!1},{filter:S(({filterModel:a,filterCallback:Q})=>[l(le,{id:"events",modelValue:a.value,"onUpdate:modelValue":W=>a.value=W,placeholder:"Any","max-selected-labels":1,selectedItemsLabel:"{0} events",onChange:W=>Q(),options:E(X),showClear:!0,required:!1},null,8,["modelValue","onUpdate:modelValue","onChange","options"])]),body:S(({data:a})=>[l(ie,{event:a.event},null,8,["event"])]),_:1}),l(F,{field:"session",header:"Session","show-filter-menu":!1},{filter:S(({filterModel:a,filterCallback:Q})=>[l(M,{modelValue:s.value.session.value,"onUpdate:modelValue":c[3]||(c[3]=W=>s.value.session.value=W),placeholder:"Session",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(F,{field:"timestamp",header:"Time",sortable:""},{body:S(({data:a})=>[n("span",null,oe(E(Ie)(a.timestamp)),1)]),_:1}),l(F,{header:"Detail","show-filter-menu":!1},{body:S(({data:a})=>[l(re,{data:a},null,8,["data"])]),_:1})]),_:1},8,["value","expandedRows","filters"])],64)}}},ut=te(dt,[["__scopeId","data-v-0c272024"]]),pt={class:"grid"},mt={class:"col-12"},vt={class:"card"},Yt={__name:"event-monitor",setup(d){const u=Z();return Oe(()=>{u.refresh()}),(h,p)=>(x(),T("div",pt,[n("div",mt,[n("div",vt,[l(ut)])])]))}};export{Yt as default};
