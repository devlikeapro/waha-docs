import{c as pe,g as me,u as te,s as ve,C as B,W as fe}from"./BbfX-E6k.js";import oe from"./DhrnU1B5.js";import{W as _e,_ as ge,a as Y,b as he}from"./xvW2Am9_.js";import ye from"./B_jdsd0A.js";import we from"./C3nzapsZ.js";import be from"./CyN2XbeM.js";import Ce from"./BHdWHbi2.js";import xe from"./H_OBNKGj.js";import Se from"./CaZdF0iV.js";import{c as D,t as C,L as H,M as ke,N as n,_ as ne,v as O,x as r,y as A,O as se,i as Ee,P as ae,Q as G,z as c,R as Ne,S as Te,r as j,o as De,T as z,H as Z,B as ee,A as E,U as P,V as Ie,C as $e,D as Oe,W as Re}from"./B84ENFC1.js";import Ve from"./DdWfxtrF.js";import"./Uj-ZQ9iL.js";import"./BMPM3cXk.js";import"./ZgQyWWLA.js";import"./DvUBhhqD.js";import"./CbneMcP1.js";import"./CHYdEvw_.js";import"./D_l070iG.js";import"./DPhNRA4J.js";import"./DHDkvOtm.js";import"./C_OR3kfV.js";import"./C3jwADRz.js";import"./DKEGsgn9.js";import"./Da8yJHCo.js";import"./BddYf7fI.js";import"./BSPwq29d.js";import"./B4QWJ8_r.js";import"./CKk77L_7.js";import"./BLi4u1bb.js";import"./BrG3JAbP.js";import"./CoJEvTrd.js";import"./CgOrBHvI.js";import"./C6YwJyCz.js";import"./BjPuWtq5.js";import"./DEMjAxYS.js";import"./CEhnqG46.js";import"./BKkzF45r.js";function Be(m){return new Date(m).toLocaleTimeString(void 0,{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})+"."+String(new Date(m).getMilliseconds()).padStart(3,"0")}const Ue={__name:"EventTag",props:["event"],setup(m){const v=m,y=D(()=>_e[v.event]||"rgb(114,166,234)"),p=D(()=>({background:"transparent",border:"2px solid rgb(66, 75, 87)",color:y.value,"font-size":"0.9rem"})),e={"session.status":"session.status 🖥️",message:"message ✉️","message.any":"message.any ✉️","message.ack":"message.ack 👀","message.revoked":"message.revoked ❌","message.edited":"message.edited ✏️"},t=D(()=>e[v.event]||v.event);return(i,w)=>{const _=Se;return C(),H(_,{style:ke(n(p)),value:n(t)},null,8,["style","value"])}}},je={class:"truncate"},Ae={__name:"EventDetail",props:["data"],setup(m){const v=m,y=D(()=>{var w,_,o,b,a,I;const e=v.data.payload,t=v.data,i=v.data.event;switch(i){case"session.status":return[e.status,(w=t.me)==null?void 0:w.id,(_=t.me)==null?void 0:_.pushName];case"message":case"message.any":case"message.ack":case"message.reaction":return[e.id,e.body,i==="message.ack"?e.ackName:null,i==="message.ack"?null:(o=e.reaction)==null?void 0:o.text,(b=e.media)!=null&&b.url?"🖼":null];case"poll.vote":return[e.vote.id,e.vote.selectedOptions];case"message.revoked":return[e.revokedMessageId,e.after.id];case"message.edited":return[e.originalMessageId,e.body,e.id];case"group.v2.join":return[e.group.id,JSON.stringify(e.group)];case"group.v2.leave":return[e.group.id];case"group.v2.update":return[e.group.id,JSON.stringify(e.group)];case"group.v2.participants":return[e.group.id,e.type,JSON.stringify(e.participants)];case"event.response":case"event.response.failed":return[(a=e.eventResponse)==null?void 0:a.response,e.eventCreationKey.id];case"engine.event":return[e.event,JSON.stringify(e.data)];case"presence.update":return[e.id,(I=e.presences)==null?void 0:I[0].lastKnownPresence];default:return[]}}),p=D(()=>y.value.filter(e=>e!=null).join(" | "));return(e,t)=>(C(),O("div",je,[r("code",null,A(n(p)),1)]))}},Le=ne(Ae,[["__scopeId","data-v-a80eb3c3"]]),Me={class:"flex gap-2"},Fe={style:{"margin-top":"-0.75rem"}},Je={style:{"max-width":"100%"}},We={__name:"EventDataViewer",props:["data"],setup(m){const v=m,{t:y}=se(),p=D(()=>{const t={...v.data};return delete t._json,{id:t.id,session:t.session,event:t.event,payload:t.payload,...t}});async function e(t){await navigator.clipboard.writeText(JSON.stringify(p.value,null,2)),t.preventDefault()}return(t,i)=>{const w=oe,_=Ee("vue-json-pretty"),o=ae("tooltip");return C(),O("div",Me,[r("div",Fe,[G(c(w,{rounded:"",text:"",icon:"pi pi-copy",severity:"secondary",onClick:i[0]||(i[0]=b=>e(b))},null,512),[[o,{value:n(y)("monitor.copiedToClipboard")},void 0,{focus:!0,bottom:!0}]])]),r("div",Je,[c(_,{data:n(p),deep:2,showLine:!1,showIcon:!0,theme:"dark"},null,8,["data"])])])}}},He={key:0,class:"pi pi-angle-down"},ze={key:1,class:"pi pi-angle-up"},Pe={__name:"expand",props:["rows","data"],setup(m){const v=m,y=D(()=>{var p;return!((p=v.rows)!=null&&p[v.data.id])});return(p,e)=>n(y)?(C(),O("i",He)):(C(),O("i",ze))}};var le={exports:{}};(function(m,v){(function(y,p){m.exports=p()})(pe,function(){return function y(p,e,t){var i=window,w="application/octet-stream",_=t||w,o=p,b=!e&&!t&&o,a=document.createElement("a"),I=function(u){return String(u)},x=i.Blob||i.MozBlob||i.WebKitBlob||I,f=e||"download",g,S;if(x=x.call?x.bind(i):Blob,String(this)==="true"&&(o=[o,_],_=o[0],o=o[1]),b&&b.length<2048&&(f=b.split("/").pop().split("?")[0],a.href=b,a.href.indexOf(b)!==-1)){var R=new XMLHttpRequest;return R.open("GET",b,!0),R.responseType="blob",R.onload=function(u){y(u.target.response,f,w)},setTimeout(function(){R.send()},0),R}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(o))if(o.length>1024*1024*1.999&&x!==I)o=L(o),_=o.type||w;else return navigator.msSaveBlob?navigator.msSaveBlob(L(o),f):T(o);else if(/([\x80-\xff])/.test(o)){var k=0,U=new Uint8Array(o.length),F=U.length;for(k;k<F;++k)U[k]=o.charCodeAt(k);o=new x([U],{type:_})}g=o instanceof x?o:new x([o],{type:_});function L(u){var $=u.split(/[:;,]/),V=$[1],s=$[2]=="base64"?atob:decodeURIComponent,d=s($.pop()),h=d.length,N=0,J=new Uint8Array(h);for(N;N<h;++N)J[N]=d.charCodeAt(N);return new x([J],{type:V})}function T(u,$){if("download"in a)return a.href=u,a.setAttribute("download",f),a.className="download-js-link",a.innerHTML="downloading...",a.style.display="none",document.body.appendChild(a),setTimeout(function(){a.click(),document.body.removeChild(a),$===!0&&setTimeout(function(){i.URL.revokeObjectURL(a.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(u)&&(u="data:"+u.replace(/^data:([\w\/\-\+]+)/,w)),window.open(u)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=u),!0;var V=document.createElement("iframe");document.body.appendChild(V),!$&&/^data:/.test(u)&&(u="data:"+u.replace(/^data:([\w\/\-\+]+)/,w)),V.src=u,setTimeout(function(){document.body.removeChild(V)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(g,f);if(i.URL)T(i.URL.createObjectURL(g),!0);else{if(typeof g=="string"||g.constructor===I)try{return T("data:"+_+";base64,"+i.btoa(g))}catch{return T("data:"+_+","+encodeURIComponent(g))}S=new FileReader,S.onload=function(u){T(this.result)},S.readAsDataURL(g)}return!0}})})(le);var Ge=le.exports;const Ke=me(Ge),K=m=>($e("data-v-68e5be48"),m=m(),Oe(),m),qe={class:"mb-4"},Qe={class:"flex align-items-center gap-1"},Xe=K(()=>r("i",{class:"pi pi-eye"},null,-1)),Ye={class:"mr-1"},Ze={class:"m-0"},et=K(()=>r("br",null,null,-1)),tt={class:"pi pi-info-circle"},ot={class:"flex justify-content-between align-items-center flex-column sm:flex-row gap-2 sm:gap-0"},nt={class:"flex flex-column sm:flex-row gap-2"},st={class:"flex gap-2"},at={class:"flex align-items-center justify-content-center"},lt={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-2"},rt={class:"p-4 text-center text-se"},it=K(()=>r("i",{class:"pi pi-spin pi-spinner"},null,-1)),ct={class:"event-viewer"},dt={__name:"EventTable",setup(m){const v=Ne(),y=te(),{servers:p}=Te(y),e=j(null),{t}=se();De(async()=>{var h;for(let N=0;N<30;N++)p.value.length===0&&await ve(100);p.value.length>0&&(e.value=(h=p.value)==null?void 0:h[0].id,k())});const i=j([]),w=["engine.event","group.join","group.leave"],_=Y.filter(s=>!w.includes(s)),o=j({global:{value:null,matchMode:z.CONTAINS},event:{value:_,matchMode:z.IN},session:{value:null,matchMode:z.CONTAINS}}),b=["_json"],a=j(!1);function I(s){s.timestamp=s.timestamp||Date.now(),s._json=s._json||JSON.stringify(s),i.value.push(s)}Z(e,()=>{a.value&&(T(),k())});const x=D(()=>{var s;return o.value.event.value?(s=o.value.event.value)==null?void 0:s.includes("engine.event"):!0});Z(x,()=>{a.value&&(T(),k())});let f=null;const g=j(B.DISCONNECTED),S=j({}),R=s=>{const d=S.value[s.data.id]===void 0||!S.value[s.data.id],h={...S.value};d?h[s.data.id]=!0:delete h[s.data.id],S.value={...h}},k=()=>{a.value=!0,U()};function U(){if(!a.value)return;if(!e.value){v.add({severity:"warn",summary:"No server selected",detail:"Please select a server to start listening"});return}if(f){v.add({severity:"warn",summary:"Already listening",detail:"Please stop the current listener before starting a new one or refresh the page"});return}const s=y.getServer(e.value),d=["*"];x.value&&d.push("engine.event"),f=new fe(s,d),f.connect(),g.value=B.CONNECTING,f.on("open",()=>{g.value=B.CONNECTED}),f.on("close",()=>{g.value=B.DISCONNECTED,F()}),f.on("error",()=>{g.value=B.ERROR,F()}),f.on("event",I)}function F(){L(),setTimeout(()=>{U()},300)}function L(){f==null||f.stop(),f=null}const T=()=>{a.value=!1,L(),g.value=B.DISCONNECTED},u=()=>{i.value=[]},$=D(()=>{const s=i.value.length;return t("monitor.cleanEvents",{count:s})});function V(s){Ke(JSON.stringify(i.value,null,2),"events.json","text/plain")}return(s,d)=>{const h=oe,N=he,J=ye,q=we,re=be,M=Ce,ie=xe,ce=Ue,de=Le,ue=Ve,Q=ae("tooltip");return C(),O(P,null,[r("div",qe,[r("h5",Qe,[Xe,r("span",Ye,A(n(t)("monitor.title")),1)]),r("div",null,[r("p",Ze,[ee(A(n(t)("monitor.description"))+" ",1),et,ee(" "+A(n(t)("monitor.purpose"))+" ",1),G(r("i",tt,null,512),[[Q,n(t)("monitor.realTimeOnly")]])])])]),c(ue,{value:i.value,dataKey:"id",expandedRows:S.value,"onUpdate:expandedRows":d[4]||(d[4]=l=>S.value=l),rowHover:!0,filters:o.value,"onUpdate:filters":d[5]||(d[5]=l=>o.value=l),filterDisplay:"row",globalFilterFields:b,showGridlines:"",style:{"white-space":"nowrap"},sortField:"timestamp",sortOrder:-1,resizableColumns:"",class:"p-datatable--clickable",onRowClick:R},{header:E(()=>[r("div",ot,[r("div",nt,[r("div",st,[a.value?(C(),H(h,{key:1,label:n(t)("monitor.pause"),icon:"pi pi-pause",severity:"secondary",onClick:T},null,8,["label"])):(C(),H(h,{key:0,label:n(t)("monitor.listen"),icon:"pi pi-play",severity:"success",onClick:k},null,8,["label"])),c(N,{placeholder:n(t)("monitor.selectServer"),modelValue:e.value,"onUpdate:modelValue":d[0]||(d[0]=l=>e.value=l),showClear:!1},null,8,["placeholder","modelValue"])]),r("div",at,[c(ge,{status:g.value},null,8,["status"])])]),r("div",lt,[G(c(h,{icon:"pi pi-download",label:n(t)("monitor.download"),onClick:d[1]||(d[1]=l=>V(l))},null,8,["label"]),[[Q,n(t)("monitor.downloadTooltip")]]),c(h,{label:n($),icon:"pi pi-trash",severity:"secondary",onClick:u},null,8,["label"]),c(re,{iconPosition:"left"},{default:E(()=>[c(J,{class:"pi pi-search"}),c(q,{modelValue:o.value.global.value,"onUpdate:modelValue":d[2]||(d[2]=l=>o.value.global.value=l),placeholder:n(t)("monitor.searchInData"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1})])])]),empty:E(()=>[r("div",rt,[g.value===n(B).CONNECTED?(C(),O(P,{key:0},[r("span",null,A(n(t)("monitor.listeningForEvents")),1),it],64)):(C(),O(P,{key:1},[a.value?Ie("",!0):(C(),H(h,{key:0,label:n(t)("monitor.listen"),icon:"pi pi-play",severity:"success",onClick:k},null,8,["label"]))],64))])]),expansion:E(l=>[r("div",ct,[c(We,{data:l.data},null,8,["data"])])]),default:E(()=>[c(M,{style:{width:"3rem"}},{body:E(({data:l})=>[c(Pe,{rows:S.value,data:l},null,8,["rows","data"])]),_:1}),c(M,{field:"event",header:n(t)("monitor.eventColumn"),"show-filter-menu":!1},{filter:E(({filterModel:l,filterCallback:X})=>[c(ie,{id:"events",modelValue:l.value,"onUpdate:modelValue":W=>l.value=W,placeholder:n(t)("monitor.any"),"max-selected-labels":1,selectedItemsLabel:n(t)("monitor.eventsSelected"),onChange:W=>X(),options:n(Y),showClear:!0,required:!1},null,8,["modelValue","onUpdate:modelValue","placeholder","selectedItemsLabel","onChange","options"])]),body:E(({data:l})=>[c(ce,{event:l.event},null,8,["event"])]),_:1},8,["header"]),c(M,{field:"session",header:n(t)("monitor.sessionColumn"),"show-filter-menu":!1},{filter:E(({filterModel:l,filterCallback:X})=>[c(q,{modelValue:o.value.session.value,"onUpdate:modelValue":d[3]||(d[3]=W=>o.value.session.value=W),placeholder:n(t)("monitor.sessionColumn"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["header"]),c(M,{field:"timestamp",header:n(t)("monitor.timeColumn"),sortable:""},{body:E(({data:l})=>[r("span",null,A(n(Be)(l.timestamp)),1)]),_:1},8,["header"]),c(M,{header:n(t)("monitor.detailColumn"),"show-filter-menu":!1},{body:E(({data:l})=>[c(de,{data:l},null,8,["data"])]),_:1},8,["header"])]),_:1},8,["value","expandedRows","filters"])],64)}}},ut=ne(dt,[["__scopeId","data-v-68e5be48"]]),pt={class:"grid"},mt={class:"col-12"},vt={class:"card"},Yt={__name:"event-monitor",setup(m){const v=te();return Re(()=>{v.refresh()}),(y,p)=>(C(),O("div",pt,[r("div",mt,[r("div",vt,[c(ut)])])]))}};export{Yt as default};
