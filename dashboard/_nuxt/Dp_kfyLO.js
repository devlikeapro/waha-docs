import{c as de,g as ue,u as Z,s as pe,C as V,W as me}from"./CdIk_7Hw.js";import ee from"./BQPSNDoI.js";import{W as ve,_ as fe,a as X,b as _e}from"./eKWKEpFB.js";import ge from"./CK5KaJnk.js";import he from"./DN-OWVNc.js";import ye from"./CNfldKbP.js";import we from"./wnkC57dZ.js";import be from"./BIj_f3l1.js";import xe from"./DBGw_Io3.js";import{c as N,t as x,L as P,M as Ce,N as k,_ as te,v as $,x as n,y as oe,i as Se,O as ne,P as K,z as i,Q as Ee,R as ke,r as L,o as Ne,S as z,H as Y,B as J,A as S,T as G,U as De,C as Te,D as $e,V as Oe}from"./ByDPVo94.js";import Re from"./qaB5xLPO.js";import"./Dkz49tGz.js";import"./RKNokHG-.js";import"./BcO5rwCj.js";import"./fEQIWzO_.js";import"./kjLG-8D8.js";import"./BWuVayyI.js";import"./DlY5tNp8.js";import"./Cy3vIf3y.js";import"./BKQOCnkS.js";import"./CYS_Nj3G.js";import"./DX1RfrCX.js";import"./DOoKashF.js";import"./DndremoW.js";import"./DOtqA4Mc.js";import"./CU9zV0Pn.js";import"./BMHHdOcf.js";import"./D7LT2zGV.js";import"./JXnbLmNb.js";import"./CAZUinx5.js";import"./BwsX22dk.js";import"./CBElRnY-.js";import"./B6ArjNxB.js";import"./L_XHsX9q.js";import"./BgnqeaHb.js";import"./BBGkEgeE.js";import"./DQiSl6-z.js";function Ie(d){return new Date(d).toLocaleTimeString(void 0,{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})+"."+String(new Date(d).getMilliseconds()).padStart(3,"0")}const Ve={__name:"EventTag",props:["event"],setup(d){const u=d,h=N(()=>ve[u.event]||"rgb(114,166,234)"),p=N(()=>({background:"transparent",border:"2px solid rgb(66, 75, 87)",color:h.value,"font-size":"0.9rem"})),e={"session.status":"session.status 🖥️",message:"message ✉️","message.any":"message.any ✉️","message.ack":"message.ack 👀"},m=N(()=>e[u.event]||u.event);return(v,w)=>{const s=xe;return x(),P(s,{style:Ce(k(p)),value:k(m)},null,8,["style","value"])}}},Be={class:"truncate"},Ae={__name:"EventDetail",props:["data"],setup(d){const u=d,h=N(()=>{var w,s,o,f,_,E;const e=u.data.payload,m=u.data,v=u.data.event;switch(v){case"session.status":return[e.status,(w=m.me)==null?void 0:w.id,(s=m.me)==null?void 0:s.pushName];case"message":case"message.any":case"message.ack":case"message.reaction":return[e.id,e.body,v==="message.ack"?e.ackName:null,v==="message.ack"?null:(o=e.reaction)==null?void 0:o.text,(f=e.media)!=null&&f.url?"🖼":null];case"group.v2.join":return[e.group.id,JSON.stringify(e.group)];case"group.v2.leave":return[e.group.id];case"group.v2.update":return[e.group.id,JSON.stringify(e.group)];case"group.v2.participants":return[e.group.id,e.type,JSON.stringify(e.participants)];case"event.response":case"event.response.failed":return[e.from,e.eventCreationKey.id,(_=e.eventResponse)==null?void 0:_.response];case"engine.event":return[e.event,JSON.stringify(e.data)];case"presence.update":return[e.id,(E=e.presences)==null?void 0:E[0].lastKnownPresence];default:return[]}}),p=N(()=>h.value.filter(e=>e!=null).join(" | "));return(e,m)=>(x(),$("div",Be,[n("code",null,oe(k(p)),1)]))}},Ue=te(Ae,[["__scopeId","data-v-d01602bd"]]),Le={class:"flex gap-2"},je={style:{"margin-top":"-0.75rem"}},Me={style:{"max-width":"100%"}},Fe={__name:"EventDataViewer",props:["data"],setup(d){const u=d,h=N(()=>{const e={...u.data};return delete e._json,{id:e.id,session:e.session,event:e.event,payload:e.payload,...e}});async function p(e){await navigator.clipboard.writeText(JSON.stringify(h.value,null,2)),e.preventDefault()}return(e,m)=>{const v=ee,w=Se("vue-json-pretty"),s=ne("tooltip");return x(),$("div",Le,[n("div",je,[K(i(v,{rounded:"",text:"",icon:"pi pi-copy",severity:"secondary",onClick:m[0]||(m[0]=o=>p(o))},null,512),[[s,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),n("div",Me,[i(w,{data:k(h),deep:2,showLine:!1,showIcon:!0,theme:"dark"},null,8,["data"])])])}}},Je={key:0,class:"pi pi-angle-down"},He={key:1,class:"pi pi-angle-up"},We={__name:"expand",props:["rows","data"],setup(d){const u=d,h=N(()=>{var p;return!((p=u.rows)!=null&&p[u.data.id])});return(p,e)=>k(h)?(x(),$("i",Je)):(x(),$("i",He))}};var se={exports:{}};(function(d,u){(function(h,p){d.exports=p()})(de,function(){return function h(p,e,m){var v=window,w="application/octet-stream",s=m||w,o=p,f=!e&&!m&&o,_=document.createElement("a"),E=function(r){return String(r)},l=v.Blob||v.MozBlob||v.WebKitBlob||E,b=e||"download",g,j;if(l=l.call?l.bind(v):Blob,String(this)==="true"&&(o=[o,s],s=o[0],o=o[1]),f&&f.length<2048&&(b=f.split("/").pop().split("?")[0],_.href=f,_.href.indexOf(f)!==-1)){var C=new XMLHttpRequest;return C.open("GET",f,!0),C.responseType="blob",C.onload=function(r){h(r.target.response,b,w)},setTimeout(function(){C.send()},0),C}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(o))if(o.length>1024*1024*1.999&&l!==E)o=U(o),s=o.type||w;else return navigator.msSaveBlob?navigator.msSaveBlob(U(o),b):O(o);else if(/([\x80-\xff])/.test(o)){var D=0,A=new Uint8Array(o.length),H=A.length;for(D;D<H;++D)A[D]=o.charCodeAt(D);o=new l([A],{type:s})}g=o instanceof l?o:new l([o],{type:s});function U(r){var T=r.split(/[:;,]/),t=T[1],c=T[2]=="base64"?atob:decodeURIComponent,y=c(T.pop()),R=y.length,I=0,M=new Uint8Array(R);for(I;I<R;++I)M[I]=y.charCodeAt(I);return new l([M],{type:t})}function O(r,T){if("download"in _)return _.href=r,_.setAttribute("download",b),_.className="download-js-link",_.innerHTML="downloading...",_.style.display="none",document.body.appendChild(_),setTimeout(function(){_.click(),document.body.removeChild(_),T===!0&&setTimeout(function(){v.URL.revokeObjectURL(_.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(r)&&(r="data:"+r.replace(/^data:([\w\/\-\+]+)/,w)),window.open(r)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=r),!0;var t=document.createElement("iframe");document.body.appendChild(t),!T&&/^data:/.test(r)&&(r="data:"+r.replace(/^data:([\w\/\-\+]+)/,w)),t.src=r,setTimeout(function(){document.body.removeChild(t)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(g,b);if(v.URL)O(v.URL.createObjectURL(g),!0);else{if(typeof g=="string"||g.constructor===E)try{return O("data:"+s+";base64,"+v.btoa(g))}catch{return O("data:"+s+","+encodeURIComponent(g))}j=new FileReader,j.onload=function(r){O(this.result)},j.readAsDataURL(g)}return!0}})})(se);var Pe=se.exports;const ze=ue(Pe),B=d=>(Te("data-v-0c272024"),d=d(),$e(),d),Ge={class:"mb-4"},Ke=B(()=>n("h5",{class:"flex align-items-center gap-1"},[n("i",{class:"pi pi-eye"}),n("span",{class:"mr-1"}," Event Monitor ")],-1)),qe={class:"m-0"},Qe=B(()=>n("a",{target:"_blank",href:"https://waha.devlike.pro/docs/how-to/webhooks/#events"}," WAHA Events ",-1)),Xe=B(()=>n("br",null,null,-1)),Ye=B(()=>n("b",null,"development",-1)),Ze=B(()=>n("b",null,"debugging",-1)),et={class:"pi pi-info-circle"},tt={class:"flex justify-content-between align-items-center flex-column sm:flex-row gap-2 sm:gap-0"},ot={class:"flex flex-column sm:flex-row gap-2"},nt={class:"flex gap-2"},st={class:"flex align-items-center justify-content-center"},at={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-2"},it={class:"p-4 text-center text-se"},lt=B(()=>n("span",null," Listening for new events... ",-1)),rt=B(()=>n("i",{class:"pi pi-spin pi-spinner"},null,-1)),ct={class:"event-viewer"},dt={__name:"EventTable",setup(d){const u=Ee(),h=Z(),{servers:p}=ke(h),e=L(null);Ne(async()=>{var y;for(let R=0;R<30;R++)p.value.length===0&&await pe(100);p.value.length>0&&(e.value=(y=p.value)==null?void 0:y[0].id,C())});const m=L([]),v=["engine.event","group.join","group.leave"],w=X.filter(t=>!v.includes(t)),s=L({global:{value:null,matchMode:z.CONTAINS},event:{value:w,matchMode:z.IN},session:{value:null,matchMode:z.CONTAINS}}),o=["_json"],f=L(!1);function _(t){t.timestamp=t.timestamp||Date.now(),t._json=t._json||JSON.stringify(t),m.value.push(t)}Y(e,()=>{f.value&&(U(),C())});const E=N(()=>{var t;return s.value.event.value?(t=s.value.event.value)==null?void 0:t.includes("engine.event"):!0});Y(E,()=>{f.value&&(U(),C())});let l=null;const b=L(V.DISCONNECTED),g=L({}),j=t=>{const c=g.value[t.data.id]===void 0||!g.value[t.data.id],y={...g.value};c?y[t.data.id]=!0:delete y[t.data.id],g.value={...y}},C=()=>{f.value=!0,D()};function D(){if(!f.value)return;if(!e.value){u.add({severity:"warn",summary:"No server selected",detail:"Please select a server to start listening"});return}if(l){u.add({severity:"warn",summary:"Already listening",detail:"Please stop the current listener before starting a new one or refresh the page"});return}const t=h.getServer(e.value),c=["*"];E.value&&c.push("engine.event"),l=new me(t,c),l.connect(),b.value=V.CONNECTING,l.on("open",()=>{b.value=V.CONNECTED}),l.on("close",()=>{b.value=V.DISCONNECTED,A()}),l.on("error",()=>{b.value=V.ERROR,A()}),l.on("event",_)}function A(){H(),setTimeout(()=>{D()},300)}function H(){l==null||l.stop(),l=null}const U=()=>{f.value=!1,H(),b.value=V.DISCONNECTED},O=()=>{m.value=[]},r=N(()=>`Clean Events (${m.value.length})`);function T(t){ze(JSON.stringify(m.value,null,2),"events.json","text/plain")}return(t,c)=>{const y=ee,R=_e,I=ge,M=he,ae=ye,F=we,ie=be,le=Ve,re=Ue,ce=Re,q=ne("tooltip");return x(),$(G,null,[n("div",Ge,[Ke,n("div",null,[n("p",qe,[J(" Monitor "),Qe,J(" from your sessions in real-time! "),Xe,J(" You can use Event Monitor for "),Ye,J(" and "),Ze,J(" purposes. "),K(n("i",et,null,512),[[q,"Displays only new incoming events in real-time; no historical data is available."]])])])]),i(ce,{value:m.value,dataKey:"id",expandedRows:g.value,"onUpdate:expandedRows":c[4]||(c[4]=a=>g.value=a),rowHover:!0,filters:s.value,"onUpdate:filters":c[5]||(c[5]=a=>s.value=a),filterDisplay:"row",globalFilterFields:o,showGridlines:"",style:{"white-space":"nowrap"},sortField:"timestamp",sortOrder:-1,resizableColumns:"",class:"p-datatable--clickable",onRowClick:j},{header:S(()=>[n("div",tt,[n("div",ot,[n("div",nt,[f.value?(x(),P(y,{key:1,label:"Pause",icon:"pi pi-pause",severity:"secondary",onClick:U})):(x(),P(y,{key:0,label:"Listen",icon:"pi pi-play",severity:"success",onClick:C})),i(R,{placeholder:"Select Server",modelValue:e.value,"onUpdate:modelValue":c[0]||(c[0]=a=>e.value=a),showClear:!1},null,8,["modelValue"])]),n("div",st,[i(fe,{status:b.value},null,8,["status"])])]),n("div",at,[K(i(y,{icon:"pi pi-download",label:"Download",onClick:c[1]||(c[1]=a=>T(a))},null,512),[[q,"Download all events as JSON"]]),i(y,{label:k(r),icon:"pi pi-trash",severity:"secondary",onClick:O},null,8,["label"]),i(ae,{iconPosition:"left"},{default:S(()=>[i(I,{class:"pi pi-search"}),i(M,{modelValue:s.value.global.value,"onUpdate:modelValue":c[2]||(c[2]=a=>s.value.global.value=a),placeholder:"Search in data",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])])]),empty:S(()=>[n("div",it,[b.value===k(V).CONNECTED?(x(),$(G,{key:0},[lt,rt],64)):(x(),$(G,{key:1},[f.value?De("",!0):(x(),P(y,{key:0,label:"Listen",icon:"pi pi-play",severity:"success",onClick:C}))],64))])]),expansion:S(a=>[n("div",ct,[i(Fe,{data:a.data},null,8,["data"])])]),default:S(()=>[i(F,{style:{width:"3rem"}},{body:S(({data:a})=>[i(We,{rows:g.value,data:a},null,8,["rows","data"])]),_:1}),i(F,{field:"event",header:"Event","show-filter-menu":!1},{filter:S(({filterModel:a,filterCallback:Q})=>[i(ie,{id:"events",modelValue:a.value,"onUpdate:modelValue":W=>a.value=W,placeholder:"Any","max-selected-labels":1,selectedItemsLabel:"{0} events",onChange:W=>Q(),options:k(X),showClear:!0,required:!1},null,8,["modelValue","onUpdate:modelValue","onChange","options"])]),body:S(({data:a})=>[i(le,{event:a.event},null,8,["event"])]),_:1}),i(F,{field:"session",header:"Session","show-filter-menu":!1},{filter:S(({filterModel:a,filterCallback:Q})=>[i(M,{modelValue:s.value.session.value,"onUpdate:modelValue":c[3]||(c[3]=W=>s.value.session.value=W),placeholder:"Session",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),i(F,{field:"timestamp",header:"Time",sortable:""},{body:S(({data:a})=>[n("span",null,oe(k(Ie)(a.timestamp)),1)]),_:1}),i(F,{header:"Detail","show-filter-menu":!1},{body:S(({data:a})=>[i(re,{data:a},null,8,["data"])]),_:1})]),_:1},8,["value","expandedRows","filters"])],64)}}},ut=te(dt,[["__scopeId","data-v-0c272024"]]),pt={class:"grid"},mt={class:"col-12"},vt={class:"card"},Yt={__name:"event-monitor",setup(d){const u=Z();return Oe(()=>{u.refresh()}),(h,p)=>(x(),$("div",pt,[n("div",mt,[n("div",vt,[i(ut)])])]))}};export{Yt as default};
