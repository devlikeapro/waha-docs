import{u as Te,_ as Pe}from"./8zR_9s5J.js";import se from"./DKYmVgiq.js";import Re from"./BvQqxAhc.js";import be from"./CQksCWA8.js";import qe from"./kj9rAbnQ.js";import ge from"./BjaEftxL.js";import{_ as De}from"./D3phANTN.js";import Ee from"./CoTXZSmX.js";import{O as F,c as L,P as re,t as y,v as K,B as V,y as i,N as s,Q as I,x as t,U as Y,$ as te,z as n,V as W,Y as Fe,L as N,_ as ke,A as p,C as Ue,D as Ie,a2 as ee,r as x,H as he,X as He,a4 as Ge,a3 as ze,d as Le,R as Qe,Z as Me,T as X,o as Ye,S as Xe,W as Ze}from"./CJX7AtTl.js";import{u as J,l as Z,d as Ve}from"./BoTHEUMz.js";import{_ as Je,u as ae}from"./JH6j0JD1.js";import $e from"./BlzUc8ea.js";import we from"./B5AwCHSV.js";import es from"./D1Qm6MuX.js";import ce from"./ly8M-CGb.js";import ss from"./DQwjlj92.js";import We from"./BKsrFb8s.js";import Ne from"./CdpbdQ7F.js";import Oe from"./Da6U4ull.js";import ts from"./C73LtYIP.js";import ns from"./BGyCHKI1.js";import je from"./d-kiEJ39.js";function os(a,e){const c=Math.floor(a/864e5),o=Math.floor(a/36e5)%24,b=Math.floor(a/6e4)%60,v=Math.floor(a/1e3)%60,u=`${String(o).padStart(2,"0")}:${String(b).padStart(2,"0")}:${String(v).padStart(2,"0")}`;return c===0?u:e?c===1?`${u} 1 ${e("uptime.day")}`:`${u} ${c} ${e("uptime.days")}`:c===1?`${u} 1 day`:`${u} ${c} days`}const ls={class:"pi pi-info-circle"},Be={__name:"ServerUptime",props:["status"],setup(a){const{t:e}=F(),c=a,o=L(()=>{const v=c.status.uptime;if(v)return os(v,e)}),b=L(()=>{const v=c.status.startTimestamp;if(v)return new Date(v)});return(v,u)=>{var k;const g=re("tooltip");return y(),K(Y,null,[V(i(o.value)+" "+i(s(e)("servers.uptimeStatus"))+"  ",1),I(t("i",ls,null,512),[[g,`${s(e)("servers.startTime")}: ${(k=b.value)==null?void 0:k.toLocaleString()}`]])],64)}}},is=t("code",null," (",-1),rs=t("code",null,")",-1),as={key:0},cs={__name:"ServerInfoColumn",props:["server"],setup(a){const e=J();return(c,o)=>{const b=Be;return y(),K(Y,null,[t("div",null,[t("code",null,i(a.server.version.engine),1),is,t("code",{class:te({"text-orange-400":a.server.version.version!==s(e).latestVersion})},i(a.server.version.version)+" "+i(a.server.version.tier),3),rs]),a.server.status?(y(),K("div",as,[n(b,{status:a.server.status},null,8,["status"])])):W("",!0)],64)}}},us={__name:"ServerSessionSummary",props:{sessions:{required:!0}},setup(a){const e=a,c=L(()=>Z.groupBy(e.sessions||[],"status")),o={WORKING:1,SCAN_QR_CODE:2,STARTING:3,FAILED:4,STOPPED:5},b=L(()=>Z.sortBy(Object.entries(c.value),([v,u])=>o[v]));return(v,u)=>{const g=Je;return y(!0),K(Y,null,Fe(s(b),([k,$])=>(y(),N(g,{key:k+$.length,status:k,suffix:`:  ${$.length}`},null,8,["status","suffix"]))),128)}}},Ke=a=>(Ue("data-v-f67c6aea"),a=a(),Ie(),a),ds=Ke(()=>t("br",null,null,-1)),ps=Ke(()=>t("br",null,null,-1)),vs={href:"https://waha.devlike.pro/docs/how-to/install/",target:"_blank",rel:"noopener noreferrer"},ms=Ke(()=>t("br",null,null,-1)),fs={href:"https://waha.devlike.pro/docs/how-to/security/",target:"_blank",rel:"noopener noreferrer"},_s={__name:"WorkerNoApiKeyWarning",props:{apikey:{type:String,required:!1,default:void 0},connected:{type:Boolean,default:!1}},setup(a){const e=a,{t:c}=F(),o=[void 0,null,"","00000000000000000000000000000000","admin","321","123","waha"],b=L(()=>o.includes(e.apikey)),v=L(()=>e.connected&&b.value);return(u,g)=>{const k=we;return v.value?(y(),N(k,{key:0,severity:"error",class:"mt-3 waha-no-api-key-warning"},{default:p(()=>[V(i(s(c)("servers.noApiKeyWarning.title"))+" ",1),ds,V(" "+i(s(c)("servers.noApiKeyWarning.readGuide"))+" ",1),ps,t("a",vs,i(s(c)("servers.noApiKeyWarning.installUpdate")),1),ms,t("a",fs,i(s(c)("servers.noApiKeyWarning.security")),1)]),_:1})):W("",!0)}}},Se=ke(_s,[["__scopeId","data-v-f67c6aea"]]),ys={class:"mb-4"},hs=t("br",null,null,-1),bs={class:"field"},gs={for:"name"},ks={key:0,class:"p-invalid"},$s={class:"field"},ws={for:"connection-url"},Ks={key:0,class:"p-invalid"},Ss={key:1,class:"p-invalid"},xs=t("br",null,null,-1),Cs={href:"https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content#developer_console",target:"_blank"},As=t("br",null,null,-1),Vs=t("br",null,null,-1),Ts={href:"https://waha.devlike.pro/docs/how-to/security/#https",target:"_blank"},Ds={class:"field"},Us={for:"connection-key"},Is={__name:"ServerDialog",props:{visible:{},visibleModifiers:{},server:{},serverModifiers:{}},emits:["update:visible","update:server"],setup(a){const{t:e}=F(),c=ee(a,"visible"),o=ee(a,"server"),b=J(),v=ae(),u=x(!1),g=L(()=>{var d;const f=(d=o.value.connection)==null?void 0:d.url;return f?f.startsWith("http://")||f.startsWith("https://"):!1});async function k(){u.value=!0,!(!o.value.name||!g.value)&&(o.value.id?await v(b.editServer(o.value.id,o.value),e("servers.serverUpdated"),e("servers.failedToUpdateServer"),o.value.name,o.value.name):await v(b.addServer(o.value),e("servers.connectedToServer"),e("servers.failedToConnectToServer"),o.value.name,o.value.name),$(),o.value={connection:{}})}function $(){u.value=!1,c.value=!1}const T=L(()=>{var d;const f=(d=o.value.connection)==null?void 0:d.url;return f?f.startsWith("http://"):!1}),S=L(()=>location.protocol==="https:");return(f,d)=>{const m=we,C=be,P=es,j=se,M=ce;return y(),N(M,{visible:c.value,"onUpdate:visible":d[3]||(d[3]=R=>c.value=R),header:s(e)("servers.server"),modal:!0,class:"p-fluid"},{footer:p(()=>[n(j,{label:s(e)("common.cancel"),icon:"pi pi-times",text:"",onClick:$,severity:"secondary"},null,8,["label"]),n(j,{label:o.value.id?s(e)("common.save"):s(e)("servers.connect"),icon:{"pi pi-check":!!o.value.id,"pi pi-link":!o.value.id},text:"",onClick:k},null,8,["label","icon"])]),default:p(()=>{var R;return[t("div",ys,[n(m,{severity:"info"},{default:p(()=>[V(i(s(e)("servers.workersDataSaved"))+" ",1),hs,V(" "+i(s(e)("servers.safeToStoreApiKey")),1)]),_:1})]),t("div",bs,[t("label",gs,i(s(e)("servers.name")),1),n(C,{id:"name",modelValue:o.value.name,"onUpdate:modelValue":d[0]||(d[0]=D=>o.value.name=D),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:u.value&&!o.value.name},null,8,["modelValue","invalid"]),u.value&&!o.value.name?(y(),K("small",ks,i(s(e)("servers.nameRequired")),1)):W("",!0)]),t("div",$s,[t("label",ws,i(s(e)("servers.apiUrl")),1),n(C,{id:"connection-url",modelValue:o.value.connection.url,"onUpdate:modelValue":d[1]||(d[1]=D=>o.value.connection.url=D),modelModifiers:{trim:!0},required:"true",invalid:u.value&&!s(g)},null,8,["modelValue","invalid"]),u.value&&!o.value.connection.url?(y(),K("small",Ks,i(s(e)("servers.urlRequired")),1)):W("",!0),u.value&&!s(g)?(y(),K("small",Ss,i(s(e)("servers.urlNotCorrect")),1)):W("",!0),s(S)&&s(T)?(y(),N(m,{key:2,severity:"error",class:"mt-2"},{default:p(()=>[V(i(s(e)("servers.mixedContentWarning"))+" ",1),xs,V(" "+i(s(e)("servers.notPossibleDueTo"))+" ",1),t("a",Cs,i(s(e)("servers.mixedContent")),1)]),_:1})):W("",!0),s(T)?(y(),N(m,{key:3,severity:"warn",class:"mt-2"},{default:p(()=>[V(i(s(e)("servers.httpWarning"))+" ",1),As,V(" "+i(s(e)("servers.configureHttps"))+" ",1),Vs,t("a",Ts,i(s(e)("servers.readMoreAboutSecurity")),1)]),_:1})):W("",!0)]),t("div",Ds,[t("label",Us,i(s(e)("servers.apiKeyOptional")),1),n(P,{id:"connection-key",modelValue:o.value.connection.key,"onUpdate:modelValue":d[2]||(d[2]=D=>o.value.connection.key=D),modelModifiers:{trim:!0},feedback:!1,toggleMask:""},null,8,["modelValue"]),n(Se,{class:"mt-2",apikey:(R=o.value.connection)==null?void 0:R.key,connected:!0},null,8,["apikey"])])]}),_:1},8,["visible","header"])}}},Ls={class:"p-3 flex flex-column gap-2"},Ms={class:"flex gap-2"},Ws={class:"flex flex-column gap-1"},Ns={class:"flex gap-1"},Os=["href"],js=t("i",{class:"pi pi-external-link"},null,-1),Bs={class:"flex gap-1"},Ps=["href"],Rs=t("i",{class:"pi pi-external-link"},null,-1),qs={class:"flex gap-2"},Es={class:"flex gap-2"},Fs={key:0,class:"text-green-500 font-medium ml-2"},Hs=t("i",{class:"pi text-green-500 pi-check-circle"},null,-1),Gs={class:"flex gap-2"},zs={key:0},Qs={class:"text-900 font-medium"},Ys={href:"https://waha.devlike.pro/docs/overview/changelog/",target:"_blank"},Xs=t("i",{class:"pi pi-external-link"},null,-1),Zs={__name:"ServerStatus",props:["server"],setup(a){const{t:e}=F(),c=a,o=J(),b=L(()=>{var v;return((v=c.server.version)==null?void 0:v.version)!==o.latestVersion});return(v,u)=>{var T,S,f,d,m,C;const g=De,k=Be,$=we;return y(),K("div",Ls,[t("div",Ms,[t("div",null,i(s(e)("servers.status")),1),t("div",Ws,[t("div",null,[n(g,{class:"mr-1",connected:a.server.connected},null,8,["connected"]),t("span",null,[t("b",null,[a.server.connected?(y(),K(Y,{key:0},[V(i(s(e)("servers.statusConnected")),1)],64)):(y(),K(Y,{key:1},[V(i(s(e)("servers.disconnected")),1)],64))])])])])]),t("div",Ns,[t("div",null,i(s(e)("servers.apiUrl")),1),t("div",null,[t("a",{href:(T=a.server.connection)==null?void 0:T.url,target:"_blank",class:"ml-2"},[V(i((S=a.server.connection)==null?void 0:S.url)+" ",1),js],8,Os)])]),t("div",Bs,[t("div",null,i(s(e)("servers.dashboardUrl")),1),t("div",null,[t("a",{href:s(Ve)((f=a.server.connection)==null?void 0:f.url),target:"_blank",class:"ml-2"},[V(i(s(Ve)((d=a.server.connection)==null?void 0:d.url))+" ",1),Rs],8,Ps)])]),t("div",qs,[t("div",null,i(s(e)("servers.engine")),1),t("div",null,[t("code",null,i((m=a.server.version)==null?void 0:m.engine),1)])]),t("div",Es,[t("div",null,i(s(e)("servers.version")),1),t("div",null,[t("code",{class:te({"text-orange-400":s(b)})},i((C=a.server.version)==null?void 0:C.version),3),s(b)?W("",!0):(y(),K("span",Fs,[Hs,V(" "+i(s(e)("servers.upToDate")),1)]))])]),t("div",Gs,[t("div",null,i(s(e)("servers.uptime")),1),a.server.status?(y(),K("div",zs,[n(k,{status:a.server.status},null,8,["status"])])):W("",!0)]),s(b)?(y(),N($,{key:0,severity:"info"},{default:p(()=>[V(i(s(e)("servers.newVersionAvailable"))+" ",1),t("span",Qs,[t("a",Ys,[V(i(s(o).latestVersion)+" ",1),Xs])]),V(" "+i(s(e)("servers.versionAvailable")),1)]),_:1})):W("",!0)])}}},Js={class:"mb-3"},et={class:"flex flex-wrap justify-content-between"},st={class:"flex gap-2 align-items-center"},tt=t("span",{class:"text-xl font-bold"},"Copy",-1),nt={class:"flex gap-2 align-items-center"},ot=t("label",{for:"show-all"},"Show All",-1),lt={__name:"ServerVariablesTable",props:["server"],setup(a){const e=a,c=J(),o=x(!1),b=ae();function v(d){return Z.sortBy(d,m=>m.name.startsWith("DEBUG")?0:m.name.startsWith("WAHA_")?1:m.name.startsWith("WHATSAPP_")?2:3)}function u(d){return d.map(m=>`${m.name}=${m.value}`).join(`
`)}const{data:g,pending:k,error:$,refresh:T}=Te(`server-environment-${e.server.id}`,async()=>{if(!e.server.id)return[];const d=await b(c.getServerEnvironment(e.server.id,o.value),void 0,"Failed to fetch server environment",void 0,e.server.name),m=Object.keys(d).map(C=>({name:C,value:d[C]}));return v(m)});he(()=>e.server,T,{immediate:!0}),he(o,T);const S=L(()=>{const d=g.value||[],m={};for(const C of d)m[C.name]=C.value;return m.WHATSAPP_API_KEY??m.WAHA_API_KEY});async function f(d){const m=u(g.value);await navigator.clipboard.writeText(m),d.preventDefault()}return(d,m)=>{const C=se,P=ss,j=ge,M=$e,R=re("tooltip");return y(),K(Y,null,[t("div",Js,[n(Se,{apikey:s(S),connected:!0},null,8,["apikey"])]),n(M,{value:s(g),loading:s(k),resizableColumns:""},{header:p(()=>[t("div",et,[t("div",st,[tt,I(n(C,{rounded:"",text:"",icon:"pi pi-copy",onClick:m[0]||(m[0]=D=>f(D))},null,512),[[R,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),t("div",nt,[n(P,{inputId:"show-all",modelValue:s(o),"onUpdate:modelValue":m[1]||(m[1]=D=>He(o)?o.value=D:null)},null,8,["modelValue"]),ot])])]),default:p(()=>[n(j,{field:"name",header:"Environment Variable"},{body:p(({data:D})=>[t("code",null,i(D.name),1)]),_:1}),n(j,{field:"value",header:"Value"})]),_:1},8,["value","loading"])],64)}}},it={__name:"ServerControlDialog",props:Ge(["server"],{visible:{},visibleModifiers:{}}),emits:["update:visible"],setup(a){const{t:e}=F(),c=ee(a,"visible"),o=a;return(b,v)=>{const u=Zs,g=lt,k=ce;return y(),N(k,{visible:c.value,"onUpdate:visible":v[0]||(v[0]=$=>c.value=$),modal:!0,class:"p-fluid",style:{"max-width":"100%","min-width":"50%"},header:s(e)("servers.server")},{default:p(()=>[t("h4",null,i(a.server.name),1),n(u,{server:o.server},null,8,["server"]),t("h4",null,i(s(e)("servers.variables")),1),n(g,{server:o.server},null,8,["server"])]),_:1},8,["visible","header"])}}},rt={style:{"min-width":"15rem"}},at={key:0,class:"flex flex-column"},ct={__name:"OverlayLinks",props:{title:{type:String,required:!0}},setup(a,{expose:e}){const c=x(null),o=x(null);return e({toggle:(v,u)=>{c.value.toggle(v),o.value=u},currentItem:o}),(v,u)=>(y(),N(s(ts),{ref_key:"overlayPanel",ref:c,appendTo:"body",showCloseIcon:!0},{default:p(()=>[t("div",rt,[o.value?(y(),K("div",at,[ze(v.$slots,"default")])):W("",!0)])]),_:3},512))}},ut=["href"],ye={__name:"OverlayLink",props:{href:{type:String,required:!0},icon:{type:String,required:!0},name:{type:String,required:!0}},setup(a){return(e,c)=>(y(),K("a",{href:a.href,target:"_blank",class:"overlay-link w-full flex align-items-center"},[t("i",{class:te(`pi ${a.icon} mr-2`)},null,2),t("span",null,i(a.name),1)],8,ut))}},dt={class:"api-key-edit"},pt={class:"field"},vt={class:"field"},mt={key:0,class:"field"},ft={for:"session"},_t={key:0,class:"p-error"},yt=Le({__name:"ApiKeyEdit",props:{modelValue:{type:Object,required:!0},visible:{type:Boolean,default:!1},isNewApiKey:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},sessions:{type:Array,default:()=>[]}},emits:["update:modelValue","update:visible","save","cancel"],setup(a,{emit:e}){const{t:c}=F(),o=a,b=e,v=L({get:()=>o.visible,set:f=>b("update:visible",f)}),u=L({get:()=>o.modelValue,set:f=>b("update:modelValue",f)}),g=L({get:()=>{var f;return((f=u.value)==null?void 0:f.isActive)!==!1},set:f=>{u.value={...u.value,isActive:f}}}),k=L({get:()=>{var f;return!!((f=u.value)!=null&&f.isAdmin)},set:f=>{var d;u.value={...u.value,isAdmin:f,session:f?null:(d=u.value)==null?void 0:d.session}}}),$=x(!1);function T(){var f;$.value=!0,k.value&&(u.value={...u.value,session:null}),!(!k.value&&!((f=u.value)!=null&&f.session))&&b("save",u.value)}function S(){$.value=!1,b("update:visible",!1),b("cancel")}return(f,d)=>{const m=Ne,C=je,P=se,j=ce;return y(),N(j,{visible:v.value,"onUpdate:visible":d[3]||(d[3]=M=>v.value=M),modal:!0,class:"p-fluid",style:{"min-width":"30%"},header:o.isNewApiKey?s(c)("apiKeys.createTitle"):s(c)("apiKeys.editTitle")},{footer:p(()=>[n(P,{label:s(c)("apiKeys.cancel"),icon:"pi pi-times",onClick:S,text:"",severity:"secondary"},null,8,["label"]),n(P,{label:o.isNewApiKey?s(c)("apiKeys.create"):s(c)("apiKeys.save"),icon:o.isNewApiKey?"pi pi-plus":"pi pi-check",onClick:T,loading:o.loading,text:""},null,8,["label","icon","loading"])]),default:p(()=>[t("div",dt,[t("div",pt,[t("label",null,[t("b",null,i(s(c)("apiKeys.statusEdit")),1)]),t("div",null,[n(m,{modelValue:g.value,"onUpdate:modelValue":d[0]||(d[0]=M=>g.value=M),onIcon:"pi pi-check",offIcon:"pi pi-times",onLabel:s(c)("apiKeys.activeOn"),offLabel:s(c)("apiKeys.activeOff")},null,8,["modelValue","onLabel","offLabel"])])]),t("div",vt,[t("label",null,[t("b",null,i(s(c)("apiKeys.scope")),1)]),t("div",null,[n(m,{modelValue:k.value,"onUpdate:modelValue":d[1]||(d[1]=M=>k.value=M),onIcon:"pi pi-shield",offIcon:"pi pi-user",onLabel:s(c)("apiKeys.scopeAdmin"),offLabel:s(c)("apiKeys.scopeSession")},null,8,["modelValue","onLabel","offLabel"])])]),k.value?W("",!0):(y(),K("div",mt,[t("label",ft,[t("b",null,i(s(c)("apiKeys.session")),1)]),n(C,{id:"session",modelValue:u.value.session,"onUpdate:modelValue":d[2]||(d[2]=M=>u.value.session=M),options:o.sessions,optionLabel:"label",optionValue:"value",placeholder:s(c)("apiKeys.selectSession"),class:te({"p-invalid":$.value&&!u.value.session}),editable:!0},null,8,["modelValue","options","placeholder","class"]),$.value&&!u.value.session?(y(),K("small",_t,i(s(c)("apiKeys.sessionRequired")),1)):W("",!0)]))])]),_:1},8,["visible","header"])}}}),ht=ke(yt,[["__scopeId","data-v-cb483248"]]),bt=a=>(Ue("data-v-5c165f3c"),a=a(),Ie(),a),gt={class:"api-key-list"},kt={class:"flex justify-content-between align-items-center w-full mb-2"},$t=bt(()=>t("div",null,null,-1)),wt={class:"flex align-items-center gap-2"},Kt={class:"text-center p-4 flex flex-column gap-2 align-items-center"},St={class:"flex align-items-center gap-1"},xt={class:"pi pi-info-circle"},Ct={class:"flex align-items-center gap-1"},At={class:"pi pi-info-circle"},Vt={class:"flex align-items-center gap-2 w-full"},Tt=["onClick"],Dt={key:0},Ut={key:1},It={class:"flex align-items-center gap-2"},Lt={class:"flex justify-content-end"},Mt={class:"flex gap-2 justify-content-end"},Wt=Le({__name:"ApiKeyList",props:{server:Object},setup(a){const{t:e}=F(),c=Qe(),o=Me(),b=J(),v=ae(),u=a,g=x([]),k=x(!1),$=x(!1),T=x(null),S=x([]),f=x(!1),d=x(!1),m=x({id:{value:null,matchMode:X.CONTAINS},key:{value:null,matchMode:X.CONTAINS},session:{value:null,matchMode:X.CONTAINS},isActive:{value:null,matchMode:X.EQUALS},isAdmin:{value:null,matchMode:X.EQUALS}}),C=x({}),P=L(()=>[{label:e("apiKeys.activeOn"),value:!0},{label:e("apiKeys.activeOff"),value:!1}]),j=L(()=>[{label:e("apiKeys.scopeAdmin"),value:!0},{label:e("apiKeys.scopeSession"),value:!1}]),M=L(()=>{var h;return(h=u.server)!=null&&h.id?(b.visibleSessionsByServer[u.server.id]||[]).map(A=>({label:A.name,value:A.name})):[]});function R(){return M.value.length>0?M.value[0].value:"default"}Ye(async()=>{await D()}),he(()=>u.server,async()=>{await D()},{deep:!0});async function D(){if(!u.server||!u.server.id){g.value=[],S.value=[];return}try{k.value=!0,g.value=await v(b.getApiKeys(u.server.id),void 0,e("apiKeys.failedToLoad")),S.value=[]}catch(_){console.error("Error loading API keys:",_)}finally{k.value=!1}}function ne(){T.value={id:"",key:"",isActive:!0,isAdmin:!1,session:R()},f.value=!0,$.value=!0}function ue(_){T.value={..._},f.value=!1,$.value=!0}function de(_,h){o.require({group:"popup",target:h.currentTarget,message:e("apiKeys.deleteConfirm",{id:_.id}),icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:e("apiKeys.no"),acceptLabel:e("apiKeys.yesDelete"),accept:async()=>{await pe(_)},reject:()=>{}})}function U(_){S.value.length&&o.require({group:"dialog",target:_.currentTarget,message:e("apiKeys.deleteConfirm",{id:S.value.length}),icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:e("apiKeys.no"),acceptLabel:e("apiKeys.yesDelete"),accept:async()=>{await w(),o.close()},reject:()=>{}})}async function w(){var h;if(!((h=u.server)!=null&&h.id)||!S.value.length)return;const _=S.value.map(A=>A.id);try{d.value=!0;for(const A of _)await v(b.deleteApiKey(u.server.id,A),void 0,e("apiKeys.failedToDelete"));c.add({severity:"success",summary:e("apiKeys.deleted"),detail:`${_.length}`,life:3e3}),S.value=[],await D()}catch(A){console.error("Error deleting API keys:",A)}finally{d.value=!1}}async function pe(_){try{await v(b.deleteApiKey(u.server.id,_.id),void 0,e("apiKeys.failedToDelete")),c.add({severity:"success",summary:e("apiKeys.deleted"),detail:_.id,life:3e3}),await D()}catch(h){console.error("Error deleting API key:",h)}}function q(_){const h=!!_.isAdmin;return{isAdmin:h,session:h?null:_.session||null,isActive:_.isActive}}async function ve(_){try{return f.value?(await v(b.createApiKey(u.server.id,q(_)),void 0,e("apiKeys.failedToCreate")),c.add({severity:"success",summary:e("apiKeys.created"),detail:_.session||e("apiKeys.adminLabel"),life:3e3})):(await v(b.updateApiKey(u.server.id,_.id,q(_)),void 0,e("apiKeys.failedToUpdate")),c.add({severity:"success",summary:e("apiKeys.updated"),detail:_.id,life:3e3})),await D(),$.value=!1,!0}catch(h){return console.error("Error saving API key:",h),!1}}function me(_){if(!_)return"";const h=_.startsWith("key_")?"key_":"",A=h?_.slice(h.length):_,B=A.slice(0,3),Q=A.slice(-3);return`${h}${B}****${Q}`}async function oe(_){_&&(await navigator.clipboard.writeText(_),c.add({severity:"success",summary:e("apiKeys.copied"),detail:e("apiKeys.copiedDetail"),life:2e3}))}function G(_){C.value={...C.value,[_]:!C.value[_]}}function z(_){return!!C.value[_]}return(_,h)=>{const A=se,B=ge,Q=be,le=ns,ie=je,fe=$e,_e=We,E=Oe,r=re("tooltip");return y(),K("div",gt,[t("div",kt,[$t,t("div",wt,[n(A,{label:s(e)("apiKeys.createKey"),icon:"pi pi-plus",onClick:ne,severity:"success",text:""},null,8,["label"])])]),n(fe,{value:g.value,loading:k.value,dataKey:"id",paginator:!0,rows:5,rowsPerPageOptions:[5,10,20,50],filters:m.value,"onUpdate:filters":h[4]||(h[4]=l=>m.value=l),selection:S.value,"onUpdate:selection":h[5]||(h[5]=l=>S.value=l),filterDisplay:"row",showGridlines:""},{empty:p(()=>[t("div",Kt,[t("span",null,i(s(e)("apiKeys.noKeysFound")),1),n(A,{label:s(e)("apiKeys.createKey"),icon:"pi pi-plus",severity:"success",onClick:ne,class:"w-auto"},null,8,["label"])])]),default:p(()=>[n(B,{selectionMode:"multiple",headerStyle:"width: 3rem"}),n(B,{field:"id",showFilterMenu:!1},{header:p(()=>[t("div",St,[t("span",null,i(s(e)("apiKeys.id")),1),I(t("i",xt,null,512),[[r,s(e)("apiKeys.idTooltip")]])])]),filter:p(()=>[n(Q,{modelValue:m.value.id.value,"onUpdate:modelValue":h[0]||(h[0]=l=>m.value.id.value=l),type:"text",placeholder:s(e)("apiKeys.id")},null,8,["modelValue","placeholder"])]),body:p(({data:l})=>[V(i(l.id),1)]),_:1}),n(B,{field:"isActive",header:s(e)("apiKeys.status"),showFilterMenu:!1,style:{width:"10rem"}},{body:p(({data:l})=>[n(le,{value:l.isActive!==!1?s(e)("apiKeys.activeOn").toUpperCase():s(e)("apiKeys.activeOff").toUpperCase(),severity:l.isActive!==!1?"success":"secondary"},null,8,["value","severity"])]),filter:p(({filterModel:l,filterCallback:O})=>[n(ie,{modelValue:l.value,"onUpdate:modelValue":H=>l.value=H,options:P.value,optionLabel:"label",optionValue:"value",placeholder:s(e)("apiKeys.any"),class:"p-column-filter",showClear:!0,onChange:H=>O()},null,8,["modelValue","onUpdate:modelValue","options","placeholder","onChange"])]),_:1},8,["header"]),n(B,{field:"key",showFilterMenu:!1},{header:p(()=>[t("div",Ct,[t("span",null,i(s(e)("apiKeys.key")),1),I(t("i",At,null,512),[[r,s(e)("apiKeys.keyTooltip")]])])]),filter:p(()=>[n(Q,{modelValue:m.value.key.value,"onUpdate:modelValue":h[1]||(h[1]=l=>m.value.key.value=l),type:"text",placeholder:s(e)("apiKeys.key")},null,8,["modelValue","placeholder"])]),body:p(({data:l})=>[t("div",Vt,[I((y(),K("span",{class:"cursor-pointer flex-1",onClick:O=>oe(l.key)},[t("code",null,i(z(l.id)?l.key:me(l.key)),1)],8,Tt)),[[r,s(e)("apiKeys.copyHint")]]),I(n(A,{icon:"pi pi-copy",text:"",rounded:"",onClick:O=>oe(l.key)},null,8,["onClick"]),[[r,s(e)("apiKeys.copyHint")]]),I(n(A,{icon:z(l.id)?"pi pi-eye-slash":"pi pi-eye",text:"",rounded:"",onClick:O=>G(l.id)},null,8,["icon","onClick"]),[[r,z(l.id)?s(e)("apiKeys.hideKey"):s(e)("apiKeys.showKey")]])])]),_:1}),n(B,{field:"session",header:s(e)("apiKeys.session"),showFilterMenu:!1,style:{width:"12rem"}},{filter:p(()=>[n(Q,{modelValue:m.value.session.value,"onUpdate:modelValue":h[2]||(h[2]=l=>m.value.session.value=l),type:"text",placeholder:s(e)("apiKeys.session")},null,8,["modelValue","placeholder"])]),body:p(({data:l})=>[l.isAdmin?(y(),K("span",Dt,i(s(e)("apiKeys.adminLabel")),1)):(y(),K("span",Ut,i(l.session),1))]),_:1},8,["header"]),n(B,{field:"isAdmin",header:s(e)("apiKeys.scope"),showFilterMenu:!1,style:{width:"9rem"}},{body:p(({data:l})=>[t("div",It,[t("i",{class:te(l.isAdmin?"pi pi-shield":"pi pi-user")},null,2),n(le,{value:l.isAdmin?s(e)("apiKeys.scopeAdmin"):s(e)("apiKeys.scopeSession"),severity:l.isAdmin?"info":"secondary"},null,8,["value","severity"])])]),filter:p(({filterModel:l,filterCallback:O})=>[n(ie,{modelValue:l.value,"onUpdate:modelValue":H=>l.value=H,options:j.value,optionLabel:"label",optionValue:"value",placeholder:s(e)("apiKeys.any"),class:"p-column-filter",showClear:!0,onChange:H=>O()},null,8,["modelValue","onUpdate:modelValue","options","placeholder","onChange"])]),_:1},8,["header"]),n(B,{showFilterMenu:!1,style:{width:"10rem","text-align":"right"}},{filter:p(()=>[t("div",Lt,[I(n(A,{icon:"pi pi-trash",severity:"danger",rounded:"",outlined:"",disabled:S.value.length===0||d.value,loading:d.value,onClick:h[3]||(h[3]=l=>U(l))},null,8,["disabled","loading"]),[[r,s(e)("apiKeys.deleteKey"),void 0,{top:!0}]])])]),body:p(({data:l})=>[t("div",Mt,[I(n(A,{icon:"pi pi-pencil",onClick:O=>ue(l),outlined:"",rounded:"",severity:"success"},null,8,["onClick"]),[[r,s(e)("apiKeys.editKey"),void 0,{top:!0}]]),I(n(A,{icon:"pi pi-trash",onClick:O=>de(l,O),outlined:"",rounded:"",severity:"danger"},null,8,["onClick"]),[[r,s(e)("apiKeys.deleteKey"),void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","filters","selection"]),n(_e,{group:"popup"}),n(E,{group:"dialog"}),T.value?(y(),N(ht,{key:0,modelValue:T.value,"onUpdate:modelValue":h[6]||(h[6]=l=>T.value=l),visible:$.value,"onUpdate:visible":h[7]||(h[7]=l=>$.value=l),sessions:M.value,isNewApiKey:f.value,loading:k.value,onSave:ve,onCancel:h[8]||(h[8]=l=>$.value=!1)},null,8,["modelValue","visible","sessions","isNewApiKey","loading"])):W("",!0)])}}}),Nt=ke(Wt,[["__scopeId","data-v-5c165f3c"]]),Ot=t("div",null,null,-1),jt={__name:"ApiKeysDialog",props:{visible:{},visibleModifiers:{},server:{},serverModifiers:{}},emits:["update:visible","update:server"],setup(a){const{t:e}=F(),c=ee(a,"visible"),o=ee(a,"server");return(b,v)=>{const u=ce;return y(),N(u,{visible:c.value,"onUpdate:visible":v[0]||(v[0]=g=>c.value=g),modal:!0,class:"p-fluid",maximizable:"",style:{"min-width":"50%"},header:s(e)("apiKeys.title")},{footer:p(()=>[Ot]),default:p(()=>[n(Nt,{server:o.value},null,8,["server"])]),_:1},8,["visible","header"])}}},Bt={class:"flex justify-content-between"},Pt={class:"flex align-items-center gap-1"},Rt=t("i",{class:"pi pi-server"},null,-1),qt={class:"mr-1"},Et=["disabled"],Ft=t("i",{class:"pi pi-refresh"},null,-1),Ht=[Ft],Gt={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-0"},zt={key:0,class:"pi pi-info-circle text-orange-400"},Qt={class:"text-left"},Yt=["href"],Xt={class:"flex gap-1"},Zt={class:"flex flex-row gap-2 justify-content-end"},Jt=t("i",{class:"pi pi-replay mr-2"},null,-1),wn={__name:"ServerTable",setup(a){const{t:e}=F(),c=Me(),o=J(),b=ae(),{servers:v,refreshing:u}=Xe(o),g=x({connection:{}}),k=x(!1),$=x(!1),T=x(!1),S=x(!1),f=x(null),d=(U,w)=>{f.value.toggle(U,w)};x(null);const m=x({}),C=x(null);Ze(()=>{P()});const P=()=>{m.value={global:{value:null,matchMode:X.CONTAINS}}};function j(){g.value={connection:{}},k.value=!0}function M(U){g.value=Z.cloneDeep(U),$.value=!0}function R(U){g.value=Z.cloneDeep(U),T.value=!0}function D(U){g.value=Z.cloneDeep(U),k.value=!0}function ne(U,w){c.require({group:"popup",target:U.target,message:e("servers.disconnectWorkerConfirm",{worker:w.name}),icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:e("common.no"),acceptLabel:e("servers.yesDisconnect"),accept:()=>b(o.deleteServer(w.id),e("servers.disconnected"),e("servers.failedToDisconnectWorker")),reject:()=>{}})}const ue=U=>{c.require({group:"restart",message:U.name,header:e("servers.restartServerConfirm",{server:U.name}),icon:"pi pi-replay",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-warning p-button-sm",rejectLabel:e("common.no"),acceptLabel:e("servers.yesRestart"),accept:async()=>{await b(o.stopServer(U,S.value),e("servers.restarting"),e("servers.failedToRestartWorker"),U.name,U.name)},reject:()=>{}})};function de(){Te("store",async()=>await o.refresh())}return(U,w)=>{const pe=Pe,q=se,ve=Re,me=be,oe=qe,G=ge,z=De,_=Ee,h=cs,A=us,B=$e,Q=Is,le=it,ie=We,fe=Ne,_e=Oe,E=re("tooltip");return y(),K(Y,null,[t("div",Bt,[t("div",null,[t("h5",Pt,[Rt,t("span",qt,i(s(e)("servers.workers")),1),n(pe,{refreshing:s(u)},null,8,["refreshing"])])]),t("div",null,[I((y(),K("button",{onClick:de,class:"p-link layout-topbar-button",disabled:s(u)},Ht,8,Et)),[[E,s(e)("servers.refresh"),void 0,{top:!0}]])])]),n(B,{value:s(v).length>0?s(v):[],paginator:!0,rows:10,dataKey:"id",rowHover:!0,filters:m.value,"onUpdate:filters":w[1]||(w[1]=r=>m.value=r),filterDisplay:"menu",loading:C.value,globalFilterFields:["name","id","connection.url"],showGridlines:"",style:{"white-space":"nowrap"},resizableColumns:""},{header:p(()=>[t("div",Gt,[n(q,{label:s(e)("servers.connect"),icon:"pi pi-link",severity:"success",onClick:j},null,8,["label"]),n(oe,{iconPosition:"left"},{default:p(()=>[n(ve,{class:"pi pi-search"}),n(me,{modelValue:m.value.global.value,"onUpdate:modelValue":w[0]||(w[0]=r=>m.value.global.value=r),placeholder:s(e)("servers.keywordSearch"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1})])]),empty:p(()=>[V(i(s(e)("servers.noWorkersFound")),1)]),loading:p(()=>[V(i(s(e)("servers.loadingWorkers")),1)]),default:p(()=>[n(G,{field:"name",header:s(e)("servers.name")},{body:p(({data:r})=>{var l,O,H,xe,Ce,Ae;return[t("div",null,[V(i(r.name)+" ",1),(O=(l=r.status)==null?void 0:l.worker)!=null&&O.id&&((xe=(H=r.status)==null?void 0:H.worker)==null?void 0:xe.id)!==r.name?I((y(),K("i",zt,null,512)),[[E,s(e)("servers.workerIdMismatch",{worker:(Ae=(Ce=r.status)==null?void 0:Ce.worker)==null?void 0:Ae.id})]]):W("",!0)])]}),_:1},8,["header"]),n(G,{header:s(e)("servers.api"),class:"text-left"},{body:p(({data:r})=>{var l;return[t("div",Qt,[t("div",null,[n(z,{connected:r.connected},null,8,["connected"]),t("a",{class:"ml-1",href:r.connection.url,target:"_blank"},i(r.connection.url),9,Yt)]),n(Se,{apikey:(l=r.connection)==null?void 0:l.key,connected:r.connected===!0},null,8,["apikey","connected"])])]}),_:1},8,["header"]),n(G,{header:s(e)("servers.info")},{body:p(({data:r})=>[r.connected===void 0?(y(),N(_,{key:0,width:"9rem"})):r.connected===!1?(y(),N(z,{key:1,connected:r.connected},null,8,["connected"])):(y(),N(h,{key:2,server:r},null,8,["server"]))]),_:1},8,["header"]),n(G,{header:s(e)("servers.sessionsSection")},{body:p(({data:r})=>[t("div",Xt,[r.connected===void 0?(y(),N(_,{key:0,width:"10rem"})):W("",!0),r.connected===!1?(y(),N(z,{key:1,connected:r.connected},null,8,["connected"])):W("",!0),n(A,{sessions:s(o).visibleSessionsByServer[r.id]},null,8,["sessions"])])]),_:1},8,["header"]),n(G,null,{body:p(({data:r})=>[t("div",Zt,[I(n(q,{icon:"pi pi-link",severity:"info",rounded:"",outlined:"",onClick:l=>d(l,r)},null,8,["onClick"]),[[E,s(e)("servers.links"),void 0,{top:!0}]]),I(n(q,{disabled:!r.connected,icon:"pi pi-key",severity:"warning",rounded:"",outlined:"",onClick:l=>R(r)},null,8,["disabled","onClick"]),[[E,s(e)("servers.apikey.button.tooltip"),void 0,{top:!0}]]),I(n(q,{disabled:!r.connected,icon:"pi pi-info",severity:"help",rounded:"",outlined:"",onClick:l=>M(r)},null,8,["disabled","onClick"]),[[E,s(e)("servers.workerInfo"),void 0,{top:!0}]]),I(n(q,{icon:"pi pi-replay",severity:"warning",rounded:"",outlined:"",onClick:l=>ue(r)},null,8,["onClick"]),[[E,s(e)("servers.restartWorker"),void 0,{top:!0}]]),I(n(q,{icon:"pi pi-pencil",severity:"success",rounded:"",outlined:"",onClick:l=>D(r)},null,8,["onClick"]),[[E,s(e)("servers.editWorker"),void 0,{top:!0}]]),I(n(q,{icon:"pi pi-times",severity:"danger",rounded:"",outlined:"",onClick:l=>ne(l,r)},null,8,["onClick"]),[[E,s(e)("servers.disconnectWorker"),void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","filters","loading"]),n(Q,{visible:k.value,"onUpdate:visible":w[2]||(w[2]=r=>k.value=r),server:g.value,"onUpdate:server":w[3]||(w[3]=r=>g.value=r)},null,8,["visible","server"]),n(le,{visible:$.value,"onUpdate:visible":w[4]||(w[4]=r=>$.value=r),server:g.value,"onUpdate:server":w[5]||(w[5]=r=>g.value=r)},null,8,["visible","server"]),n(jt,{visible:T.value,"onUpdate:visible":w[6]||(w[6]=r=>T.value=r),server:g.value,"onUpdate:server":w[7]||(w[7]=r=>g.value=r)},null,8,["visible","server"]),n(ie,{group:"popup"}),n(_e,{group:"restart"},{message:p(r=>[t("div",null,[t("p",null,i(s(e)("servers.youreGoingToRestart",{server:r.message.message})),1),t("div",null,[t("p",null,i(s(e)("servers.gracefulStop")),1),n(fe,{modelValue:S.value,"onUpdate:modelValue":w[8]||(w[8]=l=>S.value=l),id:"forceRestart",onLabel:s(e)("servers.forceRestartOn"),offLabel:s(e)("servers.forceRestartOff")},{icon:p(()=>[Jt]),_:1},8,["modelValue","onLabel","offLabel"])])])]),_:1}),n(ct,{ref_key:"linksOverlayPanel",ref:f,title:s(e)("servers.links")},{default:p(()=>{var r,l,O;return[n(ye,{href:(r=f.value.currentItem)==null?void 0:r.connection.url,icon:"pi-code",name:s(e)("servers.swagger")},null,8,["href","name"]),n(ye,{href:`${(l=f.value.currentItem)==null?void 0:l.connection.url}/jobs`,icon:"pi-cog",name:s(e)("servers.jobs")},null,8,["href","name"]),n(ye,{href:`${(O=f.value.currentItem)==null?void 0:O.connection.url}/dashboard`,icon:"pi-home",name:s(e)("servers.dashboard")},null,8,["href","name"])]}),_:1},8,["title"])],64)}}};export{wn as _};
