import{u as P,a as pe,_ as me,l as ie}from"./CXFLfZxo.js";import j from"./BHKdfI-P.js";import Ue from"./weI5uQMA.js";import ee from"./BavvvBis.js";import Ie from"./BiciGNwI.js";import Re from"./RWeoL824.js";import{c as C,M as b,t as d,P as N,O as D,v as w,N as A,z as o,y as U,r as x,A as v,x as e,X as se,R as E,U as ve,B as M,Y as Me,W as Le,_ as qe,o as _e,Z as fe,$ as ae,C as Ae,D as Oe,a0 as he,Q as be,G as Ee,i as Pe,a1 as je,S as Fe,L as We,V as Z,a2 as He}from"./Cy-Swep5.js";import ze from"./BSkBnG5x.js";import Ge from"./BbWywlK-.js";import Je from"./Czze_fhH.js";import Ke from"./5RpyfoYE.js";import{a as ge,_ as ye,u as Se}from"./MryL78FQ.js";import re from"./k3uShykO.js";import Qe from"./CQbgVfSM.js";import Ye from"./C9_ISsCF.js";import Xe from"./y_Q195UF.js";import Ze from"./CgNCr466.js";import $e from"./DcwAwZGa.js";import es from"./BnVyORpS.js";import ss from"./YCXq6W7Y.js";import os from"./CehgflH7.js";import we from"./DBAw6v5M.js";import xe from"./DL1swllK.js";import ts from"./DduuZL-C.js";import ns from"./DIEwYtuT.js";import ls from"./Clxgdvcv.js";const ke={__name:"SessionChip",props:{session:Object,image:String},setup(t){const n=t,s=C(()=>{if(n.session.me)return`${n.session.me.pushName} (${n.session.me.id})`});return(i,r)=>{const l=Re;return b(s)?(d(),N(l,{key:0,label:b(s),image:t.image},null,8,["label","image"])):D("",!0)}}},Ce={__name:"RefreshButton",props:["refreshing"],setup(t){const n=t,s=C(()=>n.refreshing?"pi pi-refresh pi-spin":"pi pi-refresh");return(i,r)=>{const l=j;return d(),N(l,{icon:b(s),rounded:"",text:"",disabled:t.refreshing},null,8,["icon","disabled"])}}},is=["src"],as={__name:"Base64Img",props:{data:String,mimetype:String},setup(t){const n=t,s=C(()=>`data:${n.mimetype};base64, ${n.data}`);return(i,r)=>(d(),w("img",{src:s.value,style:{"max-width":"100%"}},null,8,is))}};function rs(t){return new Promise(n=>setTimeout(n,t))}const cs={key:2,style:{"background-color":"#f8f9fa",padding:"1rem",color:"red","white-space":"pre-wrap"}},Ve={__name:"SessionScreenshot",props:{session:Object},setup(t,{expose:n}){const s=P(),i=t,{data:r,pending:l,error:p,refresh:a}=pe(`session-screenshot-${i.session.server.id}-${i.session.name}`,async()=>(await rs(1e3),await s.getScreenshot(i.session.server.id,i.session.name)));return n({refresh:a}),(g,m)=>{const y=Ge,k=Je,_=as;return d(),w(A,null,[b(l)?(d(),w(A,{key:0},[o(y,{mode:"indeterminate",style:{height:"3px"}}),!b(r)&&!b(p)?(d(),N(k,{key:0,width:"100%",height:"20rem"})):D("",!0)],64)):D("",!0),b(r)?(d(),N(_,{key:1,data:b(r).data,mimetype:b(r).mimetype},null,8,["data","mimetype"])):D("",!0),b(p)?(d(),w("pre",cs,""+U(b(p).cause.response.data.message||b(p).cause.response.data||b(p))+`
  `,1)):D("",!0)],64)}}},ds={class:"",style:{"min-width":"20rem"}},us={class:"flex justify-content-center align-items-center"},ps=e("h5",{class:"m-0"},"Screenshot",-1),ms={class:"m-auto w-full"},vs={__name:"ScreenshotButton",props:["disabled","session"],setup(t){const n=x(null),s=x(null),i=l=>{n.value.toggle(l)},r=()=>{s.value.refresh()};return(l,p)=>{const a=j,g=Ce,m=Ve,y=Ke;return d(),w(A,null,[o(a,{disabled:t.disabled,type:"button",icon:"pi pi-camera",onClick:i,rounded:"",outlined:""},null,8,["disabled"]),o(y,{ref_key:"op",ref:n,appendTo:"body",showCloseIcon:!0},{default:v(()=>[e("div",ds,[e("div",us,[ps,o(g,{onClick:r})]),e("div",ms,[o(m,{ref_key:"screenshot",ref:s,session:t.session},null,8,["session"])])])]),_:1},512)],64)}}},_s={class:"ml-1"},fs={key:1},hs={class:"ml-1"},Be={__name:"ServerDropdown",props:se({showClear:Boolean,placeholder:String,required:Boolean,invalid:Boolean,disabled:Boolean},{server:{},serverModifiers:{}}),emits:["update:server"],setup(t){const n=E(t,"server"),s=P();return(i,r)=>{const l=ge,p=re;return d(),N(p,{optionValue:"id",modelValue:n.value,"onUpdate:modelValue":r[0]||(r[0]=a=>n.value=a),options:b(s).servers,onChange:r[1]||(r[1]=a=>i.$emit("change",n.value)),placeholder:t.placeholder,class:"p-column-filter",showClear:t.showClear,required:t.required,invalid:t.invalid,disabled:t.disabled},{value:v(a=>[a.value?(d(),w(A,{key:0},[o(l,{connected:b(s).getServer(a.value).connected},null,8,["connected"]),e("span",_s,U(b(s).getServer(a.value).name),1)],64)):(d(),w("span",fs,U(a.placeholder),1))]),option:v(a=>[o(l,{connected:a.option.connected},null,8,["connected"]),e("span",hs,U(a.option.name)+" ("+U(a.option.connection.url)+") ",1)]),_:1},8,["modelValue","options","placeholder","showClear","required","invalid","disabled"])}}},bs={class:"p-dialog-title flex gap-2 align-items-center"},gs=e("span",null,"(",-1),ys={class:"ml-1"},Ss=e("span",null,")",-1),$s=["disabled"],ws=e("i",{class:"pi pi-refresh"},null,-1),xs=[ws],Te={__name:"SessionHeader",props:{session:Object,refresh:Boolean},setup(t){const n=t,s=P(),{refreshing:i}=ve(s),r=C(()=>n.session.server.id?n.session.server:s.getServer(n.session.server));async function l(){await s.refresh()}return(p,a)=>{var k;const g=ye,m=ge,y=me;return d(),w("div",bs,[e("span",null,U((k=t.session)==null?void 0:k.name),1),o(g,{status:t.session.status},null,8,["status"]),e("div",null,[gs,o(m,{connected:r.value.connected},null,8,["connected"]),e("span",ys,U(r.value.name),1),Ss]),t.refresh?(d(),w("button",{key:0,onClick:a[0]||(a[0]=_=>l()),class:"p-link layout-topbar-button",disabled:b(i)},xs,8,$s)):D("",!0),o(y,{refreshing:b(i)},null,8,["refreshing"])])}}},ks={class:"-mt-4 p-0 line-height-3 block",style:{"font-family":"monaco, Consolas, 'Lucida Console', monospace"}},Cs={__name:"CodeHighlight",props:["invalid"],setup(t){const n=t,s=C(()=>n.invalid?"p-invalid p-component p-inputtext":"");return(i,r)=>(d(),w("pre",{class:Le(["border-round surface-ground text-900 p-5 overflow-auto",s.value])},[M("        "),e("code",ks,[Me(i.$slots,"default")])],2))}},ce=t=>(Ae("data-v-ca11cfb1"),t=t(),Oe(),t),Vs={class:"h-full flex flex-column"},Bs={class:"flex justify-content-center align-items-center"},Ts=ce(()=>e("h5",{class:"m-0"},"Request",-1)),Ds={class:"flex flex-column justify-content-between h-full"},Ns={class:"flex flex-column gap-2"},Us={class:"flex gap-2"},Is={class:"text-center"},Rs=ce(()=>e("div",{class:"mb-2"},"Body",-1)),Ms={class:"text-center mt-2"},Ls={class:"flex flex-column h-full"},qs={class:"flex justify-content-center align-items-center"},As=ce(()=>e("h5",{class:"m-0"},"Response",-1)),Os={__name:"SessionRequestResponse",props:["session"],setup(t){const n=P(),s=t,i=x(null),r=x("POST"),l=x("/api/sendText"),p=x(""),a=x(!1),g=x(!1);function m($){return JSON.stringify($,null,2)}function y($){try{return JSON.parse($)}catch{return $}}const k=C(()=>({method:r.value,uri:l.value,params:void 0,body:y(p.value)})),_=["GET","POST","PUT","DELETE","PATCH"];async function V($){await navigator.clipboard.writeText(i.value),$.preventDefault()}async function O($){await navigator.clipboard.writeText(m(k.value)),$.preventDefault()}async function z(){try{g.value=!1,a.value=!0;const $=await n.callServerAPI(s.session.server.id,k.value);i.value=m($)}catch($){g.value=!0,$.response?i.value=m($.response.data):i.value=m($)}finally{a.value=!1}}return _e(()=>{const $={chatId:"11111111111@c.us",text:"Hi there!",session:s.session.name};p.value=m($),i.value="..."}),($,B)=>{const L=j,F=re,G=ee,W=Xe,H=Ze,T=Cs,h=fe("tooltip");return d(),w(A,null,[e("div",null,[e("div",Vs,[e("div",Bs,[Ts,ae(o(L,{rounded:"",text:"",tabindex:0,icon:"pi pi-copy",onClick:B[0]||(B[0]=c=>O(c))},null,512),[[h,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),e("div",Ds,[e("div",Ns,[e("div",Us,[o(F,{modelValue:r.value,"onUpdate:modelValue":B[1]||(B[1]=c=>r.value=c),options:_},null,8,["modelValue"]),o(G,{type:"text",class:"w-full",modelValue:l.value,"onUpdate:modelValue":B[2]||(B[2]=c=>l.value=c),placeholder:"API Endpoint"},null,8,["modelValue"])]),e("div",Is,[Rs,o(W,{modelValue:p.value,"onUpdate:modelValue":B[3]||(B[3]=c=>p.value=c),rows:"8",class:"w-full",placeholder:"Request"},null,8,["modelValue"])])]),e("div",Ms,[o(L,{onClick:z,loading:a.value,label:"Send",icon:"pi pi-send","icon-pos":"right"},null,8,["loading"])])])])]),o(H),e("div",null,[e("div",Ls,[e("div",qs,[As,ae(o(L,{rounded:"",text:"",tabindex:0,icon:"pi pi-copy",onClick:B[4]||(B[4]=c=>V(c))},null,512),[[h,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),o(T,{class:"m-0 p-4 pretty",invalid:g.value},{default:v(()=>[M(U(i.value),1)]),_:1},8,["invalid"])])])],64)}}},Es=qe(Os,[["__scopeId","data-v-ca11cfb1"]]),Ps={class:"grid pt-4"},js={class:"col-12 sm:col-6 h-full"},Fs={class:"grid"},Ws={class:"col-12"},Hs={class:""},zs={class:"flex justify-content-center align-items-center"},Gs={class:"col-12"},Js={class:""},Ks={class:"flex justify-content-center align-items-center"},Qs=e("h5",{class:"m-0"},"Screenshot",-1),Ys={class:"m-auto w-full"},Xs={class:"col-12 sm:col-6 h-full card"},Zs={__name:"SessionControl",props:["session"],setup(t){const n=P(),s=t,i=x(null),r=()=>{i.value.refresh()},l=x(null);return _e(()=>{var p,a;(a=(p=s.session)==null?void 0:p.me)!=null&&a.id&&n.getProfilePicture(s.session.server.id,s.session.name,s.session.me.id).then(g=>{l.value=g.profilePictureURL})}),(p,a)=>{const g=ke,m=Ce,y=Ve,k=Es;return d(),w("div",Ps,[e("div",js,[e("div",Fs,[e("div",Ws,[e("div",Hs,[e("div",zs,[t.session.me?(d(),N(g,{key:0,session:t.session,image:b(l)},null,8,["session","image"])):D("",!0)])])]),e("div",Gs,[e("div",Js,[e("div",Ks,[Qs,o(m,{onClick:r})]),e("div",Ys,[o(y,{ref_key:"screenshot",ref:i,session:t.session},null,8,["session"])])])])])]),e("div",Xs,[o(k,{session:t.session},null,8,["session"])])])}}},eo={__name:"SessionControlDialog",props:{visible:{},visibleModifiers:{},session:{},sessionModifiers:{}},emits:["update:visible","update:session"],setup(t){const n=E(t,"visible"),s=E(t,"session");return he(),(i,r)=>{const l=Te,p=Zs,a=$e;return d(),N(a,{visible:n.value,"onUpdate:visible":r[0]||(r[0]=g=>n.value=g),modal:!0,maximizable:""},{header:v(()=>[o(l,{session:s.value},null,8,["session"])]),default:v(()=>[o(p,{session:s.value},null,8,["session"])]),_:1},8,["visible"])}}},so={class:"field"},oo=e("label",{for:"url"},"URL",-1),to={class:"field mb-4"},no=e("label",{for:"events"},"Events",-1),lo=e("div",{class:"font-bold mb-2"},"Retries",-1),io={class:"flex gap-3"},ao={class:"field"},ro=e("label",{for:"retries-attempts"},"Attempts",-1),co=e("span",{class:"pi pi-plus"},null,-1),uo=e("span",{class:"pi pi-minus"},null,-1),po={class:"field"},mo=e("label",{for:"retries-delay-seconds"},"Delay, seconds",-1),vo=e("span",{class:"pi pi-plus"},null,-1),_o=e("span",{class:"pi pi-minus"},null,-1),fo={class:"field"},ho=e("label",{for:"hmac"},"HMAC Key (optional)",-1),bo={__name:"SessionWebhook",props:se({disabled:Boolean,index:Number},{webhook:{},webhookModifiers:{}}),emits:["update:webhook"],setup(t){const n=E(t,"webhook"),s=t,i=["session.status","message","message.any","message.reaction","message.ack","message.revoked","state.change","group.join","group.leave","presence.update","poll.vote","poll.vote.failed"];return(r,l)=>{const p=ee,a=ts,g=ns,m=j,y=we,k=xe;return d(),N(k,{activeIndex:0},{default:v(()=>[o(y,{header:`Webhook ${s.index+1}`},{default:v(()=>[e("div",so,[oo,o(p,{id:"url",modelValue:n.value.url,"onUpdate:modelValue":l[0]||(l[0]=_=>n.value.url=_),modelModifiers:{trim:!0},required:"true",disabled:t.disabled},null,8,["modelValue","disabled"])]),e("div",to,[no,o(a,{id:"events",modelValue:n.value.events,"onUpdate:modelValue":l[1]||(l[1]=_=>n.value.events=_),options:i,placeholder:"Select Events","max-selected-labels":1,selectedItemsLabel:"{0} events selected",disabled:t.disabled},null,8,["modelValue","disabled"]),e("ul",null,[(d(!0),w(A,null,be(n.value.events,_=>(d(),w("li",{key:_},U(_),1))),128))])]),e("div",null,[lo,e("div",io,[e("div",ao,[ro,o(g,{modelValue:n.value.retries.attempts,"onUpdate:modelValue":l[2]||(l[2]=_=>n.value.retries.attempts=_),inputId:"retries-delay-attempts",showButtons:"",buttonLayout:"horizontal",min:1,step:1,disabled:t.disabled},{incrementbuttonicon:v(()=>[co]),decrementbuttonicon:v(()=>[uo]),_:1},8,["modelValue","disabled"])]),e("div",po,[mo,o(g,{modelValue:n.value.retries.delaySeconds,"onUpdate:modelValue":l[3]||(l[3]=_=>n.value.retries.delaySeconds=_),inputId:"retries-delay-seconds",showButtons:"",buttonLayout:"horizontal",min:1,step:1,disabled:t.disabled},{incrementbuttonicon:v(()=>[vo]),decrementbuttonicon:v(()=>[_o]),_:1},8,["modelValue","disabled"])])])]),e("div",fo,[ho,o(p,{id:"hmac",modelValue:n.value.hmac.key,"onUpdate:modelValue":l[4]||(l[4]=_=>n.value.hmac.key=_),modelModifiers:{trim:!0},disabled:t.disabled},null,8,["modelValue","disabled"])]),o(m,{label:"Remove Webhook",icon:"pi pi-trash",text:"",onClick:l[5]||(l[5]=_=>r.$emit("remove")),severity:"warning",disabled:t.disabled},null,8,["disabled"])]),_:1},8,["header"])]),_:1})}}},go={class:"flex flex-column gap-2"},yo=e("div",null,[e("label",null,"Webhooks")],-1),So={key:0,class:"text-300 text-center"},$o={__name:"SessionWebhooksField",props:se({disabled:Boolean},{webhooks:{},webhooksModifiers:{}}),emits:["update:webhooks"],setup(t){const n=E(t,"webhooks");function s(){n.value.push({url:"https://httpbin.org/post",events:["session.status","message","message.reaction"],hmac:{key:null},retries:{delaySeconds:2,attempts:15}})}function i(r){n.value.splice(r,1)}return(r,l)=>{const p=bo,a=j;return d(),w("div",go,[yo,n.value.length===0?(d(),w("div",So," No webhooks configured ")):(d(!0),w(A,{key:1},be(n.value,(g,m)=>(d(),N(p,{webhook:n.value[m],"onUpdate:webhook":y=>n.value[m]=y,index:m,onRemove:y=>i(m),disabled:t.disabled},null,8,["webhook","onUpdate:webhook","index","onRemove","disabled"]))),256)),e("div",null,[o(a,{label:"Add Webhook",icon:"pi pi-plus",text:"",onClick:s,severity:"secondary",disabled:t.disabled},null,8,["disabled"])])])}}},wo={class:"mb-2"},xo=e("b",null,"Server",-1),ko=e("b",null,"Name",-1),Co={class:"field"},Vo=e("label",{for:"server"},"Server",-1),Bo={key:0,class:"p-invalid"},To={class:"field"},Do=e("label",{for:"name"},"Name",-1),No={key:0,class:"p-invalid"};const Uo={class:"field"},Io={class:"field flex justify-content-between align-items-center"},Ro=e("div",null,[e("label",{for:"debug"},"Proxy")],-1),Mo={key:0,class:"card mb-4"},Lo={class:"field"},qo=e("label",{for:"proxy-server"},"Server",-1),Ao={key:0,class:"p-invalid"},Oo={class:"flex gap-3"},Eo={class:"field w-full"},Po=e("label",{for:"proxy-username"},"Username (optional)",-1),jo={class:"field w-full"},Fo=e("label",{for:"proxy-password"},"Password (optional)",-1),Wo={class:"field flex justify-content-between align-items-center"},Ho=e("div",null,[e("label",{for:"debug"},"Debug Mode")],-1),zo={class:"w-full flex flex-column gap-2"},Go={class:"flex justify-content-end"},Jo={__name:"SessionDialog",props:se({mode:String},{visible:{},visibleModifiers:{},session:{},sessionModifiers:{}}),emits:["update:visible","update:session"],setup(t){var W,H;const n=E(t,"visible"),s=E(t,"session"),i=t,r=C(()=>i.mode==="new"),l=C(()=>i.mode==="view"),p=C(()=>i.mode==="start"),a=C(()=>l.value),g=C(()=>a.value||p.value),m=Se(),y=P(),k=C(()=>y.getServer(s.value.server));C(()=>k.value.version.engine==="NOWEB"),C(()=>k.value.version.engine==="WEBJS");const _=x(!!((H=(W=s.value.config)==null?void 0:W.proxy)!=null&&H.server));Ee(s,async(T,h)=>{var c,f;_.value=!!((f=(c=T.config)==null?void 0:c.proxy)!=null&&f.server)});const V=x(!1),O=x(!1),z=C(()=>{const T=ie.cloneDeep(s.value.config);return _.value||(T.proxy=void 0),T}),$=C(()=>{const T={...z.value};return delete T.noweb,{name:s.value.name,config:T}});async function B(){if(V.value=!0,!!s.value.name){try{O.value=!0,await m(y.startSession(s.value.server,$.value),"Session Started","Failed to start session")}finally{O.value=!1}s.value=void 0,L()}}function L(){V.value=!1,n.value=!1}const F=C(()=>p.value&&!["STOPPED","FAILED"].includes(s.value.status));async function G(T){await navigator.clipboard.writeText(JSON.stringify({method:"POST",uri:"/api/sessions/start",body:$.value},null,2)),T.preventDefault()}return(T,h)=>{const c=Te,f=es,oe=Be,I=ee,de=ss,Q=Pe("font-awesome-icon"),Y=os,ue=we,J=xe,te=$o,X=ls,K=j,ne=$e,le=fe("tooltip");return d(),N(ne,{visible:n.value,"onUpdate:visible":h[11]||(h[11]=S=>n.value=S),header:"Session",modal:!0,class:"p-fluid",maximizable:""},je({footer:v(()=>[e("div",zo,[e("div",null,[F.value?(d(),N(f,{key:0,severity:"warn"},{default:v(()=>[M(" The session is in '"),e("b",null,U(s.value.status)+"'",1),M(" status! If you want to change config - please stop it first and run again. ")]),_:1})):D("",!0)]),e("div",Go,[ae(o(K,{label:"Copy Request",text:"",tabindex:0,icon:"pi pi-copy",severity:"secondary",onClick:h[10]||(h[10]=S=>G(S))},null,512),[[le,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]]),o(K,{label:l.value?"Close":"Cancel",icon:"pi pi-times",text:"",severity:"secondary",onClick:L},null,8,["label"]),l.value?D("",!0):(d(),N(K,{key:0,label:r.value?"Start New":"Start",icon:"pi pi-play",text:"",onClick:B,loading:O.value,disabled:F.value},null,8,["label","loading","disabled"]))])])]),default:v(()=>[e("div",wo,[p.value?(d(),N(f,{key:0,severity:"info"},{default:v(()=>[M(" To change the "),xo,M(" or "),ko,M(" - please logout from the session and run again. ")]),_:1})):D("",!0)]),e("div",Co,[Vo,o(oe,{placeholder:"Select Server",modelValue:s.value.server,"onUpdate:modelValue":h[0]||(h[0]=S=>s.value.server=S),showClear:!1,required:!0,invalid:V.value&&!s.value.server,disabled:g.value},null,8,["modelValue","invalid","disabled"]),V.value&&!s.value.server?(d(),w("small",Bo,"Server is required.")):D("",!0)]),e("div",To,[Do,o(I,{id:"name",modelValue:s.value.name,"onUpdate:modelValue":h[1]||(h[1]=S=>s.value.name=S),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:V.value&&!s.value.name,disabled:!r.value},null,8,["modelValue","invalid","disabled"]),V.value&&!s.value.name?(d(),w("small",No,"Name is required.")):D("",!0)]),D("",!0),e("div",Uo,[o(te,{ref:"webhooks",webhooks:s.value.config.webhooks,"onUpdate:webhooks":h[4]||(h[4]=S=>s.value.config.webhooks=S),disabled:a.value},null,8,["webhooks","disabled"])]),e("div",null,[e("div",Io,[Ro,o(Y,{modelValue:_.value,"onUpdate:modelValue":h[5]||(h[5]=S=>_.value=S),onLabel:"Proxy On",offLabel:"Proxy Off",disabled:a.value},{icon:v(()=>[o(Q,{icon:"fa-solid fa-server",class:"mr-2"})]),_:1},8,["modelValue","disabled"])]),_.value?(d(),w("div",Mo,[e("div",Lo,[qo,o(I,{id:"proxy-server",modelValue:s.value.config.proxy.server,"onUpdate:modelValue":h[6]||(h[6]=S=>s.value.config.proxy.server=S),modelModifiers:{trim:!0},required:"true",invalid:V.value&&!s.value.config.proxy.server,disabled:l.value,placeholder:"host:port"},null,8,["modelValue","invalid","disabled"]),V.value&&!s.value.config.proxy.server?(d(),w("small",Ao,"Server is required.")):D("",!0)]),e("div",Oo,[e("div",Eo,[Po,o(I,{id:"proxy-username",modelValue:s.value.config.proxy.username,"onUpdate:modelValue":h[7]||(h[7]=S=>s.value.config.proxy.username=S),modelModifiers:{trim:!0},disabled:l.value},null,8,["modelValue","disabled"])]),e("div",jo,[Fo,o(X,{id:"proxy-password",modelValue:s.value.config.proxy.password,"onUpdate:modelValue":h[8]||(h[8]=S=>s.value.config.proxy.password=S),modelModifiers:{trim:!0},disabled:l.value,feedback:!1,toggleMask:""},null,8,["modelValue","disabled"])])])])):D("",!0)]),e("div",Wo,[Ho,o(Y,{modelValue:s.value.config.debug,"onUpdate:modelValue":h[9]||(h[9]=S=>s.value.config.debug=S),onLabel:"Debug Enabled",offLabel:"Debug Disabled",onIcon:"fa fa-bug",disabled:a.value},{icon:v(()=>[o(Q,{icon:"fa-solid fa-bug",class:"mr-2"})]),_:1},8,["modelValue","disabled"])])]),_:2},[r.value?void 0:{name:"header",fn:v(()=>[o(c,{session:s.value},null,8,["session"])]),key:"0"}]),1032,["visible"])}}},Ko=["WORKING","FAILED","STARTING","SCAN_QR_CODE","STOPPED"],Qo={class:"flex justify-content-between"},Yo={class:"flex align-items-center gap-1"},Xo=e("i",{class:"pi pi-whatsapp"},null,-1),Zo=e("span",{class:"mr-1"}," Sessions ",-1),et=["disabled"],st=e("i",{class:"pi pi-refresh"},null,-1),ot=[st],tt={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-0"},nt={class:"flex gap-2 align-items-center"},lt={class:"flex gap-2"},it={class:"my-auto"},at={class:"flex flex-row gap-2 justify-content-end"},Rt={__name:"SessionTable",setup(t){const n=he(),s=Fe(),i=P(),{allSessions:r,refreshing:l,servers:p}=ve(i),a=r,g=Se(),m=x({config:{webhooks:[]}}),y=x(!1),k=x(void 0),_=x(!1);x(null);const V=x({}),O=x(null);We(()=>{z()});const z=()=>{V.value={global:{value:null,matchMode:Z.CONTAINS},status:{value:null,matchMode:Z.EQUALS},"server.id":{value:null,matchMode:Z.EQUALS},name:{operator:He.AND,constraints:[{value:null,matchMode:Z.STARTS_WITH}]}}};function $(){const c=p.value.find(f=>f.connected);if(!c){n.add({severity:"error",summary:"No connected server",detail:"Please connect to a server first",life:3e3});return}m.value={server:c.id,name:"session_"+Math.random().toString(36).substring(7),config:{webhooks:[{url:"https://httpbin.org/post",events:["session.status","message","message.reaction"],hmac:{key:null},retries:{delaySeconds:2,attempts:15}}],noweb:{store:{enabled:!0,fullSync:!0}},proxy:{}}},k.value="new",y.value=!0}function B(c){m.value=ie.cloneDeep({name:c.name,status:c.status,server:c.server.id,config:c.config}),k.value="view",y.value=!0}function L(c){m.value=ie.cloneDeep({name:c.name,status:c.status,server:c.server.id,config:c.config}),k.value="start",y.value=!0}function F(c,f){s.require({target:c.target,message:`Stop '${f.name}' session?
`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-warning p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Stop",accept:async()=>{await g(i.stopSession(f.server.id,f.name,!1),"Stopped","Failed to stop session")},reject:()=>{}})}function G(c,f){s.require({target:c.target,message:`Logout '${f.name}' session?
`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Logout",accept:async()=>{await g(i.logoutSession(f.server.id,f.name),"Logged out","Failed to logout session")},reject:()=>{}})}function W(){pe("store",async()=>await i.refresh())}function H(c){T(c.data)}function T(c){_.value=!0,m.value=c}const h=["name","me.id"];return(c,f)=>{const oe=me,I=j,de=Ue,Q=ee,Y=Ie,ue=ke,J=ze,te=vs,X=ye,K=re,ne=Be,le=Qe,S=Ye,De=eo,Ne=Jo;return d(),w(A,null,[e("div",Qo,[e("div",null,[e("h5",Yo,[Xo,Zo,o(oe,{refreshing:b(l)},null,8,["refreshing"])])]),e("div",null,[e("button",{onClick:W,class:"p-link layout-topbar-button",disabled:b(l)},ot,8,et)])]),o(le,{value:b(a).length>0?b(a):[],paginator:!0,rows:20,dataKey:u=>`${u.name}-${u.server.id}-${u.status}`,rowHover:!0,filters:V.value,"onUpdate:filters":f[1]||(f[1]=u=>V.value=u),filterDisplay:"row",loading:O.value,globalFilterFields:h,onRowClick:H,showGridlines:"",class:"p-datatable--clickable",style:{"white-space":"nowrap"}},{header:v(()=>[e("div",tt,[o(I,{label:"Start New",icon:"pi pi-play",severity:"success",onClick:$}),o(Y,{iconPosition:"left"},{default:v(()=>[o(de,{class:"pi pi-search"}),o(Q,{modelValue:V.value.global.value,"onUpdate:modelValue":f[0]||(f[0]=u=>V.value.global.value=u),placeholder:"Search by name or phone number",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])]),empty:v(()=>[M(" No sessions found")]),loading:v(()=>[M(" Loading sessions...")]),default:v(()=>[o(J,{field:"name",header:"Name",sortable:""},{body:v(({data:u})=>[e("div",nt,[o(I,{icon:"pi pi-info",rounded:"",outlined:"",onClick:R=>T(u)},null,8,["onClick"]),e("span",null,U(u.name),1),o(ue,{session:u},null,8,["session"])])]),_:1}),o(J,{field:"status",header:"Status",showFilterMenu:!1,style:{width:"9rem"}},{body:v(({data:u})=>[e("div",lt,[e("div",null,[o(te,{session:u},null,8,["session"])]),e("div",it,[o(X,{status:u.status},null,8,["status"])])])]),filter:v(({filterModel:u,filterCallback:R})=>[o(K,{modelValue:u.value,"onUpdate:modelValue":q=>u.value=q,options:b(Ko),onChange:q=>R(),placeholder:"Any",class:"p-column-filter",showClear:!0},{option:v(({option:q})=>[o(X,{status:q,value:q},null,8,["status","value"])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1}),o(J,{field:"server.name",filterField:"server.id",header:"Server",showFilterMenu:!1},{filter:v(({filterModel:u,filterCallback:R})=>[o(ne,{placeholder:"Any",onChange:q=>R(),modelValue:u.value,"onUpdate:modelValue":q=>u.value=q,showClear:!0,required:!1},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:1}),o(J,null,{body:v(({data:u})=>[e("div",at,[o(I,{icon:"pi pi-cog",severity:"secondary",rounded:"",outlined:"",onClick:R=>B(u)},null,8,["onClick"]),o(I,{icon:"pi pi-play",severity:"success",rounded:"",outlined:"",onClick:R=>L(u)},null,8,["onClick"]),o(I,{icon:"pi pi-stop",severity:"warning",rounded:"",outlined:"",onClick:R=>F(R,u)},null,8,["onClick"]),o(I,{icon:"pi pi-trash",severity:"danger",rounded:"",outlined:"",onClick:R=>G(R,u)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","dataKey","filters","loading"]),o(S),o(De,{visible:_.value,"onUpdate:visible":f[2]||(f[2]=u=>_.value=u),session:m.value,"onUpdate:session":f[3]||(f[3]=u=>m.value=u)},null,8,["visible","session"]),o(Ne,{visible:y.value,"onUpdate:visible":f[4]||(f[4]=u=>y.value=u),session:m.value,"onUpdate:session":f[5]||(f[5]=u=>m.value=u),mode:k.value},null,8,["visible","session","mode"])],64)}}};export{Rt as _};
