import{u as P,s as gs,a as ye,b as $e,_ as Be,l as G}from"./C3w4ZZYK.js";import q from"./DeGajdkY.js";import bs from"./RvhuKTQ1.js";import{Q as Se,R as H,M as p,t as i,v as y,S as j,x as e,z as t,T as we,_ as re,N,U as de,y as O,c as B,P as T,O as R,r as $,A as f,V as ne,W as Q,X as hs,B as M,Y as ys,Z as $s,o as je,C as Ss,D as ws,$ as xe,G as ue,i as Ie,a0 as xs,a1 as Me,a2 as ks,a3 as Cs,L as Vs,a4 as ae,a5 as Ds}from"./DpCWagb1.js";import Oe from"./B2HWC9-Q.js";import Rs from"./Co2qXpSM.js";import le from"./BQjY-vaa.js";import Us from"./C9R_y87H.js";import Ne from"./CJzihNLU.js";import Ls from"./C53SNBKY.js";import Ee from"./D55wX_Zp.js";import Ae from"./Bl-Pa-kf.js";import Ts from"./BzI0uTMy.js";import{_ as Pe,u as ke,a as qe}from"./o-mOyOgR.js";import ce from"./pErzVIO-.js";import He from"./Ds3cYBF_.js";import Bs from"./BWW4F-X7.js";import Fe from"./iyzUyVn9.js";import js from"./BHoK2inC.js";import We from"./DFLoz2zZ.js";import Ce from"./cYwAlf7y.js";import Is from"./yYvbezlc.js";import Ms from"./yDff-tHB.js";import Ke from"./Ke7mCKgS.js";import Qe from"./CFwS2O2g.js";import ze from"./BJ51mGw1.js";import Os from"./CX9cPpyb.js";import Ns from"./Bq57sxCW.js";import Es from"./IbUhIKKr.js";import As from"./Ct2fgcEd.js";function Ps(o){return o?Object.keys(o).map(n=>({key:n,value:o[n]})):[]}function qs(o){return o.reduce((n,l)=>(n[l.key]=l.value,n),{})}const Hs={key:0},Fs={key:1,class:"ml-auto flex align-items-center gap-2 mr-2"},Ws=e("label",{for:"show-duplicates"},"Hide Duplicates",-1),Ks={class:"pi pi-info-circle"},Qs={__name:"HideDuplicates",setup(o){const n=P(),{hideDuplicatedSessions:l,servers:s}=Se(n);return n.$subscribe((a,v)=>{gs(v.hideDuplicatedSessions)}),(a,v)=>{const c=bs,r=H("tooltip");return p(s)&&p(s).length<2?(i(),y("div",Hs)):(i(),y("div",Fs,[Ws,j(e("i",Ks,null,512),[[r,`Hide STOPPED sessions with the same "name" .
Useful when you use multiple workers with the same database`]]),t(c,{id:"show-duplicates",modelValue:p(l),"onUpdate:modelValue":v[0]||(v[0]=d=>we(l)?l.value=d:null)},null,8,["modelValue"])]))}}},zs={class:"metadata"},Xs={__name:"Metadata",props:["metadata"],setup(o){return(n,l)=>(i(),y("div",zs,[(i(!0),y(N,null,de(o.metadata,(s,a)=>(i(),y("pre",{key:a},O(a)+"="+O(s),1))),128))]))}},Gs=re(Xs,[["__scopeId","data-v-cb7cbf08"]]),Ys={class:"text-center p-1"},Js={class:"text-center"},Xe={__name:"SessionChip",props:{session:Object,image:String},setup(o){const n=o,l=B(()=>{if(n.session.me)return`${n.session.me.id}`});return(s,a)=>{var c,r;const v=Ls;return i(),y("div",null,[e("div",Ys,[e("b",Js,O((r=(c=n.session)==null?void 0:c.me)==null?void 0:r.pushName),1)]),p(l)?(i(),T(v,{key:0,label:p(l),image:o.image},null,8,["label","image"])):R("",!0)])}}},Ve={__name:"RefreshButton",props:["refreshing"],setup(o){const n=o,l=B(()=>n.refreshing?"pi pi-refresh pi-spin":"pi pi-refresh");return(s,a)=>{const v=q;return i(),T(v,{icon:p(l),rounded:"",text:"",disabled:o.refreshing},null,8,["icon","disabled"])}}},Zs=["src"],Ge={__name:"Base64Img",props:{data:String,mimetype:String},setup(o){const n=o,l=B(()=>`data:${n.mimetype};base64, ${n.data}`);return(s,a)=>(i(),y("img",{src:l.value,style:{"max-width":"100%"}},null,8,Zs))}},et={key:2,style:{"background-color":"#f8f9fa",padding:"1rem",color:"red","white-space":"pre-wrap"}},Ye={__name:"SessionScreenshot",props:{session:Object},setup(o,{expose:n}){const l=P(),s=o,{data:a,pending:v,error:c,refresh:r}=ye(`session-screenshot-${s.session.server.id}-${s.session.name}`,async()=>(await $e(1e3),await l.getScreenshot(s.session.server.id,s.session.name)));return n({refresh:r}),(d,_)=>{const w=Ee,S=Ae,h=Ge;return i(),y(N,null,[p(v)?(i(),y(N,{key:0},[t(w,{mode:"indeterminate",style:{height:"3px"}}),!p(a)&&!p(c)?(i(),T(S,{key:0,width:"100%",height:"20rem"})):R("",!0)],64)):R("",!0),p(a)?(i(),T(h,{key:1,data:p(a).data,mimetype:p(a).mimetype},null,8,["data","mimetype"])):R("",!0),p(c)?(i(),y("pre",et,""+O(p(c).cause.response.data.message||p(c).cause.response.data||p(c))+`
  `,1)):R("",!0)],64)}}},st={class:"",style:{"min-width":"20rem"}},tt={class:"flex justify-content-center align-items-center"},ot=e("h5",{class:"m-0"},"Screenshot",-1),nt={class:"m-auto w-full"},lt={__name:"ScreenshotButton",props:["session"],setup(o){const n=o,l=$(null),s=$(null),a=r=>{l.value.toggle(r)},v=()=>{s.value.refresh()},c=B(()=>n.session.status==="STOPPED");return(r,d)=>{const _=q,w=Ve,S=Ye,h=Ts,x=H("tooltip");return i(),y(N,null,[j(t(_,{disabled:p(c),type:"button",icon:"pi pi-camera",onClick:a,rounded:"",outlined:"",severity:"help"},null,8,["disabled"]),[[x,"Screenshot / QR",void 0,{top:!0}]]),t(h,{ref_key:"op",ref:l,appendTo:"body",showCloseIcon:!0},{default:f(()=>[e("div",st,[e("div",tt,[ot,t(w,{onClick:v})]),e("div",nt,[t(S,{ref_key:"screenshot",ref:s,session:o.session},null,8,["session"])])])]),_:1},512)],64)}}},it={class:"ml-1"},at={key:1},rt={class:"ml-1"},Je={__name:"ServerDropdown",props:ne({showClear:Boolean,placeholder:String,required:Boolean,invalid:Boolean,disabled:Boolean},{server:{},serverModifiers:{}}),emits:["update:server"],setup(o){const n=Q(o,"server"),l=P();return(s,a)=>{const v=Pe,c=ce;return i(),T(c,{optionValue:"id",modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=r=>n.value=r),options:p(l).servers,onChange:a[1]||(a[1]=r=>s.$emit("change",n.value)),placeholder:o.placeholder,class:"p-column-filter",showClear:o.showClear,required:o.required,invalid:o.invalid,disabled:o.disabled},{value:f(r=>[r.value?(i(),y(N,{key:0},[t(v,{connected:p(l).getServer(r.value).connected},null,8,["connected"]),e("span",it,O(p(l).getServer(r.value).name),1)],64)):(i(),y("span",at,O(r.placeholder),1))]),option:f(r=>[t(v,{connected:r.option.connected},null,8,["connected"]),e("span",rt,O(r.option.name)+" ("+O(r.option.connection.url)+") ",1)]),_:1},8,["modelValue","options","placeholder","showClear","required","invalid","disabled"])}}},dt={class:"flex flex-row gap-2 justify-content-end"},Ze={__name:"SessionActionButtons",props:["name","isStarting","isRestarting","isStopping","isLoggingOut","isRemoving","allDisabled","hideActions","skipConfirmation","group"],emits:["view","start","restart","stop","logout","delete"],setup(o,{emit:n}){const l=hs(),s=o,a=n;function v(h){return s.skipConfirmation?!s.skipConfirmation.includes(h):!0}async function c(){if(!v("start")){a("start");return}l.require({group:s.group,target:event.target,message:`Start ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-success p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Start",accept:()=>{a("start")},reject:()=>{}})}const r=B(()=>s.hideActions?!s.hideActions.includes("view"):!0);function d(h){l.require({group:s.group,target:h.target,message:`Restart ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-info p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Restart",accept:()=>{a("restart")},reject:()=>{}})}function _(h){l.require({group:s.group,target:h.target,message:`Stop ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-warning p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Stop",accept:async()=>{a("stop")},reject:()=>{}})}function w(h){l.require({group:s.group,target:h.target,message:`Logout ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-warning p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Logout",accept:async()=>{a("logout")},reject:()=>{}})}function S(h){l.require({group:s.group,target:h.target,message:`Delete ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Delete",accept:async()=>{a("delete")},reject:()=>{}})}return(h,x)=>{const k=q,U=He,m=Bs,V=H("tooltip");return i(),y(N,null,[e("div",dt,[p(r)?j((i(),T(k,{key:0,icon:"pi pi-cog",severity:"help",rounded:"",outlined:"",onClick:x[0]||(x[0]=I=>h.$emit("view")),disabled:o.allDisabled},null,8,["disabled"])),[[V,"Configuration",void 0,{top:!0}]]):R("",!0),j(t(k,{icon:"pi pi-play",severity:"success",rounded:"",outlined:"",onClick:c,loading:o.isStarting,disabled:o.allDisabled},null,8,["loading","disabled"]),[[V,"Start",void 0,{top:!0}]]),j(t(k,{icon:"pi pi-replay",severity:"info",rounded:"",outlined:"",onClick:x[1]||(x[1]=I=>d(I)),loading:o.isRestarting,disabled:o.allDisabled},null,8,["loading","disabled"]),[[V,"Restart",void 0,{top:!0}]]),j(t(k,{icon:"pi pi-stop",severity:"secondary",rounded:"",outlined:"",onClick:x[2]||(x[2]=I=>_(I)),loading:o.isStopping,disabled:o.allDisabled},null,8,["loading","disabled"]),[[V,"Stop",void 0,{top:!0}]]),j(t(k,{icon:"pi pi-sign-out",severity:"warning",rounded:"",outlined:"",onClick:x[3]||(x[3]=I=>w(I)),loading:o.isLoggingOut,disabled:o.allDisabled},null,8,["loading","disabled"]),[[V,"Logout",void 0,{top:!0}]]),j(t(k,{icon:"pi pi-trash",severity:"danger",rounded:"",outlined:"",onClick:x[4]||(x[4]=I=>S(I)),loading:o.isRemoving,disabled:o.allDisabled},null,8,["loading","disabled"]),[[V,"Delete",void 0,{top:!0}]])]),o.group==="popup"?(i(),T(U,{key:0,group:"popup"})):R("",!0),o.group==="dialog"?(i(),T(m,{key:1,group:"dialog"})):R("",!0)],64)}}},ut={class:"flex flex-row gap-2 justify-content-end"},ct={__name:"SessionActions",props:["session","disabled"],setup(o,{expose:n}){const l=o,s=P(),a=ke(),v=$(!1),c=$(!1),r=$(!1),d=$(!1),_=$(!1),w=B(()=>l.disabled||v.value||c.value||r.value||d.value||_.value);async function S(){const m=l.session;d.value=!0,await a(s.startSession(m.server.id,m.name),"Started","Failed to start session",m.name,m.name).finally(()=>d.value=!1)}async function h(){const m=l.session;_.value=!0,await a(s.restartSession(m.server.id,m.name),"Restarted","Failed to restart session",m.name,m.name).finally(()=>_.value=!1)}async function x(){const m=l.session;v.value=!0,await a(s.stopSession(m.server.id,m.name),"Stopped","Failed to stop session",m.name,m.name).finally(()=>v.value=!1)}async function k(){const m=l.session;c.value=!0,await a(s.logoutSession(m.server.id,m.name),"Logged out","Failed to logout session",m.name,m.name).finally(()=>c.value=!1)}async function U(){const m=l.session;r.value=!0,await a(s.deleteSession(m.server.id,m.name),"Deleted","Failed to delete session",m.name,m.name).finally(()=>r.value=!1)}return n({startSession:S,restartSession:h,stopSession:x,logoutSession:k,deleteSession:U}),(m,V)=>{const I=Ze;return i(),y("div",ut,[t(I,{group:"popup",name:`'${o.session.name}' session`,onView:V[0]||(V[0]=A=>m.$emit("view",o.session)),onStart:S,onRestart:h,onStop:x,onLogout:k,onDelete:U,"is-starting":p(d),"is-restarting":p(_),"is-stopping":p(v),"is-logging-out":p(c),"is-removing":p(r),"all-disabled":p(w),"hide-actions":[],"skip-confirmation":["start"]},null,8,["name","is-starting","is-restarting","is-stopping","is-logging-out","is-removing","all-disabled"])])}}},pt={class:"p-dialog-title flex gap-2 align-items-center"},mt=e("i",{class:"pi pi-whatsapp"},null,-1),vt=e("span",null,"(",-1),ft={class:"ml-1"},_t=e("span",null,")",-1),gt=["disabled"],bt=e("i",{class:"pi pi-refresh"},null,-1),ht=[bt],De={__name:"SessionHeader",props:{session:Object,refresh:Boolean},setup(o){const n=o,l=P(),{refreshing:s}=Se(l),a=B(()=>n.session.server.id?n.session.server:l.getServer(n.session.server));async function v(){await l.refresh()}return(c,r)=>{var h,x;const d=qe,_=Pe,w=Be,S=H("tooltip");return i(),y("div",pt,[mt,e("span",null,O((h=o.session)==null?void 0:h.name),1),t(d,{status:o.session.status,value:(x=o.session.status)==null?void 0:x.toUpperCase()},null,8,["status","value"]),e("div",null,[vt,t(_,{connected:a.value.connected},null,8,["connected"]),e("span",ft,O(a.value.name),1),_t]),o.refresh?j((i(),y("button",{key:0,onClick:r[0]||(r[0]=k=>v()),class:"p-link layout-topbar-button",disabled:p(s)},ht,8,gt)),[[S,"Refresh",void 0,{top:!0}]]):R("",!0),t(w,{refreshing:p(s)},null,8,["refreshing"])])}}},yt={class:"-mt-4 p-0 line-height-3 block",style:{"font-family":"monaco, Consolas, 'Lucida Console', monospace"}},$t={__name:"CodeHighlight",props:["invalid"],setup(o){const n=o,l=B(()=>n.invalid?"p-invalid p-component p-inputtext":"");return(s,a)=>(i(),y("pre",{class:$s(["border-round surface-ground text-900 p-5 overflow-auto",l.value])},[M("        "),e("code",yt,[ys(s.$slots,"default")])],2))}},Re=o=>(Ss("data-v-aa1b18ec"),o=o(),ws(),o),St={class:"h-full flex flex-column"},wt={class:"flex justify-content-center align-items-center"},xt=Re(()=>e("h5",{class:"m-0"},"Request",-1)),kt={class:"flex flex-column justify-content-between h-full"},Ct={class:"flex flex-column gap-2"},Vt={class:"flex gap-2"},Dt={class:"text-center"},Rt=Re(()=>e("div",{class:"mb-2"},"Body",-1)),Ut={class:"text-center mt-2"},Lt={class:"flex flex-column h-full"},Tt={class:"flex justify-content-center align-items-center"},Bt=Re(()=>e("h5",{class:"m-0"},"Response",-1)),jt={__name:"SessionRequestResponse",props:["session"],setup(o){const n=P(),l=o,s=$(null),a=$("POST"),v=$("/api/sendText"),c=$(""),r=$(!1),d=$(!1);function _(m){return JSON.stringify(m,null,2)}function w(m){try{return JSON.parse(m)}catch{return m}}const S=B(()=>({method:a.value,uri:v.value,params:void 0,body:w(c.value)})),h=["GET","POST","PUT","DELETE","PATCH"];async function x(m){await navigator.clipboard.writeText(s.value),m.preventDefault()}async function k(m){await navigator.clipboard.writeText(_(S.value)),m.preventDefault()}async function U(){try{d.value=!1,r.value=!0;const m=await n.callServerAPI(l.session.server.id,S.value);s.value=_(m)}catch(m){d.value=!0,m.response?s.value=_(m.response.data):s.value=_(m)}finally{r.value=!1}}return je(()=>{const m={chatId:"11111111111@c.us",text:"Hi there!",session:l.session.name};c.value=_(m),s.value="..."}),(m,V)=>{const I=q,A=ce,D=le,se=js,F=We,W=$t,Y=H("tooltip");return i(),y(N,null,[e("div",null,[e("div",St,[e("div",wt,[xt,j(t(I,{rounded:"",text:"",tabindex:0,icon:"pi pi-copy",onClick:V[0]||(V[0]=C=>k(C))},null,512),[[Y,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),e("div",kt,[e("div",Ct,[e("div",Vt,[t(A,{modelValue:a.value,"onUpdate:modelValue":V[1]||(V[1]=C=>a.value=C),options:h},null,8,["modelValue"]),t(D,{type:"text",class:"w-full",modelValue:v.value,"onUpdate:modelValue":V[2]||(V[2]=C=>v.value=C),placeholder:"API Endpoint"},null,8,["modelValue"])]),e("div",Dt,[Rt,t(se,{modelValue:c.value,"onUpdate:modelValue":V[3]||(V[3]=C=>c.value=C),rows:"8",class:"w-full",placeholder:"Request"},null,8,["modelValue"])])]),e("div",Ut,[t(I,{onClick:U,loading:r.value,label:"Send",icon:"pi pi-send","icon-pos":"right"},null,8,["loading"])])])])]),t(F),e("div",null,[e("div",Lt,[e("div",Tt,[Bt,j(t(I,{rounded:"",text:"",tabindex:0,icon:"pi pi-copy",onClick:V[4]||(V[4]=C=>x(C))},null,512),[[Y,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),t(W,{class:"m-0 p-4 pretty",invalid:d.value},{default:f(()=>[M(O(s.value),1)]),_:1},8,["invalid"])])])],64)}}},It=re(jt,[["__scopeId","data-v-aa1b18ec"]]),Mt={class:"grid pt-4"},Ot={class:"col-12 sm:col-6 h-full"},Nt={class:"grid"},Et={class:"col-12"},At={class:""},Pt={class:"flex justify-content-center align-items-center"},qt={class:"col-12"},Ht={class:""},Ft={class:"flex justify-content-center align-items-center"},Wt=e("h5",{class:"m-0"},"Screenshot",-1),Kt={class:"m-auto w-full"},Qt={class:"col-12 sm:col-6 h-full card"},zt={__name:"SessionControl",props:["session"],setup(o){const n=P(),l=o,s=$(null),a=()=>{s.value.refresh()},v=$(null);return je(()=>{var c,r;(r=(c=l.session)==null?void 0:c.me)!=null&&r.id&&n.getProfilePicture(l.session.server.id,l.session.name,l.session.me.id).then(d=>{v.value=d.profilePictureURL})}),(c,r)=>{const d=Xe,_=Ve,w=Ye,S=It;return i(),y("div",Mt,[e("div",Ot,[e("div",Nt,[e("div",Et,[e("div",At,[e("div",Pt,[o.session.me?(i(),T(d,{key:0,session:o.session,image:p(v)},null,8,["session","image"])):R("",!0)])])]),e("div",qt,[e("div",Ht,[e("div",Ft,[Wt,t(_,{onClick:a})]),e("div",Kt,[t(w,{ref_key:"screenshot",ref:s,session:o.session},null,8,["session"])])])])])]),e("div",Qt,[t(S,{session:o.session},null,8,["session"])])])}}},Xt={__name:"SessionControlDialog",props:{visible:{},visibleModifiers:{},session:{},sessionModifiers:{}},emits:["update:visible","update:session"],setup(o){const n=Q(o,"visible"),l=Q(o,"session");return xe(),(s,a)=>{const v=De,c=zt,r=Ce;return i(),T(r,{visible:n.value,"onUpdate:visible":a[0]||(a[0]=d=>n.value=d),modal:!0,maximizable:""},{header:f(()=>[t(v,{session:l.value},null,8,["session"])]),default:f(()=>[t(c,{session:l.value},null,8,["session"])]),_:1},8,["visible"])}}},Gt={class:"card p-fluid"},Yt={class:"flex flex-grow-1 justify-content-center"},Jt={class:"flex flex-grow-1 justify-content-center"},es={__name:"KeyValueTable",props:ne(["keyColumn","keyColumnName","prefix","entityName"],{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const n=Q(o,"modelValue"),l=o,s=$([]),a=d=>{let{newData:_,index:w}=d;n.value[w]=_},v=d=>{let{data:_,newValue:w,field:S}=d;_[S]=w};function c(){const d=n.value.length+1,_=`${l.prefix}${d}`;n.value.unshift({[l.keyColumn]:_,value:"123"})}function r(d){n.value.splice(d,1)}return(d,_)=>{const w=le,S=Ne,h=q,x=Fe,k=H("tooltip");return i(),y("div",Gt,[t(x,{editingRows:s.value,"onUpdate:editingRows":_[0]||(_[0]=U=>s.value=U),value:n.value,editMode:"cell",dataKey:l.keyColumn,onRowEditSave:a,onCellEditComplete:v,pt:{table:{style:"min-width: 50rem"},column:{bodycell:({state:U})=>({style:U.d_editing&&"padding-top: 0.6rem; padding-bottom: 0.6rem"})}}},{default:f(()=>[t(S,{field:l.keyColumn,header:l.keyColumnName,style:{width:"40%"}},{editor:f(({data:U,field:m})=>[t(w,{modelValue:U[m],"onUpdate:modelValue":V=>U[m]=V},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["field","header"]),t(S,{style:{width:"40%"},field:"value",header:"Value"},{editor:f(({data:U,field:m})=>[t(w,{modelValue:U[m],"onUpdate:modelValue":V=>U[m]=V},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(S,{style:{"min-width":"1rem"}},{header:f(()=>[e("div",Yt,[j(t(h,{label:o.entityName,text:"",icon:"pi pi-plus",severity:"success",onClick:c},null,8,["label"]),[[k,`Add ${o.entityName}`,void 0,{top:!0}]])])]),body:f(({index:U})=>[e("div",Jt,[j(t(h,{label:"",rounded:"",text:"",style:{height:"2rem",width:"2rem"},icon:"pi pi-trash",severity:"warning",onClick:m=>r(U)},null,8,["onClick"]),[[k,"Delete",void 0,{top:!0}]])])]),_:1})]),_:1},8,["editingRows","value","dataKey","pt"])])}}},Zt={class:"flex justify-content-between align-items-center w-full"},eo={class:"field"},so=e("label",{for:"url"},"URL",-1),to={class:"field mb-4"},oo=e("label",{for:"events"},"Events",-1),no=e("div",{class:"font-bold mb-2"},"Retries",-1),lo={class:"flex gap-3"},io={class:"field",style:{width:"10em"}},ao=e("label",{for:"retries-attempts"},"Attempts",-1),ro=e("span",{class:"pi pi-plus"},null,-1),uo=e("span",{class:"pi pi-minus"},null,-1),co={class:"field",style:{width:"10em"}},po=e("label",{for:"retries-delay-seconds"},"Delay, seconds",-1),mo=e("span",{class:"pi pi-plus"},null,-1),vo=e("span",{class:"pi pi-minus"},null,-1),fo={class:"field"},_o={for:"retries-delay-policy"},go={class:"pi pi-info-circle"},bo={style:{"text-transform":"capitalize"}},ho={style:{"text-transform":"capitalize"}},yo={class:"field"},$o=e("label",{for:"hmac"},"HMAC Key (optional)",-1),So={class:"field"},wo={class:"field flex justify-content-between align-items-center"},xo=e("div",null,[e("label",{for:"hmac"},"Custom Headers (optional)")],-1),ko={__name:"SessionWebhook",props:ne({disabled:Boolean,index:Number},{webhook:{},webhookModifiers:{}}),emits:["update:webhook"],setup(o){const n=Q(o,"webhook"),l=o,s=["constant","linear","exponential"],a=B(()=>{var h;const r=((h=n.value.retries)==null?void 0:h.delaySeconds)??2,d=4,_=Array.from({length:d},(x,k)=>r),w=Array.from({length:d},(x,k)=>r*(k+1)),S=Array.from({length:d},(x,k)=>r*2**k);return[`Constant: ${_.join(", ")}`,`Linear: ${w.join(", ")}`,`Exponential: ${S.join(", ")}`].join(`
`)}),v=["session.status","message","message.any","message.reaction","message.ack","message.waiting","message.revoked","chat.archive","group.join","group.leave","presence.update","poll.vote","poll.vote.failed","call.received","call.accepted","call.rejected","label.upsert","label.deleted","label.chat.added","label.chat.deleted"],c=$(n.value.customHeaders&&n.value.customHeaders.length>0);return ue(c,(r,d)=>{if(d&&!r){n.value.customHeaders=null;return}!d&&r&&(n.value.customHeaders=[{name:"X-Header-1",value:"123"}])}),(r,d)=>{const _=q,w=le,S=Oe,h=Os,x=ce,k=Ie("font-awesome-icon"),U=Ke,m=es,V=Qe,I=ze,A=H("tooltip");return i(),T(I,{activeIndex:0},{default:f(()=>[t(V,null,{header:f(()=>[e("div",Zt,[e("div",null," Webhook "+O(l.index+1),1),e("div",null,[j(t(_,{label:"",text:"",rounded:"",style:{height:"2rem",width:"2rem"},icon:"pi pi-trash",severity:"warning",onClick:d[0]||(d[0]=D=>r.$emit("remove"))},null,512),[[A,"Delete Webhook",void 0,{top:!0}]])])])]),default:f(()=>[e("div",eo,[so,t(w,{id:"url",modelValue:n.value.url,"onUpdate:modelValue":d[1]||(d[1]=D=>n.value.url=D),modelModifiers:{trim:!0},required:"true",disabled:o.disabled},null,8,["modelValue","disabled"])]),e("div",to,[oo,t(S,{id:"events",modelValue:n.value.events,"onUpdate:modelValue":d[2]||(d[2]=D=>n.value.events=D),options:v,placeholder:"Select Events","max-selected-labels":1,selectedItemsLabel:"{0} events selected",disabled:o.disabled},null,8,["modelValue","disabled"]),e("ul",null,[(i(!0),y(N,null,de(n.value.events,D=>(i(),y("li",{key:D},O(D),1))),128))])]),e("div",null,[no,e("div",lo,[e("div",io,[ao,t(h,{modelValue:n.value.retries.attempts,"onUpdate:modelValue":d[3]||(d[3]=D=>n.value.retries.attempts=D),inputId:"retries-delay-attempts",showButtons:"",buttonLayout:"horizontal",min:1,step:1,disabled:o.disabled},{incrementbuttonicon:f(()=>[ro]),decrementbuttonicon:f(()=>[uo]),_:1},8,["modelValue","disabled"])]),e("div",co,[po,t(h,{modelValue:n.value.retries.delaySeconds,"onUpdate:modelValue":d[4]||(d[4]=D=>n.value.retries.delaySeconds=D),inputId:"retries-delay-seconds",showButtons:"",buttonLayout:"horizontal",min:1,step:1,disabled:o.disabled},{incrementbuttonicon:f(()=>[mo]),decrementbuttonicon:f(()=>[vo]),_:1},8,["modelValue","disabled"])]),e("div",fo,[e("label",_o,[M(" Retry Policy "),j(e("i",go,null,512),[[A,p(a)]])]),t(x,{id:"retries-delay-policy",modelValue:n.value.retries.policy,"onUpdate:modelValue":d[5]||(d[5]=D=>n.value.retries.policy=D),options:s,placeholder:"Select Retry Policy","max-selected-labels":1,disabled:o.disabled},{option:f(D=>[e("span",bo,O(D.option),1)]),value:f(D=>[e("span",ho,O(D.value),1)]),_:1},8,["modelValue","disabled"])])])]),e("div",yo,[$o,t(w,{id:"hmac",modelValue:n.value.hmac.key,"onUpdate:modelValue":d[6]||(d[6]=D=>n.value.hmac.key=D),modelModifiers:{trim:!0},disabled:o.disabled},null,8,["modelValue","disabled"])]),e("div",So,[e("div",wo,[xo,t(U,{modelValue:c.value,"onUpdate:modelValue":d[7]||(d[7]=D=>c.value=D),id:"customHeaders",onLabel:"Headers On",offLabel:"Headers Off"},{icon:f(()=>[t(k,{icon:"fa-solid fa-fingerprint",class:"mr-2"})]),_:1},8,["modelValue"])]),c.value?(i(),T(m,{key:0,modelValue:n.value.customHeaders,"onUpdate:modelValue":d[8]||(d[8]=D=>n.value.customHeaders=D),"entity-name":"Header","key-column":"name","key-column-name":"Header",prefix:"X-Header-"},null,8,["modelValue"])):R("",!0)])]),_:1})]),_:1})}}},Co={class:"flex flex-column gap-2"},Vo={class:"flex justify-content-between align-items-center w-full"},Do=e("h5",null,"ðŸ”„ Webhooks",-1),Ro={class:"pr-2"},Uo={key:0,class:"text-300 text-center"},Lo={__name:"SessionWebhooksField",props:ne({disabled:Boolean},{webhooks:{},webhooksModifiers:{}}),emits:["update:webhooks"],setup(o){const n=Q(o,"webhooks");function l(){const a={url:"https://httpbin.org/post",events:["session.status","message"],hmac:{key:null},retries:{delaySeconds:2,attempts:15,policy:"exponential"},customHeaders:null};n.value.push(a)}function s(a){n.value.splice(a,1)}return(a,v)=>{const c=q,r=ko,d=H("tooltip");return i(),y("div",Co,[e("div",Vo,[Do,e("div",Ro,[j(t(c,{label:"Webhook",text:"",icon:"pi pi-plus",severity:"success",onClick:l},null,512),[[d,"Add Webhook",void 0,{top:!0}]])])]),n.value.length===0?(i(),y("div",Uo," No webhooks configured ")):(i(!0),y(N,{key:1},de(n.value,(_,w)=>(i(),T(r,{webhook:n.value[w],"onUpdate:webhook":S=>n.value[w]=S,index:w,total:n.value.length,onRemove:S=>s(w),disabled:o.disabled},null,8,["webhook","onUpdate:webhook","index","total","onRemove","disabled"]))),256))])}}},To=e("div",null,[e("h5",null,[e("i",{class:"pi pi-whatsapp"}),M(" Create Session ")])],-1),Bo={class:"mb-2"},jo=e("b",null,"Server",-1),Io=e("b",null,"Name",-1),Mo={class:"field"},Oo=e("label",{for:"server"},"Server",-1),No={key:0,class:"p-invalid"},Eo={class:"field"},Ao=e("label",{for:"name"},"Name (optional)",-1),Po={key:0,class:"mb-4"},qo=e("div",{class:"mb-3"},[e("h5",null,"ðŸ­ Engine Settings ")],-1),Ho={class:"flex flex-column gap-2"},Fo=e("div",null,[e("a",{href:"https://waha.devlike.pro/docs/engines/noweb",target:"_blank"},"Read more about NOWEB settings")],-1),Wo={class:"flex gap-2"},Ko={class:"pi pi-info-circle"},Qo={class:"field mt-4"},zo={class:"field flex justify-content-between align-items-center"},Xo=e("div",null,[e("h5",null,[e("label",{for:"proxy"},"ðŸŒ Proxy")])],-1),Go={key:0,class:"card mb-4"},Yo={class:"field"},Jo=e("label",{for:"proxy-server"},"Server",-1),Zo={key:0,class:"p-invalid"},en={class:"flex gap-3"},sn={class:"field w-full"},tn=e("label",{for:"proxy-username"},"Username (optional)",-1),on={class:"field w-full"},nn=e("label",{for:"proxy-password"},"Password (optional)",-1),ln={class:"field flex justify-content-between align-items-center"},an=e("div",null,[e("h5",null,[e("label",{for:"debug"},"ðŸ› ï¸ Debug")])],-1),rn={class:"w-full flex flex-column gap-2"},dn={class:"flex justify-content-end"},un={__name:"SessionDialog",props:ne({mode:String},{visible:{},visibleModifiers:{},session:{},sessionModifiers:{}}),emits:["update:visible","update:session"],setup(o){var W,Y;const n=xe(),l=Q(o,"visible"),s=Q(o,"session"),a=o,v=B(()=>a.mode==="new"),c=B(()=>a.mode==="update"),r=B(()=>c.value),d=ke(),_=P(),w=B(()=>_.getServer(s.value.server)),S=B(()=>{var C,g;return((g=(C=w.value)==null?void 0:C.version)==null?void 0:g.engine)==="NOWEB"});B(()=>{var C,g;return((g=(C=w.value)==null?void 0:C.version)==null?void 0:g.engine)==="WEBJS"});const h=$([]),x=$(!!((Y=(W=s.value.config)==null?void 0:W.proxy)!=null&&Y.server));ue(s,async(C,g)=>{var z,E,te;x.value=(E=(z=C==null?void 0:C.config)==null?void 0:z.proxy)==null?void 0:E.server,h.value=Ps((te=C.config)==null?void 0:te.metadata)});const k=$(!1),U=$(!1),m=B(()=>{const C=G.cloneDeep(s.value.config);return x.value||(C.proxy=void 0),C.metadata=qs(h.value),C}),V=B(()=>{const C={...m.value};return S.value||delete C.noweb,{name:s.value.name,config:C}});async function I(){k.value=!0;try{U.value=!0;const C=G.cloneDeep(V.value);await d(_.updateSession(s.value.server,s.value.name,C.config),void 0,"Failed to update session"),n.add({severity:"success",summary:"Updated",detail:s.value.name,life:3e3})}finally{U.value=!1}s.value=void 0,D()}async function A(C){k.value=!0;try{U.value=!0;const g=G.cloneDeep(V.value);g.start=C;const z=await d(_.createSession(s.value.server,g),void 0,"Failed to start session"),E=C?"Started":"Created";n.add({severity:"success",summary:E,detail:z.name,life:3e3})}finally{U.value=!1}s.value=void 0,D()}function D(){k.value=!1,l.value=!1}const se=B(()=>s.value.status==="STOPPED");async function F(C){await navigator.clipboard.writeText(JSON.stringify({method:"POST",uri:"/api/sessions",body:V.value},null,2)),C.preventDefault()}return(C,g)=>{const z=De,E=Is,te=Je,ie=le,pe=Ms,J=Ie("font-awesome-icon"),Z=Ke,me=Qe,ve=ze,fe=es,_e=Lo,ge=Ns,oe=q,be=Ce,L=H("tooltip");return i(),T(be,{visible:l.value,"onUpdate:visible":g[15]||(g[15]=u=>l.value=u),modal:!0,class:"p-fluid",maximizable:""},xs({footer:f(()=>[e("div",rn,[e("div",null,[c.value&&!se.value?(i(),T(E,{key:0,severity:"warn"},{default:f(()=>[M(" The session is in '"),e("b",null,O(s.value.status)+"'",1),M(" status, in order to save configuration the session will be restarted. ")]),_:1})):R("",!0)]),e("div",dn,[j(t(oe,{label:"Copy",text:"",tabindex:0,icon:"pi pi-copy",severity:"secondary",onClick:g[12]||(g[12]=u=>F(u))},null,512),[[L,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]]),c.value?R("",!0):(i(),T(oe,{key:0,label:"Create",icon:"pi pi-plus",text:"",onClick:g[13]||(g[13]=u=>A(!1)),loading:U.value},null,8,["loading"])),c.value?R("",!0):(i(),T(oe,{key:1,label:"Create & Start",icon:"pi pi-play",text:"",onClick:g[14]||(g[14]=u=>A(!0)),loading:U.value},null,8,["loading"])),c.value?(i(),T(oe,{key:2,label:"Update",icon:"pi pi-save",text:"",onClick:I,loading:U.value},null,8,["loading"])):R("",!0)])])]),default:f(()=>[e("div",Bo,[c.value?(i(),T(E,{key:0,severity:"info"},{default:f(()=>[M(" To change the "),jo,M(" or "),Io,M(" - please remove the session and run again. ")]),_:1})):R("",!0)]),e("div",Mo,[Oo,t(te,{placeholder:"Select Server",modelValue:s.value.server,"onUpdate:modelValue":g[0]||(g[0]=u=>s.value.server=u),showClear:!1,required:!0,invalid:k.value&&!s.value.server,disabled:r.value},null,8,["modelValue","invalid","disabled"]),k.value&&!s.value.server?(i(),y("small",No,"Server is required.")):R("",!0)]),e("div",Eo,[Ao,t(ie,{id:"name",modelValue:s.value.name,"onUpdate:modelValue":g[1]||(g[1]=u=>s.value.name=u),modelModifiers:{trim:!0},required:"false",autofocus:"",placeholder:"session_1111111111111",disabled:!v.value},null,8,["modelValue","disabled"])]),S.value?(i(),y("div",Po,[qo,t(ve,{activeIndex:0},{default:f(()=>[t(me,{header:"NOWEB"},{header:f(()=>[M(" Â "),t(pe,{value:"New"})]),default:f(()=>[e("div",Ho,[Fo,e("div",null,[j((i(),T(Z,{modelValue:s.value.config.noweb.markOnline,"onUpdate:modelValue":g[2]||(g[2]=u=>s.value.config.noweb.markOnline=u),onLabel:"Presence: online",offLabel:"Presence: offline",disabled:r.value},{icon:f(()=>[t(J,{icon:"fa-solid fa-sync",class:"mr-2"})]),_:1},8,["modelValue","disabled"])),[[L,"Send presence when connect for the connected session. If presence online - you don not get notifications in your phone"]])]),e("div",Wo,[e("div",null,[j((i(),T(Z,{modelValue:s.value.config.noweb.store.enabled,"onUpdate:modelValue":g[3]||(g[3]=u=>s.value.config.noweb.store.enabled=u),onLabel:"Store: Enabled",offLabel:"Store: Disabled",disabled:r.value},{icon:f(()=>[t(J,{icon:"fa-solid fa-folder",class:"mr-2"})]),_:1},8,["modelValue","disabled"])),[[L,"Store contacts, chats, messages in the database, so you can get it in API"]])]),e("div",null,[j((i(),T(Z,{modelValue:s.value.config.noweb.store.fullSync,"onUpdate:modelValue":g[4]||(g[4]=u=>s.value.config.noweb.store.fullSync=u),onLabel:"Store: Full Sync On",offLabel:"Store: Full Sync Off",disabled:r.value},{icon:f(()=>[t(J,{icon:"fa-solid fa-sync",class:"mr-2"})]),_:1},8,["modelValue","disabled"])),[[L,`Sync all contacts, chats, messages from the phone at the start.
Otherwise the store can miss some information.`]])])])])]),_:1})]),_:1})])):R("",!0),e("div",null,[e("div",null,[e("h5",null,[M("ðŸ“ Metadata "),j(e("i",Ko,null,512),[[L,"Key value pairs you can attach to Session and will receive it in webhooks, API and search the values on Dashboard."]])])]),t(fe,{modelValue:h.value,"onUpdate:modelValue":g[5]||(g[5]=u=>h.value=u),"entity-name":"Metadata","key-column":"key","key-column-name":"Key",prefix:"user.id."},null,8,["modelValue"])]),e("div",Qo,[t(_e,{ref:"webhooks",webhooks:s.value.config.webhooks,"onUpdate:webhooks":g[6]||(g[6]=u=>s.value.config.webhooks=u)},null,8,["webhooks"])]),e("div",null,[e("div",zo,[Xo,t(Z,{modelValue:x.value,"onUpdate:modelValue":g[7]||(g[7]=u=>x.value=u),id:"proxy",onLabel:"Proxy On",offLabel:"Proxy Off"},{icon:f(()=>[t(J,{icon:"fa-solid fa-server",class:"mr-2"})]),_:1},8,["modelValue"])]),x.value?(i(),y("div",Go,[e("div",Yo,[Jo,t(ie,{id:"proxy-server",modelValue:s.value.config.proxy.server,"onUpdate:modelValue":g[8]||(g[8]=u=>s.value.config.proxy.server=u),modelModifiers:{trim:!0},required:"true",invalid:k.value&&!s.value.config.proxy.server,placeholder:"host:port"},null,8,["modelValue","invalid"]),k.value&&!s.value.config.proxy.server?(i(),y("small",Zo,"Server is required.")):R("",!0)]),e("div",en,[e("div",sn,[tn,t(ie,{id:"proxy-username",modelValue:s.value.config.proxy.username,"onUpdate:modelValue":g[9]||(g[9]=u=>s.value.config.proxy.username=u),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e("div",on,[nn,t(ge,{id:"proxy-password",modelValue:s.value.config.proxy.password,"onUpdate:modelValue":g[10]||(g[10]=u=>s.value.config.proxy.password=u),modelModifiers:{trim:!0},feedback:!1,toggleMask:""},null,8,["modelValue"])])])])):R("",!0)]),e("div",ln,[an,t(Z,{modelValue:s.value.config.debug,"onUpdate:modelValue":g[11]||(g[11]=u=>s.value.config.debug=u),onLabel:"Debug Enabled",offLabel:"Debug Disabled",onIcon:"fa fa-bug"},{icon:f(()=>[t(J,{icon:"fa-solid fa-bug",class:"mr-2"})]),_:1},8,["modelValue"])])]),_:2},[v.value?{name:"header",fn:f(()=>[To]),key:"0"}:void 0,v.value?void 0:{name:"header",fn:f(()=>[e("div",null,[t(z,{session:s.value},null,8,["session"])])]),key:"1"}]),1032,["visible"])}}},cn=["WORKING","FAILED","STARTING","SCAN_QR_CODE","STOPPED"],pn={class:"",style:{"min-width":"20rem"}},mn={class:"flex justify-content-center align-items-center"},vn=e("h5",{class:"m-0"},"QR",-1),fn={class:"m-auto w-full"},_n={class:"flex justify-content-center"},gn={key:1,style:{"background-color":"#f8f9fa",padding:"1rem",color:"red","white-space":"pre-wrap"}},bn={__name:"QRImage",props:{session:Object},setup(o){const n=P(),l=o,{data:s,pending:a,error:v,refresh:c}=ye(`session-qr-${l.session.server.id}-${l.session.name}`,async()=>(await $e(1e3),await n.getQR(l.session.server.id,l.session.name)));return(r,d)=>{const _=Ve,w=Ee,S=Ae,h=Ge;return i(),y("div",pn,[e("div",mn,[vn,t(_,{onClick:p(c)},null,8,["onClick"])]),e("div",fn,[p(a)?(i(),y(N,{key:0},[t(w,{mode:"indeterminate",style:{height:"3px"}}),!p(s)&&!p(v)?(i(),T(S,{key:0,width:"100%",height:"20rem"})):R("",!0)],64)):R("",!0),e("div",_n,[p(s)?(i(),T(h,{key:0,data:p(s).data,mimetype:p(s).mimetype},null,8,["data","mimetype"])):R("",!0),p(v)?(i(),y("pre",gn,""+O(p(v).cause.response.data.message||p(v).cause.response.data||p(v))+`
  `,1)):R("",!0)])])])}}},hn={},yn={class:"pl-4"},$n=Me('<li> Open <b>WhatsApp</b> on your phone </li><li> Tap <b>More options</b> <i class="pi pi-ellipsis-v"></i> or <b>Settings</b> <i class="pi pi-cog"></i></li><li> Tap <b>Linked Devices</b> &gt; <b>Link a device</b></li><li><b>Link with phone number instead</b> and enter the code </li>',4),Sn=[$n];function wn(o,n){return i(),y("ul",yn,Sn)}const xn=re(hn,[["render",wn]]),kn={class:"flex flex-column gap-2 mt-4"},Cn={class:"flex justify-content-between gap-2"},Vn={class:"field"},Dn={class:"card flex justify-content-center align-items-center"},Rn={class:"mx-1",style:{"font-size":"2rem"}},Un={__name:"PairingCodeSteps",props:["session"],setup(o){const n=o,l=$(null),s=$(!1),a=$("XXXX-XXXX"),v=ke(),c=P();function r(_){return _.replace(/\D/g,"")}async function d(){l.value=r(l.value),s.value=!0;try{await $e(1e3);const _=await v(c.getPairingCode(n.session.server.id,n.session.name,l.value),"Request sent","Failed to request code",n.session.name,n.session.name);a.value=_.code}finally{s.value=!1}}return ue(l,G.debounce(_=>{l.value=r(_)},1e3)),(_,w)=>{const S=le,h=q,x=We;return i(),y(N,null,[e("div",kn,[e("form",{onSubmit:ks(d,["prevent"])},[e("div",Cn,[e("div",Vn,[t(S,{id:"phone","input-id":"phone",name:"phone",modelValue:p(l),"onUpdate:modelValue":w[0]||(w[0]=k=>we(l)?l.value=k:null),modelModifiers:{trim:!0},useGrouping:!1,required:"true",autofocus:"",placeholder:"1213213213 (no +, no dashes -)"},null,8,["modelValue"])]),e("div",null,[t(h,{type:"submit",label:"Show Code",icon:"pi pi-send",loading:p(s)},null,8,["loading"])])])],32)]),p(a)?(i(),y(N,{key:0},[t(x),e("div",null,[t(xn)]),e("div",Dn,[e("div",null,[p(a)?(i(!0),y(N,{key:0},de(p(a),k=>(i(),y("span",Rn,O(k),1))),256)):R("",!0)])])],64)):R("",!0)],64)}}},Ln={},Tn={class:"pl-4"},Bn=Me('<li> Open <b>WhatsApp</b> on your phone </li><li> Tap <b>More options</b> <i class="pi pi-ellipsis-v"></i> or <b>Settings</b> <i class="pi pi-cog"></i></li><li> Tap <b>Linked Devices</b> and <b>Link a device</b></li><li> Point your phone to this screen to capture <b>QR code</b></li>',4),jn=[Bn];function In(o,n){return i(),y("ul",Tn,jn)}const Mn=re(Ln,[["render",In]]),On=e("i",{class:"pi pi-qrcode mr-2"},null,-1),Nn=e("p",null,[M(" Scan "),e("b",null,"QR Code"),M(" to authorize this session. ")],-1),En=e("i",{class:"pi pi-send mr-2"},null,-1),An=e("p",{class:"m-0"},[M(" Enter "),e("b",null,"Your Phone number"),M(": ")],-1),Pn={__name:"SessionLoginDialog",props:ne(["session"],{visible:{},visibleModifiers:{}}),emits:["update:visible"],setup(o){const n=Q(o,"visible");return(l,s)=>{const a=Es,v=As,c=Ce;return i(),T(c,{visible:n.value,"onUpdate:visible":s[0]||(s[0]=r=>n.value=r),modal:!0,class:"p-fluid",maximizable:""},{header:f(()=>[t(De,{session:o.session},null,8,["session"])]),default:f(()=>[t(v,null,{default:f(()=>[t(a,null,{header:f(()=>[On,M(" Scan QR ")]),default:f(()=>[Nn,t(Mn),e("div",null,[t(bn,{session:o.session},null,8,["session"])])]),_:1}),t(a,null,{header:f(()=>[En,M(" Enter Code ")]),default:f(()=>[An,e("div",null,[t(Un,{session:o.session},null,8,["session"])])]),_:1})]),_:1})]),_:1},8,["visible"])}}},qn={__name:"SessionLogin",props:["session"],setup(o){const n=$(!1);return(l,s)=>{const a=q,v=H("tooltip");return i(),y(N,null,[j(t(a,{icon:"pi pi-sign-in",severity:"",rounded:"",outlined:"",onClick:s[0]||(s[0]=c=>n.value=!0),disabled:o.session.status!=="SCAN_QR_CODE"},null,8,["disabled"]),[[v,"Login",void 0,{top:!0}]]),t(Pn,{visible:p(n),"onUpdate:visible":s[1]||(s[1]=c=>we(n)?n.value=c:null),session:o.session},null,8,["visible","session"])],64)}}},Hn={class:"flex justify-content-between"},Fn={class:"flex align-items-center gap-1"},Wn=e("i",{class:"pi pi-whatsapp"},null,-1),Kn=e("span",{class:"mr-1"}," Sessions ",-1),Qn=["disabled"],zn=e("i",{class:"pi pi-refresh"},null,-1),Xn=[zn],Gn={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-0"},Yn={class:"flex flex-column"},Jn={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-2"},Zn={style:{"text-align":"left"},class:"flex flex-column"},el={class:"text-center"},sl={class:"flex gap-2"},tl={class:"my-auto"},ol={key:0,class:"pi pi-info-circle text-orange-400"},nl={class:"flex flex-row gap-2 justify-content-end",style:{order:"2"}},Il={__name:"SessionTable",setup(o){const n=xe(),l=P(),{visibleSessions:s,refreshing:a,servers:v}=Se(l),c=$({config:{webhooks:[]}}),r=$(!1),d=$(void 0),_=$(!1),w=$(10);$(null);const S=$({}),h=$(null),x=$([]),k=B(()=>x.value.filter(L=>D.value[`session-action-${L.server.id}-${L.name}`])),U=$(!1),m=$(!1),V=$(!1),I=$(!1),A=$(!1),D=$({});function se(L,u){switch(L){case"startSession":U.value=u;break;case"restartSession":m.value=u;break;case"stopSession":V.value=u;break;case"logoutSession":I.value=u;break;case"deleteSession":A.value=u;break}}async function F(L){se(L,!0);try{for(const u of k.value)await D.value[`session-action-${u.server.id}-${u.name}`][L]()}finally{se(L,!1)}}Cs(()=>{D.value=[]}),Vs(()=>{ve()});const W=$([{field:"name",header:"Name"},{field:"metadata",header:"Metadata"},{field:"me",header:"Me"},{field:"status",header:"Status"},{field:"server",header:"Server"}]);function Y(){return JSON.parse(localStorage.getItem("sessions.table.columns.hidden"))||[]}const C=Y(),g=$(G.differenceBy(W.value,C,"field")),z=L=>{g.value=W.value.filter(u=>L.includes(u))};function E(L){return!g.value||g.value.length===0?!0:G.find(g.value,{field:L})}const te=B(()=>E("name")),ie=B(()=>E("metadata")),pe=B(()=>E("me")),J=B(()=>E("status")),Z=B(()=>E("server")),me=B(()=>G.differenceBy(W.value,g.value,"field"));ue(()=>me.value,L=>{localStorage.setItem("sessions.table.columns.hidden",JSON.stringify(L))},{deep:!0});const ve=()=>{S.value={global:{value:null,matchMode:ae.CONTAINS},status:{value:null,matchMode:ae.EQUALS},"server.id":{value:null,matchMode:ae.EQUALS},name:{operator:Ds.AND,constraints:[{value:null,matchMode:ae.STARTS_WITH}]}}};function fe(){const L=v.value.find(u=>u.connected);if(!L){n.add({severity:"error",summary:"No connected server",detail:"Please connect to a server first",life:3e3});return}c.value={server:L.id,name:"",config:{metadata:{},webhooks:[{url:"https://httpbin.org/post",events:["session.status","message"],hmac:{key:null},retries:{delaySeconds:1,attempts:15,policy:"exponential"},customHeaders:null}],noweb:{markOnline:!0,store:{enabled:!0,fullSync:!1}},proxy:{}}},d.value="new",r.value=!0}function _e(L){c.value=G.cloneDeep({name:L.name,status:L.status,server:L.server.id,config:L.config}),d.value="update",r.value=!0}function ge(){ye("store",async()=>await l.refresh())}function oe(L){_.value=!0,c.value=L}const be=B(()=>["name","me.id","me.pushName","_metadata"]);return(L,u)=>{const Ue=Be,Le=q,ss=Qs,ts=Oe,os=Rs,ns=le,ls=Us,ee=Ne,is=Gs,as=Xe,rs=lt,Te=qe,ds=ce,us=Je,cs=Ze,ps=ct,ms=Fe,vs=He,fs=Xt,_s=un,he=H("tooltip");return i(),y(N,null,[e("div",Hn,[e("div",null,[e("h5",Fn,[Wn,Kn,t(Ue,{refreshing:p(a)},null,8,["refreshing"])])]),e("div",null,[j((i(),y("button",{onClick:ge,class:"p-link layout-topbar-button",disabled:p(a)},Xn,8,Qn)),[[he,"Refresh",void 0,{top:!0}]])])]),t(ms,{selection:x.value,"onUpdate:selection":u[6]||(u[6]=b=>x.value=b),value:p(s).length>0?p(s):[],paginator:!0,rows:w.value,rowsPerPageOptions:[5,10,20,50,100,500],dataKey:b=>`${b.server.id}-${b.name}`,rowHover:!0,filters:S.value,"onUpdate:filters":u[7]||(u[7]=b=>S.value=b),filterDisplay:"row",loading:h.value,globalFilterFields:p(be),showGridlines:"",style:{"white-space":"nowrap"},sortField:"name",sortOrder:1},{header:f(()=>[e("div",Gn,[e("div",Yn,[t(Le,{label:"Start New",icon:"pi pi-play",severity:"success",onClick:fe})]),e("div",Jn,[t(ss),e("div",Zn,[t(ts,{placeholder:"Columns",modelValue:g.value,options:W.value,optionLabel:"header",selectedItemsLabel:"Columns",maxSelectedLabels:0,"onUpdate:modelValue":z},null,8,["modelValue","options"])]),t(ls,{iconPosition:"left"},{default:f(()=>[t(os,{class:"pi pi-search"}),t(ns,{modelValue:S.value.global.value,"onUpdate:modelValue":u[0]||(u[0]=b=>S.value.global.value=b),placeholder:"Search by name, phone, metadata",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])])]),empty:f(()=>[M(" No sessions found")]),loading:f(()=>[M(" Loading sessions...")]),default:f(()=>[t(ee,{selectionMode:"multiple",headerStyle:"width: 3rem"}),p(te)?(i(),T(ee,{key:0,field:"name",header:"Name",sortable:""})):R("",!0),p(ie)?(i(),T(ee,{key:1,header:"Metadata"},{body:f(({data:b})=>{var K;return[t(is,{metadata:(K=b.config)==null?void 0:K.metadata},null,8,["metadata"])]}),_:1})):R("",!0),p(pe)?(i(),T(ee,{key:2,header:"Me"},{body:f(({data:b})=>[e("div",el,[t(as,{session:b},null,8,["session"])])]),_:1})):R("",!0),p(J)?(i(),T(ee,{key:3,field:"status",header:"Status",showFilterMenu:!1,style:{width:"9rem"}},{body:f(({data:b})=>[e("div",sl,[e("div",null,[t(qn,{session:b},null,8,["session"])]),e("div",null,[t(rs,{session:b},null,8,["session"])]),e("div",null,[j(t(Le,{icon:"pi pi-whatsapp",severity:"",rounded:"",outlined:"",onClick:K=>oe(b)},null,8,["onClick"]),[[he,"Send Request",void 0,{top:!0}]])]),e("div",tl,[t(Te,{status:b.status,value:b.status.toUpperCase()},null,8,["status","value"])])])]),filter:f(({filterModel:b,filterCallback:K})=>[t(ds,{modelValue:b.value,"onUpdate:modelValue":X=>b.value=X,options:p(cn),onChange:X=>K(),placeholder:"Any",class:"p-column-filter",showClear:!0},{option:f(({option:X})=>[t(Te,{status:X,value:X},null,8,["status","value"])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1})):R("",!0),p(Z)?(i(),T(ee,{key:4,field:"server.name",filterField:"server.id",header:"Server",showFilterMenu:!1},{filter:f(({filterModel:b,filterCallback:K})=>[t(us,{placeholder:"Any",onChange:X=>K(),modelValue:b.value,"onUpdate:modelValue":X=>b.value=X,showClear:!0,required:!1},null,8,["onChange","modelValue","onUpdate:modelValue"])]),body:f(({data:b})=>[M(O(b.server.name)+" ",1),b.assignedWorker&&b.server.name!==b.assignedWorker?j((i(),y("i",ol,null,512)),[[he,`Assigned Worker ID does not match

ðŸ‘‰ Assigned Worker ID: ${b.assignedWorker}`]]):R("",!0)]),_:1})):R("",!0),t(ee,{showFilterMenu:!1},{filter:f(()=>[e("div",nl,[t(cs,{group:"dialog",name:`'${p(k).length}' sessions`,"all-disabled":p(k).length===0,"hide-actions":["view"],"is-starting":U.value,"is-restarting":m.value,"is-stopping":V.value,"is-logging-out":I.value,"is-removing":A.value,onStart:u[1]||(u[1]=b=>F("startSession")),onRestart:u[2]||(u[2]=b=>F("restartSession")),onStop:u[3]||(u[3]=b=>F("stopSession")),onLogout:u[4]||(u[4]=b=>F("logoutSession")),onDelete:u[5]||(u[5]=b=>F("deleteSession"))},null,8,["name","all-disabled","is-starting","is-restarting","is-stopping","is-logging-out","is-removing"])])]),body:f(({data:b})=>[t(ps,{ref:K=>{D.value[`session-action-${b.server.id}-${b.name}`]=K},session:b,disabled:p(k).length!==0,onView:_e},null,8,["session","disabled"])]),_:1})]),_:1},8,["selection","value","rows","dataKey","filters","loading","globalFilterFields"]),t(vs),t(fs,{visible:_.value,"onUpdate:visible":u[8]||(u[8]=b=>_.value=b),session:c.value,"onUpdate:session":u[9]||(u[9]=b=>c.value=b)},null,8,["visible","session"]),t(_s,{visible:r.value,"onUpdate:visible":u[10]||(u[10]=b=>r.value=b),session:c.value,"onUpdate:session":u[11]||(u[11]=b=>c.value=b),mode:d.value},null,8,["visible","session","mode"])],64)}}};export{Qs as _,Il as a};
