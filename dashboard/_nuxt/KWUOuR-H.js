import{C as x,c as ce,g as de,u as Y,s as ue,W as pe}from"./CeBpB-bY.js";import Z from"./CkvXMW2X.js";import{W as me,a as Q,_ as ve}from"./YDH4_BWB.js";import fe from"./DxelPf99.js";import _e from"./B_t27BWY.js";import ge from"./BPib5Z_v.js";import he from"./CTAfHneX.js";import we from"./CRyIBBUP.js";import ee from"./D-pKGocH.js";import{c as N,t as y,L as P,M as ye,N as k,_ as te,v as D,x as o,y as ne,i as be,O as oe,P as J,z as l,Q as Ce,R as xe,r as U,o as Se,S as z,H as X,B as j,A as C,T as G,U as Ee,C as Ne,D as ke,V as De}from"./BbIi96Xs.js";import Te from"./JlgdQNkK.js";import"./phjR0xzJ.js";import"./CwRod2ze.js";import"./DrazD8tv.js";import"./TZ-OelIU.js";import"./BcJUo35A.js";import"./BrTrkqzJ.js";import"./OtvFIBDM.js";import"./Cqsjfayk.js";import"./C2rnrwfA.js";import"./DLQrkxVN.js";import"./C-LGqMgU.js";import"./CeosNt-3.js";import"./7Uu9kh93.js";import"./BEkqqOaN.js";import"./QnRMGIyv.js";import"./DwAdasYo.js";import"./CeUKCAXf.js";import"./fFLG6Q8x.js";import"./BF-SPKT_.js";import"./mRmBM_Ov.js";import"./grtSRce_.js";import"./ByuGmR_A.js";import"./BwL0FQjt.js";import"./EpNiEfr4.js";import"./CZEpLtK2.js";import"./CJyFfDzs.js";function Re(i){return new Date(i).toLocaleTimeString(void 0,{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})+"."+String(new Date(i).getMilliseconds()).padStart(3,"0")}const $e={__name:"EventTag",props:["event"],setup(i){const r=i,v=N(()=>me[r.event]||"rgb(114,166,234)"),d=N(()=>({background:"transparent",border:"2px solid rgb(66, 75, 87)",color:v.value,"font-size":"0.9rem"})),t={"session.status":"session.status 🖥️",message:"message ✉️","message.any":"message.any ✉️","message.ack":"message.ack 👀"},u=N(()=>t[r.event]||r.event);return(f,c)=>{const _=ee;return y(),P(_,{style:ye(k(d)),value:k(u)},null,8,["style","value"])}}},Oe={class:"truncate"},Ie={__name:"EventDetail",props:["data"],setup(i){const r=i,v=N(()=>{var c,_,n,b,p;const t=r.data.payload,u=r.data,f=r.data.event;switch(f){case"session.status":return[t.status,(c=u.me)==null?void 0:c.id,(_=u.me)==null?void 0:_.pushName];case"message":case"message.any":case"message.ack":case"message.reaction":return[t.id,t.body,f==="message.ack"?t.ackName:null,f==="message.ack"?null:(n=t.reaction)==null?void 0:n.text,(b=t.media)!=null&&b.url?"🖼":null];case"engine.event":return[t.event,JSON.stringify(t.data)];case"presence.update":return[t.id,(p=t.presences)==null?void 0:p[0].lastKnownPresence];default:return[]}}),d=N(()=>v.value.filter(t=>t!=null).join(" | "));return(t,u)=>(y(),D("div",Oe,[o("code",null,ne(k(d)),1)]))}},Ve=te(Ie,[["__scopeId","data-v-eda98894"]]),Be={class:"flex gap-2"},Ae={style:{"margin-top":"-0.75rem"}},Ue={style:{"max-width":"100%"}},Le={__name:"EventDataViewer",props:["data"],setup(i){const r=i,v=N(()=>{const t={...r.data};return delete t._json,{id:t.id,session:t.session,event:t.event,payload:t.payload,...t}});async function d(t){await navigator.clipboard.writeText(JSON.stringify(v.value,null,2)),t.preventDefault()}return(t,u)=>{const f=Z,c=be("vue-json-pretty"),_=oe("tooltip");return y(),D("div",Be,[o("div",Ae,[J(l(f,{rounded:"",text:"",icon:"pi pi-copy",severity:"secondary",onClick:u[0]||(u[0]=n=>d(n))},null,512),[[_,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),o("div",Ue,[l(c,{data:k(v),deep:2,showLine:!1,showIcon:!0,theme:"dark"},null,8,["data"])])])}}},Me={key:0,class:"pi pi-angle-down"},je={key:1,class:"pi pi-angle-up"},Fe={__name:"expand",props:["rows","data"],setup(i){const r=i,v=N(()=>{var d;return!((d=r.rows)!=null&&d[r.data.id])});return(d,t)=>k(v)?(y(),D("i",Me)):(y(),D("i",je))}},We={__name:"WebSocketStatus",props:["status"],setup(i){const r=i,v=N(()=>{switch(r.status){case x.CONNECTING:return"warning";case x.CONNECTED:return"success";case x.DISCONNECTED:return"secondary";case x.ERROR:return"danger";default:return"warn"}});return(d,t)=>{const u=ee;return y(),D("div",null,[l(u,{value:i.status,severity:k(v)},null,8,["value","severity"])])}}};var se={exports:{}};(function(i,r){(function(v,d){i.exports=d()})(ce,function(){return function v(d,t,u){var f=window,c="application/octet-stream",_=u||c,n=d,b=!t&&!u&&n,p=document.createElement("a"),h=function(e){return String(e)},g=f.Blob||f.MozBlob||f.WebKitBlob||h,w=t||"download",S,E;if(g=g.call?g.bind(f):Blob,String(this)==="true"&&(n=[n,_],_=n[0],n=n[1]),b&&b.length<2048&&(w=b.split("/").pop().split("?")[0],p.href=b,p.href.indexOf(b)!==-1)){var T=new XMLHttpRequest;return T.open("GET",b,!0),T.responseType="blob",T.onload=function(e){v(e.target.response,w,c)},setTimeout(function(){T.send()},0),T}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(n))if(n.length>1024*1024*1.999&&g!==h)n=F(n),_=n.type||c;else return navigator.msSaveBlob?navigator.msSaveBlob(F(n),w):O(n);else if(/([\x80-\xff])/.test(n)){var R=0,B=new Uint8Array(n.length),L=B.length;for(R;R<L;++R)B[R]=n.charCodeAt(R);n=new g([B],{type:_})}S=n instanceof g?n:new g([n],{type:_});function F(e){var s=e.split(/[:;,]/),m=s[1],A=s[2]=="base64"?atob:decodeURIComponent,W=A(s.pop()),M=W.length,I=0,$=new Uint8Array(M);for(I;I<M;++I)$[I]=W.charCodeAt(I);return new g([$],{type:m})}function O(e,s){if("download"in p)return p.href=e,p.setAttribute("download",w),p.className="download-js-link",p.innerHTML="downloading...",p.style.display="none",document.body.appendChild(p),setTimeout(function(){p.click(),document.body.removeChild(p),s===!0&&setTimeout(function(){f.URL.revokeObjectURL(p.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,c)),window.open(e)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=e),!0;var m=document.createElement("iframe");document.body.appendChild(m),!s&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,c)),m.src=e,setTimeout(function(){document.body.removeChild(m)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(S,w);if(f.URL)O(f.URL.createObjectURL(S),!0);else{if(typeof S=="string"||S.constructor===h)try{return O("data:"+_+";base64,"+f.btoa(S))}catch{return O("data:"+_+","+encodeURIComponent(S))}E=new FileReader,E.onload=function(e){O(this.result)},E.readAsDataURL(S)}return!0}})})(se);var He=se.exports;const Pe=de(He),V=i=>(Ne("data-v-850776fb"),i=i(),ke(),i),ze={class:"mb-4"},Ge=V(()=>o("h5",{class:"flex align-items-center gap-1"},[o("i",{class:"pi pi-eye"}),o("span",{class:"mr-1"}," Event Monitor ")],-1)),Je={class:"m-0"},Ke=V(()=>o("a",{target:"_blank",href:"https://waha.devlike.pro/docs/how-to/webhooks/#events"}," WAHA Events ",-1)),qe=V(()=>o("br",null,null,-1)),Qe=V(()=>o("b",null,"development",-1)),Xe=V(()=>o("b",null,"debugging",-1)),Ye={class:"pi pi-info-circle"},Ze={class:"flex justify-content-between align-items-center flex-column sm:flex-row gap-2 sm:gap-0"},et={class:"flex flex-column sm:flex-row gap-2"},tt={class:"flex gap-2"},nt={class:"flex align-items-center justify-content-center"},ot={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-2"},st={class:"p-4 text-center text-se"},at=V(()=>o("span",null," Listening for new events... ",-1)),lt=V(()=>o("i",{class:"pi pi-spin pi-spinner"},null,-1)),it={class:"event-viewer"},rt={__name:"EventTable",setup(i){const r=Ce(),v=Y(),{servers:d}=xe(v),t=U(null);Se(async()=>{var m;for(let A=0;A<30;A++)d.value.length===0&&await ue(100);d.value.length>0&&(t.value=(m=d.value)==null?void 0:m[0].id,E())});const u=U([]),f=Q.filter(e=>e!=="engine.event"),c=U({global:{value:null,matchMode:z.CONTAINS},event:{value:f,matchMode:z.IN},session:{value:null,matchMode:z.CONTAINS}}),_=["_json"],n=U(!1);function b(e){e.timestamp=e.timestamp||Date.now(),e._json=e._json||JSON.stringify(e),u.value.push(e)}X(t,()=>{n.value&&(L(),E())});const p=N(()=>{var e;return c.value.event.value?(e=c.value.event.value)==null?void 0:e.includes("engine.event"):!0});X(p,()=>{n.value&&(L(),E())});let h=null;const g=U(x.DISCONNECTED),w=U({}),S=e=>{const s=w.value[e.data.id]===void 0||!w.value[e.data.id],m={...w.value};s?m[e.data.id]=!0:delete m[e.data.id],w.value={...m}},E=()=>{n.value=!0,T()};function T(){if(!n.value)return;if(!t.value){r.add({severity:"warn",summary:"No server selected",detail:"Please select a server to start listening"});return}if(h){r.add({severity:"warn",summary:"Already listening",detail:"Please stop the current listener before starting a new one or refresh the page"});return}const e=v.getServer(t.value),s=["*"];p.value&&s.push("engine.event"),h=new pe(e,s),h.connect(),g.value=x.CONNECTING,h.on("open",()=>{g.value=x.CONNECTED}),h.on("close",()=>{g.value=x.DISCONNECTED,R()}),h.on("error",()=>{g.value=x.ERROR,R()}),h.on("event",b)}function R(){B(),setTimeout(()=>{T()},300)}function B(){h==null||h.stop(),h=null}const L=()=>{n.value=!1,B(),g.value=x.DISCONNECTED},F=()=>{u.value=[]};function O(e){Pe(JSON.stringify(u.value,null,2),"events.json","text/plain")}return(e,s)=>{const m=Z,A=ve,W=fe,M=_e,I=ge,$=he,ae=we,le=$e,ie=Ve,re=Te,K=oe("tooltip");return y(),D(G,null,[o("div",ze,[Ge,o("div",null,[o("p",Je,[j(" Monitor "),Ke,j(" from your sessions in real-time! "),qe,j(" You can use Event Monitor for "),Qe,j(" and "),Xe,j(" purposes. "),J(o("i",Ye,null,512),[[K,"Displays only new incoming events in real-time; no historical data is available."]])])])]),l(re,{value:u.value,dataKey:"id",expandedRows:w.value,"onUpdate:expandedRows":s[4]||(s[4]=a=>w.value=a),rowHover:!0,filters:c.value,"onUpdate:filters":s[5]||(s[5]=a=>c.value=a),filterDisplay:"row",globalFilterFields:_,showGridlines:"",style:{"white-space":"nowrap"},sortField:"timestamp",sortOrder:-1,resizableColumns:"",class:"p-datatable--clickable",onRowClick:S},{header:C(()=>[o("div",Ze,[o("div",et,[o("div",tt,[n.value?(y(),P(m,{key:1,label:"Pause",icon:"pi pi-pause",severity:"secondary",onClick:L})):(y(),P(m,{key:0,label:"Listen",icon:"pi pi-play",severity:"success",onClick:E})),l(A,{placeholder:"Select Server",modelValue:t.value,"onUpdate:modelValue":s[0]||(s[0]=a=>t.value=a),showClear:!1},null,8,["modelValue"])]),o("div",nt,[l(We,{status:g.value},null,8,["status"])])]),o("div",ot,[J(l(m,{icon:"pi pi-download",label:"Download",onClick:s[1]||(s[1]=a=>O(a))},null,512),[[K,"Download all events as JSON"]]),l(m,{label:"Clean Events",icon:"pi pi-trash",severity:"secondary",onClick:F}),l(I,{iconPosition:"left"},{default:C(()=>[l(W,{class:"pi pi-search"}),l(M,{modelValue:c.value.global.value,"onUpdate:modelValue":s[2]||(s[2]=a=>c.value.global.value=a),placeholder:"Search in data",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])])]),empty:C(()=>[o("div",st,[g.value===k(x).CONNECTED?(y(),D(G,{key:0},[at,lt],64)):(y(),D(G,{key:1},[n.value?Ee("",!0):(y(),P(m,{key:0,label:"Listen",icon:"pi pi-play",severity:"success",onClick:E}))],64))])]),expansion:C(a=>[o("div",it,[l(Le,{data:a.data},null,8,["data"])])]),default:C(()=>[l($,{style:{width:"3rem"}},{body:C(({data:a})=>[l(Fe,{rows:w.value,data:a},null,8,["rows","data"])]),_:1}),l($,{field:"event",header:"Event","show-filter-menu":!1},{filter:C(({filterModel:a,filterCallback:q})=>[l(ae,{id:"events",modelValue:a.value,"onUpdate:modelValue":H=>a.value=H,placeholder:"Any","max-selected-labels":1,selectedItemsLabel:"{0} events",onChange:H=>q(),options:k(Q),showClear:!0,required:!1},null,8,["modelValue","onUpdate:modelValue","onChange","options"])]),body:C(({data:a})=>[l(le,{event:a.event},null,8,["event"])]),_:1}),l($,{field:"session",header:"Session","show-filter-menu":!1},{filter:C(({filterModel:a,filterCallback:q})=>[l(M,{modelValue:c.value.session.value,"onUpdate:modelValue":s[3]||(s[3]=H=>c.value.session.value=H),placeholder:"Session",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l($,{field:"timestamp",header:"Time",sortable:""},{body:C(({data:a})=>[o("span",null,ne(k(Re)(a.timestamp)),1)]),_:1}),l($,{header:"Detail","show-filter-menu":!1},{body:C(({data:a})=>[l(ie,{data:a},null,8,["data"])]),_:1})]),_:1},8,["value","expandedRows","filters"])],64)}}},ct=te(rt,[["__scopeId","data-v-850776fb"]]),dt={class:"grid"},ut={class:"col-12"},pt={class:"card"},Qt={__name:"event-monitor",setup(i){const r=Y();return De(()=>{r.refresh()}),(v,d)=>(y(),D("div",dt,[o("div",ut,[o("div",pt,[l(ct)])])]))}};export{Qt as default};
