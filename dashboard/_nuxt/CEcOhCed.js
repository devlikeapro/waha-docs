import{u as oe,_ as Ve}from"./D2cBBq2-.js";import K from"./pqfxJUpO.js";import Te from"./B0SjwXd2.js";import le from"./DTLlfXaW.js";import De from"./DEF2i6kF.js";import ie from"./B5dKh-v3.js";import{_ as ae}from"./Clz6KAQH.js";import Ie from"./0840QRQe.js";import{O as F,c as W,P as Q,t as u,v as y,B as b,y as r,N as t,Q as M,x as s,U as L,$ as X,z as i,V as C,Y as Ue,L as V,a2 as H,r as I,A as p,H as ne,X as Me,a4 as We,a3 as Ae,Z as Be,S as Re,W as je,T as Le}from"./DKQnC592.js";import{u as E,l as P,d as re}from"./ZqrvbXVd.js";import{_ as Oe,u as Y}from"./BLdChqrz.js";import ce from"./BOEE2nhJ.js";import ue from"./YEFu_eHk.js";import qe from"./CL-Kk8ZX.js";import de from"./DrWCErUf.js";import Ne from"./CL2uHYRt.js";import Pe from"./DMPTX9zG.js";import Fe from"./C2E5B46z.js";import Ee from"./BJQ29RKi.js";import ze from"./CtT8WNSM.js";function Ge(l,e){const d=Math.floor(l/864e5),n=Math.floor(l/36e5)%24,f=Math.floor(l/6e4)%60,c=Math.floor(l/1e3)%60,v=`${String(n).padStart(2,"0")}:${String(f).padStart(2,"0")}:${String(c).padStart(2,"0")}`;return d===0?v:e?d===1?`${v} 1 ${e("uptime.day")}`:`${v} ${d} ${e("uptime.days")}`:d===1?`${v} 1 day`:`${v} ${d} days`}const He={class:"pi pi-info-circle"},ve={__name:"ServerUptime",props:["status"],setup(l){const{t:e}=F(),d=l,n=W(()=>{const c=d.status.uptime;if(c)return Ge(c,e)}),f=W(()=>{const c=d.status.startTimestamp;if(c)return new Date(c)});return(c,v)=>{var g;const m=Q("tooltip");return u(),y(L,null,[b(r(n.value)+" "+r(t(e)("servers.uptimeStatus"))+"  ",1),M(s("i",He,null,512),[[m,`${t(e)("servers.startTime")}: ${(g=f.value)==null?void 0:g.toLocaleString()}`]])],64)}}},Ke=s("code",null," (",-1),Qe=s("code",null,")",-1),Xe={key:0},Ye={__name:"ServerInfoColumn",props:["server"],setup(l){const e=E();return(d,n)=>{const f=ve;return u(),y(L,null,[s("div",null,[s("code",null,r(l.server.version.engine),1),Ke,s("code",{class:X({"text-orange-400":l.server.version.version!==t(e).latestVersion})},r(l.server.version.version)+" "+r(l.server.version.tier),3),Qe]),l.server.status?(u(),y("div",Xe,[i(f,{status:l.server.status},null,8,["status"])])):C("",!0)],64)}}},Ze={__name:"ServerSessionSummary",props:{sessions:{required:!0}},setup(l){const e=l,d=W(()=>P.groupBy(e.sessions||[],"status")),n={WORKING:1,SCAN_QR_CODE:2,STARTING:3,FAILED:4,STOPPED:5},f=W(()=>P.sortBy(Object.entries(d.value),([c,v])=>n[c]));return(c,v)=>{const m=Oe;return u(!0),y(L,null,Ue(t(f),([g,$])=>(u(),V(m,{key:g+$.length,status:g,suffix:`:  ${$.length}`},null,8,["status","suffix"]))),128)}}},Je={class:"mb-4"},et=s("br",null,null,-1),tt={class:"field"},st={for:"name"},nt={key:0,class:"p-invalid"},rt={class:"field"},ot={for:"connection-url"},lt={key:0,class:"p-invalid"},it={key:1,class:"p-invalid"},at=s("br",null,null,-1),ct={href:"https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content#developer_console",target:"_blank"},ut=s("br",null,null,-1),dt=s("br",null,null,-1),vt={href:"https://waha.devlike.pro/docs/how-to/security/#https",target:"_blank"},pt={class:"field"},mt={for:"connection-key"},_t={__name:"ServerDialog",props:{visible:{},visibleModifiers:{},server:{},serverModifiers:{}},emits:["update:visible","update:server"],setup(l){const{t:e}=F(),d=H(l,"visible"),n=H(l,"server"),f=E(),c=Y(),v=I(!1),m=W(()=>{var a;const _=(a=n.value.connection)==null?void 0:a.url;return _?_.startsWith("http://")||_.startsWith("https://"):!1});async function g(){v.value=!0,!(!n.value.name||!m.value)&&(n.value.id?await c(f.editServer(n.value.id,n.value),e("servers.serverUpdated"),e("servers.failedToUpdateServer"),n.value.name,n.value.name):await c(f.addServer(n.value),e("servers.connectedToServer"),e("servers.failedToConnectToServer"),n.value.name,n.value.name),$(),n.value={connection:{}})}function $(){v.value=!1,d.value=!1}const T=W(()=>{var a;const _=(a=n.value.connection)==null?void 0:a.url;return _?_.startsWith("http://"):!1}),D=W(()=>location.protocol==="https:");return(_,a)=>{const w=ue,U=le,B=qe,R=K,O=de;return u(),V(O,{visible:d.value,"onUpdate:visible":a[3]||(a[3]=k=>d.value=k),header:t(e)("servers.server"),modal:!0,class:"p-fluid"},{footer:p(()=>[i(R,{label:t(e)("common.cancel"),icon:"pi pi-times",text:"",onClick:$,severity:"secondary"},null,8,["label"]),i(R,{label:n.value.id?t(e)("common.save"):t(e)("servers.connect"),icon:{"pi pi-check":!!n.value.id,"pi pi-link":!n.value.id},text:"",onClick:g},null,8,["label","icon"])]),default:p(()=>[s("div",Je,[i(w,{severity:"info"},{default:p(()=>[b(r(t(e)("servers.workersDataSaved"))+" ",1),et,b(" "+r(t(e)("servers.safeToStoreApiKey")),1)]),_:1})]),s("div",tt,[s("label",st,r(t(e)("servers.name")),1),i(U,{id:"name",modelValue:n.value.name,"onUpdate:modelValue":a[0]||(a[0]=k=>n.value.name=k),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:v.value&&!n.value.name},null,8,["modelValue","invalid"]),v.value&&!n.value.name?(u(),y("small",nt,r(t(e)("servers.nameRequired")),1)):C("",!0)]),s("div",rt,[s("label",ot,r(t(e)("servers.apiUrl")),1),i(U,{id:"connection-url",modelValue:n.value.connection.url,"onUpdate:modelValue":a[1]||(a[1]=k=>n.value.connection.url=k),modelModifiers:{trim:!0},required:"true",invalid:v.value&&!t(m)},null,8,["modelValue","invalid"]),v.value&&!n.value.connection.url?(u(),y("small",lt,r(t(e)("servers.urlRequired")),1)):C("",!0),v.value&&!t(m)?(u(),y("small",it,r(t(e)("servers.urlNotCorrect")),1)):C("",!0),t(D)&&t(T)?(u(),V(w,{key:2,severity:"error",class:"mt-2"},{default:p(()=>[b(r(t(e)("servers.mixedContentWarning"))+" ",1),at,b(" "+r(t(e)("servers.notPossibleDueTo"))+" ",1),s("a",ct,r(t(e)("servers.mixedContent")),1)]),_:1})):C("",!0),t(T)?(u(),V(w,{key:3,severity:"warn",class:"mt-2"},{default:p(()=>[b(r(t(e)("servers.httpWarning"))+" ",1),ut,b(" "+r(t(e)("servers.configureHttps"))+" ",1),dt,s("a",vt,r(t(e)("servers.readMoreAboutSecurity")),1)]),_:1})):C("",!0)]),s("div",pt,[s("label",mt,r(t(e)("servers.apiKeyOptional")),1),i(B,{id:"connection-key",modelValue:n.value.connection.key,"onUpdate:modelValue":a[2]||(a[2]=k=>n.value.connection.key=k),modelModifiers:{trim:!0},feedback:!1,toggleMask:""},null,8,["modelValue"])])]),_:1},8,["visible","header"])}}},ft={class:"p-3 flex flex-column gap-2"},ht={class:"flex gap-2"},gt={class:"flex flex-column gap-1"},bt={class:"flex gap-1"},yt=["href"],kt=s("i",{class:"pi pi-external-link"},null,-1),$t={class:"flex gap-1"},St=["href"],xt=s("i",{class:"pi pi-external-link"},null,-1),wt={class:"flex gap-2"},Ct={class:"flex gap-2"},Vt={key:0,class:"text-green-500 font-medium ml-2"},Tt=s("i",{class:"pi text-green-500 pi-check-circle"},null,-1),Dt={class:"flex gap-2"},It={key:0},Ut={class:"text-900 font-medium"},Mt={href:"https://waha.devlike.pro/docs/overview/changelog/",target:"_blank"},Wt=s("i",{class:"pi pi-external-link"},null,-1),At={__name:"ServerStatus",props:["server"],setup(l){const{t:e}=F(),d=l,n=E(),f=W(()=>{var c;return((c=d.server.version)==null?void 0:c.version)!==n.latestVersion});return(c,v)=>{var T,D,_,a,w,U;const m=ae,g=ve,$=ue;return u(),y("div",ft,[s("div",ht,[s("div",null,r(t(e)("servers.status")),1),s("div",gt,[s("div",null,[i(m,{class:"mr-1",connected:l.server.connected},null,8,["connected"]),s("span",null,[s("b",null,[l.server.connected?(u(),y(L,{key:0},[b(r(t(e)("servers.statusConnected")),1)],64)):(u(),y(L,{key:1},[b(r(t(e)("servers.disconnected")),1)],64))])])])])]),s("div",bt,[s("div",null,r(t(e)("servers.apiUrl")),1),s("div",null,[s("a",{href:(T=l.server.connection)==null?void 0:T.url,target:"_blank",class:"ml-2"},[b(r((D=l.server.connection)==null?void 0:D.url)+" ",1),kt],8,yt)])]),s("div",$t,[s("div",null,r(t(e)("servers.dashboardUrl")),1),s("div",null,[s("a",{href:t(re)((_=l.server.connection)==null?void 0:_.url),target:"_blank",class:"ml-2"},[b(r(t(re)((a=l.server.connection)==null?void 0:a.url))+" ",1),xt],8,St)])]),s("div",wt,[s("div",null,r(t(e)("servers.engine")),1),s("div",null,[s("code",null,r((w=l.server.version)==null?void 0:w.engine),1)])]),s("div",Ct,[s("div",null,r(t(e)("servers.version")),1),s("div",null,[s("code",{class:X({"text-orange-400":t(f)})},r((U=l.server.version)==null?void 0:U.version),3),t(f)?C("",!0):(u(),y("span",Vt,[Tt,b(" "+r(t(e)("servers.upToDate")),1)]))])]),s("div",Dt,[s("div",null,r(t(e)("servers.uptime")),1),l.server.status?(u(),y("div",It,[i(g,{status:l.server.status},null,8,["status"])])):C("",!0)]),t(f)?(u(),V($,{key:0,severity:"info"},{default:p(()=>[b(r(t(e)("servers.newVersionAvailable"))+" ",1),s("span",Ut,[s("a",Mt,[b(r(t(n).latestVersion)+" ",1),Wt])]),b(" "+r(t(e)("servers.versionAvailable")),1)]),_:1})):C("",!0)])}}},Bt={class:"flex flex-wrap justify-content-between"},Rt={class:"flex gap-2 align-items-center"},jt=s("span",{class:"text-xl font-bold"},"Copy",-1),Lt={class:"flex gap-2 align-items-center"},Ot=s("label",{for:"show-all"},"Show All",-1),qt={__name:"ServerVariablesTable",props:["server"],setup(l){const e=l,d=E(),n=I(!1),f=Y();function c(_){return P.sortBy(_,a=>a.name.startsWith("DEBUG")?0:a.name.startsWith("WAHA_")?1:a.name.startsWith("WHATSAPP_")?2:3)}function v(_){return _.map(a=>`${a.name}=${a.value}`).join(`
`)}const{data:m,pending:g,error:$,refresh:T}=oe(`server-environment-${e.server.id}`,async()=>{if(!e.server.id)return[];const _=await f(d.getServerEnvironment(e.server.id,n.value),void 0,"Failed to fetch server environment",void 0,e.server.name),a=Object.keys(_).map(w=>({name:w,value:_[w]}));return c(a)});ne(()=>e.server,T,{immediate:!0}),ne(n,T);async function D(_){const a=v(m.value);await navigator.clipboard.writeText(a),_.preventDefault()}return(_,a)=>{const w=K,U=Ne,B=ie,R=ce,O=Q("tooltip");return u(),V(R,{value:t(m),loading:t(g),resizableColumns:""},{header:p(()=>[s("div",Bt,[s("div",Rt,[jt,M(i(w,{rounded:"",text:"",icon:"pi pi-copy",onClick:a[0]||(a[0]=k=>D(k))},null,512),[[O,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),s("div",Lt,[i(U,{inputId:"show-all",modelValue:t(n),"onUpdate:modelValue":a[1]||(a[1]=k=>Me(n)?n.value=k:null)},null,8,["modelValue"]),Ot])])]),default:p(()=>[i(B,{field:"name",header:"Environment Variable"},{body:p(({data:k})=>[s("code",null,r(k.name),1)]),_:1}),i(B,{field:"value",header:"Value"})]),_:1},8,["value","loading"])}}},Nt={__name:"ServerControlDialog",props:We(["server"],{visible:{},visibleModifiers:{}}),emits:["update:visible"],setup(l){const{t:e}=F(),d=H(l,"visible"),n=l;return(f,c)=>{const v=At,m=qt,g=de;return u(),V(g,{visible:d.value,"onUpdate:visible":c[0]||(c[0]=$=>d.value=$),modal:!0,class:"p-fluid",style:{"max-width":"100%","min-width":"50%"},header:t(e)("servers.server")},{default:p(()=>[s("h4",null,r(l.server.name),1),i(v,{server:n.server},null,8,["server"]),s("h4",null,r(t(e)("servers.variables")),1),i(m,{server:n.server},null,8,["server"])]),_:1},8,["visible","header"])}}},Pt={style:{"min-width":"15rem"}},Ft={key:0,class:"flex flex-column"},Et={__name:"OverlayLinks",props:{title:{type:String,required:!0}},setup(l,{expose:e}){const d=I(null),n=I(null);return e({toggle:(c,v)=>{d.value.toggle(c),n.value=v},currentItem:n}),(c,v)=>(u(),V(t(ze),{ref_key:"overlayPanel",ref:d,appendTo:"body",showCloseIcon:!0},{default:p(()=>[s("div",Pt,[n.value?(u(),y("div",Ft,[Ae(c.$slots,"default")])):C("",!0)])]),_:3},512))}},zt=["href"],G={__name:"OverlayLink",props:{href:{type:String,required:!0},icon:{type:String,required:!0},name:{type:String,required:!0}},setup(l){return(e,d)=>(u(),y("a",{href:l.href,target:"_blank",class:"overlay-link w-full flex align-items-center"},[s("i",{class:X(`pi ${l.icon} mr-2`)},null,2),s("span",null,r(l.name),1)],8,zt))}},Gt={class:"flex justify-content-between"},Ht={class:"flex align-items-center gap-1"},Kt=s("i",{class:"pi pi-server"},null,-1),Qt={class:"mr-1"},Xt=["disabled"],Yt=s("i",{class:"pi pi-refresh"},null,-1),Zt=[Yt],Jt={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-0"},es={key:0,class:"pi pi-info-circle text-orange-400"},ts=["href"],ss={class:"flex gap-1"},ns={class:"flex flex-row gap-2 justify-content-end"},rs=s("i",{class:"pi pi-replay mr-2"},null,-1),ws={__name:"ServerTable",setup(l){const{t:e}=F(),d=Be(),n=E(),f=Y(),{servers:c,refreshing:v}=Re(n),m=I({connection:{}}),g=I(!1),$=I(!1),T=I(!1),D=I(null),_=(S,h)=>{D.value.toggle(S,h)};I(null);const a=I({}),w=I(null);je(()=>{U()});const U=()=>{a.value={global:{value:null,matchMode:Le.CONTAINS}}};function B(){m.value={connection:{}},g.value=!0}function R(S){m.value=P.cloneDeep(S),$.value=!0}function O(S){m.value=P.cloneDeep(S),g.value=!0}function k(S,h){d.require({group:"popup",target:S.target,message:e("servers.disconnectWorkerConfirm",{worker:h.name}),icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:e("common.no"),acceptLabel:e("servers.yesDisconnect"),accept:()=>f(n.deleteServer(h.id),e("servers.disconnected"),e("servers.failedToDisconnectWorker")),reject:()=>{}})}const pe=S=>{d.require({group:"restart",message:S.name,header:e("servers.restartServerConfirm",{server:S.name}),icon:"pi pi-replay",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-warning p-button-sm",rejectLabel:e("common.no"),acceptLabel:e("servers.yesRestart"),accept:async()=>{await f(n.stopServer(S,T.value),e("servers.restarting"),e("servers.failedToRestartWorker"),S.name,S.name)},reject:()=>{}})};function me(){oe("store",async()=>await n.refresh())}return(S,h)=>{const _e=Ve,j=K,fe=Te,he=le,ge=De,q=ie,z=ae,Z=Ie,be=Ye,ye=Ze,ke=ce,$e=_t,Se=Nt,xe=Pe,we=Fe,Ce=Ee,A=Q("tooltip");return u(),y(L,null,[s("div",Gt,[s("div",null,[s("h5",Ht,[Kt,s("span",Qt,r(t(e)("servers.workers")),1),i(_e,{refreshing:t(v)},null,8,["refreshing"])])]),s("div",null,[M((u(),y("button",{onClick:me,class:"p-link layout-topbar-button",disabled:t(v)},Zt,8,Xt)),[[A,t(e)("servers.refresh"),void 0,{top:!0}]])])]),i(ke,{value:t(c).length>0?t(c):[],paginator:!0,rows:10,dataKey:"id",rowHover:!0,filters:a.value,"onUpdate:filters":h[1]||(h[1]=o=>a.value=o),filterDisplay:"menu",loading:w.value,globalFilterFields:["name","id","connection.url"],showGridlines:"",style:{"white-space":"nowrap"},resizableColumns:""},{header:p(()=>[s("div",Jt,[i(j,{label:t(e)("servers.connect"),icon:"pi pi-link",severity:"success",onClick:B},null,8,["label"]),i(ge,{iconPosition:"left"},{default:p(()=>[i(fe,{class:"pi pi-search"}),i(he,{modelValue:a.value.global.value,"onUpdate:modelValue":h[0]||(h[0]=o=>a.value.global.value=o),placeholder:t(e)("servers.keywordSearch"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1})])]),empty:p(()=>[b(r(t(e)("servers.noWorkersFound")),1)]),loading:p(()=>[b(r(t(e)("servers.loadingWorkers")),1)]),default:p(()=>[i(q,{field:"name",header:t(e)("servers.name")},{body:p(({data:o})=>{var x,N,J,ee,te,se;return[s("div",null,[b(r(o.name)+" ",1),(N=(x=o.status)==null?void 0:x.worker)!=null&&N.id&&((ee=(J=o.status)==null?void 0:J.worker)==null?void 0:ee.id)!==o.name?M((u(),y("i",es,null,512)),[[A,t(e)("servers.workerIdMismatch",{worker:(se=(te=o.status)==null?void 0:te.worker)==null?void 0:se.id})]]):C("",!0)])]}),_:1},8,["header"]),i(q,{header:t(e)("servers.api")},{body:p(({data:o})=>[s("div",null,[i(z,{connected:o.connected},null,8,["connected"]),s("a",{class:"ml-1",href:o.connection.url,target:"_blank"},r(o.connection.url),9,ts)])]),_:1},8,["header"]),i(q,{header:t(e)("servers.info")},{body:p(({data:o})=>[o.connected===void 0?(u(),V(Z,{key:0,width:"9rem"})):o.connected===!1?(u(),V(z,{key:1,connected:o.connected},null,8,["connected"])):(u(),V(be,{key:2,server:o},null,8,["server"]))]),_:1},8,["header"]),i(q,{header:t(e)("servers.sessionsSection")},{body:p(({data:o})=>[s("div",ss,[o.connected===void 0?(u(),V(Z,{key:0,width:"10rem"})):C("",!0),o.connected===!1?(u(),V(z,{key:1,connected:o.connected},null,8,["connected"])):C("",!0),i(ye,{sessions:t(n).visibleSessionsByServer[o.id]},null,8,["sessions"])])]),_:1},8,["header"]),i(q,null,{body:p(({data:o})=>[s("div",ns,[M(i(j,{icon:"pi pi-link",severity:"info",rounded:"",outlined:"",onClick:x=>_(x,o)},null,8,["onClick"]),[[A,t(e)("servers.links"),void 0,{top:!0}]]),M(i(j,{disabled:!o.connected,icon:"pi pi-info",severity:"help",rounded:"",outlined:"",onClick:x=>R(o)},null,8,["disabled","onClick"]),[[A,t(e)("servers.workerInfo"),void 0,{top:!0}]]),M(i(j,{icon:"pi pi-pencil",severity:"success",rounded:"",outlined:"",onClick:x=>O(o)},null,8,["onClick"]),[[A,t(e)("servers.editWorker"),void 0,{top:!0}]]),M(i(j,{icon:"pi pi-replay",severity:"warning",rounded:"",outlined:"",onClick:x=>pe(o)},null,8,["onClick"]),[[A,t(e)("servers.restartWorker"),void 0,{top:!0}]]),M(i(j,{icon:"pi pi-times",severity:"danger",rounded:"",outlined:"",onClick:x=>k(x,o)},null,8,["onClick"]),[[A,t(e)("servers.disconnectWorker"),void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","filters","loading"]),i($e,{visible:g.value,"onUpdate:visible":h[2]||(h[2]=o=>g.value=o),server:m.value,"onUpdate:server":h[3]||(h[3]=o=>m.value=o)},null,8,["visible","server"]),i(Se,{visible:$.value,"onUpdate:visible":h[4]||(h[4]=o=>$.value=o),server:m.value,"onUpdate:server":h[5]||(h[5]=o=>m.value=o)},null,8,["visible","server"]),i(xe,{group:"popup"}),i(Ce,{group:"restart"},{message:p(o=>[s("div",null,[s("p",null,r(t(e)("servers.youreGoingToRestart",{server:o.message.message})),1),s("div",null,[s("p",null,r(t(e)("servers.gracefulStop")),1),i(we,{modelValue:T.value,"onUpdate:modelValue":h[6]||(h[6]=x=>T.value=x),id:"forceRestart",onLabel:t(e)("servers.forceRestartOn"),offLabel:t(e)("servers.forceRestartOff")},{icon:p(()=>[rs]),_:1},8,["modelValue","onLabel","offLabel"])])])]),_:1}),i(Et,{ref_key:"linksOverlayPanel",ref:D,title:t(e)("servers.links")},{default:p(()=>{var o,x,N;return[i(G,{href:`${(o=D.value.currentItem)==null?void 0:o.connection.url}/dashboard`,icon:"pi-home",name:t(e)("servers.dashboard")},null,8,["href","name"]),i(G,{href:`${(x=D.value.currentItem)==null?void 0:x.connection.url}/jobs`,icon:"pi-cog",name:t(e)("servers.jobs")},null,8,["href","name"]),i(G,{href:(N=D.value.currentItem)==null?void 0:N.connection.url,icon:"pi-code",name:t(e)("servers.swagger")},null,8,["href","name"])]}),_:1},8,["title"])],64)}}};export{ws as _};
