import{c as pe,g as me,u as te,s as ve,C as B,W as fe}from"./BoTHEUMz.js";import oe from"./DKYmVgiq.js";import{W as _e,_ as ge,a as Y,b as he}from"./9rtczCc1.js";import ye from"./BvQqxAhc.js";import we from"./CQksCWA8.js";import be from"./kj9rAbnQ.js";import Ce from"./BjaEftxL.js";import xe from"./CDAMQ4sO.js";import Se from"./BGyCHKI1.js";import{c as D,t as C,L as W,M as ke,N as n,_ as ne,v as $,x as l,y as A,O as se,i as Ee,P as ae,Q as G,z as c,R as Ne,S as Te,r as j,o as De,T as H,H as Z,B as ee,A as E,U as z,V as Ie,C as Oe,D as $e,W as Re}from"./CJX7AtTl.js";import Ve from"./BlzUc8ea.js";import"./C7NLapI8.js";import"./CDlw6piB.js";import"./6_R7ESbk.js";import"./B5JXFYh4.js";import"./D3phANTN.js";import"./d-kiEJ39.js";import"./Do78iRIl.js";import"./C_oNio56.js";import"./CQ4fDfS4.js";import"./D1wgvCcy.js";import"./CN5EQrjg.js";import"./CYlRIbDY.js";import"./jsliiHxW.js";import"./BagCoCA0.js";import"./BJkhOBpJ.js";import"./BU-9Jbed.js";import"./Bw5I4zK0.js";import"./Dbz6IDCL.js";import"./Cj1TGLCM.js";import"./DZar_m6B.js";import"./Ci7xPGkF.js";import"./CiRTo0HJ.js";import"./BpGnckWK.js";import"./YdLmgxUV.js";import"./fQgA2OYA.js";import"./KkXwY9FS.js";function Be(m){return new Date(m).toLocaleTimeString(void 0,{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})+"."+String(new Date(m).getMilliseconds()).padStart(3,"0")}const Ue={__name:"EventTag",props:["event"],setup(m){const v=m,y=D(()=>_e[v.event]||"rgb(114,166,234)"),p=D(()=>({background:"transparent",border:"2px solid rgb(66, 75, 87)",color:y.value,"font-size":"0.9rem"})),e={"session.status":"session.status ðŸ–¥ï¸",message:"message âœ‰ï¸","message.any":"message.any âœ‰ï¸","message.ack":"message.ack ðŸ‘€","message.revoked":"message.revoked âŒ","message.edited":"message.edited âœï¸"},t=D(()=>e[v.event]||v.event);return(i,w)=>{const _=Se;return C(),W(_,{style:ke(n(p)),value:n(t)},null,8,["style","value"])}}},je={class:"truncate"},Ae={__name:"EventDetail",props:["data"],setup(m){const v=m,y=D(()=>{var w,_,o,b,a,I;const e=v.data.payload,t=v.data,i=v.data.event;switch(i){case"session.status":return[e.status,(w=t.me)==null?void 0:w.id,(_=t.me)==null?void 0:_.pushName];case"message":case"message.any":case"message.ack":case"message.reaction":return[e.id,e.body,i==="message.ack"?e.ackName:null,i==="message.ack"?null:(o=e.reaction)==null?void 0:o.text,(b=e.media)!=null&&b.url?"ðŸ–¼":null];case"poll.vote":return[e.vote.id,e.vote.selectedOptions];case"message.revoked":return[e.revokedMessageId,e.after.id];case"message.edited":return[e.originalMessageId,e.body,e.id];case"group.v2.join":return[e.group.id,JSON.stringify(e.group)];case"group.v2.leave":return[e.group.id];case"group.v2.update":return[e.group.id,JSON.stringify(e.group)];case"group.v2.participants":return[e.group.id,e.type,JSON.stringify(e.participants)];case"event.response":case"event.response.failed":return[(a=e.eventResponse)==null?void 0:a.response,e.eventCreationKey.id];case"engine.event":return[e.event,JSON.stringify(e.data)];case"presence.update":return[e.id,(I=e.presences)==null?void 0:I[0].lastKnownPresence];default:return[]}}),p=D(()=>y.value.filter(e=>e!=null).join(" | "));return(e,t)=>(C(),$("div",je,[l("code",null,A(n(p)),1)]))}},Le=ne(Ae,[["__scopeId","data-v-a80eb3c3"]]),Me={class:"flex gap-2"},Fe={style:{"margin-top":"-0.75rem"}},Je={style:{"max-width":"100%"}},Pe={__name:"EventDataViewer",props:["data"],setup(m){const v=m,{t:y}=se(),p=D(()=>{const t={...v.data};return delete t._json,{id:t.id,session:t.session,event:t.event,payload:t.payload,...t}});async function e(t){await navigator.clipboard.writeText(JSON.stringify(p.value,null,2)),t.preventDefault()}return(t,i)=>{const w=oe,_=Ee("vue-json-pretty"),o=ae("tooltip");return C(),$("div",Me,[l("div",Fe,[G(c(w,{rounded:"",text:"",icon:"pi pi-copy",severity:"secondary",onClick:i[0]||(i[0]=b=>e(b))},null,512),[[o,{value:n(y)("monitor.copiedToClipboard")},void 0,{focus:!0,bottom:!0}]])]),l("div",Je,[c(_,{data:n(p),deep:2,showLine:!1,showIcon:!0,theme:"dark"},null,8,["data"])])])}}},We={key:0,class:"pi pi-angle-down"},He={key:1,class:"pi pi-angle-up"},ze={__name:"expand",props:["rows","data"],setup(m){const v=m,y=D(()=>{var p;return!((p=v.rows)!=null&&p[v.data.id])});return(p,e)=>n(y)?(C(),$("i",We)):(C(),$("i",He))}};var re={exports:{}};(function(m,v){(function(y,p){m.exports=p()})(pe,function(){return function y(p,e,t){var i=window,w="application/octet-stream",_=t||w,o=p,b=!e&&!t&&o,a=document.createElement("a"),I=function(u){return String(u)},x=i.Blob||i.MozBlob||i.WebKitBlob||I,f=e||"download",g,S;if(x=x.call?x.bind(i):Blob,String(this)==="true"&&(o=[o,_],_=o[0],o=o[1]),b&&b.length<2048&&(f=b.split("/").pop().split("?")[0],a.href=b,a.href.indexOf(b)!==-1)){var R=new XMLHttpRequest;return R.open("GET",b,!0),R.responseType="blob",R.onload=function(u){y(u.target.response,f,w)},setTimeout(function(){R.send()},0),R}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(o))if(o.length>1024*1024*1.999&&x!==I)o=L(o),_=o.type||w;else return navigator.msSaveBlob?navigator.msSaveBlob(L(o),f):T(o);else if(/([\x80-\xff])/.test(o)){var k=0,U=new Uint8Array(o.length),F=U.length;for(k;k<F;++k)U[k]=o.charCodeAt(k);o=new x([U],{type:_})}g=o instanceof x?o:new x([o],{type:_});function L(u){var O=u.split(/[:;,]/),V=O[1],s=O[2]=="base64"?atob:decodeURIComponent,d=s(O.pop()),h=d.length,N=0,J=new Uint8Array(h);for(N;N<h;++N)J[N]=d.charCodeAt(N);return new x([J],{type:V})}function T(u,O){if("download"in a)return a.href=u,a.setAttribute("download",f),a.className="download-js-link",a.innerHTML="downloading...",a.style.display="none",document.body.appendChild(a),setTimeout(function(){a.click(),document.body.removeChild(a),O===!0&&setTimeout(function(){i.URL.revokeObjectURL(a.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(u)&&(u="data:"+u.replace(/^data:([\w\/\-\+]+)/,w)),window.open(u)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=u),!0;var V=document.createElement("iframe");document.body.appendChild(V),!O&&/^data:/.test(u)&&(u="data:"+u.replace(/^data:([\w\/\-\+]+)/,w)),V.src=u,setTimeout(function(){document.body.removeChild(V)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(g,f);if(i.URL)T(i.URL.createObjectURL(g),!0);else{if(typeof g=="string"||g.constructor===I)try{return T("data:"+_+";base64,"+i.btoa(g))}catch{return T("data:"+_+","+encodeURIComponent(g))}S=new FileReader,S.onload=function(u){T(this.result)},S.readAsDataURL(g)}return!0}})})(re);var Ge=re.exports;const Ke=me(Ge),K=m=>(Oe("data-v-9b021f7c"),m=m(),$e(),m),qe={class:"mb-4"},Qe={class:"flex align-items-center gap-1"},Xe=K(()=>l("i",{class:"pi pi-eye"},null,-1)),Ye={class:"mr-1"},Ze={class:"m-0"},et=K(()=>l("br",null,null,-1)),tt={class:"pi pi-info-circle"},ot={class:"flex justify-content-between align-items-center flex-column sm:flex-row gap-2 sm:gap-0"},nt={class:"flex flex-column sm:flex-row gap-2"},st={class:"flex gap-2"},at={class:"flex align-items-center justify-content-center"},rt={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-2"},lt={class:"p-4 text-center text-se"},it=K(()=>l("i",{class:"pi pi-spin pi-spinner"},null,-1)),ct={class:"event-viewer"},dt={__name:"EventTable",setup(m){const v=Ne(),y=te(),{servers:p}=Te(y),e=j(null),{t}=se();De(async()=>{var h;for(let N=0;N<30;N++)p.value.length===0&&await ve(100);p.value.length>0&&(e.value=(h=p.value)==null?void 0:h[0].id,k())});const i=j([]),w=["engine.event","group.join","group.leave"],_=Y.filter(s=>!w.includes(s)),o=j({global:{value:null,matchMode:H.CONTAINS},event:{value:_,matchMode:H.IN},session:{value:null,matchMode:H.CONTAINS}}),b=["_json"],a=j(!1);function I(s){s.timestamp=s.timestamp||Date.now(),s._json=s._json||JSON.stringify(s),i.value.push(s)}Z(e,()=>{a.value&&(T(),k())});const x=D(()=>{var s;return o.value.event.value?(s=o.value.event.value)==null?void 0:s.includes("engine.event"):!0});Z(x,()=>{a.value&&(T(),k())});let f=null;const g=j(B.DISCONNECTED),S=j({}),R=s=>{const d=S.value[s.data.id]===void 0||!S.value[s.data.id],h={...S.value};d?h[s.data.id]=!0:delete h[s.data.id],S.value={...h}},k=()=>{a.value=!0,U()};function U(){if(!a.value)return;if(!e.value){v.add({severity:"warn",summary:"No server selected",detail:"Please select a server to start listening"});return}if(f){v.add({severity:"warn",summary:"Already listening",detail:"Please stop the current listener before starting a new one or refresh the page"});return}const s=y.getServer(e.value),d=["*"];x.value&&d.push("engine.event"),f=new fe(s,d),f.connect(),g.value=B.CONNECTING,f.on("open",()=>{g.value=B.CONNECTED}),f.on("close",()=>{g.value=B.DISCONNECTED,F()}),f.on("error",()=>{g.value=B.ERROR,F()}),f.on("event",I)}function F(){L(),setTimeout(()=>{U()},300)}function L(){f==null||f.stop(),f=null}const T=()=>{a.value=!1,L(),g.value=B.DISCONNECTED},u=()=>{i.value=[]},O=D(()=>{const s=i.value.length;return t("monitor.cleanEvents",{count:s})});function V(s){Ke(JSON.stringify(i.value,null,2),"events.json","text/plain")}return(s,d)=>{const h=oe,N=he,J=ye,q=we,le=be,M=Ce,ie=xe,ce=Ue,de=Le,ue=Ve,Q=ae("tooltip");return C(),$(z,null,[l("div",qe,[l("h5",Qe,[Xe,l("span",Ye,A(n(t)("monitor.title")),1)]),l("div",null,[l("p",Ze,[ee(A(n(t)("monitor.description"))+" ",1),et,ee(" "+A(n(t)("monitor.purpose"))+" ",1),G(l("i",tt,null,512),[[Q,n(t)("monitor.realTimeOnly")]])])])]),c(ue,{value:i.value,dataKey:"id",expandedRows:S.value,"onUpdate:expandedRows":d[4]||(d[4]=r=>S.value=r),rowHover:!0,paginator:"",rows:20,rowsPerPageOptions:[20,50,100,200,500],filters:o.value,"onUpdate:filters":d[5]||(d[5]=r=>o.value=r),filterDisplay:"row",globalFilterFields:b,showGridlines:"",style:{"white-space":"nowrap"},sortField:"timestamp",sortOrder:-1,resizableColumns:"",class:"p-datatable--clickable",onRowClick:R},{header:E(()=>[l("div",ot,[l("div",nt,[l("div",st,[a.value?(C(),W(h,{key:1,label:n(t)("monitor.pause"),icon:"pi pi-pause",severity:"secondary",onClick:T},null,8,["label"])):(C(),W(h,{key:0,label:n(t)("monitor.listen"),icon:"pi pi-play",severity:"success",onClick:k},null,8,["label"])),c(N,{placeholder:n(t)("monitor.selectServer"),modelValue:e.value,"onUpdate:modelValue":d[0]||(d[0]=r=>e.value=r),showClear:!1},null,8,["placeholder","modelValue"])]),l("div",at,[c(ge,{status:g.value},null,8,["status"])])]),l("div",rt,[G(c(h,{icon:"pi pi-download",label:n(t)("monitor.download"),onClick:d[1]||(d[1]=r=>V(r))},null,8,["label"]),[[Q,n(t)("monitor.downloadTooltip")]]),c(h,{label:n(O),icon:"pi pi-trash",severity:"secondary",onClick:u},null,8,["label"]),c(le,{iconPosition:"left"},{default:E(()=>[c(J,{class:"pi pi-search"}),c(q,{modelValue:o.value.global.value,"onUpdate:modelValue":d[2]||(d[2]=r=>o.value.global.value=r),placeholder:n(t)("monitor.searchInData"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1})])])]),empty:E(()=>[l("div",lt,[g.value===n(B).CONNECTED?(C(),$(z,{key:0},[l("span",null,A(n(t)("monitor.listeningForEvents")),1),it],64)):(C(),$(z,{key:1},[a.value?Ie("",!0):(C(),W(h,{key:0,label:n(t)("monitor.listen"),icon:"pi pi-play",severity:"success",onClick:k},null,8,["label"]))],64))])]),expansion:E(r=>[l("div",ct,[c(Pe,{data:r.data},null,8,["data"])])]),default:E(()=>[c(M,{style:{width:"3rem"}},{body:E(({data:r})=>[c(ze,{rows:S.value,data:r},null,8,["rows","data"])]),_:1}),c(M,{field:"event",header:n(t)("monitor.eventColumn"),"show-filter-menu":!1},{filter:E(({filterModel:r,filterCallback:X})=>[c(ie,{id:"events",modelValue:r.value,"onUpdate:modelValue":P=>r.value=P,placeholder:n(t)("monitor.any"),"max-selected-labels":1,selectedItemsLabel:n(t)("monitor.eventsSelected"),onChange:P=>X(),options:n(Y),showClear:!0,required:!1},null,8,["modelValue","onUpdate:modelValue","placeholder","selectedItemsLabel","onChange","options"])]),body:E(({data:r})=>[c(ce,{event:r.event},null,8,["event"])]),_:1},8,["header"]),c(M,{field:"session",header:n(t)("monitor.sessionColumn"),"show-filter-menu":!1},{filter:E(({filterModel:r,filterCallback:X})=>[c(q,{modelValue:o.value.session.value,"onUpdate:modelValue":d[3]||(d[3]=P=>o.value.session.value=P),placeholder:n(t)("monitor.sessionColumn"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["header"]),c(M,{field:"timestamp",header:n(t)("monitor.timeColumn"),sortable:""},{body:E(({data:r})=>[l("span",null,A(n(Be)(r.timestamp)),1)]),_:1},8,["header"]),c(M,{header:n(t)("monitor.detailColumn"),"show-filter-menu":!1},{body:E(({data:r})=>[c(de,{data:r},null,8,["data"])]),_:1},8,["header"])]),_:1},8,["value","expandedRows","filters"])],64)}}},ut=ne(dt,[["__scopeId","data-v-9b021f7c"]]),pt={class:"grid"},mt={class:"col-12"},vt={class:"card"},Yt={__name:"event-monitor",setup(m){const v=te();return Re(()=>{v.refresh()}),(y,p)=>(C(),$("div",pt,[l("div",mt,[l("div",vt,[c(ut)])])]))}};export{Yt as default};
