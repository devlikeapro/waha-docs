import{l as R,u as q,a as J,_ as X}from"./Hh9f8yKD.js";import L from"./-ljNKFgD.js";import Z from"./mIuDQZZ3.js";import A from"./86vxX2CF.js";import ee from"./T3K0J0jK.js";import ne from"./j9gGEQ7c.js";import{_ as oe,u as j,a as te}from"./B4MhIwOf.js";import se from"./BHQMsfIX.js";import{c as K,t as a,v as y,Q as le,P as h,M as v,N as F,R as P,r as b,A as i,z as t,x as o,B as g,O as w,S as ie,T as re,U as ae,L as ce,V as ue,y as I,W as de}from"./D8ZcFDtt.js";import ve from"./uF64Cm4B.js";import pe from"./BOy_UrD7.js";import me from"./D9MBE91a.js";import _e from"./BiYJeNR8.js";import fe from"./DRA93YmO.js";const be={__name:"ServerSessionSummary",props:{sessions:{required:!0}},setup(k){const m=k,n=K(()=>R.groupBy(m.sessions||[],"status"));return(S,_)=>{const r=oe;return a(!0),y(F,null,le(v(n),(c,d)=>(a(),h(r,{key:d+c.length,status:d,value:`${d}: ${c.length}`},null,8,["status","value"]))),128)}}},he={class:"mb-4"},ye=o("b",null,"browser's local storage",-1),ge=o("br",null,null,-1),ke={class:"field"},Se=o("label",{for:"name"},"Name",-1),$e={key:0,class:"p-invalid"},we={class:"field"},Ce=o("label",{for:"connection-url"},"API URL",-1),xe={key:0,class:"p-invalid"},Ve={key:1,class:"p-invalid"},Ie={class:"field"},De=o("label",{for:"connection-key"},"API Key (optional)",-1),Me={__name:"ServerDialog",props:{visible:{},visibleModifiers:{},server:{},serverModifiers:{}},emits:["update:visible","update:server"],setup(k){const m=P(k,"visible"),n=P(k,"server"),S=q(),_=j(),r=b(!1),c=K(()=>{var l;const f=(l=n.value.connection)==null?void 0:l.url;return f?f.startsWith("http://")||f.startsWith("https://"):!1});async function d(){r.value=!0,!(!n.value.name||!c.value)&&(n.value.id?await _(S.editServer(n.value.id,n.value),"Server updated","Failed to update server"):await _(S.addServer(n.value),"Connected to server","Failed to connect to server"),p(),n.value={connection:{}})}function p(){r.value=!1,m.value=!1}return(f,l)=>{const D=me,C=A,x=_e,V=L,M=fe;return a(),h(M,{visible:m.value,"onUpdate:visible":l[3]||(l[3]=s=>m.value=s),header:"Server",modal:!0,class:"p-fluid"},{footer:i(()=>[t(V,{label:"Cancel",icon:"pi pi-times",text:"",onClick:p,severity:"secondary"}),t(V,{label:n.value.id?"Save":"Connect",icon:{"pi pi-check":!!n.value.id,"pi pi-link":!n.value.id},text:"",onClick:d},null,8,["label","icon"])]),default:i(()=>[o("div",he,[t(D,{severity:"info"},{default:i(()=>[g(" Servers data is saved in your "),ye,g(". "),ge,g(" It's safe to put server API and key here. ")]),_:1})]),o("div",ke,[Se,t(C,{id:"name",modelValue:n.value.name,"onUpdate:modelValue":l[0]||(l[0]=s=>n.value.name=s),modelModifiers:{trim:!0},required:"true",autofocus:"",invalid:r.value&&!n.value.name},null,8,["modelValue","invalid"]),r.value&&!n.value.name?(a(),y("small",$e,"Name is required.")):w("",!0)]),o("div",we,[Ce,t(C,{id:"connection-url",modelValue:n.value.connection.url,"onUpdate:modelValue":l[1]||(l[1]=s=>n.value.connection.url=s),modelModifiers:{trim:!0},required:"true",invalid:r.value&&!v(c)},null,8,["modelValue","invalid"]),r.value&&!n.value.connection.url?(a(),y("small",xe,"URL is required.")):w("",!0),r.value&&!v(c)?(a(),y("small",Ve,"URL is not correct.")):w("",!0)]),o("div",Ie,[De,t(x,{id:"connection-key",modelValue:n.value.connection.key,"onUpdate:modelValue":l[2]||(l[2]=s=>n.value.connection.key=s),modelModifiers:{trim:!0},feedback:!1,toggleMask:""},null,8,["modelValue"])])]),_:1},8,["visible"])}}},Ne={class:"flex justify-content-between"},Ue={class:"flex align-items-center gap-1"},Fe=o("i",{class:"pi pi-server"},null,-1),Be=o("span",{class:"mr-1"}," Servers ",-1),Te=["disabled"],Pe=o("i",{class:"pi pi-refresh"},null,-1),Re=[Pe],qe={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-0"},Le=["href"],Ae=o("code",null," (",-1),je=o("code",null,")",-1),Ke={class:"flex gap-1"},Oe={class:"flex flex-row gap-2 justify-content-end"},sn={__name:"ServerTable",setup(k){const m=ie();re();const n=q(),S=j(),{servers:_,refreshing:r}=ae(n),c=b({connection:{}}),d=b(!1);b(null);const p=b({}),f=b(null);ce(()=>{l()});const l=()=>{p.value={global:{value:null,matchMode:ue.CONTAINS}}};function D(){c.value={connection:{}},d.value=!0}function C(s){x(s.data)}function x(s){c.value=R.cloneDeep(s),d.value=!0}function V(s,u){m.require({target:s.target,message:`Disconnect '${u.name}?'`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-warning p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Disconnect",accept:()=>S(n.deleteServer(u.id),"Disconnected","Failed to disconnect server"),reject:()=>{}})}function M(){J("store",async()=>await n.refresh())}return(s,u)=>{const O=X,N=L,W=Z,z=A,E=ee,$=ne,U=te,B=se,G=be,H=ve,Q=pe,Y=Me;return a(),y(F,null,[o("div",Ne,[o("div",null,[o("h5",Ue,[Fe,Be,t(O,{refreshing:v(r)},null,8,["refreshing"])])]),o("div",null,[o("button",{onClick:M,class:"p-link layout-topbar-button",disabled:v(r)},Re,8,Te)])]),t(Q,{value:v(_).length>0?v(_):[],paginator:!0,rows:10,dataKey:"id",rowHover:!0,filters:p.value,"onUpdate:filters":u[1]||(u[1]=e=>p.value=e),filterDisplay:"menu",loading:f.value,globalFilterFields:["name","id","connection.url"],showGridlines:"",onRowClick:C,class:"p-datatable--clickable",style:{"white-space":"nowrap"}},{header:i(()=>[o("div",qe,[t(N,{label:"Connect",icon:"pi pi-link",severity:"success",onClick:D}),t(E,{iconPosition:"left"},{default:i(()=>[t(W,{class:"pi pi-search"}),t(z,{modelValue:p.value.global.value,"onUpdate:modelValue":u[0]||(u[0]=e=>p.value.global.value=e),placeholder:"Keyword Search",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])]),empty:i(()=>[g(" No servers found")]),loading:i(()=>[g(" Loading servers...")]),default:i(()=>[t($,{field:"name",header:"Name"},{body:i(({data:e})=>[g(I(e.name),1)]),_:1}),t($,{header:"API"},{body:i(({data:e})=>[o("div",null,[t(U,{connected:e.connected},null,8,["connected"]),o("a",{class:"ml-1",href:e.connection.url,target:"_blank"},I(e.connection.url),9,Le)])]),_:1}),t($,{header:"Info"},{body:i(({data:e})=>[e.connected===void 0?(a(),h(B,{key:0,width:"9rem"})):e.connected===!1?(a(),h(U,{key:1,connected:e.connected},null,8,["connected"])):(a(),y(F,{key:2},[o("code",null,I(e.version.engine),1),Ae,o("code",{class:de({"text-orange-400":e.version.version!==v(n).latestVersion})},I(e.version.version),3),je],64))]),_:1}),t($,{header:"Sessions"},{body:i(({data:e})=>[o("div",Ke,[e.connected===void 0?(a(),h(B,{key:0,width:"10rem"})):w("",!0),e.connected===!1?(a(),h(U,{key:1,connected:e.connected},null,8,["connected"])):w("",!0),t(G,{sessions:v(n).sessions.get(e.id)},null,8,["sessions"])])]),_:1}),t($,null,{body:i(({data:e})=>[o("div",Oe,[t(N,{icon:"pi pi-pencil",severity:"success",rounded:"",outlined:"",onClick:T=>x(e)},null,8,["onClick"]),t(H),t(N,{icon:"pi pi-times",severity:"warning",rounded:"",outlined:"",onClick:T=>V(T,e)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","filters","loading","globalFilterFields"]),t(Y,{visible:d.value,"onUpdate:visible":u[2]||(u[2]=e=>d.value=e),server:c.value,"onUpdate:server":u[3]||(u[3]=e=>c.value=e)},null,8,["visible","server"])],64)}}};export{sn as _};
