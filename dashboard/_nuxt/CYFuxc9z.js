import{u as he,_ as Be}from"./Bgz-yOjo.js";import A from"./N2dL0rFw.js";import _s from"./5hW03kFQ.js";import{u as H,a as bs,s as ye,l as X}from"./B3OsGzY7.js";import{R as $e,O as q,N as p,t as l,v as S,P as I,x as e,z as t,W as Se,_ as re,T as N,X as ue,y as M,c as B,L as T,U as R,r as y,A as v,Y as gs,B as j,Z as hs,$ as ys,o as Ie,C as $s,D as Ss,a0 as G,Q as we,a1 as le,H as de,i as Oe,a2 as ws,a3 as je,a4 as xs,a5 as ks,V as Cs,S as ae,a6 as Vs}from"./DaB_32Hj.js";import Me from"./Dqms_tsx.js";import Ds from"./BCnzu6KE.js";import ne from"./CEoi542n.js";import Rs from"./edLE0BYc.js";import Ne from"./D3vCFn11.js";import Us from"./CnTqBIr6.js";import Pe from"./D9IdEWkv.js";import Ee from"./BNZ0kLuf.js";import Ls from"./BLSGc8XS.js";import{u as xe,_ as Ae}from"./CSSzcoxy.js";import ke from"./CdwSwEye.js";import{a as Ts,_ as qe}from"./D-FLcrU5.js";import He from"./S_pEdn3g.js";import Bs from"./ukb_wYuX.js";import Fe from"./CFebDbKQ.js";import{_ as Is}from"./BCSDj2Tz.js";import Os from"./DZuGLz93.js";import We from"./DEEiGtFq.js";import Ce from"./DnAIWjlr.js";import js from"./DzkG2adz.js";import Ms from"./DMAL8Z9v.js";import Ke from"./Bfmodsq2.js";import ze from"./rfXTlimk.js";import Qe from"./ErzeZYis.js";import Ns from"./DgefeTJa.js";import Ps from"./D5Ov1eRk.js";import Es from"./BOtF1PgY.js";import As from"./CPS6mhnW.js";function qs(o){return o?Object.keys(o).map(n=>({key:n,value:o[n]})):[]}function Hs(o){return o.reduce((n,i)=>(n[i.key]=i.value,n),{})}const Fs={key:0},Ws={key:1,class:"ml-auto flex align-items-center gap-2 mr-2"},Ks=e("label",{for:"show-duplicates"},"Hide Duplicates",-1),zs={class:"pi pi-info-circle"},Qs={__name:"HideDuplicates",setup(o){const n=H(),{hideDuplicatedSessions:i,servers:s}=$e(n);return n.$subscribe((r,f)=>{bs(f.hideDuplicatedSessions)}),(r,f)=>{const d=_s,m=q("tooltip");return p(s)&&p(s).length<2?(l(),S("div",Fs)):(l(),S("div",Ws,[Ks,I(e("i",zs,null,512),[[m,`Hide STOPPED sessions with the same "name" .
Useful when you use multiple workers with the same database`]]),t(d,{id:"show-duplicates",modelValue:p(i),"onUpdate:modelValue":f[0]||(f[0]=a=>Se(i)?i.value=a:null)},null,8,["modelValue"])]))}}},Xs={class:"metadata"},Gs={__name:"Metadata",props:["metadata"],setup(o){return(n,i)=>(l(),S("div",Xs,[(l(!0),S(N,null,ue(o.metadata,(s,r)=>(l(),S("pre",{key:r},M(r)+"="+M(s),1))),128))]))}},Ys=re(Gs,[["__scopeId","data-v-cb7cbf08"]]),Js={class:"text-center p-1"},Zs={class:"text-center"},Xe={__name:"SessionChip",props:{session:Object,image:String},setup(o){const n=o,i=B(()=>{if(n.session.me)return`${n.session.me.id}`});return(s,r)=>{var d,m;const f=Us;return l(),S("div",null,[e("div",Js,[e("b",Zs,M((m=(d=n.session)==null?void 0:d.me)==null?void 0:m.pushName),1)]),p(i)?(l(),T(f,{key:0,label:p(i),image:o.image},null,8,["label","image"])):R("",!0)])}}},Ve={__name:"RefreshButton",props:["refreshing"],setup(o){const n=o,i=B(()=>n.refreshing?"pi pi-refresh pi-spin":"pi pi-refresh");return(s,r)=>{const f=A;return l(),T(f,{icon:p(i),rounded:"",text:"",disabled:o.refreshing},null,8,["icon","disabled"])}}},et=["src"],Ge={__name:"Base64Img",props:{data:String,mimetype:String},setup(o){const n=o,i=B(()=>`data:${n.mimetype};base64, ${n.data}`);return(s,r)=>(l(),S("img",{src:i.value,style:{"max-width":"100%"}},null,8,et))}},st={key:2,style:{"background-color":"#f8f9fa",padding:"1rem",color:"red","white-space":"pre-wrap"}},Ye={__name:"SessionScreenshot",props:{session:Object},setup(o,{expose:n}){const i=H(),s=o,{data:r,pending:f,error:d,refresh:m}=he(`session-screenshot-${s.session.server.id}-${s.session.name}`,async()=>(await ye(1e3),await i.getScreenshot(s.session.server.id,s.session.name)));return n({refresh:m}),(a,_)=>{const w=Pe,$=Ee,h=Ge;return l(),S(N,null,[p(f)?(l(),S(N,{key:0},[t(w,{mode:"indeterminate",style:{height:"3px"}}),!p(r)&&!p(d)?(l(),T($,{key:0,width:"100%",height:"20rem"})):R("",!0)],64)):R("",!0),p(r)?(l(),T(h,{key:1,data:p(r).data,mimetype:p(r).mimetype},null,8,["data","mimetype"])):R("",!0),p(d)?(l(),S("pre",st,""+M(p(d).cause.response.data.message||p(d).cause.response.data||p(d))+`
  `,1)):R("",!0)],64)}}},tt={class:"",style:{"min-width":"20rem"}},ot={class:"flex justify-content-center align-items-center"},nt=e("h5",{class:"m-0"},"Screenshot",-1),it={class:"m-auto w-full"},lt={__name:"ScreenshotButton",props:["session"],setup(o){const n=o,i=y(null),s=y(null),r=m=>{i.value.toggle(m)},f=()=>{s.value.refresh()},d=B(()=>n.session.status==="STOPPED");return(m,a)=>{const _=A,w=Ve,$=Ye,h=Ls,x=q("tooltip");return l(),S(N,null,[I(t(_,{disabled:p(d),type:"button",icon:"pi pi-camera",onClick:r,rounded:"",outlined:"",severity:"help"},null,8,["disabled"]),[[x,"Screenshot / QR",void 0,{top:!0}]]),t(h,{ref_key:"op",ref:i,appendTo:"body",showCloseIcon:!0},{default:v(()=>[e("div",tt,[e("div",ot,[nt,t(w,{onClick:f})]),e("div",it,[t($,{ref_key:"screenshot",ref:s,session:o.session},null,8,["session"])])])]),_:1},512)],64)}}},at={class:"flex flex-row gap-2 justify-content-end"},Je={__name:"SessionActionButtons",props:["name","isStarting","isRestarting","isStopping","isLoggingOut","isRemoving","allDisabled","hideActions","skipConfirmation","group"],emits:["view","start","restart","stop","logout","delete"],setup(o,{emit:n}){const i=gs(),s=o,r=n;function f(h){return s.skipConfirmation?!s.skipConfirmation.includes(h):!0}async function d(){if(!f("start")){r("start");return}i.require({group:s.group,target:event.target,message:`Start ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-success p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Start",accept:()=>{r("start")},reject:()=>{}})}const m=B(()=>s.hideActions?!s.hideActions.includes("view"):!0);function a(h){i.require({group:s.group,target:h.target,message:`Restart ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-info p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Restart",accept:()=>{r("restart")},reject:()=>{}})}function _(h){i.require({group:s.group,target:h.target,message:`Stop ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-warning p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Stop",accept:async()=>{r("stop")},reject:()=>{}})}function w(h){i.require({group:s.group,target:h.target,message:`Logout ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-warning p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Logout",accept:async()=>{r("logout")},reject:()=>{}})}function $(h){i.require({group:s.group,target:h.target,message:`Delete ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Delete",accept:async()=>{r("delete")},reject:()=>{}})}return(h,x)=>{const k=A,U=He,c=Bs,V=q("tooltip");return l(),S(N,null,[e("div",at,[p(m)?I((l(),T(k,{key:0,icon:"pi pi-cog",severity:"help",rounded:"",outlined:"",onClick:x[0]||(x[0]=O=>h.$emit("view")),disabled:o.allDisabled},null,8,["disabled"])),[[V,"Configuration",void 0,{top:!0}]]):R("",!0),I(t(k,{icon:"pi pi-play",severity:"success",rounded:"",outlined:"",onClick:d,loading:o.isStarting,disabled:o.allDisabled},null,8,["loading","disabled"]),[[V,"Start",void 0,{top:!0}]]),I(t(k,{icon:"pi pi-replay",severity:"info",rounded:"",outlined:"",onClick:x[1]||(x[1]=O=>a(O)),loading:o.isRestarting,disabled:o.allDisabled},null,8,["loading","disabled"]),[[V,"Restart",void 0,{top:!0}]]),I(t(k,{icon:"pi pi-stop",severity:"secondary",rounded:"",outlined:"",onClick:x[2]||(x[2]=O=>_(O)),loading:o.isStopping,disabled:o.allDisabled},null,8,["loading","disabled"]),[[V,"Stop",void 0,{top:!0}]]),I(t(k,{icon:"pi pi-sign-out",severity:"warning",rounded:"",outlined:"",onClick:x[3]||(x[3]=O=>w(O)),loading:o.isLoggingOut,disabled:o.allDisabled},null,8,["loading","disabled"]),[[V,"Logout",void 0,{top:!0}]]),I(t(k,{icon:"pi pi-trash",severity:"danger",rounded:"",outlined:"",onClick:x[4]||(x[4]=O=>$(O)),loading:o.isRemoving,disabled:o.allDisabled},null,8,["loading","disabled"]),[[V,"Delete",void 0,{top:!0}]])]),o.group==="popup"?(l(),T(U,{key:0,group:"popup"})):R("",!0),o.group==="dialog"?(l(),T(c,{key:1,group:"dialog"})):R("",!0)],64)}}},rt={class:"flex flex-row gap-2 justify-content-end"},ut={__name:"SessionActions",props:["session","disabled"],setup(o,{expose:n}){const i=o,s=H(),r=xe(),f=y(!1),d=y(!1),m=y(!1),a=y(!1),_=y(!1),w=B(()=>i.disabled||f.value||d.value||m.value||a.value||_.value);async function $(){const c=i.session;a.value=!0,await r(s.startSession(c.server.id,c.name),"Started","Failed to start session",c.name,c.name).finally(()=>a.value=!1)}async function h(){const c=i.session;_.value=!0,await r(s.restartSession(c.server.id,c.name),"Restarted","Failed to restart session",c.name,c.name).finally(()=>_.value=!1)}async function x(){const c=i.session;f.value=!0,await r(s.stopSession(c.server.id,c.name),"Stopped","Failed to stop session",c.name,c.name).finally(()=>f.value=!1)}async function k(){const c=i.session;d.value=!0,await r(s.logoutSession(c.server.id,c.name),"Logged out","Failed to logout session",c.name,c.name).finally(()=>d.value=!1)}async function U(){const c=i.session;m.value=!0,await r(s.deleteSession(c.server.id,c.name),"Deleted","Failed to delete session",c.name,c.name).finally(()=>m.value=!1)}return n({startSession:$,restartSession:h,stopSession:x,logoutSession:k,deleteSession:U}),(c,V)=>{const O=Je;return l(),S("div",rt,[t(O,{group:"popup",name:`'${o.session.name}' session`,onView:V[0]||(V[0]=E=>c.$emit("view",o.session)),onStart:$,onRestart:h,onStop:x,onLogout:k,onDelete:U,"is-starting":p(a),"is-restarting":p(_),"is-stopping":p(f),"is-logging-out":p(d),"is-removing":p(m),"all-disabled":p(w),"hide-actions":[],"skip-confirmation":["start"]},null,8,["name","is-starting","is-restarting","is-stopping","is-logging-out","is-removing","all-disabled"])])}}},dt={class:"p-dialog-title flex gap-2 align-items-center"},ct=e("i",{class:"pi pi-whatsapp"},null,-1),pt=e("span",null,"(",-1),mt={class:"ml-1"},vt=e("span",null,")",-1),ft=["disabled"],_t=e("i",{class:"pi pi-refresh"},null,-1),bt=[_t],De={__name:"SessionHeader",props:{session:Object,refresh:Boolean},setup(o){const n=o,i=H(),{refreshing:s}=$e(i),r=B(()=>n.session.server.id?n.session.server:i.getServer(n.session.server));async function f(){await i.refresh()}return(d,m)=>{var h,x;const a=Ae,_=Is,w=Be,$=q("tooltip");return l(),S("div",dt,[ct,e("span",null,M((h=o.session)==null?void 0:h.name),1),t(a,{status:o.session.status,value:(x=o.session.status)==null?void 0:x.toUpperCase()},null,8,["status","value"]),e("div",null,[pt,t(_,{connected:r.value.connected},null,8,["connected"]),e("span",mt,M(r.value.name),1),vt]),o.refresh?I((l(),S("button",{key:0,onClick:m[0]||(m[0]=k=>f()),class:"p-link layout-topbar-button",disabled:p(s)},bt,8,ft)),[[$,"Refresh",void 0,{top:!0}]]):R("",!0),t(w,{refreshing:p(s)},null,8,["refreshing"])])}}},gt={class:"-mt-4 p-0 line-height-3 block",style:{"font-family":"monaco, Consolas, 'Lucida Console', monospace"}},ht={__name:"CodeHighlight",props:["invalid"],setup(o){const n=o,i=B(()=>n.invalid?"p-invalid p-component p-inputtext":"");return(s,r)=>(l(),S("pre",{class:ys(["border-round surface-ground text-900 p-5 overflow-auto",i.value])},[j("        "),e("code",gt,[hs(s.$slots,"default")])],2))}},Re=o=>($s("data-v-aa1b18ec"),o=o(),Ss(),o),yt={class:"h-full flex flex-column"},$t={class:"flex justify-content-center align-items-center"},St=Re(()=>e("h5",{class:"m-0"},"Request",-1)),wt={class:"flex flex-column justify-content-between h-full"},xt={class:"flex flex-column gap-2"},kt={class:"flex gap-2"},Ct={class:"text-center"},Vt=Re(()=>e("div",{class:"mb-2"},"Body",-1)),Dt={class:"text-center mt-2"},Rt={class:"flex flex-column h-full"},Ut={class:"flex justify-content-center align-items-center"},Lt=Re(()=>e("h5",{class:"m-0"},"Response",-1)),Tt={__name:"SessionRequestResponse",props:["session"],setup(o){const n=H(),i=o,s=y(null),r=y("POST"),f=y("/api/sendText"),d=y(""),m=y(!1),a=y(!1);function _(c){return JSON.stringify(c,null,2)}function w(c){try{return JSON.parse(c)}catch{return c}}const $=B(()=>({method:r.value,uri:f.value,params:void 0,body:w(d.value)})),h=["GET","POST","PUT","DELETE","PATCH"];async function x(c){await navigator.clipboard.writeText(s.value),c.preventDefault()}async function k(c){await navigator.clipboard.writeText(_($.value)),c.preventDefault()}async function U(){try{a.value=!1,m.value=!0;const c=await n.callServerAPI(i.session.server.id,$.value);s.value=_(c)}catch(c){a.value=!0,c.response?s.value=_(c.response.data):s.value=_(c)}finally{m.value=!1}}return Ie(()=>{const c={chatId:"11111111111@c.us",text:"Hi there!",session:i.session.name};d.value=_(c),s.value="..."}),(c,V)=>{const O=A,E=ke,D=ne,se=Os,F=We,W=ht,Y=q("tooltip");return l(),S(N,null,[e("div",null,[e("div",yt,[e("div",$t,[St,I(t(O,{rounded:"",text:"",tabindex:0,icon:"pi pi-copy",onClick:V[0]||(V[0]=C=>k(C))},null,512),[[Y,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),e("div",wt,[e("div",xt,[e("div",kt,[t(E,{modelValue:r.value,"onUpdate:modelValue":V[1]||(V[1]=C=>r.value=C),options:h},null,8,["modelValue"]),t(D,{type:"text",class:"w-full",modelValue:f.value,"onUpdate:modelValue":V[2]||(V[2]=C=>f.value=C),placeholder:"API Endpoint"},null,8,["modelValue"])]),e("div",Ct,[Vt,t(se,{modelValue:d.value,"onUpdate:modelValue":V[3]||(V[3]=C=>d.value=C),rows:"8",class:"w-full",placeholder:"Request"},null,8,["modelValue"])])]),e("div",Dt,[t(O,{onClick:U,loading:m.value,label:"Send",icon:"pi pi-send","icon-pos":"right"},null,8,["loading"])])])])]),t(F),e("div",null,[e("div",Rt,[e("div",Ut,[Lt,I(t(O,{rounded:"",text:"",tabindex:0,icon:"pi pi-copy",onClick:V[4]||(V[4]=C=>x(C))},null,512),[[Y,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),t(W,{class:"m-0 p-4 pretty",invalid:a.value},{default:v(()=>[j(M(s.value),1)]),_:1},8,["invalid"])])])],64)}}},Bt=re(Tt,[["__scopeId","data-v-aa1b18ec"]]),It={class:"grid pt-4"},Ot={class:"col-12 sm:col-6 h-full"},jt={class:"grid"},Mt={class:"col-12"},Nt={class:""},Pt={class:"flex justify-content-center align-items-center"},Et={class:"col-12"},At={class:""},qt={class:"flex justify-content-center align-items-center"},Ht=e("h5",{class:"m-0"},"Screenshot",-1),Ft={class:"m-auto w-full"},Wt={class:"col-12 sm:col-6 h-full card"},Kt={__name:"SessionControl",props:["session"],setup(o){const n=H(),i=o,s=y(null),r=()=>{s.value.refresh()},f=y(null);return Ie(()=>{var d,m;(m=(d=i.session)==null?void 0:d.me)!=null&&m.id&&n.getProfilePicture(i.session.server.id,i.session.name,i.session.me.id).then(a=>{f.value=a.profilePictureURL})}),(d,m)=>{const a=Xe,_=Ve,w=Ye,$=Bt;return l(),S("div",It,[e("div",Ot,[e("div",jt,[e("div",Mt,[e("div",Nt,[e("div",Pt,[o.session.me?(l(),T(a,{key:0,session:o.session,image:p(f)},null,8,["session","image"])):R("",!0)])])]),e("div",Et,[e("div",At,[e("div",qt,[Ht,t(_,{onClick:r})]),e("div",Ft,[t(w,{ref_key:"screenshot",ref:s,session:o.session},null,8,["session"])])])])])]),e("div",Wt,[t($,{session:o.session},null,8,["session"])])])}}},zt={__name:"SessionControlDialog",props:{visible:{},visibleModifiers:{},session:{},sessionModifiers:{}},emits:["update:visible","update:session"],setup(o){const n=G(o,"visible"),i=G(o,"session");return we(),(s,r)=>{const f=De,d=Kt,m=Ce;return l(),T(m,{visible:n.value,"onUpdate:visible":r[0]||(r[0]=a=>n.value=a),modal:!0,maximizable:""},{header:v(()=>[t(f,{session:i.value},null,8,["session"])]),default:v(()=>[t(d,{session:i.value},null,8,["session"])]),_:1},8,["visible"])}}},Qt={class:"card p-fluid"},Xt={class:"flex flex-grow-1 justify-content-center"},Gt={class:"flex flex-grow-1 justify-content-center"},Ze={__name:"KeyValueTable",props:le(["keyColumn","keyColumnName","prefix","entityName"],{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const n=G(o,"modelValue"),i=o,s=y([]),r=a=>{let{newData:_,index:w}=a;n.value[w]=_},f=a=>{let{data:_,newValue:w,field:$}=a;_[$]=w};function d(){const a=n.value.length+1,_=`${i.prefix}${a}`;n.value.unshift({[i.keyColumn]:_,value:"123"})}function m(a){n.value.splice(a,1)}return(a,_)=>{const w=ne,$=Ne,h=A,x=Fe,k=q("tooltip");return l(),S("div",Qt,[t(x,{editingRows:s.value,"onUpdate:editingRows":_[0]||(_[0]=U=>s.value=U),value:n.value,editMode:"cell",dataKey:i.keyColumn,onRowEditSave:r,onCellEditComplete:f,pt:{table:{style:"min-width: 50rem"},column:{bodycell:({state:U})=>({style:U.d_editing&&"padding-top: 0.6rem; padding-bottom: 0.6rem"})}},resizableColumns:""},{default:v(()=>[t($,{field:i.keyColumn,header:i.keyColumnName,style:{width:"40%"}},{editor:v(({data:U,field:c})=>[t(w,{modelValue:U[c],"onUpdate:modelValue":V=>U[c]=V},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["field","header"]),t($,{style:{width:"40%"},field:"value",header:"Value"},{editor:v(({data:U,field:c})=>[t(w,{modelValue:U[c],"onUpdate:modelValue":V=>U[c]=V},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t($,{style:{"min-width":"1rem"}},{header:v(()=>[e("div",Xt,[I(t(h,{label:o.entityName,text:"",icon:"pi pi-plus",severity:"success",onClick:d},null,8,["label"]),[[k,`Add ${o.entityName}`,void 0,{top:!0}]])])]),body:v(({index:U})=>[e("div",Gt,[I(t(h,{label:"",rounded:"",text:"",style:{height:"2rem",width:"2rem"},icon:"pi pi-trash",severity:"warning",onClick:c=>m(U)},null,8,["onClick"]),[[k,"Delete",void 0,{top:!0}]])])]),_:1})]),_:1},8,["editingRows","value","dataKey","pt"])])}}},Yt={class:"flex justify-content-between align-items-center w-full"},Jt={class:"field"},Zt=e("label",{for:"url"},"URL",-1),eo={class:"field mb-4"},so=e("label",{for:"events"},"Events",-1),to=e("div",{class:"font-bold mb-2"},"Retries",-1),oo={class:"flex gap-3"},no={class:"field",style:{width:"10em"}},io=e("label",{for:"retries-attempts"},"Attempts",-1),lo=e("span",{class:"pi pi-plus"},null,-1),ao=e("span",{class:"pi pi-minus"},null,-1),ro={class:"field",style:{width:"10em"}},uo=e("label",{for:"retries-delay-seconds"},"Delay, seconds",-1),co=e("span",{class:"pi pi-plus"},null,-1),po=e("span",{class:"pi pi-minus"},null,-1),mo={class:"field"},vo={for:"retries-delay-policy"},fo={class:"pi pi-info-circle"},_o={style:{"text-transform":"capitalize"}},bo={style:{"text-transform":"capitalize"}},go={class:"field"},ho=e("label",{for:"hmac"},"HMAC Key (optional)",-1),yo={class:"field"},$o={class:"field flex justify-content-between align-items-center"},So=e("div",null,[e("label",{for:"hmac"},"Custom Headers (optional)")],-1),wo={__name:"SessionWebhook",props:le({disabled:Boolean,index:Number},{webhook:{},webhookModifiers:{}}),emits:["update:webhook"],setup(o){const n=G(o,"webhook"),i=o,s=["constant","linear","exponential"],r=B(()=>{var h;const m=((h=n.value.retries)==null?void 0:h.delaySeconds)??2,a=4,_=Array.from({length:a},(x,k)=>m),w=Array.from({length:a},(x,k)=>m*(k+1)),$=Array.from({length:a},(x,k)=>m*2**k);return[`Constant: ${_.join(", ")}`,`Linear: ${w.join(", ")}`,`Exponential: ${$.join(", ")}`].join(`
`)}),f=Ts,d=y(n.value.customHeaders&&n.value.customHeaders.length>0);return de(d,(m,a)=>{if(a&&!m){n.value.customHeaders=null;return}!a&&m&&(n.value.customHeaders=[{name:"X-Header-1",value:"123"}])}),(m,a)=>{const _=A,w=ne,$=Me,h=Ns,x=ke,k=Oe("font-awesome-icon"),U=Ke,c=Ze,V=ze,O=Qe,E=q("tooltip");return l(),T(O,{activeIndex:0},{default:v(()=>[t(V,null,{header:v(()=>[e("div",Yt,[e("div",null," Webhook "+M(i.index+1),1),e("div",null,[I(t(_,{label:"",text:"",rounded:"",style:{height:"2rem",width:"2rem"},icon:"pi pi-trash",severity:"warning",onClick:a[0]||(a[0]=D=>m.$emit("remove"))},null,512),[[E,"Delete Webhook",void 0,{top:!0}]])])])]),default:v(()=>[e("div",Jt,[Zt,t(w,{id:"url",modelValue:n.value.url,"onUpdate:modelValue":a[1]||(a[1]=D=>n.value.url=D),modelModifiers:{trim:!0},required:"true",disabled:o.disabled},null,8,["modelValue","disabled"])]),e("div",eo,[so,t($,{id:"events",modelValue:n.value.events,"onUpdate:modelValue":a[2]||(a[2]=D=>n.value.events=D),options:p(f),placeholder:"Select Events","max-selected-labels":1,selectedItemsLabel:"{0} events selected",disabled:o.disabled},null,8,["modelValue","options","disabled"]),e("ul",null,[(l(!0),S(N,null,ue(n.value.events,D=>(l(),S("li",{key:D},M(D),1))),128))])]),e("div",null,[to,e("div",oo,[e("div",no,[io,t(h,{modelValue:n.value.retries.attempts,"onUpdate:modelValue":a[3]||(a[3]=D=>n.value.retries.attempts=D),inputId:"retries-delay-attempts",showButtons:"",buttonLayout:"horizontal",min:1,step:1,disabled:o.disabled},{incrementbuttonicon:v(()=>[lo]),decrementbuttonicon:v(()=>[ao]),_:1},8,["modelValue","disabled"])]),e("div",ro,[uo,t(h,{modelValue:n.value.retries.delaySeconds,"onUpdate:modelValue":a[4]||(a[4]=D=>n.value.retries.delaySeconds=D),inputId:"retries-delay-seconds",showButtons:"",buttonLayout:"horizontal",min:1,step:1,disabled:o.disabled},{incrementbuttonicon:v(()=>[co]),decrementbuttonicon:v(()=>[po]),_:1},8,["modelValue","disabled"])]),e("div",mo,[e("label",vo,[j(" Retry Policy "),I(e("i",fo,null,512),[[E,p(r)]])]),t(x,{id:"retries-delay-policy",modelValue:n.value.retries.policy,"onUpdate:modelValue":a[5]||(a[5]=D=>n.value.retries.policy=D),options:s,placeholder:"Select Retry Policy","max-selected-labels":1,disabled:o.disabled},{option:v(D=>[e("span",_o,M(D.option),1)]),value:v(D=>[e("span",bo,M(D.value),1)]),_:1},8,["modelValue","disabled"])])])]),e("div",go,[ho,t(w,{id:"hmac",modelValue:n.value.hmac.key,"onUpdate:modelValue":a[6]||(a[6]=D=>n.value.hmac.key=D),modelModifiers:{trim:!0},disabled:o.disabled},null,8,["modelValue","disabled"])]),e("div",yo,[e("div",$o,[So,t(U,{modelValue:d.value,"onUpdate:modelValue":a[7]||(a[7]=D=>d.value=D),id:"customHeaders",onLabel:"Headers On",offLabel:"Headers Off"},{icon:v(()=>[t(k,{icon:"fa-solid fa-fingerprint",class:"mr-2"})]),_:1},8,["modelValue"])]),d.value?(l(),T(c,{key:0,modelValue:n.value.customHeaders,"onUpdate:modelValue":a[8]||(a[8]=D=>n.value.customHeaders=D),"entity-name":"Header","key-column":"name","key-column-name":"Header",prefix:"X-Header-"},null,8,["modelValue"])):R("",!0)])]),_:1})]),_:1})}}},xo={class:"flex flex-column gap-2"},ko={class:"flex justify-content-between align-items-center w-full"},Co=e("h5",null,"🔄 Webhooks",-1),Vo={class:"pr-2"},Do={key:0,class:"text-300 text-center"},Ro={__name:"SessionWebhooksField",props:le({disabled:Boolean},{webhooks:{},webhooksModifiers:{}}),emits:["update:webhooks"],setup(o){const n=G(o,"webhooks");function i(){const r={url:"https://httpbin.org/post",events:["session.status","message"],hmac:{key:null},retries:{delaySeconds:2,attempts:15,policy:"exponential"},customHeaders:null};n.value.push(r)}function s(r){n.value.splice(r,1)}return(r,f)=>{const d=A,m=wo,a=q("tooltip");return l(),S("div",xo,[e("div",ko,[Co,e("div",Vo,[I(t(d,{label:"Webhook",text:"",icon:"pi pi-plus",severity:"success",onClick:i},null,512),[[a,"Add Webhook",void 0,{top:!0}]])])]),n.value.length===0?(l(),S("div",Do," No webhooks configured ")):(l(!0),S(N,{key:1},ue(n.value,(_,w)=>(l(),T(m,{webhook:n.value[w],"onUpdate:webhook":$=>n.value[w]=$,index:w,total:n.value.length,onRemove:$=>s(w),disabled:o.disabled},null,8,["webhook","onUpdate:webhook","index","total","onRemove","disabled"]))),256))])}}},Uo=e("div",null,[e("h5",null,[e("i",{class:"pi pi-whatsapp"}),j(" Create Session ")])],-1),Lo={class:"mb-2"},To=e("b",null,"Server",-1),Bo=e("b",null,"Name",-1),Io={class:"field"},Oo=e("label",{for:"server"},"Server",-1),jo={key:0,class:"p-invalid"},Mo={class:"field"},No=e("label",{for:"name"},"Name (optional)",-1),Po={key:0,class:"mb-4"},Eo=e("div",{class:"mb-3"},[e("h5",null,"🏭 Engine Settings ")],-1),Ao={class:"flex flex-column gap-2"},qo=e("div",null,[e("a",{href:"https://waha.devlike.pro/docs/engines/noweb",target:"_blank"},"Read more about NOWEB settings")],-1),Ho={class:"flex gap-2"},Fo={class:"pi pi-info-circle"},Wo={class:"field mt-4"},Ko={class:"field flex justify-content-between align-items-center"},zo=e("div",null,[e("h5",null,[e("label",{for:"proxy"},"🌐 Proxy")])],-1),Qo={key:0,class:"card mb-4"},Xo={class:"field"},Go=e("label",{for:"proxy-server"},"Server",-1),Yo={key:0,class:"p-invalid"},Jo={class:"flex gap-3"},Zo={class:"field w-full"},en=e("label",{for:"proxy-username"},"Username (optional)",-1),sn={class:"field w-full"},tn=e("label",{for:"proxy-password"},"Password (optional)",-1),on={class:"field flex justify-content-between align-items-center"},nn=e("div",null,[e("h5",null,[e("label",{for:"debug"},"🛠️ Debug")])],-1),ln={class:"w-full flex flex-column gap-2"},an={class:"flex justify-content-end"},rn={__name:"SessionDialog",props:le({mode:String},{visible:{},visibleModifiers:{},session:{},sessionModifiers:{}}),emits:["update:visible","update:session"],setup(o){var W,Y;const n=we(),i=G(o,"visible"),s=G(o,"session"),r=o,f=B(()=>r.mode==="new"),d=B(()=>r.mode==="update"),m=B(()=>d.value),a=xe(),_=H(),w=B(()=>_.getServer(s.value.server)),$=B(()=>{var C,b;return((b=(C=w.value)==null?void 0:C.version)==null?void 0:b.engine)==="NOWEB"});B(()=>{var C,b;return((b=(C=w.value)==null?void 0:C.version)==null?void 0:b.engine)==="WEBJS"});const h=y([]),x=y(!!((Y=(W=s.value.config)==null?void 0:W.proxy)!=null&&Y.server));de(s,async(C,b)=>{var z,P,te;x.value=(P=(z=C==null?void 0:C.config)==null?void 0:z.proxy)==null?void 0:P.server,h.value=qs((te=C.config)==null?void 0:te.metadata)});const k=y(!1),U=y(!1),c=B(()=>{const C=X.cloneDeep(s.value.config);return x.value||(C.proxy=void 0),C.metadata=Hs(h.value),C}),V=B(()=>{const C={...c.value};return $.value||delete C.noweb,{name:s.value.name,config:C}});async function O(){k.value=!0;try{U.value=!0;const C=X.cloneDeep(V.value);await a(_.updateSession(s.value.server,s.value.name,C.config),void 0,"Failed to update session"),n.add({severity:"success",summary:"Updated",detail:s.value.name,life:3e3})}finally{U.value=!1}s.value=void 0,D()}async function E(C){k.value=!0;try{U.value=!0;const b=X.cloneDeep(V.value);b.start=C;const z=await a(_.createSession(s.value.server,b),void 0,"Failed to start session"),P=C?"Started":"Created";n.add({severity:"success",summary:P,detail:z.name,life:3e3})}finally{U.value=!1}s.value=void 0,D()}function D(){k.value=!1,i.value=!1}const se=B(()=>s.value.status==="STOPPED");async function F(C){await navigator.clipboard.writeText(JSON.stringify({method:"POST",uri:"/api/sessions",body:V.value},null,2)),C.preventDefault()}return(C,b)=>{const z=De,P=js,te=qe,ie=ne,ce=Ms,J=Oe("font-awesome-icon"),Z=Ke,pe=ze,me=Qe,ve=Ze,fe=Ro,_e=Ps,oe=A,be=Ce,L=q("tooltip");return l(),T(be,{visible:i.value,"onUpdate:visible":b[15]||(b[15]=u=>i.value=u),modal:!0,class:"p-fluid",maximizable:""},ws({footer:v(()=>[e("div",ln,[e("div",null,[d.value&&!se.value?(l(),T(P,{key:0,severity:"warn"},{default:v(()=>[j(" The session is in '"),e("b",null,M(s.value.status)+"'",1),j(" status, in order to save configuration the session will be restarted. ")]),_:1})):R("",!0)]),e("div",an,[I(t(oe,{label:"Copy",text:"",tabindex:0,icon:"pi pi-copy",severity:"secondary",onClick:b[12]||(b[12]=u=>F(u))},null,512),[[L,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]]),d.value?R("",!0):(l(),T(oe,{key:0,label:"Create",icon:"pi pi-plus",text:"",onClick:b[13]||(b[13]=u=>E(!1)),loading:U.value},null,8,["loading"])),d.value?R("",!0):(l(),T(oe,{key:1,label:"Create & Start",icon:"pi pi-play",text:"",onClick:b[14]||(b[14]=u=>E(!0)),loading:U.value},null,8,["loading"])),d.value?(l(),T(oe,{key:2,label:"Update",icon:"pi pi-save",text:"",onClick:O,loading:U.value},null,8,["loading"])):R("",!0)])])]),default:v(()=>[e("div",Lo,[d.value?(l(),T(P,{key:0,severity:"info"},{default:v(()=>[j(" To change the "),To,j(" or "),Bo,j(" - please remove the session and run again. ")]),_:1})):R("",!0)]),e("div",Io,[Oo,t(te,{placeholder:"Select Server",modelValue:s.value.server,"onUpdate:modelValue":b[0]||(b[0]=u=>s.value.server=u),showClear:!1,required:!0,invalid:k.value&&!s.value.server,disabled:m.value},null,8,["modelValue","invalid","disabled"]),k.value&&!s.value.server?(l(),S("small",jo,"Server is required.")):R("",!0)]),e("div",Mo,[No,t(ie,{id:"name",modelValue:s.value.name,"onUpdate:modelValue":b[1]||(b[1]=u=>s.value.name=u),modelModifiers:{trim:!0},required:"false",autofocus:"",placeholder:"session_1111111111111",disabled:!f.value},null,8,["modelValue","disabled"])]),$.value?(l(),S("div",Po,[Eo,t(me,{activeIndex:0},{default:v(()=>[t(pe,{header:"NOWEB"},{header:v(()=>[j("  "),t(ce,{value:"New"})]),default:v(()=>[e("div",Ao,[qo,e("div",null,[I((l(),T(Z,{modelValue:s.value.config.noweb.markOnline,"onUpdate:modelValue":b[2]||(b[2]=u=>s.value.config.noweb.markOnline=u),onLabel:"Presence: online",offLabel:"Presence: offline",disabled:m.value},{icon:v(()=>[t(J,{icon:"fa-solid fa-sync",class:"mr-2"})]),_:1},8,["modelValue","disabled"])),[[L,"Send presence when connect for the connected session. If presence online - you don not get notifications in your phone"]])]),e("div",Ho,[e("div",null,[I((l(),T(Z,{modelValue:s.value.config.noweb.store.enabled,"onUpdate:modelValue":b[3]||(b[3]=u=>s.value.config.noweb.store.enabled=u),onLabel:"Store: Enabled",offLabel:"Store: Disabled",disabled:m.value},{icon:v(()=>[t(J,{icon:"fa-solid fa-folder",class:"mr-2"})]),_:1},8,["modelValue","disabled"])),[[L,"Store contacts, chats, messages in the database, so you can get it in API"]])]),e("div",null,[I((l(),T(Z,{modelValue:s.value.config.noweb.store.fullSync,"onUpdate:modelValue":b[4]||(b[4]=u=>s.value.config.noweb.store.fullSync=u),onLabel:"Store: Full Sync On",offLabel:"Store: Full Sync Off",disabled:m.value},{icon:v(()=>[t(J,{icon:"fa-solid fa-sync",class:"mr-2"})]),_:1},8,["modelValue","disabled"])),[[L,`Sync all contacts, chats, messages from the phone at the start.
Otherwise the store can miss some information.`]])])])])]),_:1})]),_:1})])):R("",!0),e("div",null,[e("div",null,[e("h5",null,[j("📝 Metadata "),I(e("i",Fo,null,512),[[L,"Key value pairs you can attach to Session and will receive it in webhooks, API and search the values on Dashboard."]])])]),t(ve,{modelValue:h.value,"onUpdate:modelValue":b[5]||(b[5]=u=>h.value=u),"entity-name":"Metadata","key-column":"key","key-column-name":"Key",prefix:"user.id."},null,8,["modelValue"])]),e("div",Wo,[t(fe,{ref:"webhooks",webhooks:s.value.config.webhooks,"onUpdate:webhooks":b[6]||(b[6]=u=>s.value.config.webhooks=u)},null,8,["webhooks"])]),e("div",null,[e("div",Ko,[zo,t(Z,{modelValue:x.value,"onUpdate:modelValue":b[7]||(b[7]=u=>x.value=u),id:"proxy",onLabel:"Proxy On",offLabel:"Proxy Off"},{icon:v(()=>[t(J,{icon:"fa-solid fa-server",class:"mr-2"})]),_:1},8,["modelValue"])]),x.value?(l(),S("div",Qo,[e("div",Xo,[Go,t(ie,{id:"proxy-server",modelValue:s.value.config.proxy.server,"onUpdate:modelValue":b[8]||(b[8]=u=>s.value.config.proxy.server=u),modelModifiers:{trim:!0},required:"true",invalid:k.value&&!s.value.config.proxy.server,placeholder:"host:port"},null,8,["modelValue","invalid"]),k.value&&!s.value.config.proxy.server?(l(),S("small",Yo,"Server is required.")):R("",!0)]),e("div",Jo,[e("div",Zo,[en,t(ie,{id:"proxy-username",modelValue:s.value.config.proxy.username,"onUpdate:modelValue":b[9]||(b[9]=u=>s.value.config.proxy.username=u),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e("div",sn,[tn,t(_e,{id:"proxy-password",modelValue:s.value.config.proxy.password,"onUpdate:modelValue":b[10]||(b[10]=u=>s.value.config.proxy.password=u),modelModifiers:{trim:!0},feedback:!1,toggleMask:""},null,8,["modelValue"])])])])):R("",!0)]),e("div",on,[nn,t(Z,{modelValue:s.value.config.debug,"onUpdate:modelValue":b[11]||(b[11]=u=>s.value.config.debug=u),onLabel:"Debug Enabled",offLabel:"Debug Disabled",onIcon:"fa fa-bug"},{icon:v(()=>[t(J,{icon:"fa-solid fa-bug",class:"mr-2"})]),_:1},8,["modelValue"])])]),_:2},[f.value?{name:"header",fn:v(()=>[Uo]),key:"0"}:void 0,f.value?void 0:{name:"header",fn:v(()=>[e("div",null,[t(z,{session:s.value},null,8,["session"])])]),key:"1"}]),1032,["visible"])}}},un=["WORKING","FAILED","STARTING","SCAN_QR_CODE","STOPPED"],dn={class:"",style:{"min-width":"20rem"}},cn={class:"flex justify-content-center align-items-center"},pn=e("h5",{class:"m-0"},"QR",-1),mn={class:"m-auto w-full"},vn={class:"flex justify-content-center"},fn={key:1,style:{"background-color":"#f8f9fa",padding:"1rem",color:"red","white-space":"pre-wrap"}},_n={__name:"QRImage",props:{session:Object},setup(o){const n=H(),i=o,{data:s,pending:r,error:f,refresh:d}=he(`session-qr-${i.session.server.id}-${i.session.name}`,async()=>(await ye(1e3),await n.getQR(i.session.server.id,i.session.name)));return(m,a)=>{const _=Ve,w=Pe,$=Ee,h=Ge;return l(),S("div",dn,[e("div",cn,[pn,t(_,{onClick:p(d)},null,8,["onClick"])]),e("div",mn,[p(r)?(l(),S(N,{key:0},[t(w,{mode:"indeterminate",style:{height:"3px"}}),!p(s)&&!p(f)?(l(),T($,{key:0,width:"100%",height:"20rem"})):R("",!0)],64)):R("",!0),e("div",vn,[p(s)?(l(),T(h,{key:0,data:p(s).data,mimetype:p(s).mimetype},null,8,["data","mimetype"])):R("",!0),p(f)?(l(),S("pre",fn,""+M(p(f).cause.response.data.message||p(f).cause.response.data||p(f))+`
  `,1)):R("",!0)])])])}}},bn={},gn={class:"pl-4"},hn=je('<li> Open <b>WhatsApp</b> on your phone </li><li> Tap <b>More options</b> <i class="pi pi-ellipsis-v"></i> or <b>Settings</b> <i class="pi pi-cog"></i></li><li> Tap <b>Linked Devices</b> &gt; <b>Link a device</b></li><li><b>Link with phone number instead</b> and enter the code </li>',4),yn=[hn];function $n(o,n){return l(),S("ul",gn,yn)}const Sn=re(bn,[["render",$n]]),wn={class:"flex flex-column gap-2 mt-4"},xn={class:"flex justify-content-between gap-2"},kn={class:"field"},Cn={class:"card flex justify-content-center align-items-center"},Vn={class:"mx-1",style:{"font-size":"2rem"}},Dn={__name:"PairingCodeSteps",props:["session"],setup(o){const n=o,i=y(null),s=y(!1),r=y("XXXX-XXXX"),f=xe(),d=H();function m(_){return _.replace(/\D/g,"")}async function a(){i.value=m(i.value),s.value=!0;try{await ye(1e3);const _=await f(d.getPairingCode(n.session.server.id,n.session.name,i.value),"Request sent","Failed to request code",n.session.name,n.session.name);r.value=_.code}finally{s.value=!1}}return de(i,X.debounce(_=>{i.value=m(_)},1e3)),(_,w)=>{const $=ne,h=A,x=We;return l(),S(N,null,[e("div",wn,[e("form",{onSubmit:xs(a,["prevent"])},[e("div",xn,[e("div",kn,[t($,{id:"phone","input-id":"phone",name:"phone",modelValue:p(i),"onUpdate:modelValue":w[0]||(w[0]=k=>Se(i)?i.value=k:null),modelModifiers:{trim:!0},useGrouping:!1,required:"true",autofocus:"",placeholder:"1213213213 (no +, no dashes -)"},null,8,["modelValue"])]),e("div",null,[t(h,{type:"submit",label:"Show Code",icon:"pi pi-send",loading:p(s)},null,8,["loading"])])])],32)]),p(r)?(l(),S(N,{key:0},[t(x),e("div",null,[t(Sn)]),e("div",Cn,[e("div",null,[p(r)?(l(!0),S(N,{key:0},ue(p(r),k=>(l(),S("span",Vn,M(k),1))),256)):R("",!0)])])],64)):R("",!0)],64)}}},Rn={},Un={class:"pl-4"},Ln=je('<li> Open <b>WhatsApp</b> on your phone </li><li> Tap <b>More options</b> <i class="pi pi-ellipsis-v"></i> or <b>Settings</b> <i class="pi pi-cog"></i></li><li> Tap <b>Linked Devices</b> and <b>Link a device</b></li><li> Point your phone to this screen to capture <b>QR code</b></li>',4),Tn=[Ln];function Bn(o,n){return l(),S("ul",Un,Tn)}const In=re(Rn,[["render",Bn]]),On=e("i",{class:"pi pi-qrcode mr-2"},null,-1),jn=e("p",null,[j(" Scan "),e("b",null,"QR Code"),j(" to authorize this session. ")],-1),Mn=e("i",{class:"pi pi-send mr-2"},null,-1),Nn=e("p",{class:"m-0"},[j(" Enter "),e("b",null,"Your Phone number"),j(": ")],-1),Pn={__name:"SessionLoginDialog",props:le(["session"],{visible:{},visibleModifiers:{}}),emits:["update:visible"],setup(o){const n=G(o,"visible");return(i,s)=>{const r=Es,f=As,d=Ce;return l(),T(d,{visible:n.value,"onUpdate:visible":s[0]||(s[0]=m=>n.value=m),modal:!0,class:"p-fluid",maximizable:""},{header:v(()=>[t(De,{session:o.session},null,8,["session"])]),default:v(()=>[t(f,null,{default:v(()=>[t(r,null,{header:v(()=>[On,j(" Scan QR ")]),default:v(()=>[jn,t(In),e("div",null,[t(_n,{session:o.session},null,8,["session"])])]),_:1}),t(r,null,{header:v(()=>[Mn,j(" Enter Code ")]),default:v(()=>[Nn,e("div",null,[t(Dn,{session:o.session},null,8,["session"])])]),_:1})]),_:1})]),_:1},8,["visible"])}}},En={__name:"SessionLogin",props:["session"],setup(o){const n=y(!1);return(i,s)=>{const r=A,f=q("tooltip");return l(),S(N,null,[I(t(r,{icon:"pi pi-sign-in",severity:"",rounded:"",outlined:"",onClick:s[0]||(s[0]=d=>n.value=!0),disabled:o.session.status!=="SCAN_QR_CODE"},null,8,["disabled"]),[[f,"Login",void 0,{top:!0}]]),t(Pn,{visible:p(n),"onUpdate:visible":s[1]||(s[1]=d=>Se(n)?n.value=d:null),session:o.session},null,8,["visible","session"])],64)}}},An={class:"flex justify-content-between"},qn={class:"flex align-items-center gap-1"},Hn=e("i",{class:"pi pi-whatsapp"},null,-1),Fn=e("span",{class:"mr-1"}," Sessions ",-1),Wn=["disabled"],Kn=e("i",{class:"pi pi-refresh"},null,-1),zn=[Kn],Qn={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-0"},Xn={class:"flex flex-column"},Gn={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-2"},Yn={style:{"text-align":"left"},class:"flex flex-column"},Jn={class:"text-center"},Zn={class:"flex gap-2"},ei={class:"my-auto"},si={key:0,class:"pi pi-info-circle text-orange-400"},ti={class:"flex flex-row gap-2 justify-content-end",style:{order:"2"}},ji={__name:"SessionTable",setup(o){const n=we(),i=H(),{visibleSessions:s,refreshing:r,servers:f}=$e(i),d=y({config:{webhooks:[]}}),m=y(!1),a=y(void 0),_=y(!1),w=y(10);y(null);const $=y({}),h=y(null),x=y([]),k=B(()=>x.value.filter(L=>D.value[`session-action-${L.server.id}-${L.name}`])),U=y(!1),c=y(!1),V=y(!1),O=y(!1),E=y(!1),D=y({});function se(L,u){switch(L){case"startSession":U.value=u;break;case"restartSession":c.value=u;break;case"stopSession":V.value=u;break;case"logoutSession":O.value=u;break;case"deleteSession":E.value=u;break}}async function F(L){se(L,!0);try{for(const u of k.value)await D.value[`session-action-${u.server.id}-${u.name}`][L]()}finally{se(L,!1)}}ks(()=>{D.value=[]}),Cs(()=>{me()});const W=y([{field:"name",header:"Name"},{field:"metadata",header:"Metadata"},{field:"me",header:"Me"},{field:"status",header:"Status"},{field:"server",header:"Server"}]);function Y(){return JSON.parse(localStorage.getItem("sessions.table.columns.hidden"))||[]}const C=Y(),b=y(X.differenceBy(W.value,C,"field")),z=L=>{b.value=W.value.filter(u=>L.includes(u))};function P(L){return!b.value||b.value.length===0?!0:X.find(b.value,{field:L})}const te=B(()=>P("name")),ie=B(()=>P("metadata")),ce=B(()=>P("me")),J=B(()=>P("status")),Z=B(()=>P("server")),pe=B(()=>X.differenceBy(W.value,b.value,"field"));de(()=>pe.value,L=>{localStorage.setItem("sessions.table.columns.hidden",JSON.stringify(L))},{deep:!0});const me=()=>{$.value={global:{value:null,matchMode:ae.CONTAINS},status:{value:null,matchMode:ae.EQUALS},"server.id":{value:null,matchMode:ae.EQUALS},name:{operator:Vs.AND,constraints:[{value:null,matchMode:ae.STARTS_WITH}]}}};function ve(){const L=f.value.find(u=>u.connected);if(!L){n.add({severity:"error",summary:"No connected server",detail:"Please connect to a server first",life:3e3});return}d.value={server:L.id,name:"",config:{metadata:{},webhooks:[{url:"https://httpbin.org/post",events:["session.status","message"],hmac:{key:null},retries:{delaySeconds:1,attempts:15,policy:"exponential"},customHeaders:null}],noweb:{markOnline:!0,store:{enabled:!0,fullSync:!1}},proxy:{}}},a.value="new",m.value=!0}function fe(L){d.value=X.cloneDeep({name:L.name,status:L.status,server:L.server.id,config:L.config}),a.value="update",m.value=!0}function _e(){he("store",async()=>await i.refresh())}function oe(L){_.value=!0,d.value=L}const be=B(()=>["name","me.id","me.pushName","_metadata"]);return(L,u)=>{const Ue=Be,Le=A,es=Qs,ss=Me,ts=Ds,os=ne,ns=Rs,ee=Ne,is=Ys,ls=Xe,as=lt,Te=Ae,rs=ke,us=qe,ds=Je,cs=ut,ps=Fe,ms=He,vs=zt,fs=rn,ge=q("tooltip");return l(),S(N,null,[e("div",An,[e("div",null,[e("h5",qn,[Hn,Fn,t(Ue,{refreshing:p(r)},null,8,["refreshing"])])]),e("div",null,[I((l(),S("button",{onClick:_e,class:"p-link layout-topbar-button",disabled:p(r)},zn,8,Wn)),[[ge,"Refresh",void 0,{top:!0}]])])]),t(ps,{selection:x.value,"onUpdate:selection":u[6]||(u[6]=g=>x.value=g),value:p(s).length>0?p(s):[],paginator:!0,rows:w.value,rowsPerPageOptions:[5,10,20,50,100,500],dataKey:g=>`${g.server.id}-${g.name}`,rowHover:!0,filters:$.value,"onUpdate:filters":u[7]||(u[7]=g=>$.value=g),filterDisplay:"row",loading:h.value,globalFilterFields:p(be),showGridlines:"",style:{"white-space":"nowrap"},sortField:"name",sortOrder:1,resizableColumns:""},{header:v(()=>[e("div",Qn,[e("div",Xn,[t(Le,{label:"Start New",icon:"pi pi-play",severity:"success",onClick:ve})]),e("div",Gn,[t(es),e("div",Yn,[t(ss,{placeholder:"Columns",modelValue:b.value,options:W.value,optionLabel:"header",selectedItemsLabel:"Columns",maxSelectedLabels:0,"onUpdate:modelValue":z},null,8,["modelValue","options"])]),t(ns,{iconPosition:"left"},{default:v(()=>[t(ts,{class:"pi pi-search"}),t(os,{modelValue:$.value.global.value,"onUpdate:modelValue":u[0]||(u[0]=g=>$.value.global.value=g),placeholder:"Search by name, phone, metadata",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])])]),empty:v(()=>[j(" No sessions found")]),loading:v(()=>[j(" Loading sessions...")]),default:v(()=>[t(ee,{selectionMode:"multiple",headerStyle:"width: 3rem"}),p(te)?(l(),T(ee,{key:0,field:"name",header:"Name",sortable:""})):R("",!0),p(ie)?(l(),T(ee,{key:1,header:"Metadata"},{body:v(({data:g})=>{var K;return[t(is,{metadata:(K=g.config)==null?void 0:K.metadata},null,8,["metadata"])]}),_:1})):R("",!0),p(ce)?(l(),T(ee,{key:2,header:"Me"},{body:v(({data:g})=>[e("div",Jn,[t(ls,{session:g},null,8,["session"])])]),_:1})):R("",!0),p(J)?(l(),T(ee,{key:3,field:"status",header:"Status",showFilterMenu:!1,style:{width:"9rem"}},{body:v(({data:g})=>[e("div",Zn,[e("div",null,[t(En,{session:g},null,8,["session"])]),e("div",null,[t(as,{session:g},null,8,["session"])]),e("div",null,[I(t(Le,{icon:"pi pi-whatsapp",severity:"",rounded:"",outlined:"",onClick:K=>oe(g)},null,8,["onClick"]),[[ge,"Send Request",void 0,{top:!0}]])]),e("div",ei,[t(Te,{status:g.status,value:g.status.toUpperCase()},null,8,["status","value"])])])]),filter:v(({filterModel:g,filterCallback:K})=>[t(rs,{modelValue:g.value,"onUpdate:modelValue":Q=>g.value=Q,options:p(un),onChange:Q=>K(),placeholder:"Any",class:"p-column-filter",showClear:!0},{option:v(({option:Q})=>[t(Te,{status:Q,value:Q},null,8,["status","value"])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1})):R("",!0),p(Z)?(l(),T(ee,{key:4,field:"server.name",filterField:"server.id",header:"Server",showFilterMenu:!1},{filter:v(({filterModel:g,filterCallback:K})=>[t(us,{placeholder:"Any",onChange:Q=>K(),modelValue:g.value,"onUpdate:modelValue":Q=>g.value=Q,showClear:!0,required:!1},null,8,["onChange","modelValue","onUpdate:modelValue"])]),body:v(({data:g})=>[j(M(g.server.name)+" ",1),g.assignedWorker&&g.server.name!==g.assignedWorker?I((l(),S("i",si,null,512)),[[ge,`Assigned Worker ID does not match

👉 Assigned Worker ID: ${g.assignedWorker}`]]):R("",!0)]),_:1})):R("",!0),t(ee,{showFilterMenu:!1},{filter:v(()=>[e("div",ti,[t(ds,{group:"dialog",name:`'${p(k).length}' sessions`,"all-disabled":p(k).length===0,"hide-actions":["view"],"is-starting":U.value,"is-restarting":c.value,"is-stopping":V.value,"is-logging-out":O.value,"is-removing":E.value,onStart:u[1]||(u[1]=g=>F("startSession")),onRestart:u[2]||(u[2]=g=>F("restartSession")),onStop:u[3]||(u[3]=g=>F("stopSession")),onLogout:u[4]||(u[4]=g=>F("logoutSession")),onDelete:u[5]||(u[5]=g=>F("deleteSession"))},null,8,["name","all-disabled","is-starting","is-restarting","is-stopping","is-logging-out","is-removing"])])]),body:v(({data:g})=>[t(cs,{ref:K=>{D.value[`session-action-${g.server.id}-${g.name}`]=K},session:g,disabled:p(k).length!==0,onView:fe},null,8,["session","disabled"])]),_:1})]),_:1},8,["selection","value","rows","dataKey","filters","loading","globalFilterFields"]),t(ms),t(vs,{visible:_.value,"onUpdate:visible":u[8]||(u[8]=g=>_.value=g),session:d.value,"onUpdate:session":u[9]||(u[9]=g=>d.value=g)},null,8,["visible","session"]),t(fs,{visible:m.value,"onUpdate:visible":u[10]||(u[10]=g=>m.value=g),session:d.value,"onUpdate:session":u[11]||(u[11]=g=>d.value=g),mode:a.value},null,8,["visible","session","mode"])],64)}}};export{Qs as _,ji as a};
