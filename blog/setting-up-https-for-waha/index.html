<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href="/main.bc38a07753a3bc302a0816d5b0f9af72374aadf3e5d31ab5d6cf744aa9dc7fe70c0a72dd0b0bbcc21ea8a34fedcf3465ce76833aa7c8cd384bf452fd598f583a.css" integrity="sha512-vDigd1OjvDAqCBbVsPmvcjdKrfPl0xq11s90Sqncf+cMCnLdCwu8wh6oo0/tzzRlznaDOqfIzThL9FL9WY9YOg==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=/blog/setting-up-https-for-waha/><link rel=canonical href=/blog/setting-up-https-for-waha/><title>Setting up HTTPS for WAHA | WAHA</title>
<meta name=description content="Step-by-step guide on how to set up HTTPS for WAHA"><link rel=manifest href=/manifest.webmanifest><meta property="og:url" content="/blog/setting-up-https-for-waha/"><meta property="og:site_name" content="WAHA"><meta property="og:title" content="Setting up HTTPS for WAHA"><meta property="og:description" content="Step-by-step guide on how to set up HTTPS for WAHA"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-06-17T08:48:45+00:00"><meta property="article:modified_time" content="2024-06-17T08:48:45+00:00"><meta property="og:image" content="/blog/setting-up-https-for-waha/https_icon.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/blog/setting-up-https-for-waha/https_icon.png"><meta name=twitter:title content="Setting up HTTPS for WAHA"><meta name=twitter:description content="Step-by-step guide on how to set up HTTPS for WAHA"><meta name=twitter:site content="@getdoks"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"/","name":"Whats App HTTP API","position":1},{"@type":"ListItem","item":"/blog/","name":"Blog","position":2},{"@type":"ListItem","name":"Setting Up HTTP S for Waha","position":3}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"BlogPosting","headline":"Setting up HTTPS for WAHA","description":"Step-by-step guide on how to set up HTTPS for WAHA","isPartOf":{"@id":"/blog/setting-up-https-for-waha/"},"mainEntityOfPage":{"@id":"/blog/setting-up-https-for-waha/"},"datePublished":"2024-06-17T08:48:45+00:00","dateModified":"2024-06-17T08:48:45+00:00","image":[{"@id":"/blog/setting-up-https-for-waha/https_icon.png"},{"@id":"/blog/setting-up-https-for-waha/lets-encrypt-certbot.png"},{"@id":"/blog/setting-up-https-for-waha/mitm.png"},{"@id":"/blog/setting-up-https-for-waha/self-signed-certificate-warning.png"},{"@id":"/blog/setting-up-https-for-waha/ssl-reverse-2.png"}],"author":{"@type":"Organization","name":"WAHA","url":"/"},"publisher":{"@type":"Organization","name":"WAHA"}}]}</script><link href=https://unpkg.com/aos@2.3.1/dist/aos.css rel=stylesheet><script src=https://unpkg.com/aos@2.3.1/dist/aos.js></script><script>document.addEventListener("DOMContentLoaded",function(){const t=["GET","POST","PUT","DELETE","PATCH","HEAD","OPTIONS","CONNECT","TRACE"],e=new RegExp(`^(${t.join("|")})\\b`);document.querySelectorAll("code.language-http .line .err").forEach(t=>{const n=t.textContent;e.test(n)&&(t.innerHTML=n.replace(e,function(e){return`<span class="http-method http-method-${e.toUpperCase()}">${e}</span>`}))})})</script></head><body class="single section blog"><article><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><div class=blog-header><h1>Setting up HTTPS for WAHA</h1><p><small>June 17, 2024&nbsp;in&nbsp;<a class="stretched-link position-relative link-muted" href=/categories/tips/>Tips</a>&nbsp;by&nbsp;<a class="stretched-link position-relative" href=/contributors/devlikeapro/>devlikeapro</a><span class="stretched-link position-relative reading-time text-nowrap" title="Estimated reading time"><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 7v5l3 3"/></svg>5&nbsp;minutes</span></small></p></div></div><div class="col-md-12 col-lg-9"><h2 id=why-bother-with-https>Why bother with HTTPS?</h2><p>Even if you have set up WAHA and protected it with an API key and username/password
(as we recommend on <a href=/docs/how-to/security/><strong>ðŸ”’ Security</strong></a>) - it&rsquo;s still not enough, because of
<a href=https://en.wikipedia.org/wiki/Man-in-the-middle_attack>Man-in-the-middle attacks</a>.
<img src=/blog/setting-up-https-for-waha/mitm_hu_9a6e96aced174fef.webp width=768 height=403 decoding=async fetchpriority=auto loading=lazy alt=alt id=h-rh-i-0></p><p>If you&rsquo;re exposing WAHA to the internet, you should <strong>always use HTTPS</strong> to protect your data from being intercepted.</p><hr><p>ðŸ’¡ We recommend handling HTTPS termination with a reverse proxy like Nginx - kindly follow
<a href=/docs/how-to/install/><strong>ðŸ”§ Install & Update - Additional Steps</strong></a> to set up Nginx with Let&rsquo;s Encrypt.</p><hr><p>ðŸ‘‰ WAHA <strong>supports HTTPS out of the box</strong> in <a href=/docs/how-to/waha-plus/><strong>WAHA Plus</strong></a> version.</p><p>You can set up the following environment variables to enable HTTPS:</p><ol><li><a href=#lets-encrypt-certbot--waha><strong>Let&rsquo;s Encrypt</strong></a> - use <a href=https://certbot.eff.org/>Certbot</a> to get a free certificate from Let&rsquo;s Encrypt.</li><li><a href=#self-signed-certificate--waha><strong>Self-signed certificate</strong></a> - generate a self-signed certificate and use it for HTTPS.</li><li><a href=#using-external-reverse-proxy><strong>Using reverse proxy</strong></a> - use Nginx as a reverse proxy and set up HTTPS there.</li><li><a href=#using-ngrok><strong>Using Ngrok</strong></a> - expose your WAHA safely on internet, even without Public IP or DNS name.</li></ol><h2 id=configuration>Configuration</h2><p>WAHA supports HTTPS out of the box if you don&rsquo;t want to use a reverse proxy like Nginx.</p><p>You can set up the following environment variables to enable HTTPS:</p><ul><li><code>WAHA_HTTPS_ENABLED=true</code>: Set this variable to <code>true</code> to enable HTTPS. By default, it&rsquo;s <code>false</code>.</li><li><code>WAHA_HTTPS_PATH_KEY=/path/to/key.pem</code>: The path to the key file for HTTPS. By default <code>./.secrets/privkey.pem</code></li><li><code>WAHA_HTTPS_PATH_CERT=/path/to/cert.pem</code>: The path to the certificate file for HTTPS. By default <code>./.secrets/cert.pem</code></li><li><code>WAHA_HTTPS_PATH_CA=/path/to/ca.pem</code>: The path to the CA file for HTTPS. By default <code>./.secrets/chain.pem</code></li></ul><h2 id=lets-encrypt-certbot--waha>Let&rsquo;s Encrypt (Certbot) + WAHA</h2><p><img src=/blog/setting-up-https-for-waha/lets-encrypt-certbot_hu_391d30e4432d17cd.webp width=1280 height=720 decoding=async fetchpriority=auto loading=lazy alt=alt id=h-rh-i-1></p><p><a href=https://certbot.eff.org/><strong>Certbot</strong></a> is a free and open-source tool that can be used to get a free certificate
from <a href=https://letsencrypt.org/>Let&rsquo;s Encrypt</a>.</p><p>WAHA can use the certificate generated by Certbot to enable HTTPS.</p><h3 id=step-0-requirements>Step 0: Requirements</h3><p>Here&rsquo;s assumptions for this guide:</p><ol><li><strong>Dedicated server or VPS</strong> with Public IP (
like <a href=https://www.digitalocean.com/products/droplets/>DigitalOcean DropLet</a>)</li><li><strong>Ubuntu 22.04</strong> - clean installation</li><li><strong>Public IP</strong> assigned to the server (like <code>109.71.242.111</code>)</li><li><strong>Domain</strong> pointed to the Public IP (like <code>waha.example.pro</code>)</li></ol><p>You can get the updated <a href="https://certbot.eff.org/instructions?ws=other&amp;os=ubuntufocal">Certbot documentation</a>,
and <strong>Step 7: Install your certificate</strong> - this is where we need to configure WAHA to use the certificates.</p><h3 id=step-1-install-certbot>Step 1: Install Certbot</h3><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo snap install --classic certbot
</span></span><span class=line><span class=cl>sudo ln -s /snap/bin/certbot /usr/bin/certbot</span></span></code></pre></div></figure></div><h3 id=step-2-issuing-certificate>Step 2: Issuing certificate</h3><p>Choose how you&rsquo;d like to run Certbot - Are you ok with temporarily stopping your website?</p><ul><li><strong>Yes, my web server is not currently running on this machine.</strong></li></ul><p>Stop your webserver, then run this command to get a certificate. Certbot will temporarily spin up a webserver on your
machine.</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl stop nginx
</span></span><span class=line><span class=cl>sudo certbot certonly --standalone -d waha.example.com <span class=c1># &lt;=== change to your domain</span></span></span></code></pre></div></figure></div><ul><li><strong>No, I need to keep my web server running.</strong></li></ul><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo certbot certonly --webroot
</span></span><span class=line><span class=cl><span class=c1># sudo certbot certonly --webroot /var/www/html</span></span></span></code></pre></div></figure></div><h3 id=step-3-run-waha>Step 3: Run WAHA</h3><p>After you get the certificates, you can run it</p><p>ðŸ‘‡ Few notes:</p><ul><li>Change <code>waha.example.pro</code> to your domain</li><li>We&rsquo;re running it with <code>-it</code> flag to see the logs, in production you need to run it with <code>docker run -d</code> instead.</li><li>We map the whole <code>/etc/letsencrypt</code> folder because of the way how letsencrypt works with &ldquo;live&rdquo; keys (it&rsquo;s symlinks to &ldquo;archive&rdquo; directory files)</li></ul><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>DOMAIN</span><span class=o>=</span>waha.example.pro <span class=c1># Change it to your domain!</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker run -it <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -p 3000:3000/tcp <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v <span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span>/.sessions:/app/.sessions <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v /etc/letsencrypt:/etc/letsencrypt <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --env <span class=nv>WAHA_HTTPS_ENABLED</span><span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --env <span class=nv>WAHA_HTTPS_PATH_KEY</span><span class=o>=</span>/etc/letsencrypt/live/<span class=nv>$DOMAIN</span>/privkey.pem <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --env <span class=nv>WAHA_HTTPS_PATH_CERT</span><span class=o>=</span>/etc/letsencrypt/live/<span class=nv>$DOMAIN</span>/cert.pem <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --env <span class=nv>WAHA_HTTPS_PATH_CA</span><span class=o>=</span>/etc/letsencrypt/live/<span class=nv>$DOMAIN</span>/chain.pem <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --env <span class=nv>WHATSAPP_API_SCHEMA</span><span class=o>=</span>https, 
</span></span><span class=line><span class=cl>  --env <span class=nv>WHATSAPP_API_PORT</span><span class=o>=</span>3000, 
</span></span><span class=line><span class=cl>  --env <span class=nv>WHATSAPP_API_HOSTNAME</span><span class=o>=</span><span class=nv>$DOMAIN</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --restart always <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  devlikeapro/waha-plus</span></span></code></pre></div></figure></div><p>Now open <a href=https://waha.example.com:3000>https://waha.example.com:3000</a>
and check the HTTPS connection.</p><p>If it works - consider using <a href=https://github.com/devlikeapro/waha/blob/core/docker-compose.yaml>docker-compose</a>
file for running the project, it can be hard to write such long command or using sh scripts for that.</p><h3 id=step-4-test-auto-renewal>Step 4: Test auto renewal</h3><p>When Certbot renew the certificate - WAHA automatically updates HTTPS server and use new certificate with no restart.</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo certbot renew --dry-run</span></span></code></pre></div></figure></div><h2 id=self-signed-certificate--waha>Self-signed certificate + WAHA</h2><p>As an alternative, you can issue self-signed certificate (for instance, to test the connection on localhost).</p><p>It&rsquo;ll show you an error on browser, so you need to accept it before accessing the site,
but it won&rsquo;t show expose the API key during network communication even in public networks.
<img src=/blog/setting-up-https-for-waha/self-signed-certificate-warning_hu_c7f0779f830031d2.webp width=652 height=374 decoding=async fetchpriority=auto loading=lazy alt=alt id=h-rh-i-2></p><h3 id=step-1-generate-certificates>Step 1: Generate certificates</h3><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir .secrets
</span></span><span class=line><span class=cl>openssl genpkey -algorithm RSA -out .secrets/privkey.pem -pkeyopt rsa_keygen_bits:2048
</span></span><span class=line><span class=cl>openssl req -new -key .secrets/privkey.pem -out .secrets/cert.csr -subj <span class=s2>&#34;/&#34;</span>
</span></span><span class=line><span class=cl>openssl req -x509 -days <span class=m>3650</span> -key .secrets/privkey.pem -in .secrets/cert.csr -out .secrets/cert.pem
</span></span><span class=line><span class=cl>cp .secrets/cert.pem .secrets/chain.pem
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;DONE!&#34;</span></span></span></code></pre></div></figure></div><h3 id=step-2-run-waha>Step 2: Run WAHA</h3><p>ðŸ‘‡ Few notes:</p><ul><li>We&rsquo;re running it with <code>-it</code> flag to see the logs, in production you need to run it with <code>docker run -d</code> instead.</li></ul><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -it <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -p 3000:3000 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v <span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span>/.sessions:/app/.sessions <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v <span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span>/.secrets:/app/.secrets <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>WAHA_HTTPS_ENABLED</span><span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>WAHA_HTTPS_PATH_KEY</span><span class=o>=</span>.secrets/privkey.pem <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>WAHA_HTTPS_PATH_CERT</span><span class=o>=</span>.secrets/cert.pem <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>WAHA_HTTPS_PATH_CA</span><span class=o>=</span>.secrets/chain.pem <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  devlikeapro/waha-plus</span></span></code></pre></div></figure></div><p>Open <a href=https://localhost:3000>https://localhost:3000</a> and accept self-signed certificate in your browser.</p><p>If it works - consider using <a href=https://github.com/devlikeapro/waha/blob/core/docker-compose.yaml>docker-compose</a>
file for running the project, it can be hard to write such long command or using sh scripts for that.</p><h2 id=using-external-reverse-proxy>Using External Reverse Proxy</h2><p><img src=/blog/setting-up-https-for-waha/ssl-reverse-2_hu_cbff4a7a68225af3.webp width=886 height=304 decoding=async fetchpriority=auto loading=lazy alt=alt id=h-rh-i-3>
The best way to set up HTTPS is to use a reverse proxy like Nginx.
The idea is WAHA exposes the HTTP port and Nginx handles the HTTPS part and forwards the requests to WAHA.
It distributes the load and make it easier to manage the HTTPS part.</p><p>Unfortunately, it&rsquo;s a bit more complicated than the previous options, so we don&rsquo;t cover it in the guide.</p><p>Here&rsquo;s some articles that can help you set up HTTPS with Nginx and docker-compose:</p><ol><li><a href=https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-20-04><strong>Certbot + Nginx + Docker</strong></a></li></ol><h2 id=using-ngrok>Using Ngrok</h2><p>WAHA + Ngrok - Running WAHA on local network
You also can set up <a href=/blog/waha--ngrok-running-waha-on-local-network/><strong>WAHA to use Ngrok</strong></a>
so it handles HTTPS for you, even if you&rsquo;re running it NOT on local server!</p></div></div></article><script async src=/js/bootstrap.c673c84373e66019f7895efc74b3b3b940071832aaa8a85e73218087d535e71b.js integrity="sha256-xnPIQ3PmYBn3iV78dLOzuUAHGDKqqKhecyGAh9U15xs="></script><script async src=/js/app.c17553444ec7c62f781ddbaa011948f6d85a1bab49420047d68a2b89852a8b36.js integrity="sha256-wXVTRE7Hxi94HduqARlI9thaG6tJQgBH1ooriYUqizY="></script><script async src=/js/docsearch.cfae25fd02560b1d08c4065fa744efbf59bdaf3e4d6a7bf8652794f322a813c9.js integrity="sha256-z64l/QJWCx0IxAZfp0Tvv1m9rz5Nanv4ZSeU8yKoE8k="></script></body></html>