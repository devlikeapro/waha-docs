<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href="/main.bc38a07753a3bc302a0816d5b0f9af72374aadf3e5d31ab5d6cf744aa9dc7fe70c0a72dd0b0bbcc21ea8a34fedcf3465ce76833aa7c8cd384bf452fd598f583a.css" integrity="sha512-vDigd1OjvDAqCBbVsPmvcjdKrfPl0xq11s90Sqncf+cMCnLdCwu8wh6oo0/tzzRlznaDOqfIzThL9FL9WY9YOg==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=/blog/waha-scaling-how-to-handle-500-sessions/><link rel=canonical href=/blog/waha-scaling-how-to-handle-500-sessions/><title>WAHA Scaling - How To Handle 500+ Sessions | WAHA</title>
<meta name=description content="WAHA Scaling - how to scale WAHA for >500 sessions with Vertical and Horizontal scaling"><link rel=manifest href=/manifest.webmanifest><meta property="og:url" content="/blog/waha-scaling-how-to-handle-500-sessions/"><meta property="og:site_name" content="WAHA"><meta property="og:title" content="WAHA Scaling - How To Handle 500+ Sessions"><meta property="og:description" content="WAHA Scaling - how to scale WAHA for >500 sessions with Vertical and Horizontal scaling"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-08-14T08:48:45+00:00"><meta property="article:modified_time" content="2024-08-14T08:48:45+00:00"><meta property="og:image" content="/blog/waha-scaling-how-to-handle-500-sessions/horizontal-vs-vertical-scaling.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/blog/waha-scaling-how-to-handle-500-sessions/horizontal-vs-vertical-scaling.png"><meta name=twitter:title content="WAHA Scaling - How To Handle 500+ Sessions"><meta name=twitter:description content="WAHA Scaling - how to scale WAHA for >500 sessions with Vertical and Horizontal scaling"><meta name=twitter:site content="@getdoks"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"/","name":"Whats App HTTP API","position":1},{"@type":"ListItem","item":"/blog/","name":"Blog","position":2},{"@type":"ListItem","name":"Waha Scaling How to Handle 500 Sessions","position":3}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"BlogPosting","headline":"WAHA Scaling - How To Handle 500\u002b Sessions","description":"WAHA Scaling - how to scale WAHA for \u003e500 sessions with Vertical and Horizontal scaling","isPartOf":{"@id":"/blog/waha-scaling-how-to-handle-500-sessions/"},"mainEntityOfPage":{"@id":"/blog/waha-scaling-how-to-handle-500-sessions/"},"datePublished":"2024-08-14T08:48:45+00:00","dateModified":"2024-08-14T08:48:45+00:00","image":[{"@id":"/blog/waha-scaling-how-to-handle-500-sessions/entities-schema.png"},{"@id":"/blog/waha-scaling-how-to-handle-500-sessions/horizontal-scaling.png"},{"@id":"/blog/waha-scaling-how-to-handle-500-sessions/horizontal-vs-vertical-scaling.png"},{"@id":"/blog/waha-scaling-how-to-handle-500-sessions/vertical-scaling.png"},{"@id":"/blog/waha-scaling-how-to-handle-500-sessions/waha-scaling-hor.drawio.png"},{"@id":"/blog/waha-scaling-how-to-handle-500-sessions/waha-scaling-up.drawio.png"}],"author":{"@type":"Organization","name":"WAHA","url":"/"},"publisher":{"@type":"Organization","name":"WAHA"}}]}</script><link href=https://unpkg.com/aos@2.3.1/dist/aos.css rel=stylesheet><script src=https://unpkg.com/aos@2.3.1/dist/aos.js></script><script>document.addEventListener("DOMContentLoaded",function(){const t=["GET","POST","PUT","DELETE","PATCH","HEAD","OPTIONS","CONNECT","TRACE"],e=new RegExp(`^(${t.join("|")})\\b`);document.querySelectorAll("code.language-http .line .err").forEach(t=>{const n=t.textContent;e.test(n)&&(t.innerHTML=n.replace(e,function(e){return`<span class="http-method http-method-${e.toUpperCase()}">${e}</span>`}))})})</script></head><body class="single section blog"><article><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><div class=blog-header><h1>WAHA Scaling - How To Handle 500+ Sessions</h1><p><small>August 14, 2024&nbsp;in&nbsp;<a class="stretched-link position-relative link-muted" href=/categories/tips/>Tips</a>&nbsp;by&nbsp;<a class="stretched-link position-relative" href=/contributors/devlikeapro/>devlikeapro</a><span class="stretched-link position-relative reading-time text-nowrap" title="Estimated reading time"><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 7v5l3 3"/></svg>6&nbsp;minutes</span></small></p></div></div><div class="col-md-12 col-lg-9"><h2 id=overview>Overview</h2><p>The article is for people who want to scale their WhatsApp API for customers, like CRM, SaaS, or other services and
who needs to handle a lot (<strong>>100</strong>) of <a href=/docs/how-to/sessions/><strong>üñ•Ô∏è Sessions</strong></a> (WhatsApp Accounts)</p><p>If you&rsquo;re using WAHA for <strong>1-10</strong> sessions - just make sure to follow
<a href=/docs/how-to/install/><strong>üîß Install & Update</strong></a> guide.
It handles all the necessary steps to make it work. üöÄ</p><p>There are two ways to scale WAHA:</p><ol><li><a href=#vertical-scaling><strong>Vertical Scaling</strong></a> - adding more resources (CPU, RAM) to <strong>the single server</strong> to
handle more sessions. That&rsquo;s a good way to go if you need to handle up to <strong>50</strong> sessions (<strong>WEBJS</strong>) or <strong>500</strong>
sessions (<strong>NOWEB</strong>).</li><li><a href=#horizontal-scaling---sharding><strong>Horizontal Scaling</strong></a> - adding more servers to handle more sessions.
Requires a bit of more work to set up, but it&rsquo;s the best way to go if you need to handle more than <strong>500</strong> sessions.</li></ol><h2 id=vertical-scaling>Vertical Scaling</h2><p><img src=/blog/waha-scaling-how-to-handle-500-sessions/waha-scaling-up.drawio_hu_1ec395d0598e79df.webp width=1600 height=839 decoding=async fetchpriority=auto loading=lazy alt=alt id=h-rh-i-0></p><p><strong>Vertical Scaling</strong> is the process of adding more resources (CPU, RAM) to the single server to handle more sessions.</p><p>Assuming you&rsquo;ve followed the guide <a href=/docs/how-to/install/><strong>üîß Install & Update</strong></a> and
you got something like this architecture:</p><div class="mb-2 text-center"><a href=/images/waha/scaling/waha-vertical-scaling.drawio.png target=_blank style=cursor:pointer><img src=/images/waha/scaling/waha-vertical-scaling.drawio.png alt></a><div class="text-center small" style=color:#6c757d>Click to open full size.</div></div><p><strong>How many sessions you can run adding more resources (CPU and RAM) to the single WAHA server?</strong></p><p>Here&rsquo;s
<a href=/docs/overview/faq/#system-requirements>approximate example how many session you can run on a single server</a>
using <strong>Vertical Scaling</strong> approach:</p><table><thead><tr><th style=text-align:left><a href=/docs/how-to/engines/><strong>üè≠ Engine</strong></a></th><th>Sessions</th><th>CPU</th><th>Memory</th></tr></thead><tbody><tr><td style=text-align:left><strong>WEBJS</strong></td><td>10</td><td>270%</td><td>2.5GB</td></tr><tr><td style=text-align:left><strong>WEBJS</strong></td><td>50</td><td>1500%</td><td>20GB</td></tr><tr><td style=text-align:left><strong>NOWEB</strong></td><td>50</td><td>150%</td><td>4GB</td></tr><tr><td style=text-align:left><strong>NOWEB</strong></td><td>500</td><td>300%</td><td>30GB</td></tr></tbody></table><p>üëâ The benchmark may differ from case to case, it depends on usage pattern - how many messages you get,
how many send, etc.</p><p>So if you need to run up to <strong>50</strong> session on <strong>WEBJS</strong> engine or up to <strong>500</strong> sessions on <strong>NOWEB</strong> - you
can just keep adding more resources (CPU and RAM) to the single server!
Fast to scale, easy to manage.üéâ</p><p>If you want to run more sessions - you need to consider <strong>Horizontal Scaling</strong>.
It&rsquo;s not safe to run more than the above numbers on a single server!</p><h2 id=horizontal-scaling---sharding>Horizontal Scaling - Sharding</h2><p><img src=/blog/waha-scaling-how-to-handle-500-sessions/waha-scaling-hor.drawio_hu_b70307445be1235d.webp width=1151 height=372 decoding=async fetchpriority=auto loading=lazy alt=alt id=h-rh-i-1></p><p><strong>Horizontal Scaling</strong> is the process of adding <strong>more servers</strong> to handle more sessions.</p><p>Right now the only way to do it is to run multiple WAHA instances and distribute the sessions between them in
<strong>Your Application</strong> logic using <strong>Sharding</strong> technique:</p><div class="mb-2 text-center"><a href=/images/waha/scaling/waha-horizontal-scaling.drawio.png target=_blank style=cursor:pointer><img src=/images/waha/scaling/waha-horizontal-scaling.drawio.png alt></a><div class="text-center small" style=color:#6c757d>Click to open full size.</div></div><p>Here&rsquo;s key points how to set up <strong>Horizontal Scaling</strong> using <strong>Sharding</strong> technique:</p><ol><li>You run <strong>multiple WAHA</strong> instances listening different <strong>hostnames</strong>
(<code>http://waha1.example.com</code>, <code>http://waha2.example.com</code>, etc) or <strong>ports</strong>
(<code>http://waha.example.com:3001</code>, <code>http://waha.example.com:3002</code>, etc).</li><li>You save the list of <code>url</code>, <code>api-key</code>, <code>capacity</code> to <strong>Your Application Database</strong> -
<a href=#entities-schema><strong>Entities Schema</strong></a></li><li>When a new user asks to run a new session - you follow <a href=#where-to-run-a-new-session><strong>Where to run a new session?</strong></a>
logic to find a suitable WAHA instance and save <code>user &lt;-> session &lt;-> server</code> association to <strong>Your Application Database</strong>.</li><li>When you need to send a request to WhatsApp API - you follow
<a href=#where-to-find-the-session><strong>Where to find the session?</strong></a> logic to find the WAHA instance to send the request.</li><li>All webhooks come to <strong>Your Application</strong> directly from the WAHA instance, so you don&rsquo;t need to worry about it.</li></ol><p>We&rsquo;ll guide you through the process of setting up <strong>Horizontal Scaling</strong>
using <strong>Sharding</strong> technique in the next sections.</p><p>üëâ Please note that each <strong>WAHA Worker</strong> must have its own database or <code>WAHA_WORKER_ID=waha{N}</code> environment variable set
either <strong>File Storage</strong> or <strong>MongoDB</strong> URL (not a database).</p><h3 id=entities-schema>Entities Schema</h3><p>In order to save WAHA instances and sessions associations you
need to have the following entities in <strong>Your Application Database</strong>:
<img src=/blog/waha-scaling-how-to-handle-500-sessions/entities-schema_hu_6f478082c256b7fe.webp width=700 height=347 decoding=async fetchpriority=auto loading=lazy alt=alt id=h-rh-i-2></p><h4 id=worker>Worker</h4><p><strong>Worker</strong> represents a single WAHA instance that can handle sessions.</p><ul><li><code>id</code> - unique identifier</li><li><code>url</code> - URL of the WAHA instance, <code>http://waha1.example.com</code>, <code>http://waha2.example.com</code>, etc</li><li><code>api_key</code> - API Key to authorize requests</li><li><code>capacity</code> - how many sessions can be run on the WAHA instance (for simplicity, we&rsquo;re using a single field,
but it can be a new model <strong>AvailableSession</strong> or similar).</li></ul><p>By setting <code>capacity</code> you can manage the WAHA Worker usage and prevent overloading.</p><h4 id=user>User</h4><p><strong>User</strong> is a user of <strong>Your Application</strong> that can run sessions.</p><ul><li><code>id</code> - unique identifier</li></ul><p>üëâ You can use either <strong>User</strong> or <strong>Tenant</strong> or <strong>Organization</strong> it completely depends on your application logic
and business model.
We&rsquo;ll use <strong>User</strong> for simplicity with a single field:</p><h4 id=wahasession>WAHASession</h4><p><strong>WAHASession</strong> represents a single session that is running on the WAHA <strong>Worker</strong> associated with the <strong>User</strong>.</p><ul><li><code>id</code> - unique identifier</li><li><code>name</code> - WAHA session <code>name</code></li><li><code>user_id</code> - reference to the <strong>User</strong></li><li><code>worker_id</code> - reference to the <strong>Worker</strong></li></ul><h3 id=where-to-run-a-new-session>Where to run a new session?</h3><p>When a new user asks to <strong>run a new session</strong> - you need to find a suitable WAHA instance to run it.
You can simply get a list of session with <code>capacity>0</code> and pick the one with the highest <code>capacity</code>.<div class="mb-2 text-center"><a href=/images/waha/scaling/waha-run-session.png target=_blank style=cursor:pointer><img src=/images/waha/scaling/waha-run-session.png alt></a><div class="text-center small" style=color:#6c757d>Click to open full size.</div></div></p><p>It&rsquo;s just an example with simple logic. You can adjust it and distribute WhatsApp session based on <strong>country</strong>, <strong>proxy
settings</strong>,
customer level, etc.</p><h3 id=where-to-find-the-session>Where to find the session?</h3><p>When you need to <strong>send a request</strong> to WhatsApp API - you need to find the WAHA instance to send the request.
You can simply get the <code>worker_id</code> from the <strong>WAHASession</strong> and send the request to the WAHA instance using
the <code>url</code> and <code>api_key</code>.<div class="mb-2 text-center"><a href=/images/waha/scaling/waha-send-request.png target=_blank style=cursor:pointer><img src=/images/waha/scaling/waha-send-request.png alt></a><div class="text-center small" style=color:#6c757d>Click to open full size.</div></div></p><h3 id=why-this-way>Why this way?</h3><p><strong>WAHA</strong> is not stateless application, it has <strong>a runtime state</strong> (not technically a state as in database, but still a
state) - <strong>the connection to WhatsApp</strong> (either browser or websocket connection) which can not be moved automatically,
so all HTTP requests MUST be <strong>&ldquo;sticky&rdquo;</strong>, meaning it <strong>MUST</strong> go only to the certain &ldquo;worker&rdquo; - <strong>one with &ldquo;running&rdquo; session</strong>.</p><p>This is why we can simply run more containers using Kubernetes Deployment/AWS ECS
(tho you can use <a href=https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/>StatefulSets</a> for k8s)
, we need to care about WHERE we run the session and WHERE we send the request.</p><p>and few more reasons:</p><ul><li><strong>Simple</strong> - you don&rsquo;t need to worry about the load balancer, k8s, docker, etc.</li><li><strong>Independent</strong> - you can run WAHA instances on different servers, different cloud providers, bare-metal, etc.</li><li><strong>No single point of failure</strong> - if one WAHA instance goes down - the others are still working.</li><li><strong>Flexible</strong> - you can configure HOW you distribute sessions across different servers based on your business logic.</li><li><strong>Frees our hands</strong> - we can focus on building the best WhatsApp API and adding new features,
and you can focus on building the best application. üòä</li></ul><h3 id=single-dashboard---multiple-servers>Single Dashboard - Multiple Servers</h3><p>If you&rsquo;re running multiple servers
you can run a dedicated WAHA <a href=/docs/how-to/dashboard/><strong>üìä Dashboard</strong></a> just to have a single place where from you can manage all servers:</p><div class="mb-2 text-center"><a href=/images/waha/dashboard/waha-dashboard-servers.drawio.png target=_blank style=cursor:pointer><img src=/images/waha/dashboard/waha-dashboard-servers.drawio.png alt></a><div class="text-center small" style=color:#6c757d>Click to open full size.</div></div><p>After that you can connect all server to the single dashboard:</p><div class="mb-2 text-center"><a href=/images/waha/dashboard/waha-single-dashboard-multiple-servers.png target=_blank style=cursor:pointer><img src=/images/waha/dashboard/waha-single-dashboard-multiple-servers.png alt></a><div class="text-center small" style=color:#6c757d>Click to open full size.</div></div><h2 id=horizontal-scaling---auto-scaling>Horizontal Scaling - Auto-Scaling</h2><p>üößüî®‚è≥ Auto-Scaling <strong>IS NOT AVAILABLE</strong> out-of-the-box in WAHA yet! ‚è≥üî®üöß</p><p>We&rsquo;re working on it, but it&rsquo;s not ready yet, so we&rsquo;re just giving you a future vision how it will work.</p><p>The idea is to build <strong>WAHA Hub</strong> that will handle all API requests and distribute them to the <strong>WAHA Workers</strong>
based on information where each session is running.</p><p>It&rsquo;ll also control (using underlying k8s or docker infrastructure) the number of workers based on the load.</p><div class="mb-2 text-center"><a href=/images/waha/scaling/waha-hub.png target=_blank style=cursor:pointer><img src=/images/waha/scaling/waha-hub.png alt></a><div class="text-center small" style=color:#6c757d>Click to open full size.</div></div><p>Kindly <a href=/pricing/><strong>support the project</strong></a> on <strong>PRO</strong> tier if you wish to
use the feature in the future! üôè</p><p>For now, <a href=#vertical-scaling><strong>Vertical Scaling</strong></a> and
<a href=#horizontal-scaling---sharding><strong>Horizontal Scaling - Sharding</strong></a>
are the ways to go.</p></div></div></article><script async src=/js/bootstrap.c673c84373e66019f7895efc74b3b3b940071832aaa8a85e73218087d535e71b.js integrity="sha256-xnPIQ3PmYBn3iV78dLOzuUAHGDKqqKhecyGAh9U15xs="></script><script async src=/js/app.c17553444ec7c62f781ddbaa011948f6d85a1bab49420047d68a2b89852a8b36.js integrity="sha256-wXVTRE7Hxi94HduqARlI9thaG6tJQgBH1ooriYUqizY="></script><script async src=/js/docsearch.cfae25fd02560b1d08c4065fa744efbf59bdaf3e4d6a7bf8652794f322a813c9.js integrity="sha256-z64l/QJWCx0IxAZfp0Tvv1m9rz5Nanv4ZSeU8yKoE8k="></script></body></html>