<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href="/main.bc38a07753a3bc302a0816d5b0f9af72374aadf3e5d31ab5d6cf744aa9dc7fe70c0a72dd0b0bbcc21ea8a34fedcf3465ce76833aa7c8cd384bf452fd598f583a.css" integrity="sha512-vDigd1OjvDAqCBbVsPmvcjdKrfPl0xq11s90Sqncf+cMCnLdCwu8wh6oo0/tzzRlznaDOqfIzThL9FL9WY9YOg==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=/docs/how-to/storages/><link rel=canonical href=/docs/how-to/storages/><title>🗄️ Storages | WAHA</title>
<meta name=description content="Storages - where to save authentication and media files"><link rel=manifest href=/manifest.webmanifest><meta property="og:url" content="/docs/how-to/storages/"><meta property="og:site_name" content="WAHA"><meta property="og:title" content="🗄️ Storages"><meta property="og:description" content="Storages - where to save authentication and media files"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2020-10-06T08:48:45+00:00"><meta property="article:modified_time" content="2020-10-06T08:48:45+00:00"><meta property="og:image" content="/docs/how-to/storages/waha-storages.drawio.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/docs/how-to/storages/waha-storages.drawio.png"><meta name=twitter:title content="🗄️ Storages"><meta name=twitter:description content="Storages - where to save authentication and media files"><meta name=twitter:site content="@getdoks"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"/","name":"Whats App HTTP API","position":1},{"@type":"ListItem","item":"/docs/","name":"Docs","position":2},{"@type":"ListItem","item":"/docs/how-to/","name":"How to Guides","position":3},{"@type":"ListItem","name":"Storages","position":4}]}</script><link href=https://unpkg.com/aos@2.3.1/dist/aos.css rel=stylesheet><script src=https://unpkg.com/aos@2.3.1/dist/aos.js></script><script>document.addEventListener("DOMContentLoaded",function(){const t=["GET","POST","PUT","DELETE","PATCH","HEAD","OPTIONS","CONNECT","TRACE"],e=new RegExp(`^(${t.join("|")})\\b`);document.querySelectorAll("code.language-http .line .err").forEach(t=>{const n=t.textContent;e.test(n)&&(t.innerHTML=n.replace(e,function(e){return`<span class="http-method http-method-${e.toUpperCase()}">${e}</span>`}))})})</script></head><body class="single section docs"><p>There are several storages that are used by the WAHA, below you can find the list of them and the way to configure them.</p><div class="mb-2 text-center"><a href=/images/waha/storages/waha-storages.drawio.png target=_blank style=cursor:pointer><img src=/images/waha/storages/waha-storages.drawio.png alt></a><div class="text-center small" style=color:#6c757d>Click to open full size.</div></div><ol><li><a href=#sessions><strong>🖥️ Session</strong> Storage</a> - used to store the session data, such as authentication information, configuration, and other data that is required to keep the session alive and connected to WhatsApp.</li><li><a href=#media><strong>🖼️ Media</strong> Storage</a> - used to store the media files, such as images, videos, and other files that are received from the WhatsApp instance.</li></ol><div class="callout callout-tip d-flex flex-row mt-4 mb-4 pt-4 pe-4 pb-2 ps-3"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="outline/info-circle svg-inline callout-icon me-2 mb-3" id="svg-info-circle" role="img"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 9h.01"/><path d="M11 12h1v4h1"/></svg><div class=callout-content><div class=callout-body><p>You can find complete
<a href=https://github.com/devlikeapro/waha/blob/core/docker-compose.yaml target=_blank><b>docker-compose.yaml</b>
</a>with all storages and other configurations and use it as the starting point for your project.</p></div></div></div><h2 id=features>Features</h2><p>Here&rsquo;s the list of features that are available by <a href=/docs/how-to/engines/><strong>🏭 Engines</strong></a>:</p><div></div><details><summary><strong>🗄️ Storages</strong></summary><table><thead><tr><th>Storage</th><th style=text-align:center>WEBJS</th><th style=text-align:center>NOWEB</th><th style=text-align:center>GOWS</th></tr></thead><tbody><tr><td><strong>Local</strong> - <strong>🖥️ Session</strong></td><td style=text-align:center>✔️</td><td style=text-align:center>✔️</td><td style=text-align:center>✔️</td></tr><tr><td><strong>Local</strong> - <strong>🖼️ Media</strong></td><td style=text-align:center>✔️</td><td style=text-align:center>✔️</td><td style=text-align:center>✔️</td></tr><tr><td><strong>PostgresSQL</strong> - <strong>🖥️ Session</strong></td><td style=text-align:center>➕</td><td style=text-align:center>➕</td><td style=text-align:center>➕</td></tr><tr><td><strong>PostgresSQL</strong> - <strong>🖼️ Media</strong></td><td style=text-align:center>➕</td><td style=text-align:center>➕</td><td style=text-align:center>➕</td></tr><tr><td><strong>S3</strong> - <strong>🖼️ Media</strong></td><td style=text-align:center>➕</td><td style=text-align:center>➕</td><td style=text-align:center>➕</td></tr><tr><td><del>MongoDB - 🖥️ Session</del></td><td style=text-align:center>✔️</td><td style=text-align:center>✔️</td><td style=text-align:center>❌</td></tr></tbody></table><ul><li>➕ - Available in <a href=/docs/how-to/waha-plus/><strong>➕ WAHA Plus</strong></a></li><li>Any <strong>S3 Compatible</strong> storage can be used, such as AWS S3, MinIO, DigitalOcean Spaces, etc. For in-house solutions, you can use <a href=https://min.io/><strong>MinIO</strong></a>.</li><li><strong>MongoDB</strong> is deprecated. Use <strong>PostgresSQL</strong> instead for new installations.</li></ul></details><h2 id=sessions>Sessions</h2><p>The <strong>🖥️ Session</strong> storage is used to store the session data,
such as authentication information, configuration,
and other data that is required to keep the session alive and connected to WhatsApp.</p><p>If you want to save your session and do not scan QR code everytime when you launch WAHA -
you <strong>MUST</strong> connect the session storage to the container.</p><p>For the session storage, you can use the following options:</p><ol><li><a href=#sessions---local><strong>Local</strong></a> - the default option, stores the session data in the local storage using files.</li><li><a href=#sessions---postgresql><strong>PostgreSQL</strong></a> - stores the session data in the PostgreSQL database.</li><li><a href=#sessions---mongodb><strong>MongoDB</strong></a> - stores the session data in the MongoDB database.</li></ol><h2 id=sessions---local>Sessions - Local</h2><p>By default, the WAHA uses the <strong>local storage (files)</strong> to store the session data.</p><div class="callout callout-note d-flex flex-row mt-4 mb-4 pt-4 pe-4 pb-2 ps-3"><div class=callout-content><div class=callout-body><p>It&rsquo;s <strong>well tested solution</strong> event for <strong>production</strong> with multiple sessions</p></div></div></div><div class="callout callout-tip d-flex flex-row mt-4 mb-4 pt-4 pe-4 pb-2 ps-3"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="outline/info-circle svg-inline callout-icon me-2 mb-3" id="svg-info-circle" role="img"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 9h.01"/><path d="M11 12h1v4h1"/></svg><div class=callout-content><div class=callout-body><p>You can find complete
<a href=https://github.com/devlikeapro/waha/blob/core/docker-compose.yaml target=_blank><b>docker-compose.yaml</b>
</a>with all storages and other configurations and use it as the starting point for your project.</p></div></div></div><p>In order to use the local storage and save the session data between the container restarts,
you need to mount the volume to the <code>/app/.sessions</code> directory using the <code>-v</code> option in <code>docker run</code> command:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>-v /path/to/on/host/.sessions:/app/.sessions</span></span></code></pre></div></figure></div><p>The full command to run the WAHA with the local storage and save the session data
in the current directory and <code>.sessions</code> directory:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -v <span class=sb>`</span><span class=nb>pwd</span><span class=sb>`</span>/.sessions:/app/.sessions -p 3000:3000/tcp devlikeapro/waha-plus</span></span></code></pre></div></figure></div><p>This is the only action you need to do to use the local storage - all session data will be available between the container restarts.</p><h3 id=config>Config</h3><ul><li><code>WAHA_LOCAL_STORE_BASE_DIR=/app/.sessions</code> you can override the base directory for the local storage<ul><li>For instance, to handle Azure &ldquo;dot&rdquo; restrictions <a href=https://github.com/devlikeapro/waha/issues/597 target=_blank>#597</a></li></ul></li></ul><h3 id=how-it-works>How it works</h3><p>In the host machine, the session data will be stored in the current directory in the <code>.sessions</code> directory.</p><p>Under the hood, the WAHA stores the session data in the following directory structure:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>.sessions/<span class=o>{</span>engine<span class=o>}</span>/<span class=o>{</span>sessionName<span class=o>}</span>/...</span></span></code></pre></div></figure></div><p>when you
<strong>log out</strong> the session using <a href=/docs/how-to/sessions/#logout-session>POST /api/sessions/{session}/logout</a>
or
<strong>delete</strong> the session using <a href=/docs/how-to/sessions/#delete-session>DELETE /api/sessions/{session}</a>
it removes the directory with the session data.</p><h3 id=health-check>Health Check</h3><p>The <a href=/docs/how-to/waha-plus/>WAHA Plus </a>provides <a href=/docs/how-to/observability/>the health check endpoint</a> that checks the local storage.</p><h2 id=sessions---postgresql>Sessions - PostgreSQL</h2><p>If you want to use the PostgreSQL to store the session data, you need to:</p><ol><li>Start the PostgreSQL server</li><li>Set <code>WHATSAPP_SESSIONS_POSTGRESQL_URL=postgres://postgres:postgres@localhost:5432/postgres?sslmode=disable</code> environment variable to connect to the PostgreSQL server.</li></ol><div class="callout callout-tip d-flex flex-row mt-4 mb-4 pt-4 pe-4 pb-2 ps-3"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="outline/info-circle svg-inline callout-icon me-2 mb-3" id="svg-info-circle" role="img"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 9h.01"/><path d="M11 12h1v4h1"/></svg><div class=callout-content><div class=callout-body><p>You can find complete
<a href=https://github.com/devlikeapro/waha/blob/core/docker-compose.yaml target=_blank><b>docker-compose.yaml</b>
</a>with all storages and other configurations and use it as the starting point for your project.</p></div></div></div><details><summary><b>I want to run >100 sessions on PostgresSQL</b></summary><p>If you see the error:</p><blockquote><p>pg sorry, too many clients already</p></blockquote><p>Make sure to increase the <code>max_connections</code> in the <code>postgresql.conf</code> file or start it with the flag:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>postgres -c <span class=nv>max_connections</span><span class=o>=</span><span class=m>3000</span></span></span></code></pre></div></figure></div></details><h2 id=sessions---mongodb>Sessions - MongoDB</h2><blockquote><p>⚠️ <strong>DEPRECATED</strong> - MongoDB storage is deprecated. Use <strong>PostgresSQL</strong> instead for new installations.</p></blockquote><p>If you want to use the MongoDB to store the session data, you need to:</p><ol><li>Start the MongoDB server (using docker or any other way). You can either start your own MongoDB server or use the one of cloud providers, like <a href=https://www.mongodb.com/atlas/database>MongoDB Atlas</a>.</li><li>Set <code>WHATSAPP_SESSIONS_MONGO_URL=mongodb://user:password@host:port/</code> environment variable to connect to the MongoDB server.</li></ol><p><strong>We recommend using your own MongoDB server as close as possible to WAHA server</strong> for the best performance and security reasons.</p><div class="callout callout-note d-flex flex-row mt-4 mb-4 pt-4 pe-4 pb-2 ps-3"><div class=callout-content><div class=callout-body><p>For <b>WEBJS</b> engine it can take up to 1 minute to save credentials in Mongo Database"</p></div></div></div><h4 id=example>Example</h4><div class="callout callout-tip d-flex flex-row mt-4 mb-4 pt-4 pe-4 pb-2 ps-3"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="outline/info-circle svg-inline callout-icon me-2 mb-3" id="svg-info-circle" role="img"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 9h.01"/><path d="M11 12h1v4h1"/></svg><div class=callout-content><div class=callout-body><p>You can find complete
<a href=https://github.com/devlikeapro/waha/blob/core/docker-compose.yaml target=_blank><b>docker-compose.yaml</b>
</a>with all storages and other configurations and use it as the starting point for your project.</p></div></div></div><p>First, you need to start MongoDB server:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d -p 27017:27017 --name mongodb -v mongo-data:/data/db mongo</span></span></code></pre></div></figure></div><p>Then, you need to run the WAHA with the <code>WHATSAPP_SESSIONS_MONGO_URL</code> environment variable (please note using <code>--network host</code> option as well)</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -e <span class=nv>WHATSAPP_SESSIONS_MONGO_URL</span><span class=o>=</span>mongodb://localhost:27017/ --network host devlikeapro/waha-plus</span></span></code></pre></div></figure></div><p>This is the only action you need to do to use the MongoDB storage -
all session authentication data will be stored in the MongoDB database.</p><h4 id=how-it-works-1>How it works</h4><p>When you start a session, it stores the session data in the MongoDB database in two databases:</p><ol><li><code>waha_{engine}</code> - it saves the session configuration in <code>sessions</code> collection with <code>name: {sessionName}</code> field.</li><li><code>waha_{engine}_{sessionName}</code> - it saves the WhatsApp authentication data and other session data. Each engine saves different data in this database.</li></ol><p>when you
<strong>log out</strong> the session using <a href=/docs/how-to/sessions/#logout-session>POST /api/sessions/{session}/logout</a>
or
<strong>delete</strong> the session using <a href=/docs/how-to/sessions/#delete-session>DELETE /api/sessions/{session}</a>
it removes the session data from both databases.</p><p>For dealing and troubleshooting with the MongoDB, we recommend using <a href=https://www.mongodb.com/products/tools/compass>MongoDB Compass</a>.</p><p><img src=/docs/how-to/storages/waha-mongodb_hu_ff67adf4070cb262.webp width=1845 height=676 decoding=async fetchpriority=auto loading=lazy alt=alt id=h-rh-i-0></p><h4 id=health-check-1>Health Check</h4><p>The <a href=/docs/how-to/waha-plus/>WAHA Plus </a>provides <a href=/docs/how-to/observability/>the health check endpoint</a> that checks the MongoDB connection.</p><h2 id=media>Media</h2><p>When your WhatsApp instance receives media files, it stores them in the media storage.</p><p>You can use the following options to store the media files:</p><ol><li><a href=#media---local><strong>Local</strong></a> - the default option, stores the media files in the local storage using files.</li><li><a href=#media---postgresql><strong>PostgreSQL</strong></a> - stores the media files in the PostgreSQL database.</li><li><a href=#media---s3><strong>S3</strong></a> - stores the media files in the S3 storage.</li></ol><div class="callout callout-tip d-flex flex-row mt-4 mb-4 pt-4 pe-4 pb-2 ps-3"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="outline/info-circle svg-inline callout-icon me-2 mb-3" id="svg-info-circle" role="img"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 9h.01"/><path d="M11 12h1v4h1"/></svg><div class=callout-content><div class=callout-body><p>You can find complete
<a href=https://github.com/devlikeapro/waha/blob/core/docker-compose.yaml target=_blank><b>docker-compose.yaml</b>
</a>with all storages and other configurations and use it as the starting point for your project.</p></div></div></div><div></div><details><summary><strong>🗄️ Storages</strong></summary><table><thead><tr><th>Storage</th><th style=text-align:center>WEBJS</th><th style=text-align:center>NOWEB</th><th style=text-align:center>GOWS</th></tr></thead><tbody><tr><td><strong>Local</strong> - <strong>🖥️ Session</strong></td><td style=text-align:center>✔️</td><td style=text-align:center>✔️</td><td style=text-align:center>✔️</td></tr><tr><td><strong>Local</strong> - <strong>🖼️ Media</strong></td><td style=text-align:center>✔️</td><td style=text-align:center>✔️</td><td style=text-align:center>✔️</td></tr><tr><td><strong>PostgresSQL</strong> - <strong>🖥️ Session</strong></td><td style=text-align:center>➕</td><td style=text-align:center>➕</td><td style=text-align:center>➕</td></tr><tr><td><strong>PostgresSQL</strong> - <strong>🖼️ Media</strong></td><td style=text-align:center>➕</td><td style=text-align:center>➕</td><td style=text-align:center>➕</td></tr><tr><td><strong>S3</strong> - <strong>🖼️ Media</strong></td><td style=text-align:center>➕</td><td style=text-align:center>➕</td><td style=text-align:center>➕</td></tr><tr><td><del>MongoDB - 🖥️ Session</del></td><td style=text-align:center>✔️</td><td style=text-align:center>✔️</td><td style=text-align:center>❌</td></tr></tbody></table><ul><li>➕ - Available in <a href=/docs/how-to/waha-plus/><strong>➕ WAHA Plus</strong></a></li><li>Any <strong>S3 Compatible</strong> storage can be used, such as AWS S3, MinIO, DigitalOcean Spaces, etc. For in-house solutions, you can use <a href=https://min.io/><strong>MinIO</strong></a>.</li><li><strong>MongoDB</strong> is deprecated. Use <strong>PostgresSQL</strong> instead for new installations.</li></ul></details><p>Read more about <a href=/docs/how-to/config/#files>available configuration options -></a>.</p><h2 id=media---local>Media - Local</h2><p>By default, the WAHA uses the <strong>local file storage</strong> to store the media files and those files has a short lifetime (180 seconds).</p><div class="callout callout-tip d-flex flex-row mt-4 mb-4 pt-4 pe-4 pb-2 ps-3"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="outline/info-circle svg-inline callout-icon me-2 mb-3" id="svg-info-circle" role="img"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 9h.01"/><path d="M11 12h1v4h1"/></svg><div class=callout-content><div class=callout-body><p>You can find complete
<a href=https://github.com/devlikeapro/waha/blob/core/docker-compose.yaml target=_blank><b>docker-compose.yaml</b>
</a>with all storages and other configurations and use it as the starting point for your project.</p></div></div></div><p>So it&rsquo;s your app responsibility to download and store them in a safe persistent place during this time.</p><p>If you want to use the local storage and <strong>save the media files between the container restarts for a long time</strong> - you need to:</p><ol><li>Specify a dedicated folder to store the media files using <code>WHATSAPP_FILES_FOLDER=/app/.media</code> environment variable</li><li>Disable automatic media files cleanup using <code>WHATSAPP_FILES_LIFETIME=0</code> environment variable</li><li>Connect the volume to the specified folder using the <code>-v /path/to/files/on/host:/app/.media</code> option in <code>docker run</code> command to the folder specified in <code>WHATSAPP_FILES_FOLDER</code> environment variable.</li></ol><p>Read more about <a href=/docs/how-to/config/#files>available configuration options -></a>.</p><p>Here&rsquo;s all the steps in one command:</p><div class=expressive-code><figure class="frame is-terminal not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -v /path/to/on/host/.media:/app/.media -e <span class=nv>WHATSAPP_FILES_FOLDER</span><span class=o>=</span>/app/.media -e <span class=nv>WHATSAPP_FILES_LIFETIME</span><span class=o>=</span><span class=m>0</span> -p 3000:3000/tcp devlikeapro/waha-plus</span></span></code></pre></div></figure></div><h3 id=health-check-2>Health Check</h3><p>The <a href=/docs/how-to/waha-plus/>WAHA Plus </a>provides <a href=/docs/how-to/observability/>the health check endpoint</a> that checks the local storage.</p><h2 id=media---postgresql>Media - PostgreSQL</h2><p>You can use the PostgreSQL to store the media files.</p><div class="callout callout-tip d-flex flex-row mt-4 mb-4 pt-4 pe-4 pb-2 ps-3"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="outline/info-circle svg-inline callout-icon me-2 mb-3" id="svg-info-circle" role="img"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 9h.01"/><path d="M11 12h1v4h1"/></svg><div class=callout-content><div class=callout-body><p>You can find complete
<a href=https://github.com/devlikeapro/waha/blob/core/docker-compose.yaml target=_blank><b>docker-compose.yaml</b>
</a>with all storages and other configurations and use it as the starting point for your project.</p></div></div></div><p>Configure the following environment variables to use the PostgreSQL storage:</p><ul><li><code>WAHA_MEDIA_STORAGE=POSTGRESQL</code> - enable the PostgreSQL storage</li><li><code>WAHA_MEDIA_POSTGRESQL_URL=postgres://postgres:postgres@localhost:5432/postgres?sslmode=disable</code> - the connection URL to the PostgreSQL database<ul><li>You can use <strong>the same</strong> connection URL as for the <a href=#sessions---postgresql><strong>Sessions - PostgreSQL</strong></a> storage</li></ul></li></ul><h2 id=media---s3>Media - S3</h2><p>You can use the S3 storage to store the media files.</p><p>Any <strong>S3 Compatible</strong> storage can be used, such as AWS S3, MinIO, DigitalOcean Spaces, etc. For in-house solutions, you can use <a href=https://min.io/><strong>MinIO</strong></a>.</p><div class="callout callout-tip d-flex flex-row mt-4 mb-4 pt-4 pe-4 pb-2 ps-3"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="outline/info-circle svg-inline callout-icon me-2 mb-3" id="svg-info-circle" role="img"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1018 0A9 9 0 003 12"/><path d="M12 9h.01"/><path d="M11 12h1v4h1"/></svg><div class=callout-content><div class=callout-body><p>You can find complete
<a href=https://github.com/devlikeapro/waha/blob/core/docker-compose.yaml target=_blank><b>docker-compose.yaml</b>
</a>with all storages and other configurations and use it as the starting point for your project.</p></div></div></div><ul><li><code>WAHA_MEDIA_STORAGE=S3</code> - enable the S3 storage</li><li><code>WAHA_S3_REGION=eu-west-1</code> - the region of the S3 bucket</li><li><code>WAHA_S3_BUCKET=waha</code> - the name of the S3 bucket</li><li><code>WAHA_S3_ACCESS_KEY_ID=minioadmin</code> - the access key of the S3 bucket</li><li><code>WAHA_S3_SECRET_ACCESS_KEY=minioadmin</code> - the secret access key of the S3 bucket</li><li><code>WAHA_S3_ENDPOINT=http://127.0.0.1:9000</code> - the endpoint of the S3 bucket (not required for AWS S3)</li><li><code>WAHA_S3_FORCE_PATH_STYLE=True</code> - force path style for the S3 bucket (not required for AWS S3)</li><li><code>WAHA_S3_PROXY_FILES</code> - proxy media files through WAHA (<code>False</code> by default)<ul><li><code>WAHA_S3_PROXY_FILES=False</code> - generate pre-signed URLs for media files and send them to the client in <code>media.url</code></li><li><code>WAHA_S3_PROXY_FILES=True</code> - WAHA will proxy media files through itself in <code>media.url</code></li></ul></li></ul><p>After you enabled S3 here&rsquo;s example for <a href=/docs/how-to/events/#message><strong>message</strong></a> webhook payload:</p><div class=expressive-code><figure class="frame has-title not-content"><figcaption class=header><span class=title>message</span></figcaption><div class=highlight title=message><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;event&#34;</span><span class=p>:</span> <span class=s2>&#34;message&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;session&#34;</span><span class=p>:</span> <span class=s2>&#34;default&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;engine&#34;</span><span class=p>:</span> <span class=s2>&#34;WEBJS&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;payload&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;true_11111111111@c.us_AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;hasMedia&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;media&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;http://localhost:3000/api/files/true_11111111111@c.us_AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.jpg&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;mimetype&#34;</span><span class=p>:</span> <span class=s2>&#34;image/jpeg&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;filename&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;s3&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Bucket&#34;</span><span class=p>:</span> <span class=s2>&#34;bucket-name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Key&#34;</span><span class=p>:</span> <span class=s2>&#34;/default/true_11111111111@c.us_AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.jpg&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>null</span> <span class=c1>// if there was an error during file download
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=err>...</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></figure></div><p>in addition to <code>media.*</code> field it will have <code>media.s3.*</code> field with the S3 bucket information.</p><h3 id=s3-metadata>S3 Metadata</h3><p>Each file saved in S3 has additional metadata:</p><ul><li><code>X-Amz-Meta-Waha-Session=default</code> - the session name</li><li><code>X-Amz-Meta-Waha-Message-Id=true_111...</code> - the message ID</li><li><code>X-Amz-Meta-Waha-Media-File-Name=media.jpg</code> - the media file name (if available)</li></ul><p>This line is from <code>./layouts/_default/single.html</code>.</p><script async src=/js/bootstrap.c673c84373e66019f7895efc74b3b3b940071832aaa8a85e73218087d535e71b.js integrity="sha256-xnPIQ3PmYBn3iV78dLOzuUAHGDKqqKhecyGAh9U15xs="></script><script async src=/js/app.c17553444ec7c62f781ddbaa011948f6d85a1bab49420047d68a2b89852a8b36.js integrity="sha256-wXVTRE7Hxi94HduqARlI9thaG6tJQgBH1ooriYUqizY="></script><script async src=/js/docsearch.cfae25fd02560b1d08c4065fa744efbf59bdaf3e4d6a7bf8652794f322a813c9.js integrity="sha256-z64l/QJWCx0IxAZfp0Tvv1m9rz5Nanv4ZSeU8yKoE8k="></script></body></html>